require=function e(t,r,a){function i(n,o){if(!r[n]){if(!t[n]){var l=typeof require=="function"&&require;if(!o&&l)return l(n,!0);if(s)return s(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[n]={exports:{}};t[n][0].call(f.exports,function(e){var r=t[n][1][e];return i(r?r:e)},f,f.exports,e,t,r,a)}return r[n].exports}var s=typeof require=="function"&&require;for(var n=0;n<a.length;n++)i(a[n]);return i}({1:[function(e,t,r){"use strict";var a=e("./lib/aglsl");r.aglsl=a;var i=e("./lib/attributes");r.attributes=i;var s=e("./lib/base");r.base=s;var n=e("./lib/events");r.events=n;var o=e("./lib/image");r.image=o;var l=e("./lib/library");r.library=l;var u=e("./lib/managers");r.managers=u;var f=e("awayjs-core/lib/attributes/AttributesBuffer");var g=e("awayjs-core/lib/image/BitmapImage2D");var c=e("awayjs-core/lib/image/BitmapImageCube");var h=e("awayjs-core/lib/image/Image2D");var p=e("awayjs-core/lib/image/ImageCube");var _=e("awayjs-core/lib/image/SpecularImage2D");var d=e("awayjs-core/lib/image/Sampler2D");var m=e("awayjs-core/lib/image/SamplerCube");s.Stage.registerAbstraction(i.GL_AttributesBuffer,f.AttributesBuffer);s.Stage.registerAbstraction(o.GL_RenderImage2D,h.Image2D);s.Stage.registerAbstraction(o.GL_RenderImageCube,p.ImageCube);s.Stage.registerAbstraction(o.GL_BitmapImage2D,g.BitmapImage2D);s.Stage.registerAbstraction(o.GL_BitmapImageCube,c.BitmapImageCube);s.Stage.registerAbstraction(o.GL_BitmapImage2D,_.SpecularImage2D);s.Stage.registerAbstraction(o.GL_Sampler2D,d.Sampler2D);s.Stage.registerAbstraction(o.GL_SamplerCube,m.SamplerCube)},{"./lib/aglsl":"awayjs-stagegl/lib/aglsl","./lib/attributes":"awayjs-stagegl/lib/attributes","./lib/base":"awayjs-stagegl/lib/base","./lib/events":"awayjs-stagegl/lib/events","./lib/image":"awayjs-stagegl/lib/image","./lib/library":"awayjs-stagegl/lib/library","./lib/managers":"awayjs-stagegl/lib/managers","awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/image/BitmapImage2D":undefined,"awayjs-core/lib/image/BitmapImageCube":undefined,"awayjs-core/lib/image/Image2D":undefined,"awayjs-core/lib/image/ImageCube":undefined,"awayjs-core/lib/image/Sampler2D":undefined,"awayjs-core/lib/image/SamplerCube":undefined,"awayjs-core/lib/image/SpecularImage2D":undefined}],"awayjs-stagegl/lib/aglsl/AGALTokenizer":[function(e,t,r){"use strict";var a=e("../aglsl/Description");var i=e("../aglsl/Header");var s=e("../aglsl/Mapping");var n=e("../aglsl/Token");var o=function(){function e(){}e.prototype.decribeAGALByteArray=function(e){var t=new i.Header;if(e.readUnsignedByte()!=160){throw"Bad AGAL: Missing 0xa0 magic byte."}t.version=e.readUnsignedInt();if(t.version>=16){e.readUnsignedByte();t.version>>=1}if(e.readUnsignedByte()!=161){throw"Bad AGAL: Missing 0xa1 magic byte."}t.progid=e.readUnsignedByte();switch(t.progid){case 1:t.type="fragment";break;case 0:t.type="vertex";break;case 2:t.type="cpu";break;default:t.type="";break}var r=new a.Description;var o=[];while(e.position<e.length){var l=new n.Token;l.opcode=e.readUnsignedInt();var u=s.Mapping.agal2glsllut[l.opcode];if(!u){throw"Opcode not valid or not implemented yet: "+l.opcode}if(u.matrixheight){r.hasmatrix=true}if(u.dest){l.dest.regnum=e.readUnsignedShort();l.dest.mask=e.readUnsignedByte();l.dest.regtype=e.readUnsignedByte();r.regwrite[l.dest.regtype][l.dest.regnum]|=l.dest.mask}else{l.dest=null;e.readUnsignedInt()}if(u.a){this.readReg(l.a,1,r,e)}else{l.a=null;e.readUnsignedInt();e.readUnsignedInt()}if(u.b){this.readReg(l.b,u.matrixheight|0,r,e)}else{l.b=null;e.readUnsignedInt();e.readUnsignedInt()}o.push(l)}r.header=t;r.tokens=o;return r};e.prototype.readReg=function(e,t,r,a){e.regnum=a.readUnsignedShort();e.indexoffset=a.readByte();e.swizzle=a.readUnsignedByte();e.regtype=a.readUnsignedByte();r.regread[e.regtype][e.regnum]=15;if(e.regtype==5){e.lodbiad=e.indexoffset;e.indexoffset=undefined;e.swizzle=undefined;e.readmode=a.readUnsignedByte();e.dim=e.readmode>>4;e.readmode&=15;e.special=a.readUnsignedByte();e.wrap=e.special>>4;e.special&=15;e.mipmap=a.readUnsignedByte();e.filter=e.mipmap>>4;e.mipmap&=15;r.samplers[e.regnum]=e}else{e.indexregtype=a.readUnsignedByte();e.indexselect=a.readUnsignedByte();e.indirectflag=a.readUnsignedByte()}if(e.indirectflag){r.hasindirect=true}if(!e.indirectflag&&t){for(var i=0;i<t;i++){r.regread[e.regtype][e.regnum+i]=r.regread[e.regtype][e.regnum]}}};return e}();r.AGALTokenizer=o},{"../aglsl/Description":"awayjs-stagegl/lib/aglsl/Description","../aglsl/Header":"awayjs-stagegl/lib/aglsl/Header","../aglsl/Mapping":"awayjs-stagegl/lib/aglsl/Mapping","../aglsl/Token":"awayjs-stagegl/lib/aglsl/Token"}],"awayjs-stagegl/lib/aglsl/AGLSLParser":[function(e,t,r){"use strict";var a=e("../aglsl/Mapping");var i=function(){function e(){}e.prototype.parse=function(e){var t="";var r="";t+="precision highp float;\n";var i=e.header.type[0];if(e.header.type=="vertex"){t+="uniform float yflip;\n"}var s=e.regread[1].length;if(s>0)t+="uniform vec4 "+i+"c["+s+"];\n";for(var n=0;n<e.regread[2].length||n<e.regwrite[2].length;n++){if(e.regread[2][n]||e.regwrite[2][n]){t+="vec4 "+i+"t"+n+";\n"}}for(var n=0;n<e.regread[0].length;n++){if(e.regread[0][n]){t+="attribute vec4 va"+n+";\n"}}for(var n=0;n<e.regread[4].length||n<e.regwrite[4].length;n++){if(e.regread[4][n]||e.regwrite[4][n]){t+="varying vec4 vi"+n+";\n"}}var o=["2D","Cube","3D",""];for(var n=0;n<e.samplers.length;n++){if(e.samplers[n]){t+="uniform sampler"+o[e.samplers[n].dim&3]+" fs"+n+";\n"}}if(e.header.type=="vertex"){t+="vec4 outpos;\n"}if(e.writedepth){t+="vec4 tmp_FragDepth;\n"}var l=false;r+="void main() {\n";for(var n=0;n<e.tokens.length;n++){var u=a.Mapping.agal2glsllut[e.tokens[n].opcode];if(u.s.indexOf("dFdx")!=-1||u.s.indexOf("dFdy")!=-1)l=true;if(!u){throw"Opcode not valid or not implemented yet: "}var f=u.matrixheight||1;for(var g=0;g<f;g++){var c="  "+u.s;if(e.tokens[n].dest){if(u.matrixheight){if((e.tokens[n].dest.mask>>g&1)!=1){continue}var h=this.regtostring(e.tokens[n].dest.regtype,e.tokens[n].dest.regnum,e,i);var p="float";var _=["x","y","z","w"][g];h+="."+_}else{var h=this.regtostring(e.tokens[n].dest.regtype,e.tokens[n].dest.regnum,e,i);var p;var _;if(e.tokens[n].dest.mask!=15){var d=0;_="";if(e.tokens[n].dest.mask&1){d++;_+="x"}if(e.tokens[n].dest.mask&2){d++;_+="y"}if(e.tokens[n].dest.mask&4){d++;_+="z"}if(e.tokens[n].dest.mask&8){d++;_+="w"}h+="."+_;switch(d){case 1:p="float";break;case 2:p="vec2";break;case 3:p="vec3";break;default:throw"Unexpected destination mask"}}else{p="vec4";_="xyzw"}}c=c.replace("%dest",h);c=c.replace("%cast",p);c=c.replace("%dm",_)}var m=15;if(!u.ndwm&&u.dest&&e.tokens[n].dest){m=e.tokens[n].dest.mask}if(e.tokens[n].a){c=c.replace("%a",this.sourcetostring(e.tokens[n].a,0,m,u.scalar,e,i))}if(e.tokens[n].b){c=c.replace("%b",this.sourcetostring(e.tokens[n].b,g,m,u.scalar,e,i));if(e.tokens[n].b.regtype==5){var b=["2D","Cube","3D"][e.tokens[n].b.dim];var v=["vec2","vec3","vec3"][e.tokens[n].b.dim];c=c.replace("%texdim",b);c=c.replace("%texsize",v);var x="";c=c.replace("%lod",x)}}r+=c}}if(e.header.type=="vertex"){r+="  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n"}if(l&&e.header.type=="fragment"){t="#extension GL_OES_standard_derivatives : enable\n"+t}if(e.writedepth){r+="  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n"}r+="}\n";return t+r};e.prototype.regtostring=function(e,t,r,a){switch(e){case 0:return"va"+t;case 1:return r.header.type[0]+"c["+t+"]";case 2:return a+"t"+t;case 3:return r.header.type=="vertex"?"outpos":"gl_FragColor";case 4:return"vi"+t;case 5:return"fs"+t;case 6:return"tmp_FragDepth";default:throw"Unknown register type"}};e.prototype.sourcetostring=function(e,t,r,a,i,s){var n=["x","y","z","w"];var o;if(e.indirectflag){o="vcarrr[int("+this.regtostring(e.indexregtype,e.regnum,i,s)+"."+n[e.indexselect]+")";var l=t+e.indexoffset;if(l<0)o+=l.toString();if(l>0)o+="+"+l.toString();o+="]"}else{o=this.regtostring(e.regtype,e.regnum+t,i,s)}if(e.regtype==5){return o}if(a){return o+"."+n[e.swizzle>>0&3]}if(e.swizzle==228&&r==15){return o}o+=".";if(r&1)o+=n[e.swizzle>>0&3];if(r&2)o+=n[e.swizzle>>2&3];if(r&4)o+=n[e.swizzle>>4&3];if(r&8)o+=n[e.swizzle>>6&3];return o};e.maxvertexconstants=128;e.maxfragconstants=28;e.maxtemp=8;e.maxstreams=8;e.maxtextures=8;return e}();r.AGLSLParser=i},{"../aglsl/Mapping":"awayjs-stagegl/lib/aglsl/Mapping"}],"awayjs-stagegl/lib/aglsl/Description":[function(e,t,r){"use strict";var a=e("../aglsl/Header");var i=function(){function e(){this.regread=[[],[],[],[],[],[],[]];this.regwrite=[[],[],[],[],[],[],[]];this.hasindirect=false;this.writedepth=false;this.hasmatrix=false;this.samplers=[];this.tokens=[];this.header=new a.Header}return e}();r.Description=i},{"../aglsl/Header":"awayjs-stagegl/lib/aglsl/Header"}],"awayjs-stagegl/lib/aglsl/Destination":[function(e,t,r){"use strict";var a=function(){function e(){this.mask=0;this.regnum=0;this.regtype=0;this.dim=0;this.indexoffset=0;this.swizzle=0;this.lodbiad=0;this.readmode=0;this.special=0;this.wrap=0;this.filter=0;this.indexregtype=0;this.indexselect=0;this.indirectflag=0}return e}();r.Destination=a},{}],"awayjs-stagegl/lib/aglsl/Header":[function(e,t,r){"use strict";var a=function(){function e(){this.progid=0;this.version=0;this.type=""}return e}();r.Header=a},{}],"awayjs-stagegl/lib/aglsl/Mapping":[function(e,t,r){"use strict";var a=e("../aglsl/OpLUT");var i=function(){function e(e){}e.agal2glsllut=[new a.OpLUT("%dest = %cast(%a);\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(%a + %b);\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(%a - %b);\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(%a * %b);\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(%a / %b);\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(1.0) / %a;\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(min(%a,%b));\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(max(%a,%b));\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(fract(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(sqrt(abs(%a)));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(inversesqrt(abs(%a)));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(pow(abs(%a),%b));\n",0,true,true,true,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(log2(abs(%a)));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(exp2(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(normalize(vec3( %a ) ));\n",0,true,true,false,null,null,true,null,null,null),new a.OpLUT("%dest = %cast(sin(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(cos(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(cross(vec3(%a),vec3(%b)));\n",0,true,true,true,null,null,true,null,null,null),new a.OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",0,true,true,true,null,null,true,null,null,null),new a.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",0,true,true,true,null,null,true,null,null,null),new a.OpLUT("%dest = %cast(abs(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(%a * -1.0);\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(clamp(%a,0.0,1.0));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",null,true,true,true,3,3,true,null,null,null),new a.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,true,true,true,4,4,true,null,null,null),new a.OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,true,true,true,4,3,true,null,null,null),new a.OpLUT("%dest = %cast(dFdx(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(dFdy(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("if (float(%a)==float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new a.OpLUT("if (float(%a)!=float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new a.OpLUT("if (float(%a)>=float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new a.OpLUT("if (float(%a)<float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new a.OpLUT("} else {;\n",0,false,false,false,null,null,null,null,null,null),new a.OpLUT("};\n",0,false,false,false,null,null,null,null,null,null),new a.OpLUT(null,null,null,null,false,null,null,null,null,null,null),new a.OpLUT(null,null,null,null,false,null,null,null,null,null,null),new a.OpLUT(null,null,null,null,false,null,null,null,null,null,null),new a.OpLUT(null,null,null,null,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\n",null,true,true,true,null,null,null,null,true,null),new a.OpLUT("if ( float(%a)<0.0 ) discard;\n",null,false,true,false,null,null,null,true,null,null),new a.OpLUT("%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\n",null,true,true,true,null,null,true,null,true,true),new a.OpLUT("%dest = %cast(greaterThanEqual(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null),new a.OpLUT("%dest = %cast(lessThan(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null),new a.OpLUT("%dest = %cast(sign(%a));\n",0,true,true,false,null,null,null,null,null,null),new a.OpLUT("%dest = %cast(equal(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null),new a.OpLUT("%dest = %cast(notEqual(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null)];return e}();r.Mapping=i},{"../aglsl/OpLUT":"awayjs-stagegl/lib/aglsl/OpLUT"}],"awayjs-stagegl/lib/aglsl/OpLUT":[function(e,t,r){"use strict";var a=function(){function e(e,t,r,a,i,s,n,o,l,u,f){this.s=e;this.flags=t;this.dest=r;this.a=a;this.b=i;this.matrixwidth=s;this.matrixheight=n;this.ndwm=o;this.scalar=l;this.dm=u;this.lod=f}return e}();r.OpLUT=a},{}],"awayjs-stagegl/lib/aglsl/Token":[function(e,t,r){"use strict";var a=e("../aglsl/Destination");var i=function(){function e(){this.dest=new a.Destination;this.opcode=0;this.a=new a.Destination;this.b=new a.Destination}return e}();r.Token=i},{"../aglsl/Destination":"awayjs-stagegl/lib/aglsl/Destination"}],"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":[function(e,t,r){"use strict";var a=e("../../aglsl/assembler/OpcodeMap");var i=e("../../aglsl/assembler/Part");var s=e("../../aglsl/assembler/RegMap");var n=e("../../aglsl/assembler/SamplerMap");var o=function(){function e(){this.r={};this.cur=new i.Part}e.prototype.assemble=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}if(!r){r=1}if(t){this.addHeader(t,r)}var a=e.replace(/[\f\n\r\v]+/g,"\n").split("\n");for(var i in a){this.processLine(a[i],i)}return this.r};e.prototype.processLine=function(e,t){var r=e.search("//");if(r!=-1){e=e.slice(0,r)}e=e.replace(/^\s+|\s+$/g,"");if(!(e.length>0)){return}var i=e.search(/<.*>/g);var s=null;if(i!=-1){s=e.slice(i).match(/([\w\.\-\+]+)/gi);e=e.slice(0,i)}var n=e.match(/([\w\.\+\[\]]+)/gi);if(!n||n.length<1){if(e.length>=3){console.log("Warning: bad line "+t+": "+e)}return}switch(n[0]){case"part":this.addHeader(n[1],Number(n[2]));break;case"endpart":if(!this.cur){throw"Unexpected endpart"}this.cur.data.position=0;this.cur=null;return;default:if(!this.cur){console.log("Warning: bad line "+t+": "+e+" (Outside of any part definition)");return}if(this.cur.name=="comment"){return}var o=a.OpcodeMap.map[n[0]];if(!o){throw"Bad opcode "+n[0]+" "+t+": "+e}this.emitOpcode(this.cur,o.opcode);var l=1;if(o.dest&&o.dest!="none"){if(!this.emitDest(this.cur,n[l++],o.dest)){throw"Bad destination register "+n[l-1]+" "+t+": "+e}}else{this.emitZeroDword(this.cur)}if(o.a&&o.a.format!="none"){if(!this.emitSource(this.cur,n[l++],o.a))throw"Bad source register "+n[l-1]+" "+t+": "+e}else{this.emitZeroQword(this.cur)}if(o.b&&o.b.format!="none"){if(o.b.format=="sampler"){if(!this.emitSampler(this.cur,n[l++],o.b,s)){throw"Bad sampler register "+n[l-1]+" "+t+": "+e}}else{if(!this.emitSource(this.cur,n[l++],o.b)){throw"Bad source register "+n[l-1]+" "+t+": "+e}}}else{this.emitZeroQword(this.cur)}break}};e.prototype.emitHeader=function(e){e.data.writeUnsignedByte(160);e.data.writeUnsignedInt(e.version);if(e.version>=16){e.data.writeUnsignedByte(0)}e.data.writeUnsignedByte(161);switch(e.name){case"fragment":e.data.writeUnsignedByte(1);break;case"vertex":e.data.writeUnsignedByte(0);break;case"cpu":e.data.writeUnsignedByte(2);break;default:e.data.writeUnsignedByte(255);break}};e.prototype.emitOpcode=function(e,t){e.data.writeUnsignedInt(t)};e.prototype.emitZeroDword=function(e){e.data.writeUnsignedInt(0)};e.prototype.emitZeroQword=function(e){e.data.writeUnsignedInt(0);e.data.writeUnsignedInt(0)};e.prototype.emitDest=function(e,t,r){var a=t.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!s.RegMap.map[a[1]])return false;var i={num:a[2]?a[2]:0,code:s.RegMap.map[a[1]].code,mask:this.stringToMask(a[3])};e.data.writeUnsignedShort(i.num);e.data.writeUnsignedByte(i.mask);e.data.writeUnsignedByte(i.code);return true};e.prototype.stringToMask=function(e){if(!e)return 15;var t=0;if(e.indexOf("x")!=-1)t|=1;if(e.indexOf("y")!=-1)t|=2;if(e.indexOf("z")!=-1)t|=4;if(e.indexOf("w")!=-1)t|=8;return t};e.prototype.stringToSwizzle=function(e){if(!e){return 228}var t={x:0,y:1,z:2,w:3};var r=0;if(e.charAt(0)!="."){throw"Missing . for swizzle"}if(e.length>1){r|=t[e.charAt(1)]}if(e.length>2){r|=t[e.charAt(2)]<<2}else{r|=(r&3)<<2}if(e.length>3){r|=t[e.charAt(3)]<<4}else{r|=(r&3<<2)<<2}if(e.length>4){r|=t[e.charAt(4)]<<6}else{r|=(r&3<<4)<<2}return r};e.prototype.emitSampler=function(e,t,r,a){var i=t.match(/fs(\d*)/i);if(!i||!i[1]){return false}e.data.writeUnsignedShort(parseInt(i[1]));e.data.writeUnsignedByte(0);e.data.writeUnsignedByte(0);var s=5;var o=0;for(var l=0;l<a.length;l++){var u=n.SamplerMap.map[a[l].toLowerCase()];if(u){if((o>>u.shift&u.mask)!=0){console.log("Warning, duplicate sampler option")}o|=u.mask<<u.shift;s&=~(u.mask<<u.shift);s|=u.value<<u.shift}else{console.log("Warning, unknown sampler option: ",a[l])}}e.data.writeUnsignedInt(s);return true};e.prototype.emitSource=function(e,t,r){var a=t.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i);var i;if(a){if(!s.RegMap.map[a[1]]){return false}var n={x:0,y:1,z:2,w:3};var o={num:a[2]|0,code:s.RegMap.map[a[1]].code,swizzle:this.stringToSwizzle(a[5]),select:n[a[3]],offset:a[4]|0};e.data.writeUnsignedShort(o.num);e.data.writeByte(o.offset);e.data.writeUnsignedByte(o.swizzle);e.data.writeUnsignedByte(1);e.data.writeUnsignedByte(o.code);e.data.writeUnsignedByte(o.select);e.data.writeUnsignedByte(1<<7)}else{i=t.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!s.RegMap.map[i[1]]){return false}var o={num:i[2]|0,code:s.RegMap.map[i[1]].code,swizzle:this.stringToSwizzle(i[3])};e.data.writeUnsignedShort(o.num);e.data.writeUnsignedByte(0);e.data.writeUnsignedByte(o.swizzle);e.data.writeUnsignedByte(o.code);e.data.writeUnsignedByte(0);e.data.writeUnsignedByte(0);e.data.writeUnsignedByte(0)}return true};e.prototype.addHeader=function(e,t){if(!t){t=1}if(this.r[e]==undefined){this.r[e]=new i.Part(e,t);this.emitHeader(this.r[e])}else if(this.r[e].version!=t){throw"Multiple versions for part "+e}this.cur=this.r[e]};return e}();r.AGALMiniAssembler=o},{"../../aglsl/assembler/OpcodeMap":"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap","../../aglsl/assembler/Part":"awayjs-stagegl/lib/aglsl/assembler/Part","../../aglsl/assembler/RegMap":"awayjs-stagegl/lib/aglsl/assembler/RegMap","../../aglsl/assembler/SamplerMap":"awayjs-stagegl/lib/aglsl/assembler/SamplerMap"}],"awayjs-stagegl/lib/aglsl/assembler/FS":[function(e,t,r){"use strict";var a=function(){function e(){}return e}();r.FS=a},{}],"awayjs-stagegl/lib/aglsl/assembler/Flags":[function(e,t,r){"use strict";var a=function(){function e(){}return e}();r.Flags=a},{}],"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap":[function(e,t,r){"use strict";var a=e("../../aglsl/assembler/Opcode");var i=function(){function e(){}Object.defineProperty(e,"map",{get:function(){if(!e._map){e._map=new Array;e._map["mov"]=new a.Opcode("vector","vector",4,"none",0,0,true,null,null,null);e._map["add"]=new a.Opcode("vector","vector",4,"vector",4,1,true,null,null,null);e._map["sub"]=new a.Opcode("vector","vector",4,"vector",4,2,true,null,null,null);e._map["mul"]=new a.Opcode("vector","vector",4,"vector",4,3,true,null,null,null);e._map["div"]=new a.Opcode("vector","vector",4,"vector",4,4,true,null,null,null);e._map["rcp"]=new a.Opcode("vector","vector",4,"none",0,5,true,null,null,null);e._map["min"]=new a.Opcode("vector","vector",4,"vector",4,6,true,null,null,null);e._map["max"]=new a.Opcode("vector","vector",4,"vector",4,7,true,null,null,null);e._map["frc"]=new a.Opcode("vector","vector",4,"none",0,8,true,null,null,null);e._map["sqt"]=new a.Opcode("vector","vector",4,"none",0,9,true,null,null,null);e._map["rsq"]=new a.Opcode("vector","vector",4,"none",0,10,true,null,null,null);e._map["pow"]=new a.Opcode("vector","vector",4,"vector",4,11,true,null,null,null);e._map["log"]=new a.Opcode("vector","vector",4,"none",0,12,true,null,null,null);e._map["exp"]=new a.Opcode("vector","vector",4,"none",0,13,true,null,null,null);e._map["nrm"]=new a.Opcode("vector","vector",4,"none",0,14,true,null,null,null);e._map["sin"]=new a.Opcode("vector","vector",4,"none",0,15,true,null,null,null);e._map["cos"]=new a.Opcode("vector","vector",4,"none",0,16,true,null,null,null);e._map["crs"]=new a.Opcode("vector","vector",4,"vector",4,17,true,true,null,null);e._map["dp3"]=new a.Opcode("vector","vector",4,"vector",4,18,true,true,null,null);e._map["dp4"]=new a.Opcode("vector","vector",4,"vector",4,19,true,true,null,null);e._map["abs"]=new a.Opcode("vector","vector",4,"none",0,20,true,null,null,null);e._map["neg"]=new a.Opcode("vector","vector",4,"none",0,21,true,null,null,null);e._map["sat"]=new a.Opcode("vector","vector",4,"none",0,22,true,null,null,null);e._map["ted"]=new a.Opcode("vector","vector",4,"sampler",1,38,true,null,true,null);e._map["kil"]=new a.Opcode("none","scalar",1,"none",0,39,true,null,true,null);e._map["tex"]=new a.Opcode("vector","vector",4,"sampler",1,40,true,null,true,null);e._map["m33"]=new a.Opcode("vector","matrix",3,"vector",3,23,true,null,null,true);e._map["m44"]=new a.Opcode("vector","matrix",4,"vector",4,24,true,null,null,true);e._map["m43"]=new a.Opcode("vector","matrix",3,"vector",4,25,true,null,null,true);e._map["ddx"]=new a.Opcode("vector","vector",4,"none",0,26,true,null,true,null);e._map["ddy"]=new a.Opcode("vector","vector",4,"none",0,27,true,null,true,null);e._map["sge"]=new a.Opcode("vector","vector",4,"vector",4,41,true,null,null,null);e._map["slt"]=new a.Opcode("vector","vector",4,"vector",4,42,true,null,null,null);e._map["sgn"]=new a.Opcode("vector","vector",4,"vector",4,43,true,null,null,null);e._map["seq"]=new a.Opcode("vector","vector",4,"vector",4,44,true,null,null,null);e._map["sne"]=new a.Opcode("vector","vector",4,"vector",4,45,true,null,null,null)}return e._map},enumerable:true,configurable:true});return e}();r.OpcodeMap=i},{"../../aglsl/assembler/Opcode":"awayjs-stagegl/lib/aglsl/assembler/Opcode"}],"awayjs-stagegl/lib/aglsl/assembler/Opcode":[function(e,t,r){"use strict";var a=e("../../aglsl/assembler/Flags");var i=e("../../aglsl/assembler/FS");var s=function(){function e(e,t,r,s,n,o,l,u,f,g){this.a=new i.FS;this.b=new i.FS;this.flags=new a.Flags;this.dest=e;this.a.format=t;this.a.size=r;this.b.format=s;this.b.size=n;this.opcode=o;this.flags.simple=l;this.flags.horizontal=u;this.flags.fragonly=f;this.flags.matrix=g}return e}();r.Opcode=s},{"../../aglsl/assembler/FS":"awayjs-stagegl/lib/aglsl/assembler/FS","../../aglsl/assembler/Flags":"awayjs-stagegl/lib/aglsl/assembler/Flags"}],"awayjs-stagegl/lib/aglsl/assembler/Part":[function(e,t,r){"use strict";var a=e("awayjs-core/lib/utils/ByteArray");var i=function(){function e(e,t){if(e===void 0){e=null}if(t===void 0){t=null}this.name="";this.version=0;this.name=e;this.version=t;this.data=new a.ByteArray}return e}();r.Part=i},{"awayjs-core/lib/utils/ByteArray":undefined}],"awayjs-stagegl/lib/aglsl/assembler/RegMap":[function(e,t,r){"use strict";var a=function(){function e(e,t){this.code=e;this.desc=t}return e}();var i=function(){function e(){}Object.defineProperty(e,"map",{get:function(){if(!e._map){e._map=new Array;e._map["va"]=new a(0,"vertex attribute");e._map["fc"]=new a(1,"fragment constant");e._map["vc"]=new a(1,"vertex constant");e._map["ft"]=new a(2,"fragment temporary");e._map["vt"]=new a(2,"vertex temporary");e._map["vo"]=new a(3,"vertex output");e._map["op"]=new a(3,"vertex output");e._map["fd"]=new a(3,"fragment depth output");e._map["fo"]=new a(3,"fragment output");e._map["oc"]=new a(3,"fragment output");e._map["v"]=new a(4,"varying");e._map["vi"]=new a(4,"varying output");e._map["fi"]=new a(4,"varying input");e._map["fs"]=new a(5,"sampler")}return e._map},enumerable:true,configurable:true});return e}();r.RegMap=i},{}],"awayjs-stagegl/lib/aglsl/assembler/SamplerMap":[function(e,t,r){"use strict";var a=e("../../aglsl/assembler/Sampler");var i=function(){function e(){}Object.defineProperty(e,"map",{get:function(){if(!e._map){e._map=new Array;e._map["rgba"]=new a.Sampler(8,15,0);e._map["rg"]=new a.Sampler(8,15,5);e._map["r"]=new a.Sampler(8,15,4);e._map["compressed"]=new a.Sampler(8,15,1);e._map["compressed_alpha"]=new a.Sampler(8,15,2);e._map["dxt1"]=new a.Sampler(8,15,1);e._map["dxt5"]=new a.Sampler(8,15,2);e._map["2d"]=new a.Sampler(12,15,0);e._map["cube"]=new a.Sampler(12,15,1);e._map["3d"]=new a.Sampler(12,15,2);e._map["centroid"]=new a.Sampler(16,1,1);e._map["ignoresampler"]=new a.Sampler(16,4,4);e._map["clamp"]=new a.Sampler(20,15,0);e._map["repeat"]=new a.Sampler(20,15,1);e._map["wrap"]=new a.Sampler(20,15,1);e._map["nomip"]=new a.Sampler(24,15,0);e._map["mipnone"]=new a.Sampler(24,15,0);e._map["mipnearest"]=new a.Sampler(24,15,1);e._map["miplinear"]=new a.Sampler(24,15,2);e._map["nearest"]=new a.Sampler(28,15,0);e._map["linear"]=new a.Sampler(28,15,1)}return e._map},enumerable:true,configurable:true});return e}();r.SamplerMap=i},{"../../aglsl/assembler/Sampler":"awayjs-stagegl/lib/aglsl/assembler/Sampler"}],"awayjs-stagegl/lib/aglsl/assembler/Sampler":[function(e,t,r){"use strict";var a=function(){function e(e,t,r){this.shift=e;this.mask=t;this.value=r}return e}();r.Sampler=a},{}],"awayjs-stagegl/lib/aglsl":[function(e,t,r){"use strict";var a=e("./aglsl/assembler/AGALMiniAssembler");r.AGALMiniAssembler=a.AGALMiniAssembler;var i=e("./aglsl/assembler/Flags");r.Flags=i.Flags;var s=e("./aglsl/assembler/FS");r.FS=s.FS;var n=e("./aglsl/assembler/Opcode");r.Opcode=n.Opcode;var o=e("./aglsl/assembler/OpcodeMap");r.OpcodeMap=o.OpcodeMap;var l=e("./aglsl/assembler/Part");r.Part=l.Part;var u=e("./aglsl/assembler/RegMap");r.RegMap=u.RegMap;var f=e("./aglsl/assembler/Sampler");r.Sampler=f.Sampler;var g=e("./aglsl/assembler/SamplerMap");r.SamplerMap=g.SamplerMap;var c=e("./aglsl/AGALTokenizer");r.AGALTokenizer=c.AGALTokenizer;var h=e("./aglsl/AGLSLParser");r.AGLSLParser=h.AGLSLParser;var p=e("./aglsl/Description");r.Description=p.Description;var _=e("./aglsl/Destination");r.Destination=_.Destination;var d=e("./aglsl/Header");r.Header=d.Header;var m=e("./aglsl/Mapping");r.Mapping=m.Mapping;var b=e("./aglsl/OpLUT");r.OpLUT=b.OpLUT;var v=e("./aglsl/Token");r.Token=v.Token},{"./aglsl/AGALTokenizer":"awayjs-stagegl/lib/aglsl/AGALTokenizer","./aglsl/AGLSLParser":"awayjs-stagegl/lib/aglsl/AGLSLParser","./aglsl/Description":"awayjs-stagegl/lib/aglsl/Description","./aglsl/Destination":"awayjs-stagegl/lib/aglsl/Destination","./aglsl/Header":"awayjs-stagegl/lib/aglsl/Header","./aglsl/Mapping":"awayjs-stagegl/lib/aglsl/Mapping","./aglsl/OpLUT":"awayjs-stagegl/lib/aglsl/OpLUT","./aglsl/Token":"awayjs-stagegl/lib/aglsl/Token","./aglsl/assembler/AGALMiniAssembler":"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler","./aglsl/assembler/FS":"awayjs-stagegl/lib/aglsl/assembler/FS","./aglsl/assembler/Flags":"awayjs-stagegl/lib/aglsl/assembler/Flags","./aglsl/assembler/Opcode":"awayjs-stagegl/lib/aglsl/assembler/Opcode","./aglsl/assembler/OpcodeMap":"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap","./aglsl/assembler/Part":"awayjs-stagegl/lib/aglsl/assembler/Part","./aglsl/assembler/RegMap":"awayjs-stagegl/lib/aglsl/assembler/RegMap","./aglsl/assembler/Sampler":"awayjs-stagegl/lib/aglsl/assembler/Sampler","./aglsl/assembler/SamplerMap":"awayjs-stagegl/lib/aglsl/assembler/SamplerMap"}],"awayjs-stagegl/lib/attributes/GL_AttributesBuffer":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/library/AbstractionBase");var s=function(e){a(t,e);function t(t,r){e.call(this,t,r);this._stage=r;this._attributesBuffer=t}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._attributesBuffer=null;if(this._indexBuffer){this._indexBuffer.dispose();this._indexBuffer=null}if(this._vertexBuffer){this._vertexBuffer.dispose();this._vertexBuffer=null}};t.prototype.activate=function(e,t,r,a,i){if(i===void 0){i=false}this._stage.setVertexBuffer(e,this._getVertexBuffer(),t,r,a,i)};t.prototype.draw=function(e,t,r){this._stage.context.drawIndices(e,this._getIndexBuffer(),t,r)};t.prototype._getIndexBuffer=function(){if(!this._indexBuffer){this._invalid=true;this._indexBuffer=this._stage.context.createIndexBuffer(this._attributesBuffer.count*this._attributesBuffer.stride/2)}if(this._invalid){this._invalid=false;this._indexBuffer.uploadFromByteArray(this._attributesBuffer.buffer,0,this._attributesBuffer.length)}return this._indexBuffer};t.prototype._getVertexBuffer=function(){if(!this._vertexBuffer){this._invalid=true;this._vertexBuffer=this._stage.context.createVertexBuffer(this._attributesBuffer.count,this._attributesBuffer.stride)}if(this._invalid){this._invalid=false;this._vertexBuffer.uploadFromByteArray(this._attributesBuffer.buffer,0,this._attributesBuffer.count)}return this._vertexBuffer};return t}(i.AbstractionBase);r.GL_AttributesBuffer=s},{"awayjs-core/lib/library/AbstractionBase":undefined}],"awayjs-stagegl/lib/attributes":[function(e,t,r){"use strict";var a=e("./attributes/GL_AttributesBuffer");r.GL_AttributesBuffer=a.GL_AttributesBuffer},{"./attributes/GL_AttributesBuffer":"awayjs-stagegl/lib/attributes/GL_AttributesBuffer"}],"awayjs-stagegl/lib/base/ContextGLBlendFactor":[function(e,t,r){"use strict";var a=function(){function e(){}e.DESTINATION_ALPHA="destinationAlpha";e.DESTINATION_COLOR="destinationColor";e.ONE="one";e.ONE_MINUS_DESTINATION_ALPHA="oneMinusDestinationAlpha";e.ONE_MINUS_DESTINATION_COLOR="oneMinusDestinationColor";e.ONE_MINUS_SOURCE_ALPHA="oneMinusSourceAlpha";e.ONE_MINUS_SOURCE_COLOR="oneMinusSourceColor";e.SOURCE_ALPHA="sourceAlpha";e.SOURCE_COLOR="sourceColor";e.ZERO="zero";return e}();r.ContextGLBlendFactor=a},{}],"awayjs-stagegl/lib/base/ContextGLClearMask":[function(e,t,r){"use strict";var a=function(){function e(){}e.COLOR=1;e.DEPTH=2;e.STENCIL=4;e.ALL=e.COLOR|e.DEPTH|e.STENCIL;return e}();r.ContextGLClearMask=a},{}],"awayjs-stagegl/lib/base/ContextGLCompareMode":[function(e,t,r){"use strict";var a=function(){function e(){}e.ALWAYS="always";e.EQUAL="equal";e.GREATER="greater";e.GREATER_EQUAL="greaterEqual";e.LESS="less";e.LESS_EQUAL="lessEqual";e.NEVER="never";e.NOT_EQUAL="notEqual";return e}();r.ContextGLCompareMode=a},{}],"awayjs-stagegl/lib/base/ContextGLDrawMode":[function(e,t,r){"use strict";var a=function(){function e(){}e.TRIANGLES="triangles";e.LINES="lines";return e}();r.ContextGLDrawMode=a},{}],"awayjs-stagegl/lib/base/ContextGLMipFilter":[function(e,t,r){"use strict";var a=function(){function e(){}e.MIPLINEAR="miplinear";e.MIPNEAREST="mipnearest";e.MIPNONE="mipnone";return e}();r.ContextGLMipFilter=a;
},{}],"awayjs-stagegl/lib/base/ContextGLProfile":[function(e,t,r){"use strict";var a=function(){function e(){}e.BASELINE="baseline";e.BASELINE_CONSTRAINED="baselineConstrained";e.BASELINE_EXTENDED="baselineExtended";return e}();r.ContextGLProfile=a;Object.defineProperty(r,"__esModule",{value:true});r.default=a},{}],"awayjs-stagegl/lib/base/ContextGLProgramType":[function(e,t,r){"use strict";var a=function(){function e(){}e.FRAGMENT=0;e.SAMPLER=1;e.VERTEX=2;return e}();r.ContextGLProgramType=a},{}],"awayjs-stagegl/lib/base/ContextGLStencilAction":[function(e,t,r){"use strict";var a=function(){function e(){}e.DECREMENT_SATURATE="decrementSaturate";e.DECREMENT_WRAP="decrementWrap";e.INCREMENT_SATURATE="incrementSaturate";e.INCREMENT_WRAP="incrementWrap";e.INVERT="invert";e.KEEP="keep";e.SET="set";e.ZERO="zero";return e}();r.ContextGLStencilAction=a},{}],"awayjs-stagegl/lib/base/ContextGLTextureFilter":[function(e,t,r){"use strict";var a=function(){function e(){}e.LINEAR="linear";e.NEAREST="nearest";return e}();r.ContextGLTextureFilter=a},{}],"awayjs-stagegl/lib/base/ContextGLTextureFormat":[function(e,t,r){"use strict";var a=function(){function e(){}e.BGRA="bgra";e.BGRA_PACKED="bgraPacked4444";e.BGR_PACKED="bgrPacked565";e.COMPRESSED="compressed";e.COMPRESSED_ALPHA="compressedAlpha";return e}();r.ContextGLTextureFormat=a},{}],"awayjs-stagegl/lib/base/ContextGLTriangleFace":[function(e,t,r){"use strict";var a=function(){function e(){}e.BACK="back";e.FRONT="front";e.FRONT_AND_BACK="frontAndBack";e.NONE="none";return e}();r.ContextGLTriangleFace=a},{}],"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":[function(e,t,r){"use strict";var a=function(){function e(){}e.FLOAT_1=0;e.FLOAT_2=1;e.FLOAT_3=2;e.FLOAT_4=3;e.BYTE_1=4;e.BYTE_2=5;e.BYTE_3=6;e.BYTE_4=7;e.UNSIGNED_BYTE_1=8;e.UNSIGNED_BYTE_2=9;e.UNSIGNED_BYTE_3=10;e.UNSIGNED_BYTE_4=11;e.SHORT_1=12;e.SHORT_2=13;e.SHORT_3=14;e.SHORT_4=15;e.UNSIGNED_SHORT_1=16;e.UNSIGNED_SHORT_2=17;e.UNSIGNED_SHORT_3=18;e.UNSIGNED_SHORT_4=19;return e}();r.ContextGLVertexBufferFormat=a},{}],"awayjs-stagegl/lib/base/ContextGLWrapMode":[function(e,t,r){"use strict";var a=function(){function e(){}e.CLAMP="clamp";e.REPEAT="repeat";return e}();r.ContextGLWrapMode=a},{}],"awayjs-stagegl/lib/base/ContextMode":[function(e,t,r){"use strict";var a=function(){function e(){}e.AUTO="auto";e.WEBGL="webgl";e.FLASH="flash";e.NATIVE="native";e.SOFTWARE="software";return e}();r.ContextMode=a},{}],"awayjs-stagegl/lib/base/ContextSoftware":[function(e,t,r){"use strict";var a=e("awayjs-core/lib/image/BitmapImage2D");var i=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-core/lib/geom/Matrix");var n=e("awayjs-core/lib/geom/Point");var o=e("awayjs-core/lib/geom/Vector3D");var l=e("awayjs-core/lib/geom/Rectangle");var u=e("awayjs-core/lib/utils/ColorUtils");var f=e("../base/ContextGLBlendFactor");var g=e("../base/ContextGLClearMask");var c=e("../base/ContextGLCompareMode");var h=e("../base/ContextGLProgramType");var p=e("../base/ContextGLTriangleFace");var _=e("../base/IndexBufferSoftware");var d=e("../base/VertexBufferSoftware");var m=e("../base/TextureSoftware");var b=e("../base/ProgramSoftware");var v=e("../base/SoftwareSamplerState");var x=function(){function e(e){this._backBufferRect=new l.Rectangle;this._backBufferWidth=100;this._backBufferHeight=100;this._cullingMode=p.ContextGLTriangleFace.BACK;this._blendSource=f.ContextGLBlendFactor.ONE;this._blendDestination=f.ContextGLBlendFactor.ZERO;this._colorMaskR=true;this._colorMaskG=true;this._colorMaskB=true;this._colorMaskA=true;this._writeDepth=true;this._depthCompareMode=c.ContextGLCompareMode.LESS;this._screenMatrix=new i.Matrix3D;this._frontBufferMatrix=new s.Matrix;this._bboxMin=new n.Point;this._bboxMax=new n.Point;this._clamp=new n.Point;this._samplerStates=[];this._textures=[];this._vertexBuffers=[];this._vertexBufferOffsets=[];this._vertexBufferFormats=[];this._antialias=0;this._sx=new o.Vector3D;this._sy=new o.Vector3D;this._u=new o.Vector3D;this._canvas=e;this._backBufferColor=new a.BitmapImage2D(this._backBufferWidth,this._backBufferHeight,false,0,false);this._frontBuffer=new a.BitmapImage2D(this._backBufferWidth,this._backBufferHeight,true,0,false);if(document&&document.body)document.body.appendChild(this._frontBuffer.getCanvas())}Object.defineProperty(e.prototype,"frontBuffer",{get:function(){return this._frontBuffer},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"container",{get:function(){return this._canvas},enumerable:true,configurable:true});e.prototype.clear=function(e,t,r,a,i,s,n){if(e===void 0){e=0}if(t===void 0){t=0}if(r===void 0){r=0}if(a===void 0){a=1}if(i===void 0){i=1}if(s===void 0){s=0}if(n===void 0){n=g.ContextGLClearMask.ALL}this._backBufferColor.lock();if(n&g.ContextGLClearMask.COLOR){this._colorClearUint32.fill(a*255<<24|e*255<<16|t*255<<8|r*255);this._backBufferColor.setPixels(this._backBufferRect,this._colorClearUint8)}if(n&g.ContextGLClearMask.DEPTH)this._zbuffer.set(this._zbufferClear)};e.prototype.configureBackBuffer=function(e,t,r,a){this._antialias=r;if(this._antialias%2!=0)this._antialias=Math.floor(this._antialias-.5);if(this._antialias==0)this._antialias=1;this._frontBuffer._setSize(e,t);this._backBufferWidth=e*this._antialias;this._backBufferHeight=t*this._antialias;var i=this._backBufferWidth*this._backBufferHeight;var n=new ArrayBuffer(i*8);this._zbuffer=new Float32Array(n,0,i);this._zbufferClear=new Float32Array(n,i*4,i);for(var o=0;o<i;o++)this._zbufferClear[o]=1e7;var l=new ArrayBuffer(i*4);this._colorClearUint8=new Uint8ClampedArray(l);this._colorClearUint32=new Uint32Array(l);this._backBufferRect.width=this._backBufferWidth;this._backBufferRect.height=this._backBufferHeight;this._backBufferColor._setSize(this._backBufferWidth,this._backBufferHeight);var u=this._screenMatrix.rawData;u[0]=this._backBufferWidth/2;u[1]=0;u[2]=0;u[3]=this._backBufferWidth/2;u[4]=0;u[5]=-this._backBufferHeight/2;u[6]=0;u[7]=this._backBufferHeight/2;u[8]=0;u[9]=0;u[10]=1;u[11]=0;u[12]=0;u[13]=0;u[14]=0;u[15]=0;this._screenMatrix.transpose();this._frontBufferMatrix=new s.Matrix;this._frontBufferMatrix.scale(1/this._antialias,1/this._antialias)};e.prototype.createCubeTexture=function(e,t,r,a){return undefined};e.prototype.createIndexBuffer=function(e){return new _.IndexBufferSoftware(e)};e.prototype.createProgram=function(){return new b.ProgramSoftware};e.prototype.createTexture=function(e,t,r,a,i){return new m.TextureSoftware(e,t)};e.prototype.createVertexBuffer=function(e,t){return new d.VertexBufferSoftware(e,t)};e.prototype.dispose=function(){};e.prototype.setBlendFactors=function(e,t){this._blendSource=e;this._blendDestination=t};e.prototype.setColorMask=function(e,t,r,a){this._colorMaskR=e;this._colorMaskG=t;this._colorMaskB=r;this._colorMaskA=a};e.prototype.setStencilActions=function(e,t,r,a,i,s){};e.prototype.setStencilReferenceValue=function(e,t,r){};e.prototype.setCulling=function(e,t){this._cullingMode=e};e.prototype.setDepthTest=function(e,t){this._writeDepth=e;this._depthCompareMode=t};e.prototype.setProgram=function(e){this._program=e};e.prototype.setProgramConstantsFromArray=function(e,t){var r;if(e==h.ContextGLProgramType.VERTEX)r=this._vertexConstants=new Float32Array(t.length);else if(e==h.ContextGLProgramType.FRAGMENT)r=this._fragmentConstants=new Float32Array(t.length);r.set(t)};e.prototype.setTextureAt=function(e,t){this._textures[e]=t};e.prototype.setVertexBufferAt=function(e,t,r,a){this._vertexBuffers[e]=t;this._vertexBufferOffsets[e]=r;this._vertexBufferFormats[e]=a};e.prototype.present=function(){this._backBufferColor.unlock();this._frontBuffer.fillRect(this._frontBuffer.rect,u.ColorUtils.ARGBtoFloat32(0,0,0,0));this._frontBuffer.draw(this._backBufferColor,this._frontBufferMatrix)};e.prototype.drawToBitmapImage2D=function(e){};e.prototype.drawIndices=function(e,t,r,a){if(!this._program)return;var i=new Float32Array(4);var s=new Float32Array(4);var n=new Float32Array(4);var o=new Float32Array(this._program.numVarying*4);var l=new Float32Array(this._program.numVarying*4);var u=new Float32Array(this._program.numVarying*4);if(this._cullingMode==p.ContextGLTriangleFace.BACK){for(var f=r;f<a;f+=3){this._program.vertex(this,t.data[t.startOffset+f],i,o);this._program.vertex(this,t.data[t.startOffset+f+1],s,l);this._program.vertex(this,t.data[t.startOffset+f+2],n,u);this._triangle(i,s,n,o,l,u)}}else if(this._cullingMode==p.ContextGLTriangleFace.FRONT){for(var f=r;f<a;f+=3){this._program.vertex(this,t.data[t.startOffset+f+2],i,o);this._program.vertex(this,t.data[t.startOffset+f+1],s,l);this._program.vertex(this,t.data[t.startOffset+f],n,u);this._triangle(i,s,n,o,l,u)}}else if(this._cullingMode==p.ContextGLTriangleFace.FRONT_AND_BACK||this._cullingMode==p.ContextGLTriangleFace.NONE){for(var f=r;f<a;f+=3){this._program.vertex(this,t.data[t.startOffset+f+2],i,o);this._program.vertex(this,t.data[t.startOffset+f+1],s,l);this._program.vertex(this,t.data[t.startOffset+f],n,u);this._triangle(i,s,n,o,l,u);this._program.vertex(this,t.data[t.startOffset+f],i,o);this._program.vertex(this,t.data[t.startOffset+f+1],s,l);this._program.vertex(this,t.data[t.startOffset+f+2],n,u);this._triangle(i,s,n,o,l,u)}}};e.prototype.drawVertices=function(e,t,r){};e.prototype.setScissorRectangle=function(e){};e.prototype.setSamplerStateAt=function(e,t,r,a){var i=this._samplerStates[e];if(!i)i=this._samplerStates[e]=new v.SoftwareSamplerState;i.wrap=t;i.filter=r;i.mipfilter=a};e.prototype.setRenderToTexture=function(e,t,r,a){};e.prototype.setRenderToBackBuffer=function(){};e.prototype._putPixel=function(e,t,r,a){C[0]=0;C[1]=0;C[2]=0;C[3]=0;y[this._blendDestination](a,a,r);y[this._blendSource](r,a,r);this._backBufferColor.setPixelData(e,t,C)};e.prototype.clamp=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=1}return Math.max(t,Math.min(e,r))};e.prototype.interpolate=function(e,t,r){return e+(t-e)*this.clamp(r)};e.prototype._triangle=function(e,t,r,a,i,s){var n=new o.Vector3D(e[0],e[1],e[2],e[3]);if(!n||n.w==0||isNaN(n.w)){console.error("wrong position: "+e);return}var l=new o.Vector3D(t[0],t[1],t[2],t[3]);var u=new o.Vector3D(r[0],r[1],r[2],r[3]);n.z=n.z*2-n.w;l.z=l.z*2-l.w;u.z=u.z*2-u.w;n.scaleBy(1/n.w);l.scaleBy(1/l.w);u.scaleBy(1/u.w);var f=new o.Vector3D(n.w,l.w,u.w);n=this._screenMatrix.transformVector(n);l=this._screenMatrix.transformVector(l);u=this._screenMatrix.transformVector(u);var g=new o.Vector3D(n.z,l.z,u.z);this._bboxMin.x=1e6;this._bboxMin.y=1e6;this._bboxMax.x=-1e6;this._bboxMax.y=-1e6;this._clamp.x=this._backBufferWidth-1;this._clamp.y=this._backBufferHeight-1;this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,n.x));this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,n.y));this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,l.x));this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,l.y));this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,u.x));this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,u.y));this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,n.x));this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,n.y));this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,l.x));this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,l.y));this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,u.x));this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,u.y));this._bboxMin.x=Math.floor(this._bboxMin.x);this._bboxMin.y=Math.floor(this._bboxMin.y);this._bboxMax.x=Math.floor(this._bboxMax.x);this._bboxMax.y=Math.floor(this._bboxMax.y);for(var c=this._bboxMin.x;c<=this._bboxMax.x;c++)for(var h=this._bboxMin.y;h<=this._bboxMax.y;h++){var p=this._barycentric(n,l,u,c,h);if(p.x<0||p.y<0||p.z<0)continue;var _=this._barycentric(n,l,u,c+1,h);var d=this._barycentric(n,l,u,c,h+1);var m=new o.Vector3D(p.x/f.x,p.y/f.y,p.z/f.z);m.scaleBy(1/(m.x+m.y+m.z));var b=new o.Vector3D(_.x/f.x,_.y/f.y,_.z/f.z);b.scaleBy(1/(b.x+b.y+b.z));var v=new o.Vector3D(d.x/f.x,d.y/f.y,d.z/f.z);v.scaleBy(1/(v.x+v.y+v.z));var x=c%this._backBufferWidth+h*this._backBufferWidth;var y=g.x*p.x+g.y*p.y+g.z*p.z;if(!w[this._depthCompareMode](y,this._zbuffer[x]))continue;var C=this._program.fragment(this,m,b,v,a,i,s,y);if(C.discard)continue;if(this._writeDepth)this._zbuffer[x]=y;S[0]=C.outputColor[0]*255;S[1]=C.outputColor[1]*255;S[2]=C.outputColor[2]*255;S[3]=C.outputColor[3]*255;this._backBufferColor.getPixelData(c,h,T);this._putPixel(c,h,S,T)}};e.prototype._barycentric=function(e,t,r,a,i){this._sx.x=r.x-e.x;this._sx.y=t.x-e.x;this._sx.z=e.x-a;this._sy.x=r.y-e.y;this._sy.y=t.y-e.y;this._sy.z=e.y-i;this._u=this._sx.crossProduct(this._sy,this._u);if(this._u.z<.01)return new o.Vector3D(1-(this._u.x+this._u.y)/this._u.z,this._u.y/this._u.z,this._u.x/this._u.z);return new o.Vector3D(-1,1,1)};e.MAX_SAMPLERS=8;return e}();r.ContextSoftware=x;var y=function(){function e(){}e.destinationAlpha=function(e,t,r){C[0]+=e[0]*t[0]/255;C[1]+=e[1]*t[0]/255;C[2]+=e[2]*t[0]/255;C[3]+=e[3]*t[0]/255};e.destinationColor=function(e,t,r){C[0]+=e[0]*t[0]/255;C[1]+=e[1]*t[1]/255;C[2]+=e[2]*t[2]/255;C[3]+=e[3]*t[3]/255};e.zero=function(e,t,r){};e.one=function(e,t,r){C[0]+=e[0];C[1]+=e[1];C[2]+=e[2];C[3]+=e[3]};e.oneMinusDestinationAlpha=function(e,t,r){C[0]+=e[0]*(1-t[0]/255);C[1]+=e[1]*(1-t[0]/255);C[2]+=e[2]*(1-t[0]/255);C[3]+=e[3]*(1-t[0]/255)};e.oneMinusDestinationColor=function(e,t,r){C[0]+=e[0]*(1-t[0]/255);C[1]+=e[1]*(1-t[1]/255);C[2]+=e[2]*(1-t[2]/255);C[3]+=e[3]*(1-t[3]/255)};e.oneMinusSourceAlpha=function(e,t,r){C[0]+=e[0]*(1-r[0]/255);C[1]+=e[1]*(1-r[0]/255);C[2]+=e[2]*(1-r[0]/255);C[3]+=e[3]*(1-r[0]/255)};e.oneMinusSourceColor=function(e,t,r){C[0]+=e[0]*(1-r[0]/255);C[1]+=e[1]*(1-r[1]/255);C[2]+=e[2]*(1-r[2]/255);C[3]+=e[3]*(1-r[3]/255)};e.sourceAlpha=function(e,t,r){C[0]+=e[0]*r[0]/255;C[1]+=e[1]*r[0]/255;C[2]+=e[2]*r[0]/255;C[3]+=e[3]*r[0]/255};e.sourceColor=function(e,t,r){C[0]+=e[0]*r[0]/255;C[1]+=e[1]*r[1]/255;C[2]+=e[2]*r[2]/255;C[3]+=e[3]*r[3]/255};return e}();r.BlendModeSoftware=y;var w=function(){function e(){}e.always=function(e,t){return true};e.equal=function(e,t){return e==t};e.greater=function(e,t){return e>t};e.greaterEqual=function(e,t){return e>=t};e.less=function(e,t){return e<t};e.lessEqual=function(e,t){return e<=t};e.never=function(e,t){return false};e.notEqual=function(e,t){return e!=t};return e}();r.DepthCompareModeSoftware=w;var C=new Uint8ClampedArray(4);var S=new Uint8ClampedArray(4);var T=new Uint8ClampedArray(4)},{"../base/ContextGLBlendFactor":"awayjs-stagegl/lib/base/ContextGLBlendFactor","../base/ContextGLClearMask":"awayjs-stagegl/lib/base/ContextGLClearMask","../base/ContextGLCompareMode":"awayjs-stagegl/lib/base/ContextGLCompareMode","../base/ContextGLProgramType":"awayjs-stagegl/lib/base/ContextGLProgramType","../base/ContextGLTriangleFace":"awayjs-stagegl/lib/base/ContextGLTriangleFace","../base/IndexBufferSoftware":"awayjs-stagegl/lib/base/IndexBufferSoftware","../base/ProgramSoftware":"awayjs-stagegl/lib/base/ProgramSoftware","../base/SoftwareSamplerState":"awayjs-stagegl/lib/base/SoftwareSamplerState","../base/TextureSoftware":"awayjs-stagegl/lib/base/TextureSoftware","../base/VertexBufferSoftware":"awayjs-stagegl/lib/base/VertexBufferSoftware","awayjs-core/lib/geom/Matrix":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/image/BitmapImage2D":undefined,"awayjs-core/lib/utils/ColorUtils":undefined}],"awayjs-stagegl/lib/base/ContextStage3D":[function(e,t,r){"use strict";var a=e("../base/ContextGLClearMask");var i=e("../base/ContextGLProgramType");var s=e("../base/CubeTextureFlash");var n=e("../base/IndexBufferFlash");var o=e("../base/OpCodes");var l=e("../base/ProgramFlash");var u=e("../base/TextureFlash");var f=e("../base/VertexBufferFlash");var g=function(){function e(t,r){this._cmdStream="";this._resources=new Array;var a="11.0.0";var i={id:t.id};var s={quality:"high",bgcolor:"#ffffff",allowscriptaccess:"sameDomain",allowfullscreen:"true",wmode:"direct"};this._errorCheckingEnabled=false;this._iDriverInfo="Unknown";var n={salign:"tl",id:t.id,name:t["name"]};this._oldCanvas=t.cloneNode();this._oldParent=t.parentNode;var o=this;e.contexts[t.id]=this;function l(e){if(!e.success)return;o._container=e.ref;o._iCallback=r}}Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"driverInfo",{get:function(){return this._iDriverInfo},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"errorCheckingEnabled",{get:function(){return this._errorCheckingEnabled},set:function(e){if(this._errorCheckingEnabled==e)return;this._errorCheckingEnabled=e;this.addStream(String.fromCharCode(o.OpCodes.enableErrorChecking,e?o.OpCodes.trueValue:o.OpCodes.falseValue));this.execute()},enumerable:true,configurable:true});e.prototype._iAddResource=function(e){this._resources.push(e)};e.prototype._iRemoveResource=function(e){this._resources.splice(this._resources.indexOf(e))};e.prototype.createTexture=function(e,t,r,a,i){if(i===void 0){i=0}return new u.TextureFlash(this,e,t,r,a)};e.prototype.createCubeTexture=function(e,t,r,a){if(a===void 0){a=0}return new s.CubeTextureFlash(this,e,t,r)};e.prototype.setTextureAt=function(t,r){if(r){this.addStream(String.fromCharCode(o.OpCodes.setTextureAt)+t+","+r.id+",")}else{this.addStream(String.fromCharCode(o.OpCodes.clearTextureAt)+t.toString()+",")}if(e.debug)this.execute()};e.prototype.setSamplerStateAt=function(e,t,r,a){};e.prototype.setStencilActions=function(t,r,a,i,s,n){if(t===void 0){t="frontAndBack"}if(r===void 0){r="always"}if(a===void 0){a="keep"}if(i===void 0){i="keep"}if(s===void 0){s="keep"}if(n===void 0){n="leftHanded"}this.addStream(String.fromCharCode(o.OpCodes.setStencilActions)+t+"$"+r+"$"+a+"$"+i+"$"+s+"$");if(e.debug)this.execute()};e.prototype.setStencilReferenceValue=function(t,r,a){if(r===void 0){r=255}if(a===void 0){a=255}this.addStream(String.fromCharCode(o.OpCodes.setStencilReferenceValue,t+o.OpCodes.intMask,r+o.OpCodes.intMask,a+o.OpCodes.intMask));if(e.debug)this.execute()};e.prototype.setCulling=function(t,r){if(r===void 0){r="leftHanded"}this.addStream(String.fromCharCode(o.OpCodes.setCulling)+t+"$");if(e.debug)this.execute()};e.prototype.drawIndices=function(t,r,a,i){if(a===void 0){a=0}if(i===void 0){i=-1}a=a||0;if(!i||i<0)i=r.numIndices;this.addStream(String.fromCharCode(o.OpCodes.drawTriangles,r.id+o.OpCodes.intMask)+a+","+i+",");if(e.debug)this.execute()};e.prototype.drawVertices=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=-1}};e.prototype.setProgramConstantsFromArray=function(t,r){var a;var s=r.length/4;var n=t==i.ContextGLProgramType.VERTEX?o.OpCodes.trueValue:o.OpCodes.falseValue;for(var l=0;l<s;l++){a=l*4;this.addStream(String.fromCharCode(o.OpCodes.setProgramConstant,n,l+o.OpCodes.intMask)+r[a]+","+r[a+1]+","+r[a+2]+","+r[a+3]+",");if(e.debug)this.execute()}};e.prototype.setProgram=function(t){this.addStream(String.fromCharCode(o.OpCodes.setProgram,t.id+o.OpCodes.intMask));if(e.debug)this.execute()};e.prototype.present=function(){this.addStream(String.fromCharCode(o.OpCodes.present));this.execute()};e.prototype.clear=function(t,r,i,s,n,l,u){if(t===void 0){t=0}if(r===void 0){r=0}if(i===void 0){i=0}if(s===void 0){s=1}if(n===void 0){n=1}if(l===void 0){l=0}if(u===void 0){u=a.ContextGLClearMask.ALL}this.addStream(String.fromCharCode(o.OpCodes.clear)+t+","+r+","+i+","+s+","+n+","+l+","+u+",");if(e.debug)this.execute()};e.prototype.createProgram=function(){return new l.ProgramFlash(this)};e.prototype.createVertexBuffer=function(e,t){return new f.VertexBufferFlash(this,e,t)};e.prototype.createIndexBuffer=function(e){return new n.IndexBufferFlash(this,e)};e.prototype.configureBackBuffer=function(e,t,r,a){if(a===void 0){a=true}this._width=e;this._height=t;this.addStream(String.fromCharCode(o.OpCodes.configureBackBuffer)+e+","+t+",")};e.prototype.drawToBitmapImage2D=function(e){};e.prototype.setVertexBufferAt=function(t,r,a,i){if(a===void 0){a=0}if(i===void 0){i=null}if(r){this.addStream(String.fromCharCode(o.OpCodes.setVertexBufferAt,t+o.OpCodes.intMask)+r.id+","+a+","+i+"$")}else{this.addStream(String.fromCharCode(o.OpCodes.clearVertexBufferAt,t+o.OpCodes.intMask))}if(e.debug)this.execute()};e.prototype.setColorMask=function(t,r,a,i){this.addStream(String.fromCharCode(o.OpCodes.setColorMask,t?o.OpCodes.trueValue:o.OpCodes.falseValue,r?o.OpCodes.trueValue:o.OpCodes.falseValue,a?o.OpCodes.trueValue:o.OpCodes.falseValue,i?o.OpCodes.trueValue:o.OpCodes.falseValue));if(e.debug)this.execute()};e.prototype.setBlendFactors=function(t,r){this.addStream(String.fromCharCode(o.OpCodes.setBlendFactors)+t+"$"+r+"$");if(e.debug)this.execute()};e.prototype.setRenderToTexture=function(t,r,a,i){if(r===void 0){r=false}if(a===void 0){a=0}if(i===void 0){i=0}if(t===null||t===undefined){this.addStream(String.fromCharCode(o.OpCodes.clearRenderToTexture))}else{this.addStream(String.fromCharCode(o.OpCodes.setRenderToTexture,r?o.OpCodes.trueValue:o.OpCodes.falseValue)+t.id+","+(a||0)+",")}if(e.debug)this.execute()};e.prototype.setRenderToBackBuffer=function(){this.addStream(String.fromCharCode(o.OpCodes.clearRenderToTexture));if(e.debug)this.execute()};e.prototype.setScissorRectangle=function(t){if(t){this.addStream(String.fromCharCode(o.OpCodes.setScissorRect)+t.x+","+t.y+","+t.width+","+t.height+",")}else{this.addStream(String.fromCharCode(o.OpCodes.clearScissorRect))}if(e.debug)this.execute()};e.prototype.setDepthTest=function(t,r){this.addStream(String.fromCharCode(o.OpCodes.setDepthTest,t?o.OpCodes.trueValue:o.OpCodes.falseValue)+r+"$");if(e.debug)this.execute()};e.prototype.dispose=function(){if(this._container==null)return;console.log("Context3D dispose, releasing "+this._resources.length+" resources.");while(this._resources.length)this._resources[0].dispose();if(this._container){this.addStream(String.fromCharCode(o.OpCodes.disposeContext));this.execute();if(this._oldCanvas&&this._oldParent){this._oldParent.appendChild(this._oldCanvas);this._oldParent=null}this._container=null}this._oldCanvas=null};e.prototype.addStream=function(e){this._cmdStream+=e};e.prototype.execute=function(){if(e.logStream)console.log(this._cmdStream);var t=this._container["CallFunction"]('<invoke name="execStage3dOpStream" returntype="javascript"><arguments><string>'+this._cmdStream+"</string></arguments></invoke>");if(Number(t)<=-3)throw"Exec stream failed";this._cmdStream="";return Number(t)};e.contexts=new Object;e.debug=false;e.logStream=false;return e}();r.ContextStage3D=g;function c(e,t){var r=g.contexts[e];if(r._iCallback){r._iDriverInfo=t;var a=window.setTimeout(function(){window.clearTimeout(a);try{r._iCallback(r)}catch(e){console.log("Callback failed during flash initialization with '"+e.toString()+"'")}},1)}}},{"../base/ContextGLClearMask":"awayjs-stagegl/lib/base/ContextGLClearMask","../base/ContextGLProgramType":"awayjs-stagegl/lib/base/ContextGLProgramType","../base/CubeTextureFlash":"awayjs-stagegl/lib/base/CubeTextureFlash","../base/IndexBufferFlash":"awayjs-stagegl/lib/base/IndexBufferFlash","../base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","../base/ProgramFlash":"awayjs-stagegl/lib/base/ProgramFlash","../base/TextureFlash":"awayjs-stagegl/lib/base/TextureFlash","../base/VertexBufferFlash":"awayjs-stagegl/lib/base/VertexBufferFlash"}],"awayjs-stagegl/lib/base/ContextWebGL":[function(e,t,r){"use strict";var a=e("awayjs-core/lib/geom/Rectangle");var i=e("../base/ContextGLBlendFactor");var s=e("../base/ContextGLDrawMode");var n=e("../base/ContextGLClearMask");var o=e("../base/ContextGLCompareMode");var l=e("../base/ContextGLMipFilter");var u=e("../base/ContextGLProgramType");var f=e("../base/ContextGLStencilAction");var g=e("../base/ContextGLTextureFilter");var c=e("../base/ContextGLTriangleFace");var h=e("../base/ContextGLVertexBufferFormat");var p=e("../base/ContextGLWrapMode");var _=e("../base/CubeTextureWebGL");var d=e("../base/IndexBufferWebGL");var m=e("../base/ProgramWebGL");var b=e("../base/TextureWebGL");var v=e("../base/SamplerState");var x=e("../base/VertexBufferWebGL");var y=function(){function e(t){this._blendFactorDictionary=new Object;this._drawModeDictionary=new Object;this._compareModeDictionary=new Object;this._stencilActionDictionary=new Object;this._textureIndexDictionary=new Array(8);this._textureTypeDictionary=new Object;this._wrapDictionary=new Object;this._filterDictionary=new Object;this._mipmapFilterDictionary=new Object;this._vertexBufferPropertiesDictionary=[];this._samplerStates=new Array(8);this._stencilReferenceValue=0;this._stencilReadMask=255;this._separateStencil=false;this._container=t;try{this._gl=t.getContext("experimental-webgl",{premultipliedAlpha:false,alpha:false,stencil:true});if(!this._gl)this._gl=t.getContext("webgl",{premultipliedAlpha:false,alpha:false,stencil:true})}catch(r){}if(this._gl){if(this._gl.getExtension("OES_standard_derivatives")){this._standardDerivatives=true}else{this._standardDerivatives=false}this._blendFactorDictionary[i.ContextGLBlendFactor.ONE]=this._gl.ONE;this._blendFactorDictionary[i.ContextGLBlendFactor.DESTINATION_ALPHA]=this._gl.DST_ALPHA;this._blendFactorDictionary[i.ContextGLBlendFactor.DESTINATION_COLOR]=this._gl.DST_COLOR;this._blendFactorDictionary[i.ContextGLBlendFactor.ONE]=this._gl.ONE;this._blendFactorDictionary[i.ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=this._gl.ONE_MINUS_DST_ALPHA;this._blendFactorDictionary[i.ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=this._gl.ONE_MINUS_DST_COLOR;this._blendFactorDictionary[i.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=this._gl.ONE_MINUS_SRC_ALPHA;this._blendFactorDictionary[i.ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=this._gl.ONE_MINUS_SRC_COLOR;this._blendFactorDictionary[i.ContextGLBlendFactor.SOURCE_ALPHA]=this._gl.SRC_ALPHA;this._blendFactorDictionary[i.ContextGLBlendFactor.SOURCE_COLOR]=this._gl.SRC_COLOR;this._blendFactorDictionary[i.ContextGLBlendFactor.ZERO]=this._gl.ZERO;this._drawModeDictionary[s.ContextGLDrawMode.LINES]=this._gl.LINES;this._drawModeDictionary[s.ContextGLDrawMode.TRIANGLES]=this._gl.TRIANGLES;this._compareModeDictionary[o.ContextGLCompareMode.ALWAYS]=this._gl.ALWAYS;this._compareModeDictionary[o.ContextGLCompareMode.EQUAL]=this._gl.EQUAL;this._compareModeDictionary[o.ContextGLCompareMode.GREATER]=this._gl.GREATER;this._compareModeDictionary[o.ContextGLCompareMode.GREATER_EQUAL]=this._gl.GEQUAL;this._compareModeDictionary[o.ContextGLCompareMode.LESS]=this._gl.LESS;this._compareModeDictionary[o.ContextGLCompareMode.LESS_EQUAL]=this._gl.LEQUAL;this._compareModeDictionary[o.ContextGLCompareMode.NEVER]=this._gl.NEVER;this._compareModeDictionary[o.ContextGLCompareMode.NOT_EQUAL]=this._gl.NOTEQUAL;this._stencilActionDictionary[f.ContextGLStencilAction.DECREMENT_SATURATE]=this._gl.DECR;this._stencilActionDictionary[f.ContextGLStencilAction.DECREMENT_WRAP]=this._gl.DECR_WRAP;this._stencilActionDictionary[f.ContextGLStencilAction.INCREMENT_SATURATE]=this._gl.INCR;this._stencilActionDictionary[f.ContextGLStencilAction.INCREMENT_WRAP]=this._gl.INCR_WRAP;this._stencilActionDictionary[f.ContextGLStencilAction.INVERT]=this._gl.INVERT;this._stencilActionDictionary[f.ContextGLStencilAction.KEEP]=this._gl.KEEP;this._stencilActionDictionary[f.ContextGLStencilAction.SET]=this._gl.REPLACE;this._stencilActionDictionary[f.ContextGLStencilAction.ZERO]=this._gl.ZERO;this._textureIndexDictionary[0]=this._gl.TEXTURE0;this._textureIndexDictionary[1]=this._gl.TEXTURE1;this._textureIndexDictionary[2]=this._gl.TEXTURE2;this._textureIndexDictionary[3]=this._gl.TEXTURE3;this._textureIndexDictionary[4]=this._gl.TEXTURE4;this._textureIndexDictionary[5]=this._gl.TEXTURE5;this._textureIndexDictionary[6]=this._gl.TEXTURE6;this._textureIndexDictionary[7]=this._gl.TEXTURE7;this._textureTypeDictionary["texture2d"]=this._gl.TEXTURE_2D;this._textureTypeDictionary["textureCube"]=this._gl.TEXTURE_CUBE_MAP;this._wrapDictionary[p.ContextGLWrapMode.REPEAT]=this._gl.REPEAT;this._wrapDictionary[p.ContextGLWrapMode.CLAMP]=this._gl.CLAMP_TO_EDGE;this._filterDictionary[g.ContextGLTextureFilter.LINEAR]=this._gl.LINEAR;this._filterDictionary[g.ContextGLTextureFilter.NEAREST]=this._gl.NEAREST;this._mipmapFilterDictionary[g.ContextGLTextureFilter.LINEAR]=new Object;this._mipmapFilterDictionary[g.ContextGLTextureFilter.LINEAR][l.ContextGLMipFilter.MIPNEAREST]=this._gl.LINEAR_MIPMAP_NEAREST;this._mipmapFilterDictionary[g.ContextGLTextureFilter.LINEAR][l.ContextGLMipFilter.MIPLINEAR]=this._gl.LINEAR_MIPMAP_LINEAR;this._mipmapFilterDictionary[g.ContextGLTextureFilter.LINEAR][l.ContextGLMipFilter.MIPNONE]=this._gl.LINEAR;this._mipmapFilterDictionary[g.ContextGLTextureFilter.NEAREST]=new Object;this._mipmapFilterDictionary[g.ContextGLTextureFilter.NEAREST][l.ContextGLMipFilter.MIPNEAREST]=this._gl.NEAREST_MIPMAP_NEAREST;this._mipmapFilterDictionary[g.ContextGLTextureFilter.NEAREST][l.ContextGLMipFilter.MIPLINEAR]=this._gl.NEAREST_MIPMAP_LINEAR;this._mipmapFilterDictionary[g.ContextGLTextureFilter.NEAREST][l.ContextGLMipFilter.MIPNONE]=this._gl.NEAREST;this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.FLOAT_1]=new w(1,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.FLOAT_2]=new w(2,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.FLOAT_3]=new w(3,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.FLOAT_4]=new w(4,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.BYTE_1]=new w(1,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.BYTE_2]=new w(2,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.BYTE_3]=new w(3,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.BYTE_4]=new w(4,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_BYTE_1]=new w(1,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_BYTE_2]=new w(2,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_BYTE_3]=new w(3,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_BYTE_4]=new w(4,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.SHORT_1]=new w(1,this._gl.SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.SHORT_2]=new w(2,this._gl.SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.SHORT_3]=new w(3,this._gl.SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.SHORT_4]=new w(4,this._gl.SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_SHORT_1]=new w(1,this._gl.UNSIGNED_SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_SHORT_2]=new w(2,this._gl.UNSIGNED_SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_SHORT_3]=new w(3,this._gl.UNSIGNED_SHORT,true);this._vertexBufferPropertiesDictionary[h.ContextGLVertexBufferFormat.UNSIGNED_SHORT_4]=new w(4,this._gl.UNSIGNED_SHORT,true);this._stencilCompareMode=this._gl.ALWAYS;this._stencilCompareModeBack=this._gl.ALWAYS;this._stencilCompareModeFront=this._gl.ALWAYS}else{alert("WebGL is not available.")}for(var a=0;a<e.MAX_SAMPLERS;++a){this._samplerStates[a]=new v.SamplerState;this._samplerStates[a].wrap=this._gl.REPEAT;this._samplerStates[a].filter=this._gl.LINEAR;this._samplerStates[a].mipfilter=this._gl.LINEAR}}Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"standardDerivatives",{get:function(){return this._standardDerivatives;
},enumerable:true,configurable:true});e.prototype.gl=function(){return this._gl};e.prototype.clear=function(e,t,r,a,i,s,o){if(e===void 0){e=0}if(t===void 0){t=0}if(r===void 0){r=0}if(a===void 0){a=1}if(i===void 0){i=1}if(s===void 0){s=0}if(o===void 0){o=n.ContextGLClearMask.ALL}if(!this._drawing){this.updateBlendStatus();this._drawing=true}var l=0;if(o&n.ContextGLClearMask.COLOR)l|=this._gl.COLOR_BUFFER_BIT;if(o&n.ContextGLClearMask.STENCIL)l|=this._gl.STENCIL_BUFFER_BIT;if(o&n.ContextGLClearMask.DEPTH)l|=this._gl.DEPTH_BUFFER_BIT;this._gl.clearColor(e,t,r,a);this._gl.clearDepth(i);this._gl.clearStencil(s);this._gl.clear(l)};e.prototype.configureBackBuffer=function(e,t,r,a){if(a===void 0){a=true}this._width=e;this._height=t;if(a){this._gl.enable(this._gl.STENCIL_TEST);this._gl.enable(this._gl.DEPTH_TEST)}this._gl.viewport["width"]=e;this._gl.viewport["height"]=t;this._gl.viewport(0,0,e,t)};e.prototype.createCubeTexture=function(e,t,r,a){if(a===void 0){a=0}return new _.CubeTextureWebGL(this._gl,e)};e.prototype.createIndexBuffer=function(e){return new d.IndexBufferWebGL(this._gl,e)};e.prototype.createProgram=function(){return new m.ProgramWebGL(this._gl)};e.prototype.createTexture=function(e,t,r,a,i){if(i===void 0){i=0}return new b.TextureWebGL(this._gl,e,t)};e.prototype.createVertexBuffer=function(e,t){return new x.VertexBufferWebGL(this._gl,e,t)};e.prototype.dispose=function(){for(var e=0;e<this._samplerStates.length;++e)this._samplerStates[e]=null};e.prototype.drawToBitmapImage2D=function(e){var t=new Uint8ClampedArray(e.width*e.height*4);this._gl.readPixels(0,0,e.width,e.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);e.setPixels(new a.Rectangle(0,0,e.width,e.height),t)};e.prototype.drawIndices=function(e,t,r,a){if(r===void 0){r=0}if(a===void 0){a=-1}if(!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.glBuffer);this._gl.drawElements(this._drawModeDictionary[e],a==-1?t.numIndices:a,this._gl.UNSIGNED_SHORT,r*2)};e.prototype.drawVertices=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=-1}if(!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";this._gl.drawArrays(this._drawModeDictionary[e],t,r)};e.prototype.present=function(){this._drawing=false};e.prototype.setBlendFactors=function(e,t){this._blendEnabled=true;this._blendSourceFactor=this._blendFactorDictionary[e];this._blendDestinationFactor=this._blendFactorDictionary[t];this.updateBlendStatus()};e.prototype.setColorMask=function(e,t,r,a){this._gl.colorMask(e,t,r,a)};e.prototype.setCulling=function(e,t){if(t===void 0){t="leftHanded"}if(e==c.ContextGLTriangleFace.NONE){this._gl.disable(this._gl.CULL_FACE)}else{this._gl.enable(this._gl.CULL_FACE);this._gl.cullFace(this.translateTriangleFace(e,t))}};e.prototype.setDepthTest=function(e,t){this._gl.depthFunc(this._compareModeDictionary[t]);this._gl.depthMask(e)};e.prototype.setStencilActions=function(e,t,r,a,i,s){if(e===void 0){e="frontAndBack"}if(t===void 0){t="always"}if(r===void 0){r="keep"}if(a===void 0){a="keep"}if(i===void 0){i="keep"}if(s===void 0){s="leftHanded"}this._separateStencil=e!="frontAndBack";var n=this._compareModeDictionary[t];var o=this._stencilActionDictionary[i];var l=this._stencilActionDictionary[a];var u=this._stencilActionDictionary[r];if(!this._separateStencil){this._stencilCompareMode=n;this._gl.stencilFunc(n,this._stencilReferenceValue,this._stencilReadMask);this._gl.stencilOp(o,l,u)}else if(e=="back"){this._stencilCompareModeBack=n;this._gl.stencilFuncSeparate(this._gl.BACK,n,this._stencilReferenceValue,this._stencilReadMask);this._gl.stencilOpSeparate(this._gl.BACK,o,l,u)}else if(e=="front"){this._stencilCompareModeFront=n;this._gl.stencilFuncSeparate(this._gl.FRONT,n,this._stencilReferenceValue,this._stencilReadMask);this._gl.stencilOpSeparate(this._gl.FRONT,o,l,u)}};e.prototype.setStencilReferenceValue=function(e,t,r){this._stencilReferenceValue=e;this._stencilReadMask=t;if(this._separateStencil){this._gl.stencilFuncSeparate(this._gl.FRONT,this._stencilCompareModeFront,e,t);this._gl.stencilFuncSeparate(this._gl.BACK,this._stencilCompareModeBack,e,t)}else{this._gl.stencilFunc(this._stencilCompareMode,e,t)}this._gl.stencilMask(r)};e.prototype.setProgram=function(e){this._currentProgram=e;e.focusProgram()};e.prototype.setProgramConstantsFromArray=function(e,t){if(t.length)this._gl.uniform4fv(this._currentProgram.getUniformLocation(e),t)};e.prototype.setScissorRectangle=function(e){if(!e){this._gl.disable(this._gl.SCISSOR_TEST);return}this._gl.enable(this._gl.SCISSOR_TEST);this._gl.scissor(e.x,e.y,e.width,e.height)};e.prototype.setTextureAt=function(e,t){var r=this._samplerStates[e];if(this._activeTexture!=e&&(t||r.type)){this._activeTexture=e;this._gl.activeTexture(this._textureIndexDictionary[e])}if(!t){if(r.type){this._gl.bindTexture(r.type,null);r.type=null}return}var a=this._textureTypeDictionary[t.textureType];r.type=a;this._gl.bindTexture(a,t.glTexture);this._gl.uniform1i(this._currentProgram.getUniformLocation(u.ContextGLProgramType.SAMPLER,e),e);this._gl.texParameteri(a,this._gl.TEXTURE_WRAP_S,r.wrap);this._gl.texParameteri(a,this._gl.TEXTURE_WRAP_T,r.wrap);this._gl.texParameteri(a,this._gl.TEXTURE_MAG_FILTER,r.filter);this._gl.texParameteri(a,this._gl.TEXTURE_MIN_FILTER,r.mipfilter)};e.prototype.setSamplerStateAt=function(t,r,a,i){if(0<=t&&t<e.MAX_SAMPLERS){this._samplerStates[t].wrap=this._wrapDictionary[r];this._samplerStates[t].filter=this._filterDictionary[a];this._samplerStates[t].mipfilter=this._mipmapFilterDictionary[a][i]}else{throw"Sampler is out of bounds."}};e.prototype.setVertexBufferAt=function(e,t,r,a){if(r===void 0){r=0}if(a===void 0){a=4}var i=this._currentProgram?this._currentProgram.getAttribLocation(e):-1;if(!t){if(i>-1)this._gl.disableVertexAttribArray(i);return}if(this._currentArrayBuffer!=t){this._currentArrayBuffer=t;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t?t.glBuffer:null)}var s=this._vertexBufferPropertiesDictionary[a];this._gl.enableVertexAttribArray(i);this._gl.vertexAttribPointer(i,s.size,s.type,s.normalized,t.dataPerVertex,r)};e.prototype.setRenderToTexture=function(e,t,r,a){if(t===void 0){t=false}if(r===void 0){r=0}if(a===void 0){a=0}var i=e;var s=i.frameBuffer;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,s);if(t){this._gl.enable(this._gl.STENCIL_TEST);this._gl.enable(this._gl.DEPTH_TEST)}this._gl.viewport(0,0,i.width,i.height)};e.prototype.setRenderToBackBuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)};e.prototype.updateBlendStatus=function(){if(this._blendEnabled){this._gl.enable(this._gl.BLEND);this._gl.blendEquation(this._gl.FUNC_ADD);this._gl.blendFunc(this._blendSourceFactor,this._blendDestinationFactor)}else{this._gl.disable(this._gl.BLEND)}};e.prototype.translateTriangleFace=function(e,t){switch(e){case c.ContextGLTriangleFace.BACK:return t=="leftHanded"?this._gl.FRONT:this._gl.BACK;case c.ContextGLTriangleFace.FRONT:return t=="leftHanded"?this._gl.BACK:this._gl.FRONT;case c.ContextGLTriangleFace.FRONT_AND_BACK:return this._gl.FRONT_AND_BACK;default:throw"Unknown ContextGLTriangleFace type."}};e.MAX_SAMPLERS=8;e.modulo=0;return e}();r.ContextWebGL=y;var w=function(){function e(e,t,r){this.size=e;this.type=t;this.normalized=r}return e}();r.VertexBufferProperties=w},{"../base/ContextGLBlendFactor":"awayjs-stagegl/lib/base/ContextGLBlendFactor","../base/ContextGLClearMask":"awayjs-stagegl/lib/base/ContextGLClearMask","../base/ContextGLCompareMode":"awayjs-stagegl/lib/base/ContextGLCompareMode","../base/ContextGLDrawMode":"awayjs-stagegl/lib/base/ContextGLDrawMode","../base/ContextGLMipFilter":"awayjs-stagegl/lib/base/ContextGLMipFilter","../base/ContextGLProgramType":"awayjs-stagegl/lib/base/ContextGLProgramType","../base/ContextGLStencilAction":"awayjs-stagegl/lib/base/ContextGLStencilAction","../base/ContextGLTextureFilter":"awayjs-stagegl/lib/base/ContextGLTextureFilter","../base/ContextGLTriangleFace":"awayjs-stagegl/lib/base/ContextGLTriangleFace","../base/ContextGLVertexBufferFormat":"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat","../base/ContextGLWrapMode":"awayjs-stagegl/lib/base/ContextGLWrapMode","../base/CubeTextureWebGL":"awayjs-stagegl/lib/base/CubeTextureWebGL","../base/IndexBufferWebGL":"awayjs-stagegl/lib/base/IndexBufferWebGL","../base/ProgramWebGL":"awayjs-stagegl/lib/base/ProgramWebGL","../base/SamplerState":"awayjs-stagegl/lib/base/SamplerState","../base/TextureWebGL":"awayjs-stagegl/lib/base/TextureWebGL","../base/VertexBufferWebGL":"awayjs-stagegl/lib/base/VertexBufferWebGL","awayjs-core/lib/geom/Rectangle":undefined}],"awayjs-stagegl/lib/base/CubeTextureFlash":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/utils/ByteArrayBase");var s=e("../base/OpCodes");var n=e("../base/ResourceBaseFlash");var o=function(e){a(t,e);function t(t,r,a,i,n){if(n===void 0){n=false}e.call(this);this._context=t;this._size=r;this._context.addStream(String.fromCharCode(s.OpCodes.initCubeTexture,i?s.OpCodes.trueValue:s.OpCodes.falseValue)+r+","+n+","+a+"$");this._pId=this._context.execute();this._context._iAddResource(this)}Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(s.OpCodes.disposeCubeTexture)+this._pId.toString()+",");this._context.execute();this._context._iRemoveResource(this);this._context=null};t.prototype.uploadFromData=function(e,t,r){if(r===void 0){r=0}if(e instanceof HTMLImageElement){var a=document.createElement("canvas");var n=e.width;var o=e.height;a.width=n;a.height=o;var l=a.getContext("2d");l.drawImage(e,0,0);e=l.getImageData(0,0,n,o).data}var u=0;var f=i.ByteArrayBase.internalGetBase64String(e.length,function(){return e[u++]},null);this._context.addStream(String.fromCharCode(s.OpCodes.uploadBytesCubeTexture)+this._pId+","+r+","+t+","+(this.size>>r)+","+f+"%");this._context.execute()};t.prototype.uploadCompressedTextureFromByteArray=function(e,t,r){if(r===void 0){r=false}};return t}(n.ResourceBaseFlash);r.CubeTextureFlash=o},{"../base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","../base/ResourceBaseFlash":"awayjs-stagegl/lib/base/ResourceBaseFlash","awayjs-core/lib/utils/ByteArrayBase":undefined}],"awayjs-stagegl/lib/base/CubeTextureWebGL":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/TextureBaseWebGL");var s=function(e){a(t,e);function t(t,r){e.call(this,t);this._textureSelectorDictionary=new Array(6);this.textureType="textureCube";this._size=r;this._texture=this._gl.createTexture();this._textureSelectorDictionary[0]=t.TEXTURE_CUBE_MAP_POSITIVE_X;this._textureSelectorDictionary[1]=t.TEXTURE_CUBE_MAP_NEGATIVE_X;this._textureSelectorDictionary[2]=t.TEXTURE_CUBE_MAP_POSITIVE_Y;this._textureSelectorDictionary[3]=t.TEXTURE_CUBE_MAP_NEGATIVE_Y;this._textureSelectorDictionary[4]=t.TEXTURE_CUBE_MAP_POSITIVE_Z;this._textureSelectorDictionary[5]=t.TEXTURE_CUBE_MAP_NEGATIVE_Z}t.prototype.dispose=function(){this._gl.deleteTexture(this._texture)};t.prototype.uploadFromData=function(e,t,r){if(r===void 0){r=0}this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._texture);this._gl.texImage2D(this._textureSelectorDictionary[t],r,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e);this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)};t.prototype.uploadCompressedTextureFromByteArray=function(e,t,r){if(r===void 0){r=false}};Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"glTexture",{get:function(){return this._texture},enumerable:true,configurable:true});return t}(i.TextureBaseWebGL);r.CubeTextureWebGL=s},{"../base/TextureBaseWebGL":"awayjs-stagegl/lib/base/TextureBaseWebGL"}],"awayjs-stagegl/lib/base/IContextGL":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/ICubeTexture":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/IIndexBuffer":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/IProgram":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/ITextureBase":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/ITexture":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/IVertexBuffer":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/base/IndexBufferFlash":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/OpCodes");var s=e("../base/ResourceBaseFlash");var n=function(e){a(t,e);function t(t,r){e.call(this);this._context=t;this._numIndices=r;this._context.addStream(String.fromCharCode(i.OpCodes.initIndexBuffer,r+i.OpCodes.intMask));this._pId=this._context.execute();this._context._iAddResource(this)}t.prototype.uploadFromArray=function(e,t,r){this._context.addStream(String.fromCharCode(i.OpCodes.uploadArrayIndexBuffer,this._pId+i.OpCodes.intMask)+e.join()+"#"+t+","+r+",");this._context.execute()};t.prototype.uploadFromByteArray=function(e,t,r){};t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(i.OpCodes.disposeIndexBuffer,this._pId+i.OpCodes.intMask));this._context.execute();this._context._iRemoveResource(this);this._context=null};Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});return t}(s.ResourceBaseFlash);r.IndexBufferFlash=n},{"../base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","../base/ResourceBaseFlash":"awayjs-stagegl/lib/base/ResourceBaseFlash"}],"awayjs-stagegl/lib/base/IndexBufferSoftware":[function(e,t,r){"use strict";var a=function(){function e(e){this._numIndices=e}e.prototype.uploadFromArray=function(e,t,r){this._startOffset=t*2;this._data=new Uint16Array(e)};e.prototype.uploadFromByteArray=function(e,t,r){this._startOffset=t*2;this._data=new Uint16Array(e)};e.prototype.dispose=function(){this._data=null};Object.defineProperty(e.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:true,configurable:true});return e}();r.IndexBufferSoftware=a},{}],"awayjs-stagegl/lib/base/IndexBufferWebGL":[function(e,t,r){"use strict";var a=function(){function e(e,t){this._gl=e;this._buffer=this._gl.createBuffer();this._numIndices=t}e.prototype.uploadFromArray=function(e,t,r){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer);if(t)this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,t*2,new Uint16Array(e));else this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this._gl.STATIC_DRAW)};e.prototype.uploadFromByteArray=function(e,t,r){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer);if(t)this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,t*2,e);else this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,this._gl.STATIC_DRAW)};e.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)};Object.defineProperty(e.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:true,configurable:true});return e}();r.IndexBufferWebGL=a},{}],"awayjs-stagegl/lib/base/OpCodes":[function(e,t,r){"use strict";var a=function(){function e(){}e.trueValue=32;e.falseValue=33;e.intMask=63;e.drawTriangles=41;e.setProgramConstant=42;e.setProgram=43;e.present=44;e.clear=45;e.initProgram=46;e.initVertexBuffer=47;e.initIndexBuffer=48;e.configureBackBuffer=49;e.uploadArrayIndexBuffer=50;e.uploadArrayVertexBuffer=51;e.uploadAGALBytesProgram=52;e.setVertexBufferAt=53;e.uploadBytesIndexBuffer=54;e.uploadBytesVertexBuffer=55;e.setColorMask=56;e.setDepthTest=57;e.disposeProgram=58;e.disposeContext=59;e.disposeVertexBuffer=61;e.disposeIndexBuffer=63;e.initTexture=64;e.setTextureAt=65;e.uploadBytesTexture=66;e.disposeTexture=67;e.setCulling=68;e.setScissorRect=69;e.clearScissorRect=70;e.setBlendFactors=71;e.setRenderToTexture=72;e.clearTextureAt=73;e.clearVertexBufferAt=74;e.setStencilActions=75;e.setStencilReferenceValue=76;e.initCubeTexture=77;e.disposeCubeTexture=78;e.uploadBytesCubeTexture=79;e.clearRenderToTexture=80;e.enableErrorChecking=81;return e}();r.OpCodes=a},{}],"awayjs-stagegl/lib/base/ProgramFlash":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/ContextStage3D");var s=e("../base/OpCodes");var n=e("../base/ResourceBaseFlash");var o=function(e){a(t,e);function t(t){e.call(this);this._context=t;this._context.addStream(String.fromCharCode(s.OpCodes.initProgram));this._pId=this._context.execute();this._context._iAddResource(this)}t.prototype.upload=function(e,t){this._context.addStream(String.fromCharCode(s.OpCodes.uploadAGALBytesProgram,this._pId+s.OpCodes.intMask)+e.readBase64String(e.length)+"%"+t.readBase64String(t.length)+"%");if(i.ContextStage3D.debug)this._context.execute()};t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(s.OpCodes.disposeProgram,this._pId+s.OpCodes.intMask));this._context.execute();this._context._iRemoveResource(this);this._context=null};return t}(n.ResourceBaseFlash);r.ProgramFlash=o},{"../base/ContextStage3D":"awayjs-stagegl/lib/base/ContextStage3D","../base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","../base/ResourceBaseFlash":"awayjs-stagegl/lib/base/ResourceBaseFlash"}],"awayjs-stagegl/lib/base/ProgramSoftware":[function(e,t,r){"use strict";var a=e("../aglsl/AGALTokenizer");var i=e("../base/ProgramVOSoftware");var s=e("../base/ContextGLVertexBufferFormat");var n=e("../base/SoftwareSamplerState");var o=e("../base/ContextGLTextureFilter");var l=e("../base/ContextGLMipFilter");var u=e("../base/ContextGLWrapMode");var f=function(){function e(){this._numVarying=0}Object.defineProperty(e.prototype,"numVarying",{get:function(){return this._numVarying},enumerable:true,configurable:true});e.prototype.upload=function(t,r){this._vertexDescr=e._tokenizer.decribeAGALByteArray(t);this._vertexVO=new i.ProgramVOSoftware;this._vertexVO.temp=new Float32Array(this._vertexDescr.regwrite[2].length*4);this._vertexVO.attributes=new Float32Array(this._vertexDescr.regread[0].length*4);this._numVarying=this._vertexDescr.regwrite[4].length;this._fragmentDescr=e._tokenizer.decribeAGALByteArray(r);this._fragmentVO=new i.ProgramVOSoftware;this._fragmentVO.temp=new Float32Array(this._fragmentDescr.regwrite[2].length*4);this._fragmentVO.varying=new Float32Array(this._fragmentDescr.regread[4].length*4);this._fragmentVO.derivativeX=new Float32Array(this._fragmentVO.varying.length);this._fragmentVO.derivativeY=new Float32Array(this._fragmentVO.varying.length)};e.prototype.dispose=function(){this._vertexDescr=null;this._fragmentDescr=null};e.prototype.vertex=function(t,r,a,i){var n;var o=0;var l=this._vertexDescr.regread[0].length;var u=this._vertexVO.attributes;for(n=0;n<l;n++){var f=t._vertexBuffers[n];if(!f)continue;var g=t._vertexBufferOffsets[n]/4+r*f.attributesPerVertex;if(t._vertexBufferFormats[n]==s.ContextGLVertexBufferFormat.UNSIGNED_BYTE_4){u[o++]=f.uintData[g*4];u[o++]=f.uintData[g*4+1];u[o++]=f.uintData[g*4+2];u[o++]=f.uintData[g*4+3]}else if(t._vertexBufferFormats[n]==s.ContextGLVertexBufferFormat.FLOAT_4){u[o++]=f.data[g];u[o++]=f.data[g+1];u[o++]=f.data[g+2];u[o++]=f.data[g+3]}else if(t._vertexBufferFormats[n]==s.ContextGLVertexBufferFormat.FLOAT_3){u[o++]=f.data[g];u[o++]=f.data[g+1];u[o++]=f.data[g+2];u[o++]=1}else if(t._vertexBufferFormats[n]==s.ContextGLVertexBufferFormat.FLOAT_2){u[o++]=f.data[g];u[o++]=f.data[g+1];u[o++]=0;u[o++]=1}else if(t._vertexBufferFormats[n]==s.ContextGLVertexBufferFormat.FLOAT_1){u[o++]=f.data[g];u[o++]=0;u[o++]=0;u[o++]=1}}var c=this._vertexVO.temp;var h=c.length;for(var n=0;n<h;n+=4){c[n]=0;c[n+1]=0;c[n+2]=0;c[n+3]=1}this._vertexVO.outputPosition=a;this._vertexVO.varying=i;var p=this._vertexDescr.tokens.length;for(var n=0;n<p;n++){var _=this._vertexDescr.tokens[n];e._opCodeFunc[_.opcode](this._vertexVO,this._vertexDescr,_.dest,_.a,_.b,t)}};e.prototype.fragment=function(t,r,a,i,s,n,o,u){this._fragmentVO.outputDepth=u;var f=this._fragmentVO.temp;var g=f.length;for(var c=0;c<g;c+=4){f[c]=0;f[c+1]=0;f[c+2]=0;f[c+3]=1}var h=[];var p=this._fragmentDescr.tokens.length;for(var c=0;c<p;c++){var _=this._fragmentDescr.tokens[c];if(_.opcode==40&&t._samplerStates[_.b.regnum]&&t._samplerStates[_.b.regnum].mipfilter==l.ContextGLMipFilter.MIPLINEAR&&t._textures[_.b.regnum].getMipLevelsCount()>1)h.push(_.a.regnum)}var d=this._fragmentVO.derivativeX;var m=this._fragmentVO.derivativeY;var b=this._fragmentVO.varying;var v=b.length;for(var c=0;c<v;c+=4){b[c]=r.x*s[c]+r.y*n[c]+r.z*o[c];b[c+1]=r.x*s[c+1]+r.y*n[c+1]+r.z*o[c+1];b[c+2]=r.x*s[c+2]+r.y*n[c+2]+r.z*o[c+2];b[c+3]=r.x*s[c+3]+r.y*n[c+3]+r.z*o[c+3];if(h.indexOf(c)==-1)continue;d[c]=a.x*s[c]+a.y*n[c]+a.z*o[c];d[c+1]=a.x*s[c+1]+a.y*n[c+1]+a.z*o[c+1];d[c+2]=a.x*s[c+2]+a.y*n[c+2]+a.z*o[c+2];d[c+3]=a.x*s[c+3]+a.y*n[c+3]+a.z*o[c+3];d[c]-=b[c];d[c+1]-=b[c+1];d[c+2]-=b[c+2];d[c+3]-=b[c+3];m[c]=i.x*s[c]+i.y*n[c]+i.z*o[c];m[c+1]=i.x*s[c+1]+i.y*n[c+1]+i.z*o[c+1];m[c+2]=i.x*s[c+2]+i.y*n[c+2]+i.z*o[c+2];m[c+3]=i.x*s[c+3]+i.y*n[c+3]+i.z*o[c+3];m[c]-=b[c];m[c+1]-=b[c+1];m[c+2]-=b[c+2];m[c+3]-=b[c+3]}for(var c=0;c<p;c++){var _=this._fragmentDescr.tokens[c];e._opCodeFunc[_.opcode](this._fragmentVO,this._fragmentDescr,_.dest,_.a,_.b,t)}return this._fragmentVO};e.getDestTarget=function(e,t,r){var a;if(r.regtype==2){a=e.temp}else if(r.regtype==3){if(t.header.type=="vertex"){a=e.outputPosition}else{a=e.outputColor}}else if(r.regtype==4){a=e.varying}return a};e.getSourceTarget=function(e,t,r,a){var i;if(r.regtype==0){i=e.attributes}else if(r.regtype==1){if(t.header.type=="vertex"){i=a._vertexConstants}else{i=a._fragmentConstants}}else if(r.regtype==2){i=e.temp}else if(r.regtype==4){i=e.varying}return i};e.mov=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;if(g&1)u[o]=f[l+(i.swizzle>>0&3)];if(g&2)u[o+1]=f[l+(i.swizzle>>2&3)];if(g&4)u[o+2]=f[l+(i.swizzle>>4&3)];if(g&8)u[o+3]=f[l+(i.swizzle>>6&3)]};e.m44=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;if(h&1)f[o]=g[l]*c[u]+g[l+1]*c[u+1]+g[l+2]*c[u+2]+c[u+3];if(h&2)f[o+1]=g[l]*c[u+4]+g[l+1]*c[u+5]+g[l+2]*c[u+6]+c[u+7];if(h&4)f[o+2]=g[l]*c[u+8]+g[l+1]*c[u+9]+g[l+2]*c[u+10]+c[u+11];if(h&8)f[o+3]=g[l]*c[u+12]+g[l+1]*c[u+13]+g[l+2]*c[u+14]+c[u+15]};e.sample=function(t,r,a,i,s){var n=4*i.regnum;var f=e.getSourceTarget(t,r,i,a);var g=f[i.swizzle>>0&3];var c=f[i.swizzle>>2&3];if(s>=a._textures.length||a._textures[s]==null)return new Float32Array([1,g,c,0]);var h=a._textures[s];var p=a._samplerStates[s]||this._defaultSamplerState;var _=p.wrap==u.ContextGLWrapMode.REPEAT;var d=p.mipfilter==l.ContextGLMipFilter.MIPLINEAR;if(d&&h.getMipLevelsCount()>1){var m=Math.abs(t.derivativeX[n+(i.swizzle>>0&3)]);var b=Math.abs(t.derivativeX[n+(i.swizzle>>2&3)]);var v=Math.abs(t.derivativeY[n+(i.swizzle>>0&3)]);var x=Math.abs(t.derivativeY[n+(i.swizzle>>2&3)]);var y=Math.log(Math.max(h.width*Math.sqrt(m*m+b*b),h.height*Math.sqrt(v*v+x*x)))/Math.LN2;if(y>0){var w=Math.floor(y);var C=Math.ceil(y);var S=Math.log(Math.min(h.width,h.height))/Math.LN2;if(C>S)C=S;if(w>S)w=S;var T=y-Math.floor(y);var L;var B;var A=h.getData(w);var G=h.width/Math.pow(2,w);var E=h.height/Math.pow(2,w);var O=h.getData(C);var D=h.width/Math.pow(2,C);var M=h.height/Math.pow(2,C);if(p.filter==o.ContextGLTextureFilter.LINEAR){L=e.sampleBilinear(g,c,A,G,E,_);B=e.sampleBilinear(g,c,O,D,M,_)}else{L=e.sampleNearest(g,c,A,G,E,_);B=e.sampleNearest(g,c,O,D,M,_)}return e.interpolateColor(L,B,T)}}var F;var R=h.getData(0);if(p.filter==o.ContextGLTextureFilter.LINEAR){F=e.sampleBilinear(g,c,R,h.width,h.height,_)}else{F=e.sampleNearest(g,c,R,h.width,h.height,_)}return F};e.sampleNearest=function(e,t,r,a,i,s){e*=a;t*=i;if(s){e=Math.abs(e%a);t=Math.abs(t%i)}else{if(e<0)e=0;else if(e>a-1)e=a-1;if(t<0)t=0;else if(t>i-1)t=i-1}e=Math.floor(e);t=Math.floor(t);var n=(e+t*a)*4;var o=r[n]/255;var l=r[n+1]/255;var u=r[n+2]/255;var f=r[n+3]/255;return new Float32Array([f,o,l,u])};e.sampleBilinear=function(t,r,a,i,s,n){var o=1/i;var l=1/s;t-=o/2;r-=l/2;var u=e.sampleNearest(t,r,a,i,s,n);var f=e.sampleNearest(t+o,r,a,i,s,n);var g=e.sampleNearest(t,r+l,a,i,s,n);var c=e.sampleNearest(t+o,r+l,a,i,s,n);var h=t*i;h=h-Math.floor(h);var p=e.interpolateColor(u,f,h);var _=e.interpolateColor(g,c,h);var d=r*s;d=d-Math.floor(d);return e.interpolateColor(p,_,d)};e.interpolateColor=function(e,t,r){var a=new Float32Array(4);a[0]=e[0]+(t[0]-e[0])*r;a[1]=e[1]+(t[1]-e[1])*r;a[2]=e[2]+(t[2]-e[2])*r;a[3]=e[3]+(t[3]-e[3])*r;return a};e.tex=function(t,r,a,i,s,n){var o=4*a.regnum;var l=e.getDestTarget(t,r,a);var u=e.sample(t,r,n,i,s.regnum);var f=a.mask;if(f&1)l[o]=u[1];if(f&2)l[o+1]=u[2];if(f&4)l[o+2]=u[3];if(f&8)l[o+3]=u[0]};e.add=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=g[l+(p>>0&3)]+c[u+(_>>0&3)];if(h&2)f[o+1]=g[l+(p>>2&3)]+c[u+(_>>2&3)];if(h&4)f[o+2]=g[l+(p>>4&3)]+c[u+(_>>4&3)];if(h&8)f[o+3]=g[l+(p>>6&3)]+c[u+(_>>6&3)]};e.sub=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=g[l+(p>>0&3)]-c[u+(_>>0&3)];if(h&2)f[o+1]=g[l+(p>>2&3)]-c[u+(_>>2&3)];if(h&4)f[o+2]=g[l+(p>>4&3)]-c[u+(_>>4&3)];if(h&8)f[o+3]=g[l+(p>>6&3)]-c[u+(_>>6&3)]};e.mul=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=g[l+(p>>0&3)]*c[u+(_>>0&3)];if(h&2)f[o+1]=g[l+(p>>2&3)]*c[u+(_>>2&3)];if(h&4)f[o+2]=g[l+(p>>4&3)]*c[u+(_>>4&3)];if(h&8)f[o+3]=g[l+(p>>6&3)]*c[u+(_>>6&3)]};e.div=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=g[l+(p>>0&3)]/c[u+(_>>0&3)];if(h&2)f[o+1]=g[l+(p>>2&3)]/c[u+(_>>2&3)];if(h&4)f[o+2]=g[l+(p>>4&3)]/c[u+(_>>4&3)];if(h&8)f[o+3]=g[l+(p>>6&3)]/c[u+(_>>6&3)]};e.rcp=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=1/f[l+(c>>0&3)];if(g&2)u[o+1]=1/f[l+(c>>2&3)];if(g&4)u[o+2]=1/f[l+(c>>4&3)];if(g&8)u[o+3]=1/f[l+(c>>6&3)]};e.min=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=Math.min(g[l+(p>>0&3)],c[u+(_>>0&3)]);if(h&2)f[o+1]=Math.min(g[l+(p>>2&3)],c[u+(_>>2&3)]);if(h&4)f[o+2]=Math.min(g[l+(p>>4&3)],c[u+(_>>4&3)]);if(h&8)f[o+3]=Math.min(g[l+(p>>6&3)],c[u+(_>>6&3)])};e.max=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=Math.max(g[l+(p>>0&3)],c[u+(_>>0&3)]);if(h&2)f[o+1]=Math.max(g[l+(p>>2&3)],c[u+(_>>2&3)]);if(h&4)f[o+2]=Math.max(g[l+(p>>4&3)],c[u+(_>>4&3)]);if(h&8)f[o+3]=Math.max(g[l+(p>>6&3)],c[u+(_>>6&3)])};e.frc=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=f[l+(c>>0&3)]-Math.floor(f[l+(c>>0&3)]);if(g&2)u[o+1]=f[l+(c>>2&3)]-Math.floor(f[l+(c>>2&3)]);if(g&4)u[o+2]=f[l+(c>>4&3)]-Math.floor(f[l+(c>>4&3)]);if(g&8)u[o+3]=f[l+(c>>6&3)]-Math.floor(f[l+(c>>6&3)])};e.sqt=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.sqrt(f[l+(c>>0&3)]);if(g&2)u[o+1]=Math.sqrt(f[l+(c>>2&3)]);if(g&4)u[o+2]=Math.sqrt(f[l+(c>>4&3)]);if(g&8)u[o+3]=Math.sqrt(f[l+(c>>6&3)])};e.rsq=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=1/Math.sqrt(f[l+(c>>0&3)]);if(g&2)u[o+1]=1/Math.sqrt(f[l+(c>>2&3)]);if(g&4)u[o+2]=1/Math.sqrt(f[l+(c>>4&3)]);if(g&8)u[o+3]=1/Math.sqrt(f[l+(c>>6&3)])};e.pow=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;var p=i.swizzle;var _=s.swizzle;if(h&1)f[o]=Math.pow(g[l+(p>>0&3)],c[u+(_>>0&3)]);if(h&2)f[o+1]=Math.pow(g[l+(p>>2&3)],c[u+(_>>2&3)]);if(h&4)f[o+2]=Math.pow(g[l+(p>>4&3)],c[u+(_>>4&3)]);if(h&8)f[o+3]=Math.pow(g[l+(p>>6&3)],c[u+(_>>6&3)])};e.log=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.log(f[l+(c>>0&3)])/Math.LN2;if(g&2)u[o+1]=Math.log(f[l+(c>>2&3)])/Math.LN2;if(g&4)u[o+2]=Math.log(f[l+(c>>4&3)])/Math.LN2;if(g&8)u[o+3]=Math.log(f[l+(c>>6&3)])/Math.LN2};e.exp=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.exp(f[l+(c>>0&3)]);if(g&2)u[o+1]=Math.exp(f[l+(c>>2&3)]);if(g&4)u[o+2]=Math.exp(f[l+(c>>4&3)]);if(g&8)u[o+3]=Math.exp(f[l+(c>>6&3)])};e.nrm=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;var h=f[l+(c>>0&3)];var p=f[l+(c>>2&3)];var _=f[l+(c>>4&3)];var d=Math.sqrt(h*h+p*p+_*_);h/=d;p/=d;_/=d;if(g&1)u[o]=h;if(g&2)u[o+1]=p;if(g&4)u[o+2]=_};e.sin=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.sin(f[l+(c>>0&3)]);if(g&2)u[o+1]=Math.sin(f[l+(c>>2&3)]);if(g&4)u[o+2]=Math.sin(f[l+(c>>4&3)]);if(g&8)u[o+3]=Math.sin(f[l+(c>>6&3)])};e.cos=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.cos(f[l+(c>>0&3)]);if(g&2)u[o+1]=Math.cos(f[l+(c>>2&3)]);if(g&4)u[o+2]=Math.cos(f[l+(c>>4&3)]);if(g&8)u[o+3]=Math.cos(f[l+(c>>6&3)])};e.crs=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=e.getSourceTarget(t,r,s,n);var v=b[u+(h>>0&3)];var x=b[u+(h>>2&3)];var y=b[u+(h>>4&3)];if(g&1)f[o]=d*y-m*x;if(g&2)f[o+1]=m*v-_*y;if(g&4)f[o+2]=_*x-d*v};e.dp3=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;
var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=e.getSourceTarget(t,r,s,n);var v=b[u+(h>>0&3)];var x=b[u+(h>>2&3)];var y=b[u+(h>>4&3)];if(g&1)f[o]=_*v+d*x+m*y;if(g&2)f[o+1]=_*v+d*x+m*y;if(g&4)f[o+2]=_*v+d*x+m*y;if(g&8)f[o+3]=_*v+d*x+m*y};e.dp4=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=p[l+(c>>6&3)];var v=e.getSourceTarget(t,r,s,n);var x=v[u+(h>>0&3)];var y=v[u+(h>>2&3)];var w=v[u+(h>>4&3)];var C=v[u+(h>>6&3)];if(g&1)f[o]=_*x+d*y+m*w+b*C;if(g&2)f[o+1]=_*x+d*y+m*w+b*C;if(g&4)f[o+2]=_*x+d*y+m*w+b*C;if(g&8)f[o+3]=_*x+d*y+m*w+b*C};e.abs=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.abs(f[l+(c>>0&3)]);if(g&2)u[o+1]=Math.abs(f[l+(c>>2&3)]);if(g&4)u[o+2]=Math.abs(f[l+(c>>4&3)]);if(g&8)u[o+3]=Math.abs(f[l+(c>>6&3)])};e.neg=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=-f[l+(c>>0&3)];if(g&2)u[o+1]=-f[l+(c>>2&3)];if(g&4)u[o+2]=-f[l+(c>>4&3)];if(g&8)u[o+3]=-f[l+(c>>6&3)]};e.sat=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=e.getSourceTarget(t,r,i,n);var g=a.mask;var c=i.swizzle;if(g&1)u[o]=Math.max(0,Math.min(1,f[l+(c>>0&3)]));if(g&2)u[o+1]=Math.max(0,Math.min(1,f[l+(c>>2&3)]));if(g&4)u[o+2]=Math.max(0,Math.min(1,f[l+(c>>4&3)]));if(g&8)u[o+3]=Math.max(0,Math.min(1,f[l+(c>>6&3)]))};e.m33=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;if(h&1)f[o]=g[l]*c[u]+g[l+1]*c[u+1]+g[l+2]*c[u+2];if(h&2)f[o+1]=g[l]*c[u+4]+g[l+1]*c[u+5]+g[l+2]*c[u+6];if(h&4)f[o+2]=g[l]*c[u+8]+g[l+1]*c[u+9]+g[l+2]*c[u+10]};e.m34=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*s.regnum;var f=e.getDestTarget(t,r,a);var g=e.getSourceTarget(t,r,i,n);var c=e.getSourceTarget(t,r,s,n);var h=a.mask;if(h&1)f[o]=g[l]*c[u]+g[l+1]*c[u+1]+g[l+2]*c[u+2]+c[u+3];if(h&2)f[o+1]=g[l]*c[u+4]+g[l+1]*c[u+5]+g[l+2]*c[u+6]+c[u+7];if(h&4)f[o+2]=g[l]*c[u+8]+g[l+1]*c[u+9]+g[l+2]*c[u+10]+c[u+11]};e.ddx=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=t.derivativeX;var g=a.mask;var c=i.swizzle;if(g&1)u[o]=f[l+(c>>0&3)];if(g&2)u[o+1]=f[l+(c>>2&3)];if(g&4)u[o+2]=f[l+(c>>4&3)];if(g&8)u[o+3]=f[l+(c>>6&3)]};e.ddy=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=t.derivativeY;var g=a.mask;var c=i.swizzle;if(g&1)u[o]=f[l+(c>>0&3)];if(g&2)u[o+1]=f[l+(c>>2&3)];if(g&4)u[o+2]=f[l+(c>>4&3)];if(g&8)u[o+3]=f[l+(c>>6&3)]};e.sge=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*i.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=p[l+(c>>6&3)];var v=e.getSourceTarget(t,r,s,n);var x=v[u+(h>>0&3)];var y=v[u+(h>>2&3)];var w=v[u+(h>>4&3)];var C=v[u+(h>>6&3)];if(g&1)f[o]=_>=x?1:0;if(g&2)f[o+1]=d>=y?1:0;if(g&4)f[o+2]=m>=w?1:0;if(g&8)f[o+3]=b>=C?1:0};e.slt=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*i.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=p[l+(c>>6&3)];var v=e.getSourceTarget(t,r,s,n);var x=v[u+(h>>0&3)];var y=v[u+(h>>2&3)];var w=v[u+(h>>4&3)];var C=v[u+(h>>6&3)];if(g&1)f[o]=_<x?1:0;if(g&2)f[o+1]=d<y?1:0;if(g&4)f[o+2]=m<w?1:0;if(g&8)f[o+3]=b<C?1:0};e.seq=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*i.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=p[l+(c>>6&3)];var v=e.getSourceTarget(t,r,s,n);var x=v[u+(h>>0&3)];var y=v[u+(h>>2&3)];var w=v[u+(h>>4&3)];var C=v[u+(h>>6&3)];if(g&1)f[o]=_==x?1:0;if(g&2)f[o+1]=d==y?1:0;if(g&4)f[o+2]=m==w?1:0;if(g&8)f[o+3]=b==C?1:0};e.sne=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=4*i.regnum;var f=e.getDestTarget(t,r,a);var g=a.mask;var c=i.swizzle;var h=s.swizzle;var p=e.getSourceTarget(t,r,i,n);var _=p[l+(c>>0&3)];var d=p[l+(c>>2&3)];var m=p[l+(c>>4&3)];var b=p[l+(c>>6&3)];var v=e.getSourceTarget(t,r,s,n);var x=v[u+(h>>0&3)];var y=v[u+(h>>2&3)];var w=v[u+(h>>4&3)];var C=v[u+(h>>6&3)];if(g&1)f[o]=_!=x?1:0;if(g&2)f[o+1]=d!=y?1:0;if(g&4)f[o+2]=m!=w?1:0;if(g&8)f[o+3]=b!=C?1:0};e.sgn=function(t,r,a,i,s,n){var o=4*a.regnum;var l=4*i.regnum;var u=e.getDestTarget(t,r,a);var f=a.mask;var g=i.swizzle;var c=e.getSourceTarget(t,r,i,n);var h=c[l+(g>>0&3)];var p=c[l+(g>>2&3)];var _=c[l+(g>>4&3)];var d=c[l+(g>>6&3)];if(f&1)u[o]=h<0?-1:h>0?1:0;if(f&2)u[o+1]=p<0?-1:p>0?1:0;if(f&4)u[o+2]=_<0?-1:_>0?1:0;if(f&8)u[o+3]=d<0?-1:d>0?1:0};e.kil=function(t,r,a,i,s,n){var o=4*i.regnum;var l=i.swizzle;var u=e.getSourceTarget(t,r,i,n);var f=u[o+(l>>0&3)];if(f<0)t.discard=true};e._defaultSamplerState=new n.SoftwareSamplerState;e._tokenizer=new a.AGALTokenizer;e._opCodeFunc=[e.mov,e.add,e.sub,e.mul,e.div,e.rcp,e.min,e.max,e.frc,e.sqt,e.rsq,e.pow,e.log,e.exp,e.nrm,e.sin,e.cos,e.crs,e.dp3,e.dp4,e.abs,e.neg,e.sat,e.m33,e.m44,e.m34,null,null,null,null,null,null,null,null,null,null,null,null,null,e.kil,e.tex,e.sge,e.slt,e.sgn,e.seq,e.sne];return e}();r.ProgramSoftware=f},{"../aglsl/AGALTokenizer":"awayjs-stagegl/lib/aglsl/AGALTokenizer","../base/ContextGLMipFilter":"awayjs-stagegl/lib/base/ContextGLMipFilter","../base/ContextGLTextureFilter":"awayjs-stagegl/lib/base/ContextGLTextureFilter","../base/ContextGLVertexBufferFormat":"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat","../base/ContextGLWrapMode":"awayjs-stagegl/lib/base/ContextGLWrapMode","../base/ProgramVOSoftware":"awayjs-stagegl/lib/base/ProgramVOSoftware","../base/SoftwareSamplerState":"awayjs-stagegl/lib/base/SoftwareSamplerState"}],"awayjs-stagegl/lib/base/ProgramVOSoftware":[function(e,t,r){"use strict";var a=function(){function e(){this.outputColor=new Float32Array([0,0,0,1]);this.discard=false}return e}();r.ProgramVOSoftware=a},{}],"awayjs-stagegl/lib/base/ProgramWebGL":[function(e,t,r){"use strict";var a=e("../aglsl/AGALTokenizer");var i=e("../aglsl/AGLSLParser");var s=function(){function e(e){this._uniforms=[[],[],[]];this._attribs=[];this._gl=e;this._program=this._gl.createProgram()}e.prototype.upload=function(t,r){var a=e._aglslParser.parse(e._tokenizer.decribeAGALByteArray(t));var i=e._aglslParser.parse(e._tokenizer.decribeAGALByteArray(r));this._vertexShader=this._gl.createShader(this._gl.VERTEX_SHADER);this._fragmentShader=this._gl.createShader(this._gl.FRAGMENT_SHADER);this._gl.shaderSource(this._vertexShader,a);this._gl.compileShader(this._vertexShader);if(!this._gl.getShaderParameter(this._vertexShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._vertexShader));this._gl.shaderSource(this._fragmentShader,i);this._gl.compileShader(this._fragmentShader);if(!this._gl.getShaderParameter(this._fragmentShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._fragmentShader));this._gl.attachShader(this._program,this._vertexShader);this._gl.attachShader(this._program,this._fragmentShader);this._gl.linkProgram(this._program);if(!this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS))throw new Error(this._gl.getProgramInfoLog(this._program));this._uniforms[0].length=0;this._uniforms[1].length=0;this._uniforms[2].length=0;this._attribs.length=0};e.prototype.getUniformLocation=function(t,r){if(r===void 0){r=-1}if(this._uniforms[t][r+1]!=null)return this._uniforms[t][r+1];var a=r==-1?e._uniformLocationNameDictionary[t]:e._uniformLocationNameDictionary[t]+r;return this._uniforms[t][r+1]=this._gl.getUniformLocation(this._program,a)};e.prototype.getAttribLocation=function(e){if(this._attribs[e]!=null)return this._attribs[e];return this._attribs[e]=this._gl.getAttribLocation(this._program,"va"+e)};e.prototype.dispose=function(){this._gl.deleteProgram(this._program)};e.prototype.focusProgram=function(){this._gl.useProgram(this._program)};Object.defineProperty(e.prototype,"glProgram",{get:function(){return this._program},enumerable:true,configurable:true});e._tokenizer=new a.AGALTokenizer;e._aglslParser=new i.AGLSLParser;e._uniformLocationNameDictionary=["fc","fs","vc"];return e}();r.ProgramWebGL=s},{"../aglsl/AGALTokenizer":"awayjs-stagegl/lib/aglsl/AGALTokenizer","../aglsl/AGLSLParser":"awayjs-stagegl/lib/aglsl/AGLSLParser"}],"awayjs-stagegl/lib/base/ResourceBaseFlash":[function(e,t,r){"use strict";var a=function(){function e(){}Object.defineProperty(e.prototype,"id",{get:function(){return this._pId},enumerable:true,configurable:true});e.prototype.dispose=function(){};return e}();r.ResourceBaseFlash=a},{}],"awayjs-stagegl/lib/base/SamplerState":[function(e,t,r){"use strict";var a=function(){function e(){}return e}();r.SamplerState=a},{}],"awayjs-stagegl/lib/base/SoftwareSamplerState":[function(e,t,r){"use strict";var a=e("./ContextGLTextureFilter");var i=e("./ContextGLMipFilter");var s=e("./ContextGLWrapMode");var n=function(){function e(){this.wrap=s.ContextGLWrapMode.REPEAT;this.filter=a.ContextGLTextureFilter.LINEAR;this.mipfilter=i.ContextGLMipFilter.MIPLINEAR}return e}();r.SoftwareSamplerState=n;Object.defineProperty(r,"__esModule",{value:true});r.default=n},{"./ContextGLMipFilter":"awayjs-stagegl/lib/base/ContextGLMipFilter","./ContextGLTextureFilter":"awayjs-stagegl/lib/base/ContextGLTextureFilter","./ContextGLWrapMode":"awayjs-stagegl/lib/base/ContextGLWrapMode"}],"awayjs-stagegl/lib/base/Stage":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/events/EventDispatcher");var s=e("awayjs-core/lib/geom/Rectangle");var n=e("awayjs-core/lib/utils/CSS");var o=e("../base/ContextMode");var l=e("../base/ContextGLMipFilter");var u=e("../base/ContextGLTextureFilter");var f=e("../base/ContextGLVertexBufferFormat");var g=e("../base/ContextGLWrapMode");var c=e("../base/ContextWebGL");var h=e("../base/ContextStage3D");var p=e("../base/ContextSoftware");var _=e("../events/StageEvent");var d=e("../image/ProgramDataPool");var m=function(e){a(t,e);function t(t,r,a,i,o){var l=this;if(i===void 0){i=false}if(o===void 0){o="baseline"}e.call(this);this._abstractionPool=new Object;this._programData=new Array;this._x=0;this._y=0;this._stageIndex=-1;this._antiAlias=0;this._renderTarget=null;this._renderSurfaceSelector=0;this._initialised=false;this._bufferFormatDictionary=new Array(5);this.globalDisableMipmap=false;this.globalDisableSmooth=false;this._programDataPool=new d.ProgramDataPool(this);this._container=t;if(this._container){this._container.addEventListener("webglcontextlost",function(e){return l.onContextLost(e)});this._container.addEventListener("webglcontextrestored",function(e){return l.onContextRestored(e)})}this._stageIndex=r;this._stageManager=a;this._viewPort=new s.Rectangle;this._enableDepthAndStencil=true;n.CSS.setElementX(this._container,0);n.CSS.setElementY(this._container,0);this._bufferFormatDictionary[1]=new Array(5);this._bufferFormatDictionary[1][1]=f.ContextGLVertexBufferFormat.BYTE_1;this._bufferFormatDictionary[1][2]=f.ContextGLVertexBufferFormat.BYTE_2;this._bufferFormatDictionary[1][3]=f.ContextGLVertexBufferFormat.BYTE_3;this._bufferFormatDictionary[1][4]=f.ContextGLVertexBufferFormat.BYTE_4;this._bufferFormatDictionary[2]=new Array(5);this._bufferFormatDictionary[2][1]=f.ContextGLVertexBufferFormat.SHORT_1;this._bufferFormatDictionary[2][2]=f.ContextGLVertexBufferFormat.SHORT_2;this._bufferFormatDictionary[2][3]=f.ContextGLVertexBufferFormat.SHORT_3;this._bufferFormatDictionary[2][4]=f.ContextGLVertexBufferFormat.SHORT_4;this._bufferFormatDictionary[4]=new Array(5);this._bufferFormatDictionary[4][1]=f.ContextGLVertexBufferFormat.FLOAT_1;this._bufferFormatDictionary[4][2]=f.ContextGLVertexBufferFormat.FLOAT_2;this._bufferFormatDictionary[4][3]=f.ContextGLVertexBufferFormat.FLOAT_3;this._bufferFormatDictionary[4][4]=f.ContextGLVertexBufferFormat.FLOAT_4;this._bufferFormatDictionary[5]=new Array(5);this._bufferFormatDictionary[5][1]=f.ContextGLVertexBufferFormat.UNSIGNED_BYTE_1;this._bufferFormatDictionary[5][2]=f.ContextGLVertexBufferFormat.UNSIGNED_BYTE_2;this._bufferFormatDictionary[5][3]=f.ContextGLVertexBufferFormat.UNSIGNED_BYTE_3;this._bufferFormatDictionary[5][4]=f.ContextGLVertexBufferFormat.UNSIGNED_BYTE_4;this._bufferFormatDictionary[6]=new Array(5);this._bufferFormatDictionary[6][1]=f.ContextGLVertexBufferFormat.UNSIGNED_SHORT_1;this._bufferFormatDictionary[6][2]=f.ContextGLVertexBufferFormat.UNSIGNED_SHORT_2;this._bufferFormatDictionary[6][3]=f.ContextGLVertexBufferFormat.UNSIGNED_SHORT_3;this._bufferFormatDictionary[6][4]=f.ContextGLVertexBufferFormat.UNSIGNED_SHORT_4;this.visible=true}t.prototype.getProgramData=function(e,t){return this._programDataPool.getItem(e,t)};t.prototype.setRenderTarget=function(e,t,r){if(t===void 0){t=false}if(r===void 0){r=0}if(this._renderTarget===e&&r==this._renderSurfaceSelector&&this._enableDepthAndStencil==t)return;this._renderTarget=e;this._renderSurfaceSelector=r;this._enableDepthAndStencil=t;if(e){this._context.setRenderToTexture(this.getAbstraction(e).texture,t,this._antiAlias,r)}else{this._context.setRenderToBackBuffer();this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)}};t.prototype.getAbstraction=function(e){return this._abstractionPool[e.id]||(this._abstractionPool[e.id]=new t._abstractionClassPool[e.assetType](e,this))};t.prototype.clearAbstraction=function(e){this._abstractionPool[e.id]=null};t.registerAbstraction=function(e,r){t._abstractionClassPool[r.assetType]=e};t.prototype.requestContext=function(e,t,r){var a=this;if(e===void 0){e=false}if(t===void 0){t="baseline"}if(r===void 0){r="auto"}if(this._usesSoftwareRendering!=null)this._usesSoftwareRendering=e;this._profile=t;try{if(r==o.ContextMode.FLASH)new h.ContextStage3D(this._container,function(e){return a._callback(e)});else if(r==o.ContextMode.SOFTWARE)this._context=new p.ContextSoftware(this._container);else this._context=new c.ContextWebGL(this._container)}catch(i){try{if(r==o.ContextMode.AUTO)new h.ContextStage3D(this._container,function(e){return a._callback(e)});else this.dispatchEvent(new _.StageEvent(_.StageEvent.STAGE_ERROR,this))}catch(i){this.dispatchEvent(new _.StageEvent(_.StageEvent.STAGE_ERROR,this))}}if(this._context)this._callback(this._context)};Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){if(this._width==e)return;n.CSS.setElementWidth(this._container,e);this._width=this._viewPort.width=e;this._backBufferDirty=true;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){if(this._height==e)return;n.CSS.setElementHeight(this._container,e);this._height=this._viewPort.height=e;this._backBufferDirty=true;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){if(this._x==e)return;n.CSS.setElementX(this._container,e);this._x=this._viewPort.x=e;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){if(this._y==e)return;n.CSS.setElementY(this._container,e);this._y=this._viewPort.y=e;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"visible",{get:function(){return n.CSS.getElementVisibility(this._container)},set:function(e){n.CSS.setElementVisibility(this._container,e)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:true,configurable:true});t.prototype.notifyViewportUpdated=function(){if(this._viewportDirty)return;this._viewportDirty=true;this.dispatchEvent(new _.StageEvent(_.StageEvent.VIEWPORT_UPDATED,this))};Object.defineProperty(t.prototype,"profile",{get:function(){return this._profile},enumerable:true,configurable:true});t.prototype.dispose=function(){for(var e in this._abstractionPool)this._abstractionPool[e].clear();this._abstractionPool=null;this._stageManager.iRemoveStage(this);this.freeContext();this._stageManager=null;this._stageIndex=-1};t.prototype.configureBackBuffer=function(e,t,r,a){this.width=e;this.height=t;this._antiAlias=r;this._enableDepthAndStencil=a;if(this._context)this._context.configureBackBuffer(e,t,r,a)};Object.defineProperty(t.prototype,"enableDepthAndStencil",{get:function(){return this._enableDepthAndStencil},set:function(e){this._enableDepthAndStencil=e;this._backBufferDirty=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderSurfaceSelector",{get:function(){return this._renderSurfaceSelector},enumerable:true,configurable:true});t.prototype.clear=function(){if(!this._context)return;if(this._backBufferDirty){this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil);this._backBufferDirty=false}this._context.clear((this._color&4278190080)>>>24,(this._color&16711680)>>>16,(this._color&65280)>>>8,this._color&255);this._bufferClear=true};Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._scissorRect},set:function(e){this._scissorRect=e;this._context.setScissorRectangle(this._scissorRect)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stageIndex",{get:function(){return this._stageIndex},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"usesSoftwareRendering",{get:function(){return this._usesSoftwareRendering},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){this._antiAlias=e;this._backBufferDirty=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewPort",{get:function(){this._viewportDirty=false;return this._viewPort},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"bufferClear",{get:function(){return this._bufferClear},set:function(e){this._bufferClear=e},enumerable:true,configurable:true});t.prototype.registerProgram=function(e){var t=0;while(this._programData[t]!=null)t++;this._programData[t]=e;e.id=t};t.prototype.unRegisterProgram=function(e){this._programData[e.id]=null;e.id=-1};t.prototype.freeContext=function(){if(this._context){this._context.dispose();this.dispatchEvent(new _.StageEvent(_.StageEvent.CONTEXT_DISPOSED,this))}this._context=null;this._initialised=false};t.prototype.onContextLost=function(e){};t.prototype.onContextRestored=function(e){};t.prototype.recoverFromDisposal=function(){if(!this._context)return false;return true};t.prototype._callback=function(e){this._context=e;this._container=this._context.container;if(this._width&&this._height)this._context.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil);this.dispatchEvent(new _.StageEvent(this._initialised?_.StageEvent.CONTEXT_RECREATED:_.StageEvent.CONTEXT_CREATED,this));this._initialised=true};t.prototype.setVertexBuffer=function(e,t,r,a,i,s){if(s===void 0){s=false}this._context.setVertexBufferAt(e,t,i,this._bufferFormatDictionary[s?r+4:r][a])};t.prototype.setSamplerState=function(e,t,r,a){var i=t?g.ContextGLWrapMode.REPEAT:g.ContextGLWrapMode.CLAMP;var s=r&&!this.globalDisableSmooth?u.ContextGLTextureFilter.LINEAR:u.ContextGLTextureFilter.NEAREST;var n=a&&!this.globalDisableMipmap?l.ContextGLMipFilter.MIPLINEAR:l.ContextGLMipFilter.MIPNONE;this._context.setSamplerStateAt(e,i,s,n)};t._abstractionClassPool=new Object;return t}(i.EventDispatcher);r.Stage=m},{"../base/ContextGLMipFilter":"awayjs-stagegl/lib/base/ContextGLMipFilter","../base/ContextGLTextureFilter":"awayjs-stagegl/lib/base/ContextGLTextureFilter","../base/ContextGLVertexBufferFormat":"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat","../base/ContextGLWrapMode":"awayjs-stagegl/lib/base/ContextGLWrapMode","../base/ContextMode":"awayjs-stagegl/lib/base/ContextMode","../base/ContextSoftware":"awayjs-stagegl/lib/base/ContextSoftware","../base/ContextStage3D":"awayjs-stagegl/lib/base/ContextStage3D","../base/ContextWebGL":"awayjs-stagegl/lib/base/ContextWebGL","../events/StageEvent":"awayjs-stagegl/lib/events/StageEvent","../image/ProgramDataPool":"awayjs-stagegl/lib/image/ProgramDataPool","awayjs-core/lib/events/EventDispatcher":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/utils/CSS":undefined}],"awayjs-stagegl/lib/base/TextureBaseWebGL":[function(e,t,r){"use strict";var a=e("awayjs-core/lib/errors/AbstractMethodError");var i=function(){function e(e){this.textureType="";this._gl=e}e.prototype.dispose=function(){throw"Abstract method must be overridden."};Object.defineProperty(e.prototype,"glTexture",{get:function(){throw new a.AbstractMethodError},enumerable:true,configurable:true});return e}();r.TextureBaseWebGL=i},{"awayjs-core/lib/errors/AbstractMethodError":undefined}],"awayjs-stagegl/lib/base/TextureFlash":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/utils/ByteArrayBase");var s=e("../base/OpCodes");var n=e("../base/ResourceBaseFlash");var o=function(e){a(t,e);function t(t,r,a,i,n,o){if(o===void 0){o=false}e.call(this);this._context=t;this._width=r;this._height=a;this._context.addStream(String.fromCharCode(s.OpCodes.initTexture,n?s.OpCodes.trueValue:s.OpCodes.falseValue)+r+","+a+","+o+","+i+"$");this._pId=this._context.execute();this._context._iAddResource(this)}Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(s.OpCodes.disposeTexture)+this._pId.toString()+",");this._context.execute();this._context._iRemoveResource(this);this._context=null};t.prototype.uploadFromData=function(e,t){if(t===void 0){t=0}if(e instanceof HTMLImageElement){var r=document.createElement("canvas");var a=e.width;var n=e.height;r.width=a;r.height=n;var o=r.getContext("2d");o.drawImage(e,0,0);e=o.getImageData(0,0,a,n).data}var l=0;var u=i.ByteArrayBase.internalGetBase64String(e.length,function(){return e[l++]},null);this._context.addStream(String.fromCharCode(s.OpCodes.uploadBytesTexture)+this._pId+","+t+","+(this._width>>t)+","+(this._height>>t)+","+u+"%");this._context.execute()};return t}(n.ResourceBaseFlash);r.TextureFlash=o},{"../base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","../base/ResourceBaseFlash":"awayjs-stagegl/lib/base/ResourceBaseFlash","awayjs-core/lib/utils/ByteArrayBase":undefined}],"awayjs-stagegl/lib/base/TextureSoftware":[function(e,t,r){"use strict";var a=function(){function e(e,t){this.textureType="texture2d";this._mipLevels=[];this._width=e;this._height=t}e.prototype.dispose=function(){this._mipLevels=null};Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});e.prototype.uploadFromData=function(e,t){if(t===void 0){t=0}this._mipLevels[t]=e.data};e.prototype.getData=function(e){return this._mipLevels[e]};e.prototype.getMipLevelsCount=function(){return this._mipLevels.length};return e}();r.TextureSoftware=a},{}],"awayjs-stagegl/lib/base/TextureWebGL":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/TextureBaseWebGL");var s=function(e){a(t,e);function t(t,r,a){e.call(this,t);this.textureType="texture2d";this._width=r;this._height=a;this._glTexture=this._gl.createTexture()}t.prototype.dispose=function(){this._gl.deleteTexture(this._glTexture)};Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"frameBuffer",{get:function(){if(!this._frameBuffer){this._frameBuffer=this._gl.createFramebuffer();this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._frameBuffer);this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null);var e=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,e);this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_STENCIL,this._width,this._height);this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._glTexture,0);this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_STENCIL_ATTACHMENT,this._gl.RENDERBUFFER,e);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null);this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return this._frameBuffer},enumerable:true,configurable:true});t.prototype.uploadFromData=function(e,t){if(t===void 0){t=0}this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,t,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e);this._gl.bindTexture(this._gl.TEXTURE_2D,null)};t.prototype.uploadCompressedTextureFromByteArray=function(e,t,r){if(r===void 0){r=false}var a=this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")};Object.defineProperty(t.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:true,configurable:true});t.prototype.generateMipmaps=function(){};return t}(i.TextureBaseWebGL);r.TextureWebGL=s},{"../base/TextureBaseWebGL":"awayjs-stagegl/lib/base/TextureBaseWebGL"}],"awayjs-stagegl/lib/base/VertexBufferFlash":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/OpCodes");var s=e("../base/ResourceBaseFlash");var n=function(e){a(t,e);function t(t,r,a){e.call(this);this._context=t;this._numVertices=r;this._dataPerVertex=a;this._context.addStream(String.fromCharCode(i.OpCodes.initVertexBuffer,a+i.OpCodes.intMask)+r.toString()+",");this._pId=this._context.execute();this._context._iAddResource(this)}t.prototype.uploadFromArray=function(e,t,r){this._context.addStream(String.fromCharCode(i.OpCodes.uploadArrayVertexBuffer,this._pId+i.OpCodes.intMask)+e.join()+"#"+[t,r].join()+",");this._context.execute()};t.prototype.uploadFromByteArray=function(e,t,r){};Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(i.OpCodes.disposeVertexBuffer,this._pId+i.OpCodes.intMask));this._context.execute();this._context._iRemoveResource(this);this._context=null};return t}(s.ResourceBaseFlash);r.VertexBufferFlash=n},{"../base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","../base/ResourceBaseFlash":"awayjs-stagegl/lib/base/ResourceBaseFlash"}],"awayjs-stagegl/lib/base/VertexBufferSoftware":[function(e,t,r){"use strict";var a=function(){function e(e,t){this._numVertices=e;this._dataPerVertex=t}e.prototype.uploadFromArray=function(e,t,r){this._floatData=new Float32Array(e)};e.prototype.uploadFromByteArray=function(e,t,r){this._floatData=new Float32Array(e,t*this._dataPerVertex,r*this._dataPerVertex/4);this._uintData=new Uint8Array(e)};Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"attributesPerVertex",{get:function(){return this._dataPerVertex/4},enumerable:true,configurable:true});e.prototype.dispose=function(){this._floatData=null};Object.defineProperty(e.prototype,"data",{get:function(){return this._floatData},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"uintData",{get:function(){return this._uintData},enumerable:true,configurable:true});return e}();r.VertexBufferSoftware=a},{}],"awayjs-stagegl/lib/base/VertexBufferWebGL":[function(e,t,r){"use strict";var a=function(){function e(e,t,r){this._gl=e;this._buffer=this._gl.createBuffer();this._numVertices=t;this._dataPerVertex=r}e.prototype.uploadFromArray=function(e,t,r){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer);if(t)this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t*this._dataPerVertex,new Float32Array(e));else this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW)};e.prototype.uploadFromByteArray=function(e,t,r){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer);if(t)this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t*this._dataPerVertex,e);else this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW)};Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:true,configurable:true});e.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)};return e}();r.VertexBufferWebGL=a},{}],"awayjs-stagegl/lib/base":[function(e,t,r){"use strict";var a=e("./base/ContextGLBlendFactor");r.ContextGLBlendFactor=a.ContextGLBlendFactor;var i=e("./base/ContextGLClearMask");r.ContextGLClearMask=i.ContextGLClearMask;var s=e("./base/ContextGLCompareMode");r.ContextGLCompareMode=s.ContextGLCompareMode;var n=e("./base/ContextGLDrawMode");r.ContextGLDrawMode=n.ContextGLDrawMode;var o=e("./base/ContextGLMipFilter");r.ContextGLMipFilter=o.ContextGLMipFilter;var l=e("./base/ContextGLProfile");r.ContextGLProfile=l.ContextGLProfile;var u=e("./base/ContextGLProgramType");r.ContextGLProgramType=u.ContextGLProgramType;var f=e("./base/ContextGLStencilAction");r.ContextGLStencilAction=f.ContextGLStencilAction;var g=e("./base/ContextGLTextureFilter");r.ContextGLTextureFilter=g.ContextGLTextureFilter;var c=e("./base/ContextGLTextureFormat");r.ContextGLTextureFormat=c.ContextGLTextureFormat;var h=e("./base/ContextGLTriangleFace");r.ContextGLTriangleFace=h.ContextGLTriangleFace;var p=e("./base/ContextGLVertexBufferFormat");r.ContextGLVertexBufferFormat=p.ContextGLVertexBufferFormat;var _=e("./base/ContextGLWrapMode");
r.ContextGLWrapMode=_.ContextGLWrapMode;var d=e("./base/ContextMode");r.ContextMode=d.ContextMode;var m=e("./base/ContextSoftware");r.ContextSoftware=m.ContextSoftware;var b=e("./base/ContextStage3D");r.ContextStage3D=b.ContextStage3D;var v=e("./base/ContextWebGL");r.ContextWebGL=v.ContextWebGL;var x=e("./base/CubeTextureFlash");r.CubeTextureFlash=x.CubeTextureFlash;var y=e("./base/CubeTextureWebGL");r.CubeTextureWebGL=y.CubeTextureWebGL;var w=e("./base/IndexBufferFlash");r.IndexBufferFlash=w.IndexBufferFlash;var C=e("./base/IndexBufferSoftware");r.IndexBufferSoftware=C.IndexBufferSoftware;var S=e("./base/IndexBufferWebGL");r.IndexBufferWebGL=S.IndexBufferWebGL;var T=e("./base/OpCodes");r.OpCodes=T.OpCodes;var L=e("./base/ProgramFlash");r.ProgramFlash=L.ProgramFlash;var B=e("./base/ProgramSoftware");r.ProgramSoftware=B.ProgramSoftware;var A=e("./base/ProgramVOSoftware");r.ProgramVOSoftware=A.ProgramVOSoftware;var G=e("./base/ProgramWebGL");r.ProgramWebGL=G.ProgramWebGL;var E=e("./base/ResourceBaseFlash");r.ResourceBaseFlash=E.ResourceBaseFlash;var O=e("./base/SamplerState");r.SamplerState=O.SamplerState;var D=e("./base/SoftwareSamplerState");r.SoftwareSamplerState=D.SoftwareSamplerState;var M=e("./base/Stage");r.Stage=M.Stage;var F=e("./base/TextureBaseWebGL");r.TextureBaseWebGL=F.TextureBaseWebGL;var R=e("./base/TextureFlash");r.TextureFlash=R.TextureFlash;var P=e("./base/TextureSoftware");r.TextureSoftware=P.TextureSoftware;var j=e("./base/TextureWebGL");r.TextureWebGL=j.TextureWebGL;var I=e("./base/VertexBufferFlash");r.VertexBufferFlash=I.VertexBufferFlash;var N=e("./base/VertexBufferSoftware");r.VertexBufferSoftware=N.VertexBufferSoftware;var U=e("./base/VertexBufferWebGL");r.VertexBufferWebGL=U.VertexBufferWebGL},{"./base/ContextGLBlendFactor":"awayjs-stagegl/lib/base/ContextGLBlendFactor","./base/ContextGLClearMask":"awayjs-stagegl/lib/base/ContextGLClearMask","./base/ContextGLCompareMode":"awayjs-stagegl/lib/base/ContextGLCompareMode","./base/ContextGLDrawMode":"awayjs-stagegl/lib/base/ContextGLDrawMode","./base/ContextGLMipFilter":"awayjs-stagegl/lib/base/ContextGLMipFilter","./base/ContextGLProfile":"awayjs-stagegl/lib/base/ContextGLProfile","./base/ContextGLProgramType":"awayjs-stagegl/lib/base/ContextGLProgramType","./base/ContextGLStencilAction":"awayjs-stagegl/lib/base/ContextGLStencilAction","./base/ContextGLTextureFilter":"awayjs-stagegl/lib/base/ContextGLTextureFilter","./base/ContextGLTextureFormat":"awayjs-stagegl/lib/base/ContextGLTextureFormat","./base/ContextGLTriangleFace":"awayjs-stagegl/lib/base/ContextGLTriangleFace","./base/ContextGLVertexBufferFormat":"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat","./base/ContextGLWrapMode":"awayjs-stagegl/lib/base/ContextGLWrapMode","./base/ContextMode":"awayjs-stagegl/lib/base/ContextMode","./base/ContextSoftware":"awayjs-stagegl/lib/base/ContextSoftware","./base/ContextStage3D":"awayjs-stagegl/lib/base/ContextStage3D","./base/ContextWebGL":"awayjs-stagegl/lib/base/ContextWebGL","./base/CubeTextureFlash":"awayjs-stagegl/lib/base/CubeTextureFlash","./base/CubeTextureWebGL":"awayjs-stagegl/lib/base/CubeTextureWebGL","./base/IndexBufferFlash":"awayjs-stagegl/lib/base/IndexBufferFlash","./base/IndexBufferSoftware":"awayjs-stagegl/lib/base/IndexBufferSoftware","./base/IndexBufferWebGL":"awayjs-stagegl/lib/base/IndexBufferWebGL","./base/OpCodes":"awayjs-stagegl/lib/base/OpCodes","./base/ProgramFlash":"awayjs-stagegl/lib/base/ProgramFlash","./base/ProgramSoftware":"awayjs-stagegl/lib/base/ProgramSoftware","./base/ProgramVOSoftware":"awayjs-stagegl/lib/base/ProgramVOSoftware","./base/ProgramWebGL":"awayjs-stagegl/lib/base/ProgramWebGL","./base/ResourceBaseFlash":"awayjs-stagegl/lib/base/ResourceBaseFlash","./base/SamplerState":"awayjs-stagegl/lib/base/SamplerState","./base/SoftwareSamplerState":"awayjs-stagegl/lib/base/SoftwareSamplerState","./base/Stage":"awayjs-stagegl/lib/base/Stage","./base/TextureBaseWebGL":"awayjs-stagegl/lib/base/TextureBaseWebGL","./base/TextureFlash":"awayjs-stagegl/lib/base/TextureFlash","./base/TextureSoftware":"awayjs-stagegl/lib/base/TextureSoftware","./base/TextureWebGL":"awayjs-stagegl/lib/base/TextureWebGL","./base/VertexBufferFlash":"awayjs-stagegl/lib/base/VertexBufferFlash","./base/VertexBufferSoftware":"awayjs-stagegl/lib/base/VertexBufferSoftware","./base/VertexBufferWebGL":"awayjs-stagegl/lib/base/VertexBufferWebGL"}],"awayjs-stagegl/lib/events/StageEvent":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/events/EventBase");var s=function(e){a(t,e);function t(t,r){e.call(this,t);this._stage=r}Object.defineProperty(t.prototype,"stage",{get:function(){return this._stage},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._stage)};t.STAGE_ERROR="stageError";t.CONTEXT_CREATED="contextCreated";t.CONTEXT_DISPOSED="contextDisposed";t.CONTEXT_RECREATED="contextRecreated";t.VIEWPORT_UPDATED="viewportUpdated";return t}(i.EventBase);r.StageEvent=s},{"awayjs-core/lib/events/EventBase":undefined}],"awayjs-stagegl/lib/events":[function(e,t,r){"use strict";var a=e("./events/StageEvent");r.StageEvent=a.StageEvent},{"./events/StageEvent":"awayjs-stagegl/lib/events/StageEvent"}],"awayjs-stagegl/lib/image/GL_BitmapImage2D":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/utils/MipmapGenerator");var s=e("../image/GL_Image2D");var n=function(e){a(t,e);function t(){e.apply(this,arguments)}t.prototype.activate=function(t,r){if(r&&this._stage.globalDisableMipmap)r=false;if(!this._texture){this._createTexture();this._invalid=true}if(!this._mipmap&&r){this._mipmap=true;this._invalid=true}if(this._invalid){this._invalid=false;if(r){var a=this._mipmapData||(this._mipmapData=new Array);i.MipmapGenerator._generateMipMaps(this._asset.getCanvas(),a,true);var s=a.length;for(var n=0;n<s;n++)this._texture.uploadFromData(a[n].getImageData(),n)}else{this._texture.uploadFromData(this._asset.getImageData(),0)}}e.prototype.activate.call(this,t,r)};t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);if(this._mipmapData){var r=this._mipmapData.length;for(var a=0;a<r;a++)i.MipmapGenerator._freeMipMapHolder(this._mipmapData[a])}};return t}(s.GL_Image2D);r.GL_BitmapImage2D=n},{"../image/GL_Image2D":"awayjs-stagegl/lib/image/GL_Image2D","awayjs-core/lib/utils/MipmapGenerator":undefined}],"awayjs-stagegl/lib/image/GL_BitmapImageCube":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/utils/MipmapGenerator");var s=e("../image/GL_ImageCube");var n=function(e){a(t,e);function t(){e.apply(this,arguments);this._mipmapDataArray=new Array(6)}t.prototype.activate=function(t,r){if(r&&this._stage.globalDisableMipmap)r=false;if(!this._texture){this._createTexture();this._invalid=true}if(!this._mipmap&&r){this._mipmap=true;this._invalid=true}if(this._invalid){this._invalid=false;for(var a=0;a<6;++a){if(r){var s=this._mipmapDataArray[a]||(this._mipmapDataArray[a]=new Array);i.MipmapGenerator._generateMipMaps(this._asset.getCanvas(a),s,true);var n=s.length;for(var o=0;o<n;o++)this._texture.uploadFromData(s[o].getImageData(),a,o)}else{this._texture.uploadFromData(this._asset.getImageData(a),a,0)}}}e.prototype.activate.call(this,t,r)};t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);for(var r=0;r<6;r++){var a=this._mipmapDataArray[r];if(a){var s=a.length;for(var n=0;n<s;r++)i.MipmapGenerator._freeMipMapHolder(a[n])}}};return t}(s.GL_ImageCube);r.GL_BitmapImageCube=n},{"../image/GL_ImageCube":"awayjs-stagegl/lib/image/GL_ImageCube","awayjs-core/lib/utils/MipmapGenerator":undefined}],"awayjs-stagegl/lib/image/GL_Image2D":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/ContextGLTextureFormat");var s=e("../image/GL_ImageBase");var n=function(e){a(t,e);function t(){e.apply(this,arguments)}t.prototype._createTexture=function(){this._texture=this._stage.context.createTexture(this._asset.width,this._asset.height,i.ContextGLTextureFormat.BGRA,true)};return t}(s.GL_ImageBase);r.GL_Image2D=n},{"../base/ContextGLTextureFormat":"awayjs-stagegl/lib/base/ContextGLTextureFormat","../image/GL_ImageBase":"awayjs-stagegl/lib/image/GL_ImageBase"}],"awayjs-stagegl/lib/image/GL_ImageBase":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/errors/AbstractMethodError");var s=e("awayjs-core/lib/library/AbstractionBase");var n=function(e){a(t,e);function t(t,r){e.call(this,t,r);this.usages=0;this._stage=r}Object.defineProperty(t.prototype,"texture",{get:function(){if(!this._texture){this._createTexture();this._invalid=true}return this._texture},enumerable:true,configurable:true});t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);if(this._texture){this._texture.dispose();this._texture=null}};t.prototype.activate=function(e,t){this._stage.context.setTextureAt(e,this._texture)};t.prototype._createTexture=function(){throw new i.AbstractMethodError};return t}(s.AbstractionBase);r.GL_ImageBase=n},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AbstractionBase":undefined}],"awayjs-stagegl/lib/image/GL_ImageCube":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../base/ContextGLTextureFormat");var s=e("../image/GL_ImageBase");var n=function(e){a(t,e);function t(){e.apply(this,arguments)}t.prototype._createTexture=function(){this._texture=this._stage.context.createCubeTexture(this._asset.size,i.ContextGLTextureFormat.BGRA,false)};return t}(s.GL_ImageBase);r.GL_ImageCube=n},{"../base/ContextGLTextureFormat":"awayjs-stagegl/lib/base/ContextGLTextureFormat","../image/GL_ImageBase":"awayjs-stagegl/lib/image/GL_ImageBase"}],"awayjs-stagegl/lib/image/GL_RenderImage2D":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../image/GL_Image2D");var s=function(e){a(t,e);function t(){e.apply(this,arguments)}t.prototype.activate=function(t,r){e.prototype.activate.call(this,t,false)};return t}(i.GL_Image2D);r.GL_RenderImage2D=s},{"../image/GL_Image2D":"awayjs-stagegl/lib/image/GL_Image2D"}],"awayjs-stagegl/lib/image/GL_RenderImageCube":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../image/GL_ImageCube");var s=function(e){a(t,e);function t(){e.apply(this,arguments)}t.prototype.activate=function(t,r){e.prototype.activate.call(this,t,false)};return t}(i.GL_ImageCube);r.GL_RenderImageCube=s},{"../image/GL_ImageCube":"awayjs-stagegl/lib/image/GL_ImageCube"}],"awayjs-stagegl/lib/image/GL_Sampler2D":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../image/GL_SamplerBase");var s=function(e){a(t,e);function t(t,r){e.call(this,t,r);this._sampler=t}t.prototype.activate=function(e){this._stage.setSamplerState(e,this._sampler.repeat,this._sampler.smooth,this._sampler.mipmap)};return t}(i.GL_SamplerBase);r.GL_Sampler2D=s},{"../image/GL_SamplerBase":"awayjs-stagegl/lib/image/GL_SamplerBase"}],"awayjs-stagegl/lib/image/GL_SamplerBase":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/errors/AbstractMethodError");var s=e("awayjs-core/lib/library/AbstractionBase");var n=function(e){a(t,e);function t(t,r){e.call(this,t,r);this._stage=r}t.prototype.activate=function(e){throw new i.AbstractMethodError};return t}(s.AbstractionBase);r.GL_SamplerBase=n},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AbstractionBase":undefined}],"awayjs-stagegl/lib/image/GL_SamplerCube":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("../image/GL_SamplerBase");var s=function(e){a(t,e);function t(t,r){e.call(this,t,r);this._sampler=t}t.prototype.activate=function(e){this._stage.setSamplerState(e,false,this._sampler.smooth,this._sampler.mipmap)};return t}(i.GL_SamplerBase);r.GL_SamplerCube=s},{"../image/GL_SamplerBase":"awayjs-stagegl/lib/image/GL_SamplerBase"}],"awayjs-stagegl/lib/image/ProgramDataPool":[function(e,t,r){"use strict";var a=e("../image/ProgramData");var i=function(){function e(e){this._pool=new Object;this._stage=e}e.prototype.getItem=function(e,t){var r=e+t;return this._pool[r]||(this._pool[r]=new a.ProgramData(this,this._stage,e,t))};e.prototype.disposeItem=function(e){this._pool[e]=null};return e}();r.ProgramDataPool=i},{"../image/ProgramData":"awayjs-stagegl/lib/image/ProgramData"}],"awayjs-stagegl/lib/image/ProgramData":[function(e,t,r){"use strict";var a=function(){function e(e,t,r,a){this.usages=0;this._pool=e;this.stage=t;this.vertexString=r;this.fragmentString=a;this.stage.registerProgram(this)}e.prototype.dispose=function(){this.usages--;if(!this.usages){this._pool.disposeItem(this.vertexString+this.fragmentString);this.stage.unRegisterProgram(this);if(this.program){this.program.dispose();this.program=null}}};e.PROGRAMDATA_ID_COUNT=0;return e}();r.ProgramData=a},{}],"awayjs-stagegl/lib/image":[function(e,t,r){"use strict";var a=e("./image/GL_BitmapImage2D");r.GL_BitmapImage2D=a.GL_BitmapImage2D;var i=e("./image/GL_BitmapImageCube");r.GL_BitmapImageCube=i.GL_BitmapImageCube;var s=e("./image/GL_Image2D");r.GL_Image2D=s.GL_Image2D;var n=e("./image/GL_ImageBase");r.GL_ImageBase=n.GL_ImageBase;var o=e("./image/GL_ImageCube");r.GL_ImageCube=o.GL_ImageCube;var l=e("./image/GL_RenderImage2D");r.GL_RenderImage2D=l.GL_RenderImage2D;var u=e("./image/GL_RenderImageCube");r.GL_RenderImageCube=u.GL_RenderImageCube;var f=e("./image/GL_Sampler2D");r.GL_Sampler2D=f.GL_Sampler2D;var g=e("./image/GL_SamplerBase");r.GL_SamplerBase=g.GL_SamplerBase;var c=e("./image/GL_SamplerCube");r.GL_SamplerCube=c.GL_SamplerCube;var h=e("./image/ProgramData");r.ProgramData=h.ProgramData;var p=e("./image/ProgramDataPool");r.ProgramDataPool=p.ProgramDataPool},{"./image/GL_BitmapImage2D":"awayjs-stagegl/lib/image/GL_BitmapImage2D","./image/GL_BitmapImageCube":"awayjs-stagegl/lib/image/GL_BitmapImageCube","./image/GL_Image2D":"awayjs-stagegl/lib/image/GL_Image2D","./image/GL_ImageBase":"awayjs-stagegl/lib/image/GL_ImageBase","./image/GL_ImageCube":"awayjs-stagegl/lib/image/GL_ImageCube","./image/GL_RenderImage2D":"awayjs-stagegl/lib/image/GL_RenderImage2D","./image/GL_RenderImageCube":"awayjs-stagegl/lib/image/GL_RenderImageCube","./image/GL_Sampler2D":"awayjs-stagegl/lib/image/GL_Sampler2D","./image/GL_SamplerBase":"awayjs-stagegl/lib/image/GL_SamplerBase","./image/GL_SamplerCube":"awayjs-stagegl/lib/image/GL_SamplerCube","./image/ProgramData":"awayjs-stagegl/lib/image/ProgramData","./image/ProgramDataPool":"awayjs-stagegl/lib/image/ProgramDataPool"}],"awayjs-stagegl/lib/library/GL_IAssetClass":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/library":[function(e,t,r){"use strict"},{}],"awayjs-stagegl/lib/managers/StageManager":[function(e,t,r){"use strict";var a=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)};var i=e("awayjs-core/lib/events/EventDispatcher");var s=e("awayjs-core/lib/errors/ArgumentError");var n=e("../base/Stage");var o=e("../events/StageEvent");var l=function(e){a(t,e);function t(){var r=this;e.call(this);this._stages=new Array(t.STAGE_MAX_QUANTITY);this._onContextCreatedDelegate=function(e){return r.onContextCreated(e)}}t.getInstance=function(){if(this._instance==null)this._instance=new t;return this._instance};t.prototype.getStageAt=function(e,r,a,i){if(r===void 0){r=false}if(a===void 0){a="baseline"}if(i===void 0){i="auto"}if(e<0||e>=t.STAGE_MAX_QUANTITY)throw new s.ArgumentError("Index is out of bounds [0.."+t.STAGE_MAX_QUANTITY+"]");if(!this._stages[e]){t._numStages++;if(document){var l=document.createElement("canvas");l.id="stage"+e;document.body.appendChild(l)}var u=this._stages[e]=new n.Stage(l,e,this,r,a);u.addEventListener(o.StageEvent.CONTEXT_CREATED,this._onContextCreatedDelegate);u.requestContext(r,a,i)}return u};t.prototype.iRemoveStage=function(e){t._numStages--;e.removeEventListener(o.StageEvent.CONTEXT_CREATED,this._onContextCreatedDelegate);this._stages[e.stageIndex]=null};t.prototype.getFreeStage=function(e,t,r){if(e===void 0){e=false}if(t===void 0){t="baseline"}if(r===void 0){r="auto"}var a=0;var i=this._stages.length;while(a<i){if(!this._stages[a])return this.getStageAt(a,e,t,r);++a}return null};Object.defineProperty(t.prototype,"hasFreeStage",{get:function(){return t._numStages<t.STAGE_MAX_QUANTITY?true:false},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numSlotsFree",{get:function(){return t.STAGE_MAX_QUANTITY-t._numStages},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numSlotsUsed",{get:function(){return t._numStages},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numSlotsTotal",{get:function(){return this._stages.length},enumerable:true,configurable:true});t.prototype.onContextCreated=function(e){};t.STAGE_MAX_QUANTITY=8;t._numStages=0;return t}(i.EventDispatcher);r.StageManager=l},{"../base/Stage":"awayjs-stagegl/lib/base/Stage","../events/StageEvent":"awayjs-stagegl/lib/events/StageEvent","awayjs-core/lib/errors/ArgumentError":undefined,"awayjs-core/lib/events/EventDispatcher":undefined}],"awayjs-stagegl/lib/managers":[function(e,t,r){"use strict";var a=e("./managers/StageManager");r.StageManager=a.StageManager},{"./managers/StageManager":"awayjs-stagegl/lib/managers/StageManager"}]},{},[1]);
//# sourceMappingURL=awayjs-stagegl.min.js.map

require=function e(t,i,s){function a(n,o){if(!i[n]){if(!t[n]){var l="function"==typeof require&&require;if(!o&&l)return l(n,!0);if(r)return r(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var p=i[n]={exports:{}};t[n][0].call(p.exports,function(e){var i=t[n][1][e];return a(i?i:e)},p,p.exports,e,t,i,s)}return i[n].exports}for(var r="function"==typeof require&&require,n=0;n<s.length;n++)a(s[n]);return a}({"awayjs-stagegl/lib/aglsl/AGALTokenizer":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/Description"),s=e("awayjs-stagegl/lib/aglsl/Header"),a=e("awayjs-stagegl/lib/aglsl/Mapping"),r=e("awayjs-stagegl/lib/aglsl/Token"),n=function(){function e(){}return e.prototype.decribeAGALByteArray=function(e){var t=new s;if(160!=e.readUnsignedByte())throw"Bad AGAL: Missing 0xa0 magic byte.";if(t.version=e.readUnsignedInt(),t.version>=16&&(e.readUnsignedByte(),t.version>>=1),161!=e.readUnsignedByte())throw"Bad AGAL: Missing 0xa1 magic byte.";switch(t.progid=e.readUnsignedByte(),t.progid){case 1:t.type="fragment";break;case 0:t.type="vertex";break;case 2:t.type="cpu";break;default:t.type=""}for(var n=new i,o=[];e.position<e.length;){var l=new r;l.opcode=e.readUnsignedInt();var h=a.agal2glsllut[l.opcode];if(!h)throw"Opcode not valid or not implemented yet: "+l.opcode;h.matrixheight&&(n.hasmatrix=!0),h.dest?(l.dest.regnum=e.readUnsignedShort(),l.dest.mask=e.readUnsignedByte(),l.dest.regtype=e.readUnsignedByte(),n.regwrite[l.dest.regtype][l.dest.regnum]|=l.dest.mask):(l.dest=null,e.readUnsignedInt()),h.a?this.readReg(l.a,1,n,e):(l.a=null,e.readUnsignedInt(),e.readUnsignedInt()),h.b?this.readReg(l.b,0|h.matrixheight,n,e):(l.b=null,e.readUnsignedInt(),e.readUnsignedInt()),o.push(l)}return n.header=t,n.tokens=o,n},e.prototype.readReg=function(e,t,i,s){if(e.regnum=s.readUnsignedShort(),e.indexoffset=s.readByte(),e.swizzle=s.readUnsignedByte(),e.regtype=s.readUnsignedByte(),i.regread[e.regtype][e.regnum]=15,5==e.regtype?(e.lodbiad=e.indexoffset,e.indexoffset=void 0,e.swizzle=void 0,e.readmode=s.readUnsignedByte(),e.dim=e.readmode>>4,e.readmode&=15,e.special=s.readUnsignedByte(),e.wrap=e.special>>4,e.special&=15,e.mipmap=s.readUnsignedByte(),e.filter=e.mipmap>>4,e.mipmap&=15,i.samplers[e.regnum]=e):(e.indexregtype=s.readUnsignedByte(),e.indexselect=s.readUnsignedByte(),e.indirectflag=s.readUnsignedByte()),e.indirectflag&&(i.hasindirect=!0),!e.indirectflag&&t)for(var a=0;t>a;a++)i.regread[e.regtype][e.regnum+a]=i.regread[e.regtype][e.regnum]},e}();t.exports=n},{"awayjs-stagegl/lib/aglsl/Description":void 0,"awayjs-stagegl/lib/aglsl/Header":void 0,"awayjs-stagegl/lib/aglsl/Mapping":void 0,"awayjs-stagegl/lib/aglsl/Token":void 0}],"awayjs-stagegl/lib/aglsl/AGLSLParser":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/Mapping"),s=e("awayjs-stagegl/lib/base/ContextStage3D"),a=function(){function e(){}return e.prototype.parse=function(e){var t="",a="";t+="precision highp float;\n";var r=e.header.type[0];if("vertex"==e.header.type&&(t+="uniform float yflip;\n"),e.hasindirect)t+="uniform vec4 "+r+"carrr["+s.maxvertexconstants+"];\n";else for(var n=0;n<e.regread[1].length;n++)e.regread[1][n]&&(t+="uniform vec4 "+r+"c"+n+";\n");for(var n=0;n<e.regread[2].length||n<e.regwrite[2].length;n++)(e.regread[2][n]||e.regwrite[2][n])&&(t+="vec4 "+r+"t"+n+";\n");for(var n=0;n<e.regread[0].length;n++)e.regread[0][n]&&(t+="attribute vec4 va"+n+";\n");for(var n=0;n<e.regread[4].length||n<e.regwrite[4].length;n++)(e.regread[4][n]||e.regwrite[4][n])&&(t+="varying vec4 vi"+n+";\n");for(var o=["2D","Cube","3D",""],n=0;n<e.samplers.length;n++)e.samplers[n]&&(t+="uniform sampler"+o[3&e.samplers[n].dim]+" fs"+n+";\n");"vertex"==e.header.type&&(t+="vec4 outpos;\n"),e.writedepth&&(t+="vec4 tmp_FragDepth;\n"),a+="void main() {\n";for(var n=0;n<e.tokens.length;n++){var l=i.agal2glsllut[e.tokens[n].opcode];if(!l)throw"Opcode not valid or not implemented yet: ";for(var h=l.matrixheight||1,p=0;h>p;p++){var u="  "+l.s;if(e.tokens[n].dest){if(l.matrixheight){if(1!=(e.tokens[n].dest.mask>>p&1))continue;var d=this.regtostring(e.tokens[n].dest.regtype,e.tokens[n].dest.regnum,e,r),g="float",c=["x","y","z","w"][p];d+="."+c}else{var g,c,d=this.regtostring(e.tokens[n].dest.regtype,e.tokens[n].dest.regnum,e,r);if(15!=e.tokens[n].dest.mask){var _=0;switch(c="",1&e.tokens[n].dest.mask&&(_++,c+="x"),2&e.tokens[n].dest.mask&&(_++,c+="y"),4&e.tokens[n].dest.mask&&(_++,c+="z"),8&e.tokens[n].dest.mask&&(_++,c+="w"),d+="."+c,_){case 1:g="float";break;case 2:g="vec2";break;case 3:g="vec3";break;default:throw"Unexpected destination mask"}}else g="vec4",c="xyzw"}u=u.replace("%dest",d),u=u.replace("%cast",g),u=u.replace("%dm",c)}var f=15;if(!l.ndwm&&l.dest&&e.tokens[n].dest&&(f=e.tokens[n].dest.mask),e.tokens[n].a&&(u=u.replace("%a",this.sourcetostring(e.tokens[n].a,0,f,l.scalar,e,r))),e.tokens[n].b&&(u=u.replace("%b",this.sourcetostring(e.tokens[n].b,p,f,l.scalar,e,r)),5==e.tokens[n].b.regtype)){var m=["2D","Cube","3D"][e.tokens[n].b.dim],y=["vec2","vec3","vec3"][e.tokens[n].b.dim];u=u.replace("%texdim",m),u=u.replace("%texsize",y);var b="";u=u.replace("%lod",b)}a+=u}}return"vertex"==e.header.type&&(a+="  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n"),e.writedepth&&(a+="  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n"),a+="}\n",t+a},e.prototype.regtostring=function(e,t,i,s){switch(e){case 0:return"va"+t;case 1:return i.hasindirect&&"vertex"==i.header.type?"vcarrr["+t+"]":s+"c"+t;case 2:return s+"t"+t;case 3:return"vertex"==i.header.type?"outpos":"gl_FragColor";case 4:return"vi"+t;case 5:return"fs"+t;case 6:return"tmp_FragDepth";default:throw"Unknown register type"}},e.prototype.sourcetostring=function(e,t,i,s,a,r){var n,o=["x","y","z","w"];if(e.indirectflag){n="vcarrr[int("+this.regtostring(e.indexregtype,e.regnum,a,r)+"."+o[e.indexselect]+")";var l=t+e.indexoffset;0>l&&(n+=l.toString()),l>0&&(n+="+"+l.toString()),n+="]"}else n=this.regtostring(e.regtype,e.regnum+t,a,r);return 5==e.regtype?n:s?n+"."+o[e.swizzle>>0&3]:228==e.swizzle&&15==i?n:(n+=".",1&i&&(n+=o[e.swizzle>>0&3]),2&i&&(n+=o[e.swizzle>>2&3]),4&i&&(n+=o[e.swizzle>>4&3]),8&i&&(n+=o[e.swizzle>>6&3]),n)},e}();t.exports=a},{"awayjs-stagegl/lib/aglsl/Mapping":void 0,"awayjs-stagegl/lib/base/ContextStage3D":void 0}],"awayjs-stagegl/lib/aglsl/Description":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/Header"),s=function(){function e(){this.regread=[[],[],[],[],[],[],[]],this.regwrite=[[],[],[],[],[],[],[]],this.hasindirect=!1,this.writedepth=!1,this.hasmatrix=!1,this.samplers=[],this.tokens=[],this.header=new i}return e}();t.exports=s},{"awayjs-stagegl/lib/aglsl/Header":void 0}],"awayjs-stagegl/lib/aglsl/Destination":[function(e,t){var i=function(){function e(){this.mask=0,this.regnum=0,this.regtype=0,this.dim=0}return e}();t.exports=i},{}],"awayjs-stagegl/lib/aglsl/Header":[function(e,t){var i=function(){function e(){this.progid=0,this.version=0,this.type=""}return e}();t.exports=i},{}],"awayjs-stagegl/lib/aglsl/Mapping":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/OpLUT"),s=function(){function e(){}return e.agal2glsllut=[new i("%dest = %cast(%a);\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(%a + %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(%a - %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(%a * %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(%a / %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(1.0) / %a;\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(min(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(max(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(fract(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(sqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(inversesqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(pow(abs(%a),%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new i("%dest = %cast(log2(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(exp2(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(normalize(vec3( %a ) ));\n",0,!0,!0,!1,null,null,!0,null,null,null),new i("%dest = %cast(sin(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(cos(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(cross(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new i("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new i("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new i("%dest = %cast(abs(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(%a * -1.0);\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(clamp(%a,0.0,1.0));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",null,!0,!0,!0,3,3,!0,null,null,null),new i("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,4,!0,null,null,null),new i("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,3,!0,null,null,null),new i("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("if (float(%a)==float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new i("if (float(%a)!=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new i("if (float(%a)>=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new i("if (float(%a)<float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new i("} else {;\n",0,!1,!1,!1,null,null,null,null,null,null),new i("};\n",0,!1,!1,!1,null,null,null,null,null,null),new i(null,null,null,null,!1,null,null,null,null,null,null),new i(null,null,null,null,!1,null,null,null,null,null,null),new i(null,null,null,null,!1,null,null,null,null,null,null),new i(null,null,null,null,!1,null,null,null,null,null,null),new i("%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\n",null,!0,!0,!0,null,null,null,null,!0,null),new i("if ( float(%a)<0.0 ) discard;\n",null,!1,!0,!1,null,null,null,!0,null,null),new i("%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\n",null,!0,!0,!0,null,null,!0,null,!0,!0),new i("%dest = %cast(greaterThanEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new i("%dest = %cast(lessThan(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new i("%dest = %cast(sign(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new i("%dest = %cast(equal(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new i("%dest = %cast(notEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null)],e}();t.exports=s},{"awayjs-stagegl/lib/aglsl/OpLUT":void 0}],"awayjs-stagegl/lib/aglsl/OpLUT":[function(e,t){var i=function(){function e(e,t,i,s,a,r,n,o,l,h,p){this.s=e,this.flags=t,this.dest=i,this.a=s,this.b=a,this.matrixwidth=r,this.matrixheight=n,this.ndwm=o,this.scalar=l,this.dm=h,this.lod=p}return e}();t.exports=i},{}],"awayjs-stagegl/lib/aglsl/Sampler":[function(e,t){var i=function(){function e(){this.lodbias=0,this.dim=0,this.readmode=0,this.special=0,this.wrap=0,this.mipmap=0,this.filter=0}return e}();t.exports=i},{}],"awayjs-stagegl/lib/aglsl/Token":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/Destination"),s=function(){function e(){this.dest=new i,this.opcode=0,this.a=new i,this.b=new i}return e}();t.exports=s},{"awayjs-stagegl/lib/aglsl/Destination":void 0}],"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/assembler/OpcodeMap"),s=e("awayjs-stagegl/lib/aglsl/assembler/Part"),a=e("awayjs-stagegl/lib/aglsl/assembler/RegMap"),r=e("awayjs-stagegl/lib/aglsl/assembler/SamplerMap"),n=function(){function e(){this.r={},this.cur=new s}return e.prototype.assemble=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),i||(i=1),t&&this.addHeader(t,i);var s=e.replace(/[\f\n\r\v]+/g,"\n").split("\n");for(var a in s)this.processLine(s[a],a);return this.r},e.prototype.processLine=function(e,t){var s=e.search("//");if(-1!=s&&(e=e.slice(0,s)),e=e.replace(/^\s+|\s+$/g,""),e.length>0){var a=e.search(/<.*>/g),r=null;-1!=a&&(r=e.slice(a).match(/([\w\.\-\+]+)/gi),e=e.slice(0,a));var n=e.match(/([\w\.\+\[\]]+)/gi);if(!n||n.length<1)return void(e.length>=3&&console.log("Warning: bad line "+t+": "+e));switch(n[0]){case"part":this.addHeader(n[1],Number(n[2]));break;case"endpart":if(!this.cur)throw"Unexpected endpart";return this.cur.data.position=0,void(this.cur=null);default:if(!this.cur)return void console.log("Warning: bad line "+t+": "+e+" (Outside of any part definition)");if("comment"==this.cur.name)return;var o=i.map[n[0]];if(!o)throw"Bad opcode "+n[0]+" "+t+": "+e;this.emitOpcode(this.cur,o.opcode);var l=1;if(o.dest&&"none"!=o.dest){if(!this.emitDest(this.cur,n[l++],o.dest))throw"Bad destination register "+n[l-1]+" "+t+": "+e}else this.emitZeroDword(this.cur);if(o.a&&"none"!=o.a.format){if(!this.emitSource(this.cur,n[l++],o.a))throw"Bad source register "+n[l-1]+" "+t+": "+e}else this.emitZeroQword(this.cur);if(o.b&&"none"!=o.b.format){if("sampler"==o.b.format){if(!this.emitSampler(this.cur,n[l++],o.b,r))throw"Bad sampler register "+n[l-1]+" "+t+": "+e}else if(!this.emitSource(this.cur,n[l++],o.b))throw"Bad source register "+n[l-1]+" "+t+": "+e}else this.emitZeroQword(this.cur)}}},e.prototype.emitHeader=function(e){switch(e.data.writeUnsignedByte(160),e.data.writeUnsignedInt(e.version),e.version>=16&&e.data.writeUnsignedByte(0),e.data.writeUnsignedByte(161),e.name){case"fragment":e.data.writeUnsignedByte(1);break;case"vertex":e.data.writeUnsignedByte(0);break;case"cpu":e.data.writeUnsignedByte(2);break;default:e.data.writeUnsignedByte(255)}},e.prototype.emitOpcode=function(e,t){e.data.writeUnsignedInt(t)},e.prototype.emitZeroDword=function(e){e.data.writeUnsignedInt(0)},e.prototype.emitZeroQword=function(e){e.data.writeUnsignedInt(0),e.data.writeUnsignedInt(0)},e.prototype.emitDest=function(e,t){var i=t.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!a.map[i[1]])return!1;var s={num:i[2]?i[2]:0,code:a.map[i[1]].code,mask:this.stringToMask(i[3])};return e.data.writeUnsignedShort(s.num),e.data.writeUnsignedByte(s.mask),e.data.writeUnsignedByte(s.code),!0},e.prototype.stringToMask=function(e){if(!e)return 15;var t=0;return-1!=e.indexOf("x")&&(t|=1),-1!=e.indexOf("y")&&(t|=2),-1!=e.indexOf("z")&&(t|=4),-1!=e.indexOf("w")&&(t|=8),t},e.prototype.stringToSwizzle=function(e){if(!e)return 228;var t={x:0,y:1,z:2,w:3},i=0;if("."!=e.charAt(0))throw"Missing . for swizzle";return e.length>1&&(i|=t[e.charAt(1)]),i|=e.length>2?t[e.charAt(2)]<<2:(3&i)<<2,i|=e.length>3?t[e.charAt(3)]<<4:(12&i)<<2,i|=e.length>4?t[e.charAt(4)]<<6:(48&i)<<2},e.prototype.emitSampler=function(e,t,i,s){var a=t.match(/fs(\d*)/i);if(!a||!a[1])return!1;e.data.writeUnsignedShort(parseInt(a[1])),e.data.writeUnsignedByte(0),e.data.writeUnsignedByte(0);for(var n=5,o=0,l=0;l<s.length;l++){var h=r.map[s[l].toLowerCase()];h?(0!=(o>>h.shift&h.mask)&&console.log("Warning, duplicate sampler option"),o|=h.mask<<h.shift,n&=~(h.mask<<h.shift),n|=h.value<<h.shift):console.log("Warning, unknown sampler option: ",s[l])}return e.data.writeUnsignedInt(n),!0},e.prototype.emitSource=function(e,t){var i,s=t.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i);if(s){if(!a.map[s[1]])return!1;var r={x:0,y:1,z:2,w:3},n={num:0|s[2],code:a.map[s[1]].code,swizzle:this.stringToSwizzle(s[5]),select:r[s[3]],offset:0|s[4]};e.data.writeUnsignedShort(n.num),e.data.writeByte(n.offset),e.data.writeUnsignedByte(n.swizzle),e.data.writeUnsignedByte(1),e.data.writeUnsignedByte(n.code),e.data.writeUnsignedByte(n.select),e.data.writeUnsignedByte(128)}else{if(i=t.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i),!a.map[i[1]])return!1;var n={num:0|i[2],code:a.map[i[1]].code,swizzle:this.stringToSwizzle(i[3])};e.data.writeUnsignedShort(n.num),e.data.writeUnsignedByte(0),e.data.writeUnsignedByte(n.swizzle),e.data.writeUnsignedByte(n.code),e.data.writeUnsignedByte(0),e.data.writeUnsignedByte(0),e.data.writeUnsignedByte(0)}return!0},e.prototype.addHeader=function(e,t){if(t||(t=1),void 0==this.r[e])this.r[e]=new s(e,t),this.emitHeader(this.r[e]);else if(this.r[e].version!=t)throw"Multiple versions for part "+e;this.cur=this.r[e]},e}();t.exports=n},{"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap":void 0,"awayjs-stagegl/lib/aglsl/assembler/Part":void 0,"awayjs-stagegl/lib/aglsl/assembler/RegMap":void 0,"awayjs-stagegl/lib/aglsl/assembler/SamplerMap":void 0}],"awayjs-stagegl/lib/aglsl/assembler/FS":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-stagegl/lib/aglsl/assembler/Flags":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/assembler/Opcode"),s=function(){function e(){}return Object.defineProperty(e,"map",{get:function(){return e._map||(e._map=new Array,e._map.mov=new i("vector","vector",4,"none",0,0,!0,null,null,null),e._map.add=new i("vector","vector",4,"vector",4,1,!0,null,null,null),e._map.sub=new i("vector","vector",4,"vector",4,2,!0,null,null,null),e._map.mul=new i("vector","vector",4,"vector",4,3,!0,null,null,null),e._map.div=new i("vector","vector",4,"vector",4,4,!0,null,null,null),e._map.rcp=new i("vector","vector",4,"none",0,5,!0,null,null,null),e._map.min=new i("vector","vector",4,"vector",4,6,!0,null,null,null),e._map.max=new i("vector","vector",4,"vector",4,7,!0,null,null,null),e._map.frc=new i("vector","vector",4,"none",0,8,!0,null,null,null),e._map.sqt=new i("vector","vector",4,"none",0,9,!0,null,null,null),e._map.rsq=new i("vector","vector",4,"none",0,10,!0,null,null,null),e._map.pow=new i("vector","vector",4,"vector",4,11,!0,null,null,null),e._map.log=new i("vector","vector",4,"none",0,12,!0,null,null,null),e._map.exp=new i("vector","vector",4,"none",0,13,!0,null,null,null),e._map.nrm=new i("vector","vector",4,"none",0,14,!0,null,null,null),e._map.sin=new i("vector","vector",4,"none",0,15,!0,null,null,null),e._map.cos=new i("vector","vector",4,"none",0,16,!0,null,null,null),e._map.crs=new i("vector","vector",4,"vector",4,17,!0,!0,null,null),e._map.dp3=new i("vector","vector",4,"vector",4,18,!0,!0,null,null),e._map.dp4=new i("vector","vector",4,"vector",4,19,!0,!0,null,null),e._map.abs=new i("vector","vector",4,"none",0,20,!0,null,null,null),e._map.neg=new i("vector","vector",4,"none",0,21,!0,null,null,null),e._map.sat=new i("vector","vector",4,"none",0,22,!0,null,null,null),e._map.ted=new i("vector","vector",4,"sampler",1,38,!0,null,!0,null),e._map.kil=new i("none","scalar",1,"none",0,39,!0,null,!0,null),e._map.tex=new i("vector","vector",4,"sampler",1,40,!0,null,!0,null),e._map.m33=new i("vector","matrix",3,"vector",3,23,!0,null,null,!0),e._map.m44=new i("vector","matrix",4,"vector",4,24,!0,null,null,!0),e._map.m43=new i("vector","matrix",3,"vector",4,25,!0,null,null,!0),e._map.sge=new i("vector","vector",4,"vector",4,41,!0,null,null,null),e._map.slt=new i("vector","vector",4,"vector",4,42,!0,null,null,null),e._map.sgn=new i("vector","vector",4,"vector",4,43,!0,null,null,null),e._map.seq=new i("vector","vector",4,"vector",4,44,!0,null,null,null),e._map.sne=new i("vector","vector",4,"vector",4,45,!0,null,null,null)),e._map},enumerable:!0,configurable:!0}),e}();t.exports=s},{"awayjs-stagegl/lib/aglsl/assembler/Opcode":void 0}],"awayjs-stagegl/lib/aglsl/assembler/Opcode":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/assembler/Flags"),s=e("awayjs-stagegl/lib/aglsl/assembler/FS"),a=function(){function e(e,t,a,r,n,o,l,h,p,u){this.a=new s,this.b=new s,this.flags=new i,this.dest=e,this.a.format=t,this.a.size=a,this.b.format=r,this.b.size=n,this.opcode=o,this.flags.simple=l,this.flags.horizontal=h,this.flags.fragonly=p,this.flags.matrix=u}return e}();t.exports=a},{"awayjs-stagegl/lib/aglsl/assembler/FS":void 0,"awayjs-stagegl/lib/aglsl/assembler/Flags":void 0}],"awayjs-stagegl/lib/aglsl/assembler/Part":[function(e,t){var i=e("awayjs-core/lib/utils/ByteArray"),s=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.name="",this.version=0,this.name=e,this.version=t,this.data=new i}return e}();t.exports=s},{"awayjs-core/lib/utils/ByteArray":void 0}],"awayjs-stagegl/lib/aglsl/assembler/RegMap":[function(e,t){var i=function(){function e(e,t){this.code=e,this.desc=t}return e}(),s=function(){function e(){}return Object.defineProperty(e,"map",{get:function(){return e._map||(e._map=new Array,e._map.va=new i(0,"vertex attribute"),e._map.fc=new i(1,"fragment constant"),e._map.vc=new i(1,"vertex constant"),e._map.ft=new i(2,"fragment temporary"),e._map.vt=new i(2,"vertex temporary"),e._map.vo=new i(3,"vertex output"),e._map.op=new i(3,"vertex output"),e._map.fd=new i(3,"fragment depth output"),e._map.fo=new i(3,"fragment output"),e._map.oc=new i(3,"fragment output"),e._map.v=new i(4,"varying"),e._map.vi=new i(4,"varying output"),e._map.fi=new i(4,"varying input"),e._map.fs=new i(5,"sampler")),e._map},enumerable:!0,configurable:!0}),e}();t.exports=s},{}],"awayjs-stagegl/lib/aglsl/assembler/SamplerMap":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/assembler/Sampler"),s=function(){function e(){}return Object.defineProperty(e,"map",{get:function(){return e._map||(e._map=new Array,e._map.rgba=new i(8,15,0),e._map.rg=new i(8,15,5),e._map.r=new i(8,15,4),e._map.compressed=new i(8,15,1),e._map.compressed_alpha=new i(8,15,2),e._map.dxt1=new i(8,15,1),e._map.dxt5=new i(8,15,2),e._map["2d"]=new i(12,15,0),e._map.cube=new i(12,15,1),e._map["3d"]=new i(12,15,2),e._map.centroid=new i(16,1,1),e._map.ignoresampler=new i(16,4,4),e._map.clamp=new i(20,15,0),e._map.repeat=new i(20,15,1),e._map.wrap=new i(20,15,1),e._map.nomip=new i(24,15,0),e._map.mipnone=new i(24,15,0),e._map.mipnearest=new i(24,15,1),e._map.miplinear=new i(24,15,2),e._map.nearest=new i(28,15,0),e._map.linear=new i(28,15,1)),e._map},enumerable:!0,configurable:!0}),e}();t.exports=s},{"awayjs-stagegl/lib/aglsl/assembler/Sampler":void 0}],"awayjs-stagegl/lib/aglsl/assembler/Sampler":[function(e,t){var i=function(){function e(e,t,i){this.shift=e,this.mask=t,this.value=i}return e}();t.exports=i},{}],"awayjs-stagegl/lib/animators/AnimationSetBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),r=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-stagegl/lib/errors/AnimationSetError"),o=function(e){function t(){e.call(this),this._animations=new Array,this._animationNames=new Array,this._animationDictionary=new Object}return i(t,e),t.prototype._pFindTempReg=function(e,t){void 0===t&&(t=null);for(var i,s=0;;){if(i="vt"+s,-1==e.indexOf(i)&&t!=i)return i;++s}return null},Object.defineProperty(t.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:!0,configurable:!0}),t.prototype.resetGPUCompatibility=function(){this._usesCPU=!1},t.prototype.cancelGPUCompatibility=function(){this._usesCPU=!0},t.prototype.getAGALVertexCode=function(){throw new r},t.prototype.activate=function(){throw new r},t.prototype.deactivate=function(){throw new r},t.prototype.getAGALFragmentCode=function(){throw new r},t.prototype.getAGALUVCode=function(){throw new r},t.prototype.doneAGALCode=function(){throw new r},Object.defineProperty(t.prototype,"assetType",{get:function(){return s.ANIMATION_SET},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),t.prototype.hasAnimation=function(e){return null!=this._animationDictionary[e]},t.prototype.getAnimation=function(e){return this._animationDictionary[e]},t.prototype.addAnimation=function(e){if(this._animationDictionary[e.name])throw new n("root node name '"+e.name+"' already exists in the set");this._animationDictionary[e.name]=e,this._animations.push(e),this._animationNames.push(e.name)},t.prototype.dispose=function(){},t}(a);t.exports=o},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-stagegl/lib/errors/AnimationSetError":void 0}],"awayjs-stagegl/lib/animators/AnimatorBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),r=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-core/lib/utils/RequestAnimationFrame"),o=e("awayjs-core/lib/utils/getTimer"),l=e("awayjs-stagegl/lib/events/AnimatorEvent"),h=function(e){function t(t){e.call(this),this._autoUpdate=!0,this._time=0,this._playbackSpeed=1,this._pOwners=new Array,this._pAbsoluteTime=0,this._animationStates=new Object,this.updatePosition=!0,this._pAnimationSet=t,this._broadcaster=new n(this.onEnterFrame,this)}return i(t,e),t.prototype.getAnimationState=function(e){var t=e.stateClass,i=e.id;return null==this._animationStates[i]&&(this._animationStates[i]=new t(this,e)),this._animationStates[i]},t.prototype.getAnimationStateByName=function(e){return this.getAnimationState(this._pAnimationSet.getAnimation(e))},Object.defineProperty(t.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){this._autoUpdate!=e&&(this._autoUpdate=e,this._autoUpdate?this.start():this.stop())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(e){this._time!=e&&this.update(e)},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._pActiveState.phase(e)},Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(e){this._playbackSpeed=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(){throw new r},t.prototype.start=function(){!this._isPlaying&&this._autoUpdate&&(this._time=this._pAbsoluteTime=o(),this._isPlaying=!0,this._broadcaster.start(),this.hasEventListener(l.START)&&(null==this._startEvent&&(this._startEvent=new l(l.START,this)),this.dispatchEvent(this._startEvent)))},t.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._broadcaster.stop(),this.hasEventListener(l.STOP)&&(null==this._stopEvent&&(this._stopEvent=new l(l.STOP,this)),this.dispatchEvent(this._stopEvent)))},t.prototype.update=function(e){var t=(e-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(t),this._time=e},t.prototype.reset=function(e,t){void 0===t&&(t=0),this.getAnimationState(this._pAnimationSet.getAnimation(e)).offset(t+this._pAbsoluteTime)},t.prototype.addOwner=function(e){this._pOwners.push(e)},t.prototype.removeOwner=function(e){this._pOwners.splice(this._pOwners.indexOf(e),1)},t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e,this._pActiveState.update(this._pAbsoluteTime),this.updatePosition&&this.applyPositionDelta()},t.prototype.onEnterFrame=function(e){void 0===e&&(e=null),this.update(o())},t.prototype.applyPositionDelta=function(){var e,t=this._pActiveState.positionDelta,i=t.length;if(i>0){e=this._pOwners.length;for(var s=0;e>s;++s)this._pOwners[s].translateLocal(t,i)}},t.prototype.dispatchCycleEvent=function(){this.hasEventListener(l.CYCLE_COMPLETE)&&(null==this._cycleEvent&&(this._cycleEvent=new l(l.CYCLE_COMPLETE,this)),this.dispatchEvent(this._cycleEvent))},t.prototype.clone=function(){throw new r},t.prototype.dispose=function(){},t.prototype.testGPUCompatibility=function(){throw new r},Object.defineProperty(t.prototype,"assetType",{get:function(){return s.ANIMATOR},enumerable:!0,configurable:!0}),t.prototype.getRenderableSubGeometry=function(e,t){return t},t}(a);t.exports=h},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-core/lib/utils/RequestAnimationFrame":void 0,"awayjs-core/lib/utils/getTimer":void 0,"awayjs-stagegl/lib/events/AnimatorEvent":void 0}],"awayjs-stagegl/lib/animators/data/AnimationRegisterCache":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterCache"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),r=function(e){function t(t){e.call(this,t),this.indexDictionary=new Object,this.vertexConstantData=new Array,this.fragmentConstantData=new Array}return i(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.rotationRegisters=new Array,this.positionAttribute=this.getRegisterFromString(this.sourceRegisters[0]),this.scaleAndRotateTarget=this.getRegisterFromString(this.targetRegisters[0]),this.addVertexTempUsages(this.scaleAndRotateTarget,1);for(var t=1;t<this.targetRegisters.length;t++)this.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[t])),this.addVertexTempUsages(this.rotationRegisters[t-1],1);if(this.scaleAndRotateTarget=new a(this.scaleAndRotateTarget.regName,this.scaleAndRotateTarget.index),this.vertexZeroConst=this.getFreeVertexConstant(),this.vertexZeroConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,0),this.vertexOneConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,1),this.vertexTwoConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,2),this.positionTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.positionTarget,1),this.positionTarget=new a(this.positionTarget.regName,this.positionTarget.index),this.needVelocity)this.velocityTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.velocityTarget,1),this.velocityTarget=new a(this.velocityTarget.regName,this.velocityTarget.index),this.vertexTime=new a(this.velocityTarget.regName,this.velocityTarget.index,3),this.vertexLife=new a(this.positionTarget.regName,this.positionTarget.index,3);else{var i=this.getFreeVertexVectorTemp();this.addVertexTempUsages(i,1),this.vertexTime=new a(i.regName,i.index,0),this.vertexLife=new a(i.regName,i.index,1)}},t.prototype.setUVSourceAndTarget=function(e,t){this.uvVar=this.getRegisterFromString(t),this.uvAttribute=this.getRegisterFromString(e),this.uvTarget=new a(this.positionTarget.regName,this.positionTarget.index)},t.prototype.setRegisterIndex=function(e,t,i){var s=this.indexDictionary[e.id];null==s&&(s=this.indexDictionary[e.id]=new Array(8)),s[t]=i},t.prototype.getRegisterIndex=function(e,t){return this.indexDictionary[e.id][t]},t.prototype.getInitCode=function(){for(var e=this.sourceRegisters.length,t="",i=0;e>i;i++)t+="mov "+this.targetRegisters[i]+","+this.sourceRegisters[i]+"\n";return t+="mov "+this.positionTarget+".xyz,"+this.vertexZeroConst.toString()+"\n",this.needVelocity&&(t+="mov "+this.velocityTarget+".xyz,"+this.vertexZeroConst.toString()+"\n"),t},t.prototype.getCombinationCode=function(){return"add "+this.scaleAndRotateTarget+".xyz,"+this.scaleAndRotateTarget+".xyz,"+this.positionTarget+".xyz\n"
},t.prototype.initColorRegisters=function(){var e="";return this.hasColorMulNode&&(this.colorMulTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorMulTarget,1),this.colorMulVary=this.getFreeVarying(),e+="mov "+this.colorMulTarget+","+this.vertexOneConst+"\n"),this.hasColorAddNode&&(this.colorAddTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorAddTarget,1),this.colorAddVary=this.getFreeVarying(),e+="mov "+this.colorAddTarget+","+this.vertexZeroConst+"\n"),e},t.prototype.getColorPassCode=function(){var e="";return this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)&&(this.hasColorMulNode&&(e+="mov "+this.colorMulVary+","+this.colorMulTarget+"\n"),this.hasColorAddNode&&(e+="mov "+this.colorAddVary+","+this.colorAddTarget+"\n")),e},t.prototype.getColorCombinationCode=function(e){var t="";if(this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){var i=this.getRegisterFromString(e);this.addFragmentTempUsages(i,1),this.hasColorMulNode&&(t+="mul "+i+","+i+","+this.colorMulVary+"\n"),this.hasColorAddNode&&(t+="add "+i+","+i+","+this.colorAddVary+"\n")}return t},t.prototype.getRegisterFromString=function(e){var t=e.split(/(\d+)/);return new a(t[0],parseInt(t[1]))},Object.defineProperty(t.prototype,"numVertexConstant",{get:function(){return this._numVertexConstant},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numFragmentConstant",{get:function(){return this._numFragmentConstant},enumerable:!0,configurable:!0}),t.prototype.setDataLength=function(){this._numVertexConstant=this.numUsedVertexConstants-this.vertexConstantOffset,this._numFragmentConstant=this.numUsedFragmentConstants-this.fragmentConstantOffset,this.vertexConstantData.length=4*this._numVertexConstant,this.fragmentConstantData.length=4*this._numFragmentConstant},t.prototype.setVertexConst=function(e,t,i,s,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0);var r=4*(e-this.vertexConstantOffset);this.vertexConstantData[r++]=t,this.vertexConstantData[r++]=i,this.vertexConstantData[r++]=s,this.vertexConstantData[r]=a},t.prototype.setVertexConstFromArray=function(e,t){for(var i=4*(e-this.vertexConstantOffset),s=0;s<t.length;s++)this.vertexConstantData[i++]=t[s]},t.prototype.setVertexConstFromMatrix=function(e,t){var i=t.rawData,s=4*(e-this.vertexConstantOffset);this.vertexConstantData[s++]=i[0],this.vertexConstantData[s++]=i[4],this.vertexConstantData[s++]=i[8],this.vertexConstantData[s++]=i[12],this.vertexConstantData[s++]=i[1],this.vertexConstantData[s++]=i[5],this.vertexConstantData[s++]=i[9],this.vertexConstantData[s++]=i[13],this.vertexConstantData[s++]=i[2],this.vertexConstantData[s++]=i[6],this.vertexConstantData[s++]=i[10],this.vertexConstantData[s++]=i[14],this.vertexConstantData[s++]=i[3],this.vertexConstantData[s++]=i[7],this.vertexConstantData[s++]=i[11],this.vertexConstantData[s]=i[15]},t.prototype.setFragmentConst=function(e,t,i,s,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0);var r=4*(e-this.fragmentConstantOffset);this.fragmentConstantData[r++]=t,this.fragmentConstantData[r++]=i,this.fragmentConstantData[r++]=s,this.fragmentConstantData[r]=a},t}(s);t.exports=r},{"awayjs-stagegl/lib/materials/compilation/ShaderRegisterCache":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-stagegl/lib/animators/states/IAnimationState":[function(){},{}],"awayjs-stagegl/lib/base/ContextGLBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-core/lib/textures/RenderTexture"),a=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),r=e("awayjs-stagegl/lib/pool/TextureDataPool"),n=e("awayjs-stagegl/lib/pool/ProgramDataPool"),o=e("awayjs-stagegl/lib/pool/MaterialDataPool"),l=e("awayjs-stagegl/lib/base/ContextGLClearMask"),h=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),p=function(){function e(e){this._programData=new Array,this._numUsedStreams=0,this._numUsedTextures=0,this._stageIndex=-1,this._antiAlias=0,this._renderTarget=null,this._renderSurfaceSelector=0,this._stageIndex=e,this._texturePool=new r(this),this._materialDataPool=new o(this),this._programDataPool=new n(this)}return Object.defineProperty(e.prototype,"container",{get:function(){return this._pContainer},enumerable:!0,configurable:!0}),e.prototype.setRenderTarget=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=0),(this._renderTarget!==e||i!=this._renderSurfaceSelector||this._enableDepthAndStencil!=t)&&(this._renderTarget=e,this._renderSurfaceSelector=i,this._enableDepthAndStencil=t,e instanceof s?this.setRenderToTexture(this.getRenderTexture(e),t,this._antiAlias,i):(this.setRenderToBackBuffer(),this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)))},e.prototype.getRenderTexture=function(e){var t=this._texturePool.getItem(e);return t.texture||(t.texture=this.createTexture(e.width,e.height,h.BGRA,!0)),t.texture},e.prototype.getProgram=function(e){if(e.key.length)return e.programData;e.key=e.animationVertexCode+e.vertexCode+"---"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode;var t=this._programDataPool.getItem(e.key);return e.programData!=t&&(e.programData&&e.programData.dispose(),e.programData=t,t.usages++),t},e.prototype.getMaterial=function(e,t){var i=this._materialDataPool.getItem(e);if(i.invalidAnimation){i.invalidAnimation=!1;for(var s,a=i.getMaterialPasses(t),r=this.getEnabledGPUAnimation(e,a),n=0,o=1,l=a.length,h=0;l>h;h++)s=a[h],s.usesAnimation!=r&&(s.usesAnimation=r,""==s.key),""==s.key&&this.calcAnimationCode(e,s),n+=this.getProgram(s).id*o,o*=1e3;i.renderOrderId=n}return i},e.prototype.activateBuffer=function(e,t,i,s){t.contexts[this._stageIndex]||(t.contexts[this._stageIndex]=this),t.buffers[this._stageIndex]||(t.buffers[this._stageIndex]=this.createVertexBuffer(t.data.length/t.dataPerVertex,t.dataPerVertex),t.invalid[this._stageIndex]=!0),t.invalid[this._stageIndex]&&(t.buffers[this._stageIndex].uploadFromArray(t.data,0,t.data.length/t.dataPerVertex),t.invalid[this._stageIndex]=!1),this.setVertexBufferAt(e,t.buffers[this._stageIndex],i,s)},e.prototype.disposeVertexData=function(e){e.buffers[this._stageIndex].dispose(),e.buffers[this._stageIndex]=null},e.prototype.activateRenderTexture=function(e,t){this.setTextureAt(e,this.getRenderTexture(t))},e.prototype.activateMaterialPass=function(e,t,i){for(var s=e.shaderObject,r=s.numUsedStreams;r<this._numUsedStreams;r++)this.setVertexBufferAt(r,null);for(var r=s.numUsedTextures;r<this._numUsedTextures;r++)this.setTextureAt(r,null);e.usesAnimation&&e.material.animationSet.activate(s,t),s.iActivate(t,i);var n=this.getProgram(e);if(!n.program){n.program=this.createProgram();var o=(new a).assemble("part vertex 1\n"+e.animationVertexCode+e.vertexCode+"endpart").vertex.data,l=(new a).assemble("part fragment 1\n"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode+"endpart").fragment.data;n.program.upload(o,l)}this.setProgram(n.program)},e.prototype.deactivateMaterialPass=function(e,t){var i=e.shaderObject;e.usesAnimation&&e.material.animationSet.deactivate(i,t),e.shaderObject.iDeactivate(t),this._numUsedStreams=i.numUsedStreams,this._numUsedTextures=i.numUsedTextures},e.prototype.activateTexture=function(e,t){var i=this._texturePool.getItem(t);if(i.texture||(i.texture=this.createTexture(t.width,t.height,h.BGRA,!0),i.invalid=!0),i.invalid)if(i.invalid=!1,t.generateMipmaps)for(var s=t._iGetMipmapData(),a=s.length,r=0;a>r;r++)i.texture.uploadFromData(s[r],r);else i.texture.uploadFromData(t._iGetTextureData(),0);this.setTextureAt(e,i.texture)},e.prototype.activateCubeTexture=function(e,t){var i=this._texturePool.getItem(t);if(i.texture||(i.texture=this.createCubeTexture(t.size,h.BGRA,!1),i.invalid=!0),i.invalid){i.invalid=!1;for(var s=0;6>s;++s)if(t.generateMipmaps)for(var a=t._iGetMipmapData(s),r=a.length,n=0;r>n;n++)i.texture.uploadFromData(a[n],s,n);else i.texture.uploadFromData(t._iGetTextureData(s),s,0)}this.setTextureAt(e,i.texture)},e.prototype.getIndexBuffer=function(e){return e.contexts[this._stageIndex]||(e.contexts[this._stageIndex]=this),e.buffers[this._stageIndex]||(e.buffers[this._stageIndex]=this.createIndexBuffer(e.data.length),e.invalid[this._stageIndex]=!0),e.invalid[this._stageIndex]&&(e.buffers[this._stageIndex].uploadFromArray(e.data,0,e.data.length),e.invalid[this._stageIndex]=!1),e.buffers[this._stageIndex]},e.prototype.disposeIndexData=function(e){e.buffers[this._stageIndex].dispose(),e.buffers[this._stageIndex]=null},e.prototype.clear=function(e,t,i,s,a,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===a&&(a=1),void 0===r&&(r=0),void 0===n&&(n=l.ALL)},e.prototype.configureBackBuffer=function(e,t,i,s){void 0===s&&(s=!0),this._width=e,this._height=t},e.prototype.createIndexBuffer=function(){throw new i},e.prototype.createVertexBuffer=function(){throw new i},e.prototype.createTexture=function(e,t,s,a,r){throw void 0===r&&(r=0),new i},e.prototype.createCubeTexture=function(e,t,s,a){throw void 0===a&&(a=0),new i},e.prototype.createProgram=function(){throw new i},e.prototype.dispose=function(){},e.prototype.present=function(){},e.prototype.setRenderToTexture=function(e,t,i,s){void 0===t&&(t=!1),void 0===i&&(i=0),void 0===s&&(s=0)},e.prototype.setRenderToBackBuffer=function(){},e.prototype.setScissorRectangle=function(){},e.prototype.setTextureAt=function(){},e.prototype.setVertexBufferAt=function(e,t,i,s){void 0===i&&(i=0),void 0===s&&(s=null)},e.prototype.setProgram=function(){},e.prototype.registerProgram=function(e){for(var t=0;null!=this._programData[t];)t++;this._programData[t]=e,e.id=t},e.prototype.unRegisterProgram=function(e){this._programData[e.id]=null,e.id=-1},e.prototype.getEnabledGPUAnimation=function(e,t){if(e.animationSet){e.animationSet.resetGPUCompatibility();for(var i=e.iOwners,s=i.length,a=t.length,r=0;a>r;r++)for(var n=0;s>n;n++)i[n].animator&&i[n].animator.testGPUCompatibility(t[r].shaderObject);return!e.animationSet.usesCPU}return!1},e.prototype.calcAnimationCode=function(e,t){t.key="",t.animationVertexCode="",t.animationFragmentCode="";var i=t.shaderObject;if(t.usesAnimation){var s=e.animationSet;t.animationVertexCode+=s.getAGALVertexCode(i),i.uvDependencies>0&&!i.usesUVTransform&&(t.animationVertexCode+=s.getAGALUVCode(i)),i.usesFragmentAnimation&&(t.animationFragmentCode+=s.getAGALFragmentCode(i,t.shadedTarget)),s.doneAGALCode(i)}else{for(var a=i.animatableAttributes.length,r=0;a>r;++r)t.animationVertexCode+="mov "+i.animationTargetRegisters[r]+", "+i.animatableAttributes[r]+"\n";i.uvDependencies>0&&!i.usesUVTransform&&(t.animationVertexCode+="mov "+i.uvTarget+","+i.uvSource+"\n")}},e}();t.exports=p},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0,"awayjs-stagegl/lib/pool/MaterialDataPool":void 0,"awayjs-stagegl/lib/pool/ProgramDataPool":void 0,"awayjs-stagegl/lib/pool/TextureDataPool":void 0}],"awayjs-stagegl/lib/base/ContextGLBlendFactor":[function(e,t){var i=function(){function e(){}return e.DESTINATION_ALPHA="destinationAlpha",e.DESTINATION_COLOR="destinationColor",e.ONE="one",e.ONE_MINUS_DESTINATION_ALPHA="oneMinusDestinationAlpha",e.ONE_MINUS_DESTINATION_COLOR="oneMinusDestinationColor",e.ONE_MINUS_SOURCE_ALPHA="oneMinusSourceAlpha",e.ONE_MINUS_SOURCE_COLOR="oneMinusSourceColor",e.SOURCE_ALPHA="sourceAlpha",e.SOURCE_COLOR="sourceColor",e.ZERO="zero",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLClearMask":[function(e,t){var i=function(){function e(){}return e.COLOR=1,e.DEPTH=2,e.STENCIL=4,e.ALL=e.COLOR|e.DEPTH|e.STENCIL,e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLCompareMode":[function(e,t){var i=function(){function e(){}return e.ALWAYS="always",e.EQUAL="equal",e.GREATER="greater",e.GREATER_EQUAL="greaterEqual",e.LESS="less",e.LESS_EQUAL="lessEqual",e.NEVER="never",e.NOT_EQUAL="notEqual",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLMipFilter":[function(e,t){var i=function(){function e(){}return e.MIPLINEAR="miplinear",e.MIPNEAREST="mipnearest",e.MIPNONE="mipnone",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLProfile":[function(e,t){var i=function(){function e(){}return e.BASELINE="baseline",e.BASELINE_CONSTRAINED="baselineConstrained",e.BASELINE_EXTENDED="baselineExtended",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLProgramType":[function(e,t){var i=function(){function e(){}return e.FRAGMENT="fragment",e.VERTEX="vertex",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLStencilAction":[function(e,t){var i=function(){function e(){}return e.DECREMENT_SATURATE="decrementSaturate",e.DECREMENT_WRAP="decrementWrap",e.INCREMENT_SATURATE="incrementSaturate",e.INCREMENT_WRAP="incrementWrap",e.INVERT="invert",e.KEEP="keep",e.SET="set",e.ZERO="zero",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLTextureFilter":[function(e,t){var i=function(){function e(){}return e.LINEAR="linear",e.NEAREST="nearest",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLTextureFormat":[function(e,t){var i=function(){function e(){}return e.BGRA="bgra",e.BGRA_PACKED="bgraPacked4444",e.BGR_PACKED="bgrPacked565",e.COMPRESSED="compressed",e.COMPRESSED_ALPHA="compressedAlpha",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLTriangleFace":[function(e,t){var i=function(){function e(){}return e.BACK="back",e.FRONT="front",e.FRONT_AND_BACK="frontAndBack",e.NONE="none",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":[function(e,t){var i=function(){function e(){}return e.BYTES_4="bytes4",e.FLOAT_1="float1",e.FLOAT_2="float2",e.FLOAT_3="float3",e.FLOAT_4="float4",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextGLWrapMode":[function(e,t){var i=function(){function e(){}return e.CLAMP="clamp",e.REPEAT="repeat",e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ContextStage3D":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/swfobject"),a=e("awayjs-stagegl/lib/aglsl/Sampler"),r=e("awayjs-stagegl/lib/base/ContextGLBase"),n=e("awayjs-stagegl/lib/base/ContextGLClearMask"),o=e("awayjs-stagegl/lib/base/ContextGLProgramType"),l=e("awayjs-stagegl/lib/base/CubeTextureFlash"),h=e("awayjs-stagegl/lib/base/IndexBufferFlash"),p=e("awayjs-stagegl/lib/base/OpCodes"),u=e("awayjs-stagegl/lib/base/ProgramFlash"),d=e("awayjs-stagegl/lib/base/TextureFlash"),g=e("awayjs-stagegl/lib/base/VertexBufferFlash"),c=function(e){function t(i,a,r){function n(e){e.success&&(u._pContainer=e.ref,u._iCallback=r)}e.call(this,a),this._cmdStream="",this._resources=new Array;var o="11.0.0",l={id:i.id},h={quality:"high",bgcolor:"#ffffff",allowscriptaccess:"sameDomain",allowfullscreen:"true",wmode:"direct"};this._errorCheckingEnabled=!1,this._iDriverInfo="Unknown";var p={salign:"tl",id:i.id,name:i.name};this._oldCanvas=i.cloneNode(),this._oldParent=i.parentNode;var u=this;t.contexts[i.id]=this,s.embedSWF("libs/molehill_js_flashbridge.swf",i.id,String(i.width),String(i.height),o,"",l,h,p,n)}return i(t,e),Object.defineProperty(t.prototype,"container",{get:function(){return this._pContainer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"driverInfo",{get:function(){return this._iDriverInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorCheckingEnabled",{get:function(){return this._errorCheckingEnabled},set:function(e){this._errorCheckingEnabled!=e&&(this._errorCheckingEnabled=e,this.addStream(String.fromCharCode(p.enableErrorChecking,e?p.trueValue:p.falseValue)),this.execute())},enumerable:!0,configurable:!0}),t.prototype._iAddResource=function(e){this._resources.push(e)},t.prototype._iRemoveResource=function(e){this._resources.splice(this._resources.indexOf(e))},t.prototype.createTexture=function(e,t,i,s,a){return void 0===a&&(a=0),new d(this,e,t,i,s)},t.prototype.createCubeTexture=function(e,t,i,s){return void 0===s&&(s=0),new l(this,e,t,i)},t.prototype.setTextureAt=function(e,i){this.addStream(i?String.fromCharCode(p.setTextureAt)+e+","+i.id+",":String.fromCharCode(p.clearTextureAt)+e.toString()+","),t.debug&&this.execute()},t.prototype.setSamplerStateAt=function(){},t.prototype.setStencilActions=function(e,i,s,a,r){void 0===e&&(e="frontAndBack"),void 0===i&&(i="always"),void 0===s&&(s="keep"),void 0===a&&(a="keep"),void 0===r&&(r="keep"),this.addStream(String.fromCharCode(p.setStencilActions)+e+"$"+i+"$"+s+"$"+a+"$"+r+"$"),t.debug&&this.execute()},t.prototype.setStencilReferenceValue=function(e,i,s){void 0===i&&(i=255),void 0===s&&(s=255),this.addStream(String.fromCharCode(p.setStencilReferenceValue,e+p.intMask,i+p.intMask,s+p.intMask)),t.debug&&this.execute()},t.prototype.setCulling=function(e,i){void 0===i&&(i="leftHanded"),this.addStream(String.fromCharCode(p.setCulling)+e+"$"),t.debug&&this.execute()},t.prototype.drawTriangles=function(e,i,s){void 0===i&&(i=0),void 0===s&&(s=-1),i=i||0,(!s||0>s)&&(s=e.numIndices/3),this.addStream(String.fromCharCode(p.drawTriangles,e.id+p.intMask)+i+","+s+","),t.debug&&this.execute()},t.prototype.setProgramConstantsFromMatrix=function(e,t,i,s){void 0===s&&(s=!1);var a=i.rawData;s?(this.setProgramConstantsFromArray(e,t,[a[0],a[4],a[8],a[12]],1),this.setProgramConstantsFromArray(e,t+1,[a[1],a[5],a[9],a[13]],1),this.setProgramConstantsFromArray(e,t+2,[a[2],a[6],a[10],a[14]],1),this.setProgramConstantsFromArray(e,t+3,[a[3],a[7],a[11],a[15]],1)):(this.setProgramConstantsFromArray(e,t,[a[0],a[1],a[2],a[3]],1),this.setProgramConstantsFromArray(e,t+1,[a[4],a[5],a[6],a[7]],1),this.setProgramConstantsFromArray(e,t+2,[a[8],a[9],a[10],a[11]],1),this.setProgramConstantsFromArray(e,t+3,[a[12],a[13],a[14],a[15]],1))},t.prototype.setProgramConstantsFromArray=function(e,i,s,a){void 0===a&&(a=-1);for(var r,n=e==o.VERTEX?p.trueValue:p.falseValue,l=0;a>l;l++)r=4*l,this.addStream(String.fromCharCode(p.setProgramConstant,n,i+l+p.intMask)+s[r]+","+s[r+1]+","+s[r+2]+","+s[r+3]+","),t.debug&&this.execute()},t.prototype.setProgram=function(e){this.addStream(String.fromCharCode(p.setProgram,e.id+p.intMask)),t.debug&&this.execute()},t.prototype.present=function(){this.addStream(String.fromCharCode(p.present)),this.execute()},t.prototype.clear=function(e,i,s,a,r,o,l){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=1),void 0===r&&(r=1),void 0===o&&(o=0),void 0===l&&(l=n.ALL),this.addStream(String.fromCharCode(p.clear)+e+","+i+","+s+","+a+","+r+","+o+","+l+","),t.debug&&this.execute()},t.prototype.createProgram=function(){return new u(this)},t.prototype.createVertexBuffer=function(e,t){return new g(this,e,t)},t.prototype.createIndexBuffer=function(e){return new h(this,e)},t.prototype.configureBackBuffer=function(t,i,s,a){void 0===a&&(a=!0),e.prototype.configureBackBuffer.call(this,t,i,s,a),this.addStream(String.fromCharCode(p.configureBackBuffer)+t+","+i+",")},t.prototype.drawToBitmapData=function(){},t.prototype.setVertexBufferAt=function(e,i,s,a){void 0===s&&(s=0),void 0===a&&(a=null),this.addStream(i?String.fromCharCode(p.setVertexBufferAt,e+p.intMask)+i.id+","+s+","+a+"$":String.fromCharCode(p.clearVertexBufferAt,e+p.intMask)),t.debug&&this.execute()},t.prototype.setColorMask=function(e,i,s,a){this.addStream(String.fromCharCode(p.setColorMask,e?p.trueValue:p.falseValue,i?p.trueValue:p.falseValue,s?p.trueValue:p.falseValue,a?p.trueValue:p.falseValue)),t.debug&&this.execute()},t.prototype.setBlendFactors=function(e,i){this.addStream(String.fromCharCode(p.setBlendFactors)+e+"$"+i+"$"),t.debug&&this.execute()},t.prototype.setRenderToTexture=function(e,i,s,a){void 0===i&&(i=!1),void 0===s&&(s=0),void 0===a&&(a=0),this.addStream(null===e||void 0===e?String.fromCharCode(p.clearRenderToTexture):String.fromCharCode(p.setRenderToTexture,i?p.trueValue:p.falseValue)+e.id+","+(s||0)+","),t.debug&&this.execute()},t.prototype.setRenderToBackBuffer=function(){this.addStream(String.fromCharCode(p.clearRenderToTexture)),t.debug&&this.execute()},t.prototype.setScissorRectangle=function(e){this.addStream(e?String.fromCharCode(p.setScissorRect)+e.x+","+e.y+","+e.width+","+e.height+",":String.fromCharCode(p.clearScissorRect)),t.debug&&this.execute()},t.prototype.setDepthTest=function(e,i){this.addStream(String.fromCharCode(p.setDepthTest,e?p.trueValue:p.falseValue)+i+"$"),t.debug&&this.execute()},t.prototype.dispose=function(){if(null!=this._pContainer){for(console.log("Context3D dispose, releasing "+this._resources.length+" resources.");this._resources.length;)this._resources[0].dispose();this._pContainer&&(this.addStream(String.fromCharCode(p.disposeContext)),this.execute(),s.removeSWF(this._oldCanvas.id),this._oldCanvas&&this._oldParent&&(this._oldParent.appendChild(this._oldCanvas),this._oldParent=null),this._pContainer=null),this._oldCanvas=null}},t.prototype.addStream=function(e){this._cmdStream+=e},t.prototype.execute=function(){t.logStream&&console.log(this._cmdStream);var e=this._pContainer.CallFunction('<invoke name="execStage3dOpStream" returntype="javascript"><arguments><string>'+this._cmdStream+"</string></arguments></invoke>");if(Number(e)<=-3)throw"Exec stream failed";return this._cmdStream="",Number(e)},t.contexts=new Object,t.maxvertexconstants=128,t.maxfragconstants=28,t.maxtemp=8,t.maxstreams=8,t.maxtextures=8,t.defaultsampler=new a,t.debug=!1,t.logStream=!1,t}(r);t.exports=c},{"awayjs-stagegl/lib/aglsl/Sampler":void 0,"awayjs-stagegl/lib/base/ContextGLBase":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/CubeTextureFlash":void 0,"awayjs-stagegl/lib/base/IndexBufferFlash":void 0,"awayjs-stagegl/lib/base/OpCodes":void 0,"awayjs-stagegl/lib/base/ProgramFlash":void 0,"awayjs-stagegl/lib/base/TextureFlash":void 0,"awayjs-stagegl/lib/base/VertexBufferFlash":void 0,"awayjs-stagegl/lib/swfobject":void 0}],"awayjs-stagegl/lib/base/ContextWebGL":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Rectangle"),a=e("awayjs-core/lib/utils/ByteArray"),r=e("awayjs-stagegl/lib/base/ContextGLBase"),n=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),o=e("awayjs-stagegl/lib/base/ContextGLClearMask"),l=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),h=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),p=e("awayjs-stagegl/lib/base/ContextGLProgramType"),u=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),d=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),g=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),c=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),_=e("awayjs-stagegl/lib/base/CubeTextureWebGL"),f=e("awayjs-stagegl/lib/base/IndexBufferWebGL"),m=e("awayjs-stagegl/lib/base/ProgramWebGL"),y=e("awayjs-stagegl/lib/base/TextureWebGL"),b=e("awayjs-stagegl/lib/base/SamplerState"),x=e("awayjs-stagegl/lib/base/VertexBufferWebGL"),v=function(e){function t(i,s){e.call(this,s),this._blendFactorDictionary=new Object,this._depthTestDictionary=new Object,this._textureIndexDictionary=new Array(8),this._textureTypeDictionary=new Object,this._wrapDictionary=new Object,this._filterDictionary=new Object,this._mipmapFilterDictionary=new Object,this._uniformLocationNameDictionary=new Object,this._vertexBufferDimensionDictionary=new Object,this._indexBufferList=new Array,this._vertexBufferList=new Array,this._textureList=new Array,this._programList=new Array,this._samplerStates=new Array(8),this._pContainer=i;try{this._gl=i.getContext("experimental-webgl",{premultipliedAlpha:!1,alpha:!1}),this._gl||(this._gl=i.getContext("webgl",{premultipliedAlpha:!1,alpha:!1}))}catch(a){}this._gl?(this._blendFactorDictionary[n.ONE]=this._gl.ONE,this._blendFactorDictionary[n.DESTINATION_ALPHA]=this._gl.DST_ALPHA,this._blendFactorDictionary[n.DESTINATION_COLOR]=this._gl.DST_COLOR,this._blendFactorDictionary[n.ONE]=this._gl.ONE,this._blendFactorDictionary[n.ONE_MINUS_DESTINATION_ALPHA]=this._gl.ONE_MINUS_DST_ALPHA,this._blendFactorDictionary[n.ONE_MINUS_DESTINATION_COLOR]=this._gl.ONE_MINUS_DST_COLOR,this._blendFactorDictionary[n.ONE_MINUS_SOURCE_ALPHA]=this._gl.ONE_MINUS_SRC_ALPHA,this._blendFactorDictionary[n.ONE_MINUS_SOURCE_COLOR]=this._gl.ONE_MINUS_SRC_COLOR,this._blendFactorDictionary[n.SOURCE_ALPHA]=this._gl.SRC_ALPHA,this._blendFactorDictionary[n.SOURCE_COLOR]=this._gl.SRC_COLOR,this._blendFactorDictionary[n.ZERO]=this._gl.ZERO,this._depthTestDictionary[l.ALWAYS]=this._gl.ALWAYS,this._depthTestDictionary[l.EQUAL]=this._gl.EQUAL,this._depthTestDictionary[l.GREATER]=this._gl.GREATER,this._depthTestDictionary[l.GREATER_EQUAL]=this._gl.GEQUAL,this._depthTestDictionary[l.LESS]=this._gl.LESS,this._depthTestDictionary[l.LESS_EQUAL]=this._gl.LEQUAL,this._depthTestDictionary[l.NEVER]=this._gl.NEVER,this._depthTestDictionary[l.NOT_EQUAL]=this._gl.NOTEQUAL,this._textureIndexDictionary[0]=this._gl.TEXTURE0,this._textureIndexDictionary[1]=this._gl.TEXTURE1,this._textureIndexDictionary[2]=this._gl.TEXTURE2,this._textureIndexDictionary[3]=this._gl.TEXTURE3,this._textureIndexDictionary[4]=this._gl.TEXTURE4,this._textureIndexDictionary[5]=this._gl.TEXTURE5,this._textureIndexDictionary[6]=this._gl.TEXTURE6,this._textureIndexDictionary[7]=this._gl.TEXTURE7,this._textureTypeDictionary.texture2d=this._gl.TEXTURE_2D,this._textureTypeDictionary.textureCube=this._gl.TEXTURE_CUBE_MAP,this._wrapDictionary[c.REPEAT]=this._gl.REPEAT,this._wrapDictionary[c.CLAMP]=this._gl.CLAMP_TO_EDGE,this._filterDictionary[u.LINEAR]=this._gl.LINEAR,this._filterDictionary[u.NEAREST]=this._gl.NEAREST,this._mipmapFilterDictionary[u.LINEAR]=new Object,this._mipmapFilterDictionary[u.LINEAR][h.MIPNEAREST]=this._gl.LINEAR_MIPMAP_NEAREST,this._mipmapFilterDictionary[u.LINEAR][h.MIPLINEAR]=this._gl.LINEAR_MIPMAP_LINEAR,this._mipmapFilterDictionary[u.LINEAR][h.MIPNONE]=this._gl.LINEAR,this._mipmapFilterDictionary[u.NEAREST]=new Object,this._mipmapFilterDictionary[u.NEAREST][h.MIPNEAREST]=this._gl.NEAREST_MIPMAP_NEAREST,this._mipmapFilterDictionary[u.NEAREST][h.MIPLINEAR]=this._gl.NEAREST_MIPMAP_LINEAR,this._mipmapFilterDictionary[u.NEAREST][h.MIPNONE]=this._gl.NEAREST,this._uniformLocationNameDictionary[p.VERTEX]="vc",this._uniformLocationNameDictionary[p.FRAGMENT]="fc",this._vertexBufferDimensionDictionary[g.FLOAT_1]=1,this._vertexBufferDimensionDictionary[g.FLOAT_2]=2,this._vertexBufferDimensionDictionary[g.FLOAT_3]=3,this._vertexBufferDimensionDictionary[g.FLOAT_4]=4,this._vertexBufferDimensionDictionary[g.BYTES_4]=4):alert("WebGL is not available.");for(var r=0;r<t.MAX_SAMPLERS;++r)this._samplerStates[r]=new b,this._samplerStates[r].wrap=this._gl.REPEAT,this._samplerStates[r].filter=this._gl.LINEAR,this._samplerStates[r].mipfilter=this._gl.LINEAR}return i(t,e),Object.defineProperty(t.prototype,"container",{get:function(){return this._pContainer},enumerable:!0,configurable:!0}),t.prototype.gl=function(){return this._gl},t.prototype.clear=function(e,t,i,s,a,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===a&&(a=1),void 0===r&&(r=0),void 0===n&&(n=o.ALL),this._drawing||(this.updateBlendStatus(),this._drawing=!0);var l=0;n&o.COLOR&&(l|=this._gl.COLOR_BUFFER_BIT),n&o.STENCIL&&(l|=this._gl.STENCIL_BUFFER_BIT),n&o.DEPTH&&(l|=this._gl.DEPTH_BUFFER_BIT),this._gl.clearColor(e,t,i,s),this._gl.clearDepth(a),this._gl.clearStencil(r),this._gl.clear(l)},t.prototype.configureBackBuffer=function(t,i,s,a){void 0===a&&(a=!0),e.prototype.configureBackBuffer.call(this,t,i,s,a),a&&(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST)),this._gl.viewport.width=t,this._gl.viewport.height=i,this._gl.viewport(0,0,t,i)},t.prototype.createCubeTexture=function(e,t,i,s){void 0===s&&(s=0);var a=new _(this._gl,e);return this._textureList.push(a),a},t.prototype.createIndexBuffer=function(e){var t=new f(this._gl,e);return this._indexBufferList.push(t),t},t.prototype.createProgram=function(){var e=new m(this._gl);return this._programList.push(e),e},t.prototype.createTexture=function(e,t,i,s,a){void 0===a&&(a=0);var r=new y(this._gl,e,t);return this._textureList.push(r),r},t.prototype.createVertexBuffer=function(e,t){var i=new x(this._gl,e,t);return this._vertexBufferList.push(i),i},t.prototype.dispose=function(){var e;for(e=0;e<this._indexBufferList.length;++e)this._indexBufferList[e].dispose();for(this._indexBufferList=null,e=0;e<this._vertexBufferList.length;++e)this._vertexBufferList[e].dispose();for(this._vertexBufferList=null,e=0;e<this._textureList.length;++e)this._textureList[e].dispose();for(this._textureList=null,e=0;e<this._programList.length;++e)this._programList[e].dispose();for(e=0;e<this._samplerStates.length;++e)this._samplerStates[e]=null;this._programList=null},t.prototype.drawToBitmapData=function(e){var t=new ArrayBuffer(e.width*e.height*4);this._gl.readPixels(0,0,e.width,e.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,new Uint8Array(t));var i=new a;i.setArrayBuffer(t),e.setPixels(new s(0,0,e.width,e.height),i)},t.prototype.drawTriangles=function(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=-1),!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.glBuffer),this._gl.drawElements(this._gl.TRIANGLES,-1==i?e.numIndices:3*i,this._gl.UNSIGNED_SHORT,t)},t.prototype.present=function(){this._drawing=!1},t.prototype.setBlendFactors=function(e,t){this._blendEnabled=!0,this._blendSourceFactor=this._blendFactorDictionary[e],this._blendDestinationFactor=this._blendFactorDictionary[t],this.updateBlendStatus()},t.prototype.setColorMask=function(e,t,i,s){this._gl.colorMask(e,t,i,s)},t.prototype.setCulling=function(e,t){if(void 0===t&&(t="leftHanded"),e==d.NONE)this._gl.disable(this._gl.CULL_FACE);else switch(this._gl.enable(this._gl.CULL_FACE),e){case d.BACK:this._gl.cullFace("leftHanded"==t?this._gl.FRONT:this._gl.BACK);break;case d.FRONT:this._gl.cullFace("leftHanded"==t?this._gl.BACK:this._gl.FRONT);break;case d.FRONT_AND_BACK:this._gl.cullFace(this._gl.FRONT_AND_BACK);break;default:throw"Unknown ContextGLTriangleFace type."}},t.prototype.setDepthTest=function(e,t){this._gl.depthFunc(this._depthTestDictionary[t]),this._gl.depthMask(e)},t.prototype.setProgram=function(e){this._currentProgram=e,e.focusProgram()},t.prototype.setProgramConstantsFromMatrix=function(e,t,i,s){void 0===s&&(s=!1);var a=i.rawData;s?(this.setProgramConstantsFromArray(e,t,[a[0],a[4],a[8],a[12]],1),this.setProgramConstantsFromArray(e,t+1,[a[1],a[5],a[9],a[13]],1),this.setProgramConstantsFromArray(e,t+2,[a[2],a[6],a[10],a[14]],1),this.setProgramConstantsFromArray(e,t+3,[a[3],a[7],a[11],a[15]],1)):(this.setProgramConstantsFromArray(e,t,[a[0],a[1],a[2],a[3]],1),this.setProgramConstantsFromArray(e,t+1,[a[4],a[5],a[6],a[7]],1),this.setProgramConstantsFromArray(e,t+2,[a[8],a[9],a[10],a[11]],1),this.setProgramConstantsFromArray(e,t+3,[a[12],a[13],a[14],a[15]],1))},t.prototype.setProgramConstantsFromArray=function(e,t,i,s){void 0===s&&(s=-1);for(var a,r=this._uniformLocationNameDictionary[e],n=0;s>n;n++)a=4*n,this._gl.uniform4f(this._gl.getUniformLocation(this._currentProgram.glProgram,r+(t+n)),i[a],i[a+1],i[a+2],i[a+3])},t.prototype.setScissorRectangle=function(e){return e?(this._gl.enable(this._gl.SCISSOR_TEST),void this._gl.scissor(e.x,e.y,e.width,e.height)):void this._gl.disable(this._gl.SCISSOR_TEST)},t.prototype.setTextureAt=function(e,t){var i=this._samplerStates[e];if(this._activeTexture!=e&&(t||i.type)&&(this._activeTexture=e,this._gl.activeTexture(this._textureIndexDictionary[e])),!t)return void(i.type&&(this._gl.bindTexture(i.type,null),i.type=null));var s=this._textureTypeDictionary[t.textureType];i.type=s,this._gl.bindTexture(s,t.glTexture),this._gl.uniform1i(this._gl.getUniformLocation(this._currentProgram.glProgram,"fs"+e),e),this._gl.texParameteri(s,this._gl.TEXTURE_WRAP_S,i.wrap),this._gl.texParameteri(s,this._gl.TEXTURE_WRAP_T,i.wrap),this._gl.texParameteri(s,this._gl.TEXTURE_MAG_FILTER,i.filter),this._gl.texParameteri(s,this._gl.TEXTURE_MIN_FILTER,i.mipfilter)
},t.prototype.setSamplerStateAt=function(e,i,s,a){if(!(e>=0&&e<t.MAX_SAMPLERS))throw"Sampler is out of bounds.";this._samplerStates[e].wrap=this._wrapDictionary[i],this._samplerStates[e].filter=this._filterDictionary[s],this._samplerStates[e].mipfilter=this._mipmapFilterDictionary[s][a]},t.prototype.setVertexBufferAt=function(e,t,i,s){void 0===i&&(i=0),void 0===s&&(s=null);var a=this._currentProgram?this._gl.getAttribLocation(this._currentProgram.glProgram,"va"+e):-1;return t?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.glBuffer),this._gl.enableVertexAttribArray(a),void this._gl.vertexAttribPointer(a,this._vertexBufferDimensionDictionary[s],this._gl.FLOAT,!1,4*t.data32PerVertex,4*i)):void(a>-1&&this._gl.disableVertexAttribArray(a))},t.prototype.setRenderToTexture=function(e,t,i,s){void 0===t&&(t=!1),void 0===i&&(i=0),void 0===s&&(s=0);var a=e,r=a.frameBuffer;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,r),t&&(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST)),this._gl.viewport(0,0,a.width,a.height)},t.prototype.setRenderToBackBuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},t.prototype.updateBlendStatus=function(){this._blendEnabled?(this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._blendSourceFactor,this._blendDestinationFactor)):this._gl.disable(this._gl.BLEND)},t.MAX_SAMPLERS=8,t.modulo=0,t}(r);t.exports=v},{"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/utils/ByteArray":void 0,"awayjs-stagegl/lib/base/ContextGLBase":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/base/CubeTextureWebGL":void 0,"awayjs-stagegl/lib/base/IndexBufferWebGL":void 0,"awayjs-stagegl/lib/base/ProgramWebGL":void 0,"awayjs-stagegl/lib/base/SamplerState":void 0,"awayjs-stagegl/lib/base/TextureWebGL":void 0,"awayjs-stagegl/lib/base/VertexBufferWebGL":void 0}],"awayjs-stagegl/lib/base/CubeTextureFlash":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/utils/ByteArrayBase"),r=e("awayjs-stagegl/lib/base/OpCodes"),n=e("awayjs-stagegl/lib/base/ResourceBaseFlash"),o=function(e){function t(t,i,s,a,n){void 0===n&&(n=!1),e.call(this),this._context=t,this._size=i,this._context.addStream(String.fromCharCode(r.initCubeTexture,a?r.trueValue:r.falseValue)+i+","+n+","+s+"$"),this._pId=this._context.execute(),this._context._iAddResource(this)}return i(t,e),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(r.disposeCubeTexture)+this._pId.toString()+","),this._context.execute(),this._context._iRemoveResource(this),this._context=null},t.prototype.uploadFromData=function(e,t,i){if(void 0===i&&(i=0),e instanceof s)e=e.imageData.data;else if(e instanceof HTMLImageElement){var n=document.createElement("canvas"),o=e.width,l=e.height;n.width=o,n.height=l;var h=n.getContext("2d");h.drawImage(e,0,0),e=h.getImageData(0,0,o,l).data}var p=0,u=a.internalGetBase64String(e.length,function(){return e[p++]},null);this._context.addStream(String.fromCharCode(r.uploadBytesCubeTexture)+this._pId+","+i+","+t+","+(this.size>>i)+","+u+"%"),this._context.execute()},t.prototype.uploadCompressedTextureFromByteArray=function(e,t,i){void 0===i&&(i=!1)},t}(n);t.exports=o},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/utils/ByteArrayBase":void 0,"awayjs-stagegl/lib/base/OpCodes":void 0,"awayjs-stagegl/lib/base/ResourceBaseFlash":void 0}],"awayjs-stagegl/lib/base/CubeTextureWebGL":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-stagegl/lib/base/TextureBaseWebGL"),r=function(e){function t(t,i){e.call(this,t),this._textureSelectorDictionary=new Array(6),this.textureType="textureCube",this._size=i,this._texture=this._gl.createTexture(),this._textureSelectorDictionary[0]=t.TEXTURE_CUBE_MAP_POSITIVE_X,this._textureSelectorDictionary[1]=t.TEXTURE_CUBE_MAP_NEGATIVE_X,this._textureSelectorDictionary[2]=t.TEXTURE_CUBE_MAP_POSITIVE_Y,this._textureSelectorDictionary[3]=t.TEXTURE_CUBE_MAP_NEGATIVE_Y,this._textureSelectorDictionary[4]=t.TEXTURE_CUBE_MAP_POSITIVE_Z,this._textureSelectorDictionary[5]=t.TEXTURE_CUBE_MAP_NEGATIVE_Z}return i(t,e),t.prototype.dispose=function(){this._gl.deleteTexture(this._texture)},t.prototype.uploadFromData=function(e,t,i){void 0===i&&(i=0),e instanceof s&&(e=e.imageData),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._texture),this._gl.texImage2D(this._textureSelectorDictionary[t],i,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)},t.prototype.uploadCompressedTextureFromByteArray=function(e,t,i){void 0===i&&(i=!1)},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glTexture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),t}(a);t.exports=r},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-stagegl/lib/base/TextureBaseWebGL":void 0}],"awayjs-stagegl/lib/base/IContextStageGL":[function(){},{}],"awayjs-stagegl/lib/base/ICubeTexture":[function(){},{}],"awayjs-stagegl/lib/base/IIndexBuffer":[function(){},{}],"awayjs-stagegl/lib/base/IProgram":[function(){},{}],"awayjs-stagegl/lib/base/ITextureBase":[function(){},{}],"awayjs-stagegl/lib/base/ITexture":[function(){},{}],"awayjs-stagegl/lib/base/IVertexBuffer":[function(){},{}],"awayjs-stagegl/lib/base/IndexBufferFlash":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/OpCodes"),a=e("awayjs-stagegl/lib/base/ResourceBaseFlash"),r=function(e){function t(t,i){e.call(this),this._context=t,this._numIndices=i,this._context.addStream(String.fromCharCode(s.initIndexBuffer,i+s.intMask)),this._pId=this._context.execute(),this._context._iAddResource(this)}return i(t,e),t.prototype.uploadFromArray=function(e,t,i){this._context.addStream(String.fromCharCode(s.uploadArrayIndexBuffer,this._pId+s.intMask)+e.join()+"#"+t+","+i+","),this._context.execute()},t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(s.disposeIndexBuffer,this._pId+s.intMask)),this._context.execute(),this._context._iRemoveResource(this),this._context=null},Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),t}(a);t.exports=r},{"awayjs-stagegl/lib/base/OpCodes":void 0,"awayjs-stagegl/lib/base/ResourceBaseFlash":void 0}],"awayjs-stagegl/lib/base/IndexBufferWebGL":[function(e,t){var i=function(){function e(e,t){this._gl=e,this._buffer=this._gl.createBuffer(),this._numIndices=t}return e.prototype.uploadFromArray=function(e){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this._gl.STATIC_DRAW)},e.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)},Object.defineProperty(e.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-stagegl/lib/base/OpCodes":[function(e,t){var i=function(){function e(){}return e.trueValue=32,e.falseValue=33,e.intMask=63,e.drawTriangles=41,e.setProgramConstant=42,e.setProgram=43,e.present=44,e.clear=45,e.initProgram=46,e.initVertexBuffer=47,e.initIndexBuffer=48,e.configureBackBuffer=49,e.uploadArrayIndexBuffer=50,e.uploadArrayVertexBuffer=51,e.uploadAGALBytesProgram=52,e.setVertexBufferAt=53,e.uploadBytesIndexBuffer=54,e.uploadBytesVertexBuffer=55,e.setColorMask=56,e.setDepthTest=57,e.disposeProgram=58,e.disposeContext=59,e.disposeVertexBuffer=61,e.disposeIndexBuffer=63,e.initTexture=64,e.setTextureAt=65,e.uploadBytesTexture=66,e.disposeTexture=67,e.setCulling=68,e.setScissorRect=69,e.clearScissorRect=70,e.setBlendFactors=71,e.setRenderToTexture=72,e.clearTextureAt=73,e.clearVertexBufferAt=74,e.setStencilActions=75,e.setStencilReferenceValue=76,e.initCubeTexture=77,e.disposeCubeTexture=78,e.uploadBytesCubeTexture=79,e.clearRenderToTexture=80,e.enableErrorChecking=81,e}();t.exports=i},{}],"awayjs-stagegl/lib/base/ProgramFlash":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextStage3D"),a=e("awayjs-stagegl/lib/base/OpCodes"),r=e("awayjs-stagegl/lib/base/ResourceBaseFlash"),n=function(e){function t(t){e.call(this),this._context=t,this._context.addStream(String.fromCharCode(a.initProgram)),this._pId=this._context.execute(),this._context._iAddResource(this)}return i(t,e),t.prototype.upload=function(e,t){this._context.addStream(String.fromCharCode(a.uploadAGALBytesProgram,this._pId+a.intMask)+e.readBase64String(e.length)+"%"+t.readBase64String(t.length)+"%"),s.debug&&this._context.execute()},t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(a.disposeProgram,this._pId+a.intMask)),this._context.execute(),this._context._iRemoveResource(this),this._context=null},t}(r);t.exports=n},{"awayjs-stagegl/lib/base/ContextStage3D":void 0,"awayjs-stagegl/lib/base/OpCodes":void 0,"awayjs-stagegl/lib/base/ResourceBaseFlash":void 0}],"awayjs-stagegl/lib/base/ProgramWebGL":[function(e,t){var i=e("awayjs-stagegl/lib/aglsl/AGALTokenizer"),s=e("awayjs-stagegl/lib/aglsl/AGLSLParser"),a=function(){function e(e){this._gl=e,this._program=this._gl.createProgram()}return e.prototype.upload=function(t,i){var s=e._aglslParser.parse(e._tokenizer.decribeAGALByteArray(t)),a=e._aglslParser.parse(e._tokenizer.decribeAGALByteArray(i));if(this._vertexShader=this._gl.createShader(this._gl.VERTEX_SHADER),this._fragmentShader=this._gl.createShader(this._gl.FRAGMENT_SHADER),this._gl.shaderSource(this._vertexShader,s),this._gl.compileShader(this._vertexShader),!this._gl.getShaderParameter(this._vertexShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._vertexShader));if(this._gl.shaderSource(this._fragmentShader,a),this._gl.compileShader(this._fragmentShader),!this._gl.getShaderParameter(this._fragmentShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._fragmentShader));if(this._gl.attachShader(this._program,this._vertexShader),this._gl.attachShader(this._program,this._fragmentShader),this._gl.linkProgram(this._program),!this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS))throw new Error(this._gl.getProgramInfoLog(this._program))},e.prototype.dispose=function(){this._gl.deleteProgram(this._program)},e.prototype.focusProgram=function(){this._gl.useProgram(this._program)},Object.defineProperty(e.prototype,"glProgram",{get:function(){return this._program},enumerable:!0,configurable:!0}),e._tokenizer=new i,e._aglslParser=new s,e}();t.exports=a},{"awayjs-stagegl/lib/aglsl/AGALTokenizer":void 0,"awayjs-stagegl/lib/aglsl/AGLSLParser":void 0}],"awayjs-stagegl/lib/base/ResourceBaseFlash":[function(e,t){var i=function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){return this._pId},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},e}();t.exports=i},{}],"awayjs-stagegl/lib/base/SamplerState":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-stagegl/lib/base/Stage":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Rectangle"),a=e("awayjs-core/lib/events/Event"),r=e("awayjs-core/lib/events/EventDispatcher"),n=e("awayjs-core/lib/utils/CSS"),o=e("awayjs-display/lib/display/ContextMode"),l=e("awayjs-display/lib/events/StageEvent"),h=e("awayjs-stagegl/lib/base/ContextStage3D"),p=e("awayjs-stagegl/lib/base/ContextWebGL"),u=function(e){function t(t,i,a,r,o){void 0===r&&(r=!1),void 0===o&&(o="baseline"),e.call(this),this._x=0,this._y=0,this._stageIndex=-1,this._antiAlias=0,this._renderTarget=null,this._renderSurfaceSelector=0,this._initialised=!1,this._container=t,this._stageIndex=i,this._stageManager=a,this._viewPort=new s,this._enableDepthAndStencil=!0,n.setElementX(this._container,0),n.setElementY(this._container,0),this.visible=!0}return i(t,e),t.prototype.requestContext=function(e,t,i){var s=this;void 0===e&&(e=!1),void 0===t&&(t="baseline"),void 0===i&&(i="auto"),null!=this._usesSoftwareRendering&&(this._usesSoftwareRendering=e),this._profile=t;try{i==o.FLASH?new h(this._container,this._stageIndex,function(e){return s._callback(e)}):this._context=new p(this._container,this._stageIndex)}catch(r){try{i==o.AUTO?new h(this._container,this._stageIndex,function(e){return s._callback(e)}):this.dispatchEvent(new a(a.ERROR))}catch(r){this.dispatchEvent(new a(a.ERROR))}}this._context&&this._callback(this._context)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width!=e&&(n.setElementWidth(this._container,e),this._width=this._viewPort.width=e,this._backBufferDirty=!0,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height!=e&&(n.setElementHeight(this._container,e),this._height=this._viewPort.height=e,this._backBufferDirty=!0,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x!=e&&(n.setElementX(this._container,e),this._x=this._viewPort.x=e,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y!=e&&(n.setElementY(this._container,e),this._y=this._viewPort.y=e,this.notifyViewportUpdated())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return n.getElementVisibility(this._container)},set:function(e){n.setElementVisibility(this._container,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),t.prototype.notifyViewportUpdated=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewportUpdated=new l(l.VIEWPORT_UPDATED),this.dispatchEvent(this._viewportUpdated))},t.prototype.notifyEnterFrame=function(){this._enterFrame||(this._enterFrame=new a(a.ENTER_FRAME)),this.dispatchEvent(this._enterFrame)},t.prototype.notifyExitFrame=function(){this._exitFrame||(this._exitFrame=new a(a.EXIT_FRAME)),this.dispatchEvent(this._exitFrame)},Object.defineProperty(t.prototype,"profile",{get:function(){return this._profile},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._stageManager.iRemoveStage(this),this.freeContext(),this._stageManager=null,this._stageIndex=-1},t.prototype.configureBackBuffer=function(e,t,i,s){this.width=e,this.height=t,this._antiAlias=i,this._enableDepthAndStencil=s,this._context&&this._context.configureBackBuffer(e,t,i,s)},Object.defineProperty(t.prototype,"enableDepthAndStencil",{get:function(){return this._enableDepthAndStencil},set:function(e){this._enableDepthAndStencil=e,this._backBufferDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderSurfaceSelector",{get:function(){return this._renderSurfaceSelector},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._context&&(this._backBufferDirty&&(this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil),this._backBufferDirty=!1),this._context.clear((4278190080&this._color)>>>24,(16711680&this._color)>>>16,(65280&this._color)>>>8,255&this._color),this._bufferClear=!0)},t.prototype.addEventListener=function(t,i){e.prototype.addEventListener.call(this,t,i)},t.prototype.removeEventListener=function(t,i){e.prototype.removeEventListener.call(this,t,i)},Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._scissorRect},set:function(e){this._scissorRect=e,this._context.setScissorRectangle(this._scissorRect)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageIndex",{get:function(){return this._stageIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesSoftwareRendering",{get:function(){return this._usesSoftwareRendering},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){this._antiAlias=e,this._backBufferDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewportDirty=!1,this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferClear",{get:function(){return this._bufferClear},set:function(e){this._bufferClear=e},enumerable:!0,configurable:!0}),t.prototype.freeContext=function(){this._context&&(this._context.dispose(),this.dispatchEvent(new l(l.CONTEXT_DISPOSED))),this._context=null,this._initialised=!1},t.prototype.onEnterFrame=function(){this._context&&(this.clear(),this.notifyEnterFrame(),this._context||this._context.present(),this.notifyExitFrame())},t.prototype.recoverFromDisposal=function(){return this._context?!0:!1},t.prototype._callback=function(e){this._context=e,this._container=this._context.container,this._width&&this._height&&this._context.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil),this.dispatchEvent(new l(this._initialised?l.CONTEXT_RECREATED:l.CONTEXT_CREATED)),this._initialised=!0},t}(r);t.exports=u},{"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/utils/CSS":void 0,"awayjs-display/lib/display/ContextMode":void 0,"awayjs-display/lib/events/StageEvent":void 0,"awayjs-stagegl/lib/base/ContextStage3D":void 0,"awayjs-stagegl/lib/base/ContextWebGL":void 0}],"awayjs-stagegl/lib/base/TextureBaseWebGL":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),s=function(){function e(e){this.textureType="",this._gl=e}return e.prototype.dispose=function(){throw"Abstract method must be overridden."},Object.defineProperty(e.prototype,"glTexture",{get:function(){throw new i},enumerable:!0,configurable:!0}),e}();t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":void 0}],"awayjs-stagegl/lib/base/TextureFlash":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/utils/ByteArrayBase"),r=e("awayjs-stagegl/lib/base/OpCodes"),n=e("awayjs-stagegl/lib/base/ResourceBaseFlash"),o=function(e){function t(t,i,s,a,n,o){void 0===o&&(o=!1),e.call(this),this._context=t,this._width=i,this._height=s,this._context.addStream(String.fromCharCode(r.initTexture,n?r.trueValue:r.falseValue)+i+","+s+","+o+","+a+"$"),this._pId=this._context.execute(),this._context._iAddResource(this)}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(r.disposeTexture)+this._pId.toString()+","),this._context.execute(),this._context._iRemoveResource(this),this._context=null},t.prototype.uploadFromData=function(e,t){if(void 0===t&&(t=0),e instanceof s)e=e.imageData.data;else if(e instanceof HTMLImageElement){var i=document.createElement("canvas"),n=e.width,o=e.height;i.width=n,i.height=o;var l=i.getContext("2d");l.drawImage(e,0,0),e=l.getImageData(0,0,n,o).data}var h=0,p=a.internalGetBase64String(e.length,function(){return e[h++]},null);this._context.addStream(String.fromCharCode(r.uploadBytesTexture)+this._pId+","+t+","+(this._width>>t)+","+(this._height>>t)+","+p+"%"),this._context.execute()},t}(n);t.exports=o},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/utils/ByteArrayBase":void 0,"awayjs-stagegl/lib/base/OpCodes":void 0,"awayjs-stagegl/lib/base/ResourceBaseFlash":void 0}],"awayjs-stagegl/lib/base/TextureWebGL":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-stagegl/lib/base/TextureBaseWebGL"),r=function(e){function t(t,i,s){e.call(this,t),this.textureType="texture2d",this._width=i,this._height=s,this._glTexture=this._gl.createTexture()}return i(t,e),t.prototype.dispose=function(){this._gl.deleteTexture(this._glTexture)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameBuffer",{get:function(){if(!this._frameBuffer){this._frameBuffer=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._frameBuffer),this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null);var e=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,e),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._width,this._height),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._glTexture,0),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,e),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return this._frameBuffer},enumerable:!0,configurable:!0}),t.prototype.uploadFromData=function(e,t){void 0===t&&(t=0),e instanceof s&&(e=e.imageData),this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,t,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},t.prototype.uploadCompressedTextureFromByteArray=function(e,t,i){void 0===i&&(i=!1);this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")},Object.defineProperty(t.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:!0,configurable:!0}),t.prototype.generateMipmaps=function(){},t}(a);t.exports=r},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-stagegl/lib/base/TextureBaseWebGL":void 0}],"awayjs-stagegl/lib/base/VertexBufferFlash":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/OpCodes"),a=e("awayjs-stagegl/lib/base/ResourceBaseFlash"),r=function(e){function t(t,i,a){e.call(this),this._context=t,this._numVertices=i,this._data32PerVertex=a,this._context.addStream(String.fromCharCode(s.initVertexBuffer,a+s.intMask)+i.toString()+","),this._pId=this._context.execute(),this._context._iAddResource(this)}return i(t,e),t.prototype.uploadFromArray=function(e,t,i){this._context.addStream(String.fromCharCode(s.uploadArrayVertexBuffer,this._pId+s.intMask)+e.join()+"#"+[t,i].join()+","),this._context.execute()},Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data32PerVertex",{get:function(){return this._data32PerVertex},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._context.addStream(String.fromCharCode(s.disposeVertexBuffer,this._pId+s.intMask)),this._context.execute(),this._context._iRemoveResource(this),this._context=null},t}(a);t.exports=r},{"awayjs-stagegl/lib/base/OpCodes":void 0,"awayjs-stagegl/lib/base/ResourceBaseFlash":void 0}],"awayjs-stagegl/lib/base/VertexBufferWebGL":[function(e,t){var i=function(){function e(e,t,i){this._gl=e,this._buffer=this._gl.createBuffer(),this._numVertices=t,this._data32PerVertex=i}return e.prototype.uploadFromArray=function(e){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW)},Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data32PerVertex",{get:function(){return this._data32PerVertex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)},e}();t.exports=i},{}],"awayjs-stagegl/lib/errors/AnimationSetError":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/errors/Error"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t}(s);t.exports=a},{"awayjs-core/lib/errors/Error":void 0}],"awayjs-stagegl/lib/events/AnimatorEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/events/Event"),a=function(e){function t(t,i){e.call(this,t),this._animator=i}return i(t,e),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.type,this._animator)},t.START="start",t.STOP="stop",t.CYCLE_COMPLETE="cycle_complete",t}(s);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-stagegl/lib/events/ShadingMethodEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/events/Event"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.SHADER_INVALIDATED="ShaderInvalidated",t}(s);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-stagegl/lib/filters/Filter3DBase":[function(e,t){var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.pAddTask=function(e){this._tasks.push(e),null==this._requireDepthRender&&(this._requireDepthRender=e.requireDepthRender)},Object.defineProperty(e.prototype,"tasks",{get:function(){return this._tasks},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._tasks[0].getMainInputTexture(e)},Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureHeight=e},enumerable:!0,configurable:!0}),e.prototype.setRenderTargets=function(e){this._tasks[this._tasks.length-1].target=e},e.prototype.dispose=function(){for(var e=0;e<this._tasks.length;++e)this._tasks[e].dispose()},e.prototype.update=function(){},e}();t.exports=i},{}],"awayjs-stagegl/lib/filters/tasks/Filter3DTaskBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),r=function(){function e(e){void 0===e&&(e=!1),this._scaledTextureWidth=-1,this._scaledTextureHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._textureDimensionsInvalid=!0,this._program3DInvalid=!0,this._textureScale=0,this._requireDepthRender=e}return Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){this._textureScale!=e&&(this._textureScale=e,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth!=e&&(this._textureWidth=e,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight!=e&&(this._textureHeight=e,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._textureDimensionsInvalid&&this.pUpdateTextures(e),this._mainInputTexture},e.prototype.dispose=function(){this._mainInputTexture&&this._mainInputTexture.dispose(),this._program3D&&this._program3D.dispose()},e.prototype.pInvalidateProgram=function(){this._program3DInvalid=!0},e.prototype.pUpdateProgram=function(e){this._program3D&&this._program3D.dispose(),this._program3D=e.context.createProgram();var t=(new s).assemble("part vertex 1\n"+this.pGetVertexCode()+"endpart").vertex.data,i=(new s).assemble("part fragment 1\n"+this.pGetFragmentCode()+"endpart").fragment.data;this._program3D.upload(t,i),this._program3DInvalid=!1},e.prototype.pGetVertexCode=function(){return"mov op, va0\nmov v0, va1\n"},e.prototype.pGetFragmentCode=function(){throw new i},e.prototype.pUpdateTextures=function(e){this._mainInputTexture&&this._mainInputTexture.dispose(),this._mainInputTexture=e.context.createTexture(this._scaledTextureWidth,this._scaledTextureHeight,a.BGRA,!0),this._textureDimensionsInvalid=!1},e.prototype.getProgram=function(e){return this._program3DInvalid&&this.pUpdateProgram(e),this._program3D},e.prototype.activate=function(){},e.prototype.deactivate=function(){},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e}();t.exports=r},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0}],"awayjs-stagegl/lib/managers/RTTBufferManager":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e
}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Rectangle"),a=e("awayjs-core/lib/events/Event"),r=e("awayjs-core/lib/events/EventDispatcher"),n=e("awayjs-core/lib/utils/TextureUtils"),o=function(e){function t(t){e.call(this),this._viewWidth=-1,this._viewHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._buffersInvalid=!0,this._renderToTextureRect=new s,this._stage=t}return i(t,e),t.getInstance=function(e){if(!e)throw new Error("stage key cannot be null!");null==t._instances&&(t._instances=new Array);var i=t.getRTTBufferManagerFromStage(e);if(null==i){i=new t(e);var s=new l;s.stage3d=e,s.rttbfm=i,t._instances.push(s)}return i},t.getRTTBufferManagerFromStage=function(e){for(var i,s=t._instances.length,a=0;s>a;a++)if(i=t._instances[a],i.stage3d===e)return i.rttbfm;return null},t.deleteRTTBufferManager=function(e){for(var i,s=t._instances.length,a=0;s>a;a++)if(i=t._instances[a],i.stage3d===e)return void t._instances.splice(a,1)},Object.defineProperty(t.prototype,"textureRatioX",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureRatioY",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(e){e!=this._viewWidth&&(this._viewWidth=e,this._buffersInvalid=!0,this._textureWidth=n.getBestPowerOf2(this._viewWidth),this._textureWidth>this._viewWidth?(this._renderToTextureRect.x=Math.floor(.5*(this._textureWidth-this._viewWidth)),this._renderToTextureRect.width=this._viewWidth):(this._renderToTextureRect.x=0,this._renderToTextureRect.width=this._textureWidth),this.dispatchEvent(new a(a.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(e){e!=this._viewHeight&&(this._viewHeight=e,this._buffersInvalid=!0,this._textureHeight=n.getBestPowerOf2(this._viewHeight),this._textureHeight>this._viewHeight?(this._renderToTextureRect.y=Math.floor(.5*(this._textureHeight-this._viewHeight)),this._renderToTextureRect.height=this._viewHeight):(this._renderToTextureRect.y=0,this._renderToTextureRect.height=this._textureHeight),this.dispatchEvent(new a(a.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToScreenVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToScreenVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureRect",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){t.deleteRTTBufferManager(this._stage),this._indexBuffer&&(this._indexBuffer.dispose(),this._renderToScreenVertexBuffer.dispose(),this._renderToTextureVertexBuffer.dispose(),this._renderToScreenVertexBuffer=null,this._renderToTextureVertexBuffer=null,this._indexBuffer=null)},t.prototype.updateRTTBuffers=function(){var e,t,i,s,a=this._stage.context;null==this._renderToTextureVertexBuffer&&(this._renderToTextureVertexBuffer=a.createVertexBuffer(4,5)),null==this._renderToScreenVertexBuffer&&(this._renderToScreenVertexBuffer=a.createVertexBuffer(4,5)),this._indexBuffer||(this._indexBuffer=a.createIndexBuffer(6),this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)),this._textureRatioX=i=Math.min(this._viewWidth/this._textureWidth,1),this._textureRatioY=s=Math.min(this._viewHeight/this._textureHeight,1);var r=.5*(1-i),n=.5*(i+1),o=.5*(s+1),l=.5*(1-s);e=[-i,-s,r,o,0,i,-s,n,o,1,i,s,n,l,2,-i,s,r,l,3],t=[-1,-1,r,o,0,1,-1,n,o,1,1,1,n,l,2,-1,1,r,l,3],this._renderToTextureVertexBuffer.uploadFromArray(e,0,4),this._renderToScreenVertexBuffer.uploadFromArray(t,0,4),this._buffersInvalid=!1},t}(r),l=function(){function e(){}return e}();t.exports=o},{"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/utils/TextureUtils":void 0}],"awayjs-stagegl/lib/managers/StageManager":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/events/EventDispatcher"),a=e("awayjs-core/lib/errors/ArgumentError"),r=e("awayjs-display/lib/events/StageEvent"),n=e("awayjs-stagegl/lib/base/Stage"),o=function(e){function t(){var i=this;e.call(this),this._stages=new Array(t.STAGE_MAX_QUANTITY),this._onContextCreatedDelegate=function(e){return i.onContextCreated(e)}}return i(t,e),t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getStageAt=function(e,i,s,o){if(void 0===i&&(i=!1),void 0===s&&(s="baseline"),void 0===o&&(o="auto"),0>e||e>=t.STAGE_MAX_QUANTITY)throw new a("Index is out of bounds [0.."+t.STAGE_MAX_QUANTITY+"]");if(!this._stages[e]){t._numStages++;var l=document.createElement("canvas");l.id="stage"+e,document.body.appendChild(l);var h=this._stages[e]=new n(l,e,this,i,s);h.addEventListener(r.CONTEXT_CREATED,this._onContextCreatedDelegate),h.requestContext(i,s,o)}return h},t.prototype.iRemoveStage=function(e){t._numStages--,e.removeEventListener(r.CONTEXT_CREATED,this._onContextCreatedDelegate),this._stages[e.stageIndex]=null},t.prototype.getFreeStage=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t="baseline"),void 0===i&&(i="auto");for(var s=0,a=this._stages.length;a>s;){if(!this._stages[s])return this.getStageAt(s,e,t,i);++s}return null},Object.defineProperty(t.prototype,"hasFreeStage",{get:function(){return t._numStages<t.STAGE_MAX_QUANTITY?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSlotsFree",{get:function(){return t.STAGE_MAX_QUANTITY-t._numStages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSlotsUsed",{get:function(){return t._numStages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSlotsTotal",{get:function(){return this._stages.length},enumerable:!0,configurable:!0}),t.prototype.onContextCreated=function(){},t.STAGE_MAX_QUANTITY=8,t._numStages=0,t}(s);t.exports=o},{"awayjs-core/lib/errors/ArgumentError":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-display/lib/events/StageEvent":void 0,"awayjs-stagegl/lib/base/Stage":void 0}],"awayjs-stagegl/lib/materials/LineBasicMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-display/lib/base/LineSubGeometry"),r=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-stagegl/lib/materials/StageGLMaterialBase"),o=e("awayjs-stagegl/lib/materials/passes/LineBasicPass"),l=function(e){function t(t){void 0===t&&(t=1.25),e.call(this),this._constants=new Array(0,0,0,0),this._thickness=t,this.bothSides=!0,this._pAddScreenPass(this._screenPass=new o),this._calcMatrix=new s,this._constants[1]=1/255}return i(t,e),t.prototype._iGetVertexCode=function(){return"m44 vt0, va0, vc8			\nm44 vt1, va1, vc8			\nsub vt2, vt1, vt0 			\nslt vt5.x, vt0.z, vc7.z			\nsub vt5.y, vc5.x, vt5.x			\nadd vt4.x, vt0.z, vc7.z			\nsub vt4.y, vt0.z, vt1.z			\nseq vt4.z, vt4.y vc6.x			\nadd vt4.y, vt4.y, vt4.z			\ndiv vt4.z, vt4.x, vt4.y			\nmul vt4.xyz, vt4.zzz, vt2.xyz	\nadd vt3.xyz, vt0.xyz, vt4.xyz	\nmov vt3.w, vc5.x			\nmul vt0, vt0, vt5.yyyy			\nmul vt3, vt3, vt5.xxxx			\nadd vt0, vt0, vt3				\nsub vt2, vt1, vt0 			\nnrm vt2.xyz, vt2.xyz			\nnrm vt5.xyz, vt0.xyz			\nmov vt5.w, vc5.x				\ncrs vt3.xyz, vt2, vt5			\nnrm vt3.xyz, vt3.xyz			\nmul vt3.xyz, vt3.xyz, va2.xxx	\nmov vt3.w, vc5.x			\ndp3 vt4.x, vt0, vc6			\nmul vt4.x, vt4.x, vc7.x			\nmul vt3.xyz, vt3.xyz, vt4.xxx	\nadd vt0.xyz, vt0.xyz, vt3.xyz	\nm44 op, vt0, vc0			\nmov v0, va3				\n"},t.prototype._iActivatePass=function(i,s,a){e.prototype._iActivatePass.call(this,i,s,a);var n=s.context;this._constants[0]=this._thickness/(s.scissorRect?Math.min(s.scissorRect.width,s.scissorRect.height):Math.min(s.width,s.height)),this._constants[2]=a.projection.near,n.setProgramConstantsFromArray(r.VERTEX,5,t.pONE_VECTOR,1),n.setProgramConstantsFromArray(r.VERTEX,6,t.pFRONT_VECTOR,1),n.setProgramConstantsFromArray(r.VERTEX,7,this._constants,1),n.setProgramConstantsFromMatrix(r.VERTEX,0,a.projection.matrix,!0)},t.prototype._iRenderPass=function(t,i,s,n,o){e.prototype._iRenderPass.call(this,t,i,s,n,o);var l=s.context;this._calcMatrix.copyFrom(i.sourceEntity.sceneTransform),this._calcMatrix.append(n.inverseSceneTransform),l.setProgramConstantsFromMatrix(r.VERTEX,8,this._calcMatrix,!0),l.activateBuffer(0,i.getVertexData(a.START_POSITION_DATA),i.getVertexOffset(a.START_POSITION_DATA),a.POSITION_FORMAT),l.activateBuffer(1,i.getVertexData(a.END_POSITION_DATA),i.getVertexOffset(a.END_POSITION_DATA),a.POSITION_FORMAT),l.activateBuffer(2,i.getVertexData(a.THICKNESS_DATA),i.getVertexOffset(a.THICKNESS_DATA),a.THICKNESS_FORMAT),l.activateBuffer(3,i.getVertexData(a.COLOR_DATA),i.getVertexOffset(a.COLOR_DATA),a.COLOR_FORMAT),l.drawTriangles(l.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t.pONE_VECTOR=Array(1,1,1,1),t.pFRONT_VECTOR=Array(0,0,-1,0),t}(n);t.exports=l},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-display/lib/base/LineSubGeometry":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/materials/StageGLMaterialBase":void 0,"awayjs-stagegl/lib/materials/passes/LineBasicPass":void 0}],"awayjs-stagegl/lib/materials/SkyboxMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLProgramType"),o=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),l=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),h=e("awayjs-stagegl/lib/materials/StageGLMaterialBase"),p=e("awayjs-stagegl/lib/materials/passes/SkyboxPass"),u=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),d=function(e){function t(t,i,s,a){void 0===i&&(i=!0),void 0===s&&(s=!1),void 0===a&&(a=!1),e.call(this),this._cubeMap=t,this._pAddScreenPass(this._skyboxPass=new p),this._vertexData=new Array(0,0,0,0,1,1,1,1)}return i(t,e),Object.defineProperty(t.prototype,"cubeMap",{get:function(){return this._cubeMap},set:function(e){e&&this._cubeMap&&(e.hasMipmaps!=this._cubeMap.hasMipmaps||e.format!=this._cubeMap.format)&&this._pInvalidatePasses(),this._cubeMap=e},enumerable:!0,configurable:!0}),t.prototype._iGetVertexCode=function(){return"mul vt0, va0, vc5\nadd vt0, vt0, vc4\nm44 op, vt0, vc0\nmov v0, va0\n"},t.prototype._iGetFragmentCode=function(){var e=",mipnone";return this._cubeMap.hasMipmaps&&(e=",miplinear"),"tex ft0, v0, fs0 <cube,"+u.getFormatStringForTexture(this._cubeMap)+"linear,clamp"+e+">\n"},t.prototype._iActivatePass=function(t,i,s){e.prototype._iActivatePass.call(this,t,i,s);var n=i.context;n.setSamplerStateAt(0,l.CLAMP,o.LINEAR,this._cubeMap.hasMipmaps?r.MIPLINEAR:r.MIPNONE),n.setDepthTest(!1,a.LESS),n.activateCubeTexture(0,this._cubeMap)},t.prototype._iRenderPass=function(t,i,a,r,o){e.prototype._iRenderPass.call(this,t,i,a,r,o);var l=a.context,h=r.scenePosition;this._vertexData[0]=h.x,this._vertexData[1]=h.y,this._vertexData[2]=h.z,this._vertexData[4]=this._vertexData[5]=this._vertexData[6]=r.projection.far/Math.sqrt(3),l.setProgramConstantsFromMatrix(n.VERTEX,0,o,!0),l.setProgramConstantsFromArray(n.VERTEX,4,this._vertexData,2),l.activateBuffer(0,i.getVertexData(s.POSITION_DATA),i.getVertexOffset(s.POSITION_DATA),s.POSITION_FORMAT),l.drawTriangles(l.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t}(h);t.exports=d},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/StageGLMaterialBase":void 0,"awayjs-stagegl/lib/materials/passes/SkyboxPass":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/StageGLMaterialBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/materials/MaterialBase"),a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._iGetVertexCode=function(){return""},t.prototype._iGetFragmentCode=function(){return""},t}(s);t.exports=a},{"awayjs-display/lib/materials/MaterialBase":void 0}],"awayjs-stagegl/lib/materials/TriangleBasicMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/textures/Texture2DBase"),a=e("awayjs-display/lib/base/BlendMode"),r=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),n=e("awayjs-stagegl/lib/materials/passes/TriangleBasicPass"),o=e("awayjs-stagegl/lib/materials/TriangleMaterialBase"),l=function(e){function t(t,i,a,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===a&&(a=!1),void 0===o&&(o=!1),e.call(this),this._alphaBlending=!1,this._alpha=1,this._depthCompareMode=r.LESS_EQUAL,this._screenPass=new n,t instanceof s?(this.texture=t,this.smooth=null==i?!0:!1,this.repeat=a,this.mipmap=o):(this.color=t?Number(t):13421772,this.alpha=null==i?1:Number(i))}return i(t,e),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode!=e&&(this._depthCompareMode=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e>1?e=1:0>e&&(e=0),this._alpha!=e&&(this._alpha=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){this._alphaBlending!=e&&(this._alphaBlending=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),t.prototype.iUpdateMaterial=function(){var e;this._pScreenPassesInvalid&&(this.pUpdateScreenPasses(),e=!0),e&&(this._pClearScreenPasses(),this._pAddScreenPass(this._screenPass))},t.prototype.pUpdateScreenPasses=function(){this.initPasses(),this.setBlendAndCompareModes(),this._pScreenPassesInvalid=!1},t.prototype.initPasses=function(){},t.prototype.setBlendAndCompareModes=function(){this._pRequiresBlending=this._pBlendMode!=a.NORMAL||this._alphaBlending||this._alpha<1,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.setBlendMode(this._pBlendMode==a.NORMAL&&this._pRequiresBlending?a.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1},t}(o);t.exports=l},{"awayjs-core/lib/textures/Texture2DBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialBase":void 0,"awayjs-stagegl/lib/materials/passes/TriangleBasicPass":void 0}],"awayjs-stagegl/lib/materials/TriangleMaterialBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Matrix3DUtils"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),r=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-stagegl/lib/materials/StageGLMaterialBase"),o=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._iGetVertexCode=function(e,t,i){var s="",a=e.globalPosDependencies>0?i.globalPositionVertex:i.localPosition,r=t.getFreeVertexConstant();if(t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),e.viewMatrixIndex=4*r.index,e.projectionDependencies>0){i.projectionFragment=t.getFreeVarying();var n=t.getFreeVertexVectorTemp();s+="m44 "+n+", "+a+", "+r+"\nmov "+i.projectionFragment+", "+n+"\nmov op, "+n+"\n"}else s+="m44 op, "+a+", "+r+"\n";return s},t.prototype._iRenderPass=function(t,i,n,o,l){e.prototype._iRenderPass.call(this,t,i,n,o,l);var h=t.shaderObject;if(h.sceneMatrixIndex>=0)i.sourceEntity.getRenderSceneTransform(o).copyRawDataTo(h.vertexConstantData,h.sceneMatrixIndex,!0),l.copyRawDataTo(h.vertexConstantData,h.viewMatrixIndex,!0);else{var p=s.CALCULATION_MATRIX;p.copyFrom(i.sourceEntity.getRenderSceneTransform(o)),p.append(l),p.copyRawDataTo(h.vertexConstantData,h.viewMatrixIndex,!0)}var u=n.context;u.setProgramConstantsFromArray(r.VERTEX,0,h.vertexConstantData,h.numUsedVertexConstants),u.setProgramConstantsFromArray(r.FRAGMENT,0,h.fragmentConstantData,h.numUsedFragmentConstants),u.activateBuffer(0,i.getVertexData(a.POSITION_DATA),i.getVertexOffset(a.POSITION_DATA),a.POSITION_FORMAT),u.drawTriangles(u.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t}(n);t.exports=o},{"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/materials/StageGLMaterialBase":void 0}],"awayjs-stagegl/lib/materials/TriangleMaterialMode":[function(e,t){var i=function(){function e(){}return e.SINGLE_PASS="singlePass",e.MULTI_PASS="multiPass",e}();t.exports=i},{}],"awayjs-stagegl/lib/materials/TriangleMethodMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-core/lib/textures/Texture2DBase"),r=e("awayjs-display/lib/base/BlendMode"),n=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker"),o=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),l=e("awayjs-stagegl/lib/materials/methods/AmbientBasicMethod"),h=e("awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod"),p=e("awayjs-stagegl/lib/materials/methods/NormalBasicMethod"),u=e("awayjs-stagegl/lib/materials/methods/SpecularBasicMethod"),d=e("awayjs-stagegl/lib/materials/passes/MaterialPassMode"),g=e("awayjs-stagegl/lib/materials/passes/TriangleMethodPass"),c=e("awayjs-stagegl/lib/materials/TriangleMaterialBase"),_=e("awayjs-stagegl/lib/materials/TriangleMaterialMode"),f=function(e){function t(t,i,s,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=!1),void 0===r&&(r=!1),e.call(this),this._alphaBlending=!1,this._alpha=1,this._ambientMethod=new l,this._diffuseMethod=new h,this._normalMethod=new p,this._specularMethod=new u,this._depthCompareMode=o.LESS_EQUAL,this._materialMode=_.SINGLE_PASS,t instanceof a?(this.texture=t,this.smooth=null==i?!0:!1,this.repeat=s,this.mipmap=r):(this.color=null==t?16777215:Number(t),this.alpha=null==i?1:Number(i))}return i(t,e),Object.defineProperty(t.prototype,"materialMode",{get:function(){return this._materialMode},set:function(e){this._materialMode!=e&&(this._materialMode=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode!=e&&(this._depthCompareMode=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e>1?e=1:0>e&&(e=0),this._alpha!=e&&(this._alpha=e,null==this._colorTransform&&(this._colorTransform=new s),this._colorTransform.alphaMultiplier=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._screenPass.colorTransform},set:function(e){this._screenPass.colorTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseTexture",{get:function(){return this._diffuseMethod.texture},set:function(e){this._diffuseMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(e){this._ambientMethod!=e&&(e&&this._ambientMethod&&e.copyFrom(this._ambientMethod),this._ambientMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(e){this._shadowMethod!=e&&(e&&this._shadowMethod&&e.copyFrom(this._shadowMethod),this._shadowMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(e){this._diffuseMethod!=e&&(e&&this._diffuseMethod&&e.copyFrom(this._diffuseMethod),this._diffuseMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(e){this._specularMethod!=e&&(e&&this._specularMethod&&e.copyFrom(this._specularMethod),this._specularMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(e){this._normalMethod!=e&&(e&&this._normalMethod&&e.copyFrom(this._normalMethod),this._normalMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),t.prototype.addEffectMethod=function(e){null==this._screenPass&&(this._screenPass=new g),this._screenPass.addEffectMethod(e),this._pInvalidateScreenPasses()},Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._screenPass?this._screenPass.numEffectMethods:0},enumerable:!0,configurable:!0}),t.prototype.hasEffectMethod=function(e){return this._screenPass?this._screenPass.hasEffectMethod(e):!1},t.prototype.getEffectMethodAt=function(e){return null==this._screenPass?null:this._screenPass.getEffectMethodAt(e)},t.prototype.addEffectMethodAt=function(e,t){null==this._screenPass&&(this._screenPass=new g),this._screenPass.addEffectMethodAt(e,t),this._pInvalidatePasses()},t.prototype.removeEffectMethod=function(e){null!=this._screenPass&&(this._screenPass.removeEffectMethod(e),0==this._screenPass.numEffectMethods&&this._pInvalidatePasses())},Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._normalMethod.normalMap},set:function(e){this._normalMethod.normalMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMap",{get:function(){return this._specularMethod.texture},set:function(e){this._specularMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this._specularMethod.gloss},set:function(e){this._specularMethod.gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambientMethod.ambient},set:function(e){this._ambientMethod.ambient=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._specularMethod.specular},set:function(e){this._specularMethod.specular=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._diffuseMethod.ambientColor},set:function(e){this._diffuseMethod.ambientColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseMethod.diffuseColor},set:function(e){this._diffuseMethod.diffuseColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularMethod.specularColor},set:function(e){this._specularMethod.specularColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){this._alphaBlending!=e&&(this._alphaBlending=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),t.prototype._iUpdateMaterial=function(){if(this._pScreenPassesInvalid){if(this._pScreenPassesInvalid=!1,this.initPasses(),this.setBlendAndCompareModes(),this._pClearScreenPasses(),this._materialMode==_.MULTI_PASS&&(this._casterLightPass&&this._pAddScreenPass(this._casterLightPass),this._nonCasterLightPasses))for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pAddScreenPass(this._nonCasterLightPasses[e]);this._screenPass&&this._pAddScreenPass(this._screenPass)}},t.prototype.initPasses=function(){0==this.numLights||this.numEffectMethods>0||this._materialMode==_.SINGLE_PASS?this.initEffectPass():this._screenPass&&this.removeEffectPass(),this._shadowMethod&&this._materialMode==_.MULTI_PASS?this.initCasterLightPass():this._casterLightPass&&this.removeCasterLightPass(),this.numNonCasters>0&&this._materialMode==_.MULTI_PASS?this.initNonCasterLightPasses():this._nonCasterLightPasses&&this.removeNonCasterLightPasses()},t.prototype.setBlendAndCompareModes=function(){var e=Boolean(this._casterLightPass||this._screenPass);if(this._casterLightPass&&(this._casterLightPass.forceSeparateMVP=e,this._casterLightPass.setBlendMode(r.NORMAL),this._casterLightPass.depthCompareMode=this._depthCompareMode),this._nonCasterLightPasses){var t=0;this._casterLightPass||(this._nonCasterLightPasses[0].forceSeparateMVP=e,this._nonCasterLightPasses[0].setBlendMode(r.NORMAL),this._nonCasterLightPasses[0].depthCompareMode=this._depthCompareMode,t=1);for(var i=t;i<this._nonCasterLightPasses.length;++i)this._nonCasterLightPasses[i].forceSeparateMVP=e,this._nonCasterLightPasses[i].setBlendMode(r.ADD),this._nonCasterLightPasses[i].depthCompareMode=o.LESS_EQUAL}this._casterLightPass||this._nonCasterLightPasses?(this._pRequiresBlending=!1,this._screenPass&&(this._screenPass.passMode=d.EFFECTS,this._screenPass.depthCompareMode=o.LESS_EQUAL,this._screenPass.setBlendMode(r.LAYER),this._screenPass.forceSeparateMVP=e)):this._screenPass&&(this._pRequiresBlending=this._pBlendMode!=r.NORMAL||this._alphaBlending||this._colorTransform&&this._colorTransform.alphaMultiplier<1,this._screenPass.passMode=d.SUPER_SHADER,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.colorTransform=this._colorTransform,this._screenPass.setBlendMode(this._pBlendMode==r.NORMAL&&this._pRequiresBlending?r.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1)},t.prototype.initCasterLightPass=function(){null==this._casterLightPass&&(this._casterLightPass=new g(d.LIGHTING)),this._casterLightPass.lightPicker=new n([this._shadowMethod.castingLight]),this._casterLightPass.shadowMethod=this._shadowMethod,this._casterLightPass.diffuseMethod=this._diffuseMethod,this._casterLightPass.ambientMethod=this._ambientMethod,this._casterLightPass.normalMethod=this._normalMethod,this._casterLightPass.specularMethod=this._specularMethod},t.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose(),this._pRemoveScreenPass(this._casterLightPass),this._casterLightPass=null},t.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var e,t=this._pLightPicker.numDirectionalLights,i=this._pLightPicker.numPointLights,s=this._pLightPicker.numLightProbes,a=0,r=0,n=0;for(this._casterLightPass||(t+=this._pLightPicker.numCastingDirectionalLights,i+=this._pLightPicker.numCastingPointLights),this._nonCasterLightPasses=new Array;t>a||i>r||s>n;)e=new g(d.LIGHTING),e.includeCasters=null==this._shadowMethod,e.directionalLightsOffset=a,e.pointLightsOffset=r,e.lightProbesOffset=n,e.lightPicker=this._pLightPicker,e.diffuseMethod=this._diffuseMethod,e.ambientMethod=this._ambientMethod,e.normalMethod=this._normalMethod,e.specularMethod=this._specularMethod,this._nonCasterLightPasses.push(e),a+=e.iNumDirectionalLights,r+=e.iNumPointLights,n+=e.iNumLightProbes},t.prototype.removeNonCasterLightPasses=function(){if(this._nonCasterLightPasses){for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pRemoveScreenPass(this._nonCasterLightPasses[e]);this._nonCasterLightPasses=null}},t.prototype.removeEffectPass=function(){this._screenPass.ambientMethod!=this._ambientMethod&&this._screenPass.ambientMethod.dispose(),this._screenPass.diffuseMethod!=this._diffuseMethod&&this._screenPass.diffuseMethod.dispose(),this._screenPass.specularMethod!=this._specularMethod&&this._screenPass.specularMethod.dispose(),this._screenPass.normalMethod!=this._normalMethod&&this._screenPass.normalMethod.dispose(),this._pRemoveScreenPass(this._screenPass),this._screenPass=null},t.prototype.initEffectPass=function(){null==this._screenPass&&(this._screenPass=new g),this._materialMode==_.SINGLE_PASS?(this._screenPass.ambientMethod=this._ambientMethod,this._screenPass.diffuseMethod=this._diffuseMethod,this._screenPass.specularMethod=this._specularMethod,this._screenPass.normalMethod=this._normalMethod,this._screenPass.shadowMethod=this._shadowMethod):this._materialMode==_.MULTI_PASS&&(this._screenPass.ambientMethod=0==this.numLights?this._ambientMethod:null,this._screenPass.preserveAlpha=!1,this._screenPass.normalMethod=this._normalMethod)},Object.defineProperty(t.prototype,"numLights",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights+this._pLightPicker.numCastingDirectionalLights+this._pLightPicker.numCastingPointLights:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numNonCasters",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights:0},enumerable:!0,configurable:!0}),t}(c);t.exports=f},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-core/lib/textures/Texture2DBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialBase":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialMode":void 0,"awayjs-stagegl/lib/materials/methods/AmbientBasicMethod":void 0,"awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod":void 0,"awayjs-stagegl/lib/materials/methods/NormalBasicMethod":void 0,"awayjs-stagegl/lib/materials/methods/SpecularBasicMethod":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassMode":void 0,"awayjs-stagegl/lib/materials/passes/TriangleMethodPass":void 0}],"awayjs-stagegl/lib/materials/compilation/MethodVO":[function(e,t){var i=function(){function e(e){this.useMethod=!0,this.method=e}return e.prototype.reset=function(){this.method.iReset(),this.texturesIndex=-1,this.vertexConstantsIndex=-1,this.fragmentConstantsIndex=-1,this.needsProjection=!1,this.needsView=!1,this.needsNormals=!1,this.needsTangents=!1,this.needsUV=!1,this.needsSecondaryUV=!1,this.needsGlobalVertexPos=!1,this.needsGlobalFragmentPos=!1},e}();t.exports=i},{}],"awayjs-stagegl/lib/materials/compilation/RegisterPool":[function(e,t){var i=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=function(){function e(e,t,i){void 0===i&&(i=!0),this._regName=e,this._regCount=t,this._persistent=i,this.initRegisters(e,t)
}return e.prototype.requestFreeVectorReg=function(){for(var e=0;e<this._regCount;++e)if(!this.isRegisterUsed(e))return this._persistent&&this._usedVectorCount[e]++,this._vectorRegisters[e];throw new Error("Register overflow!")},e.prototype.requestFreeRegComponent=function(){for(var e=0;e<this._regCount;++e)if(!(this._usedVectorCount[e]>0))for(var t=0;4>t;++t)if(0==this._usedSingleCount[t][e])return this._persistent&&this._usedSingleCount[t][e]++,this._registerComponents[t][e];throw new Error("Register overflow!")},e.prototype.addUsage=function(e,t){e._component>-1?this._usedSingleCount[e._component][e.index]+=t:this._usedVectorCount[e.index]+=t},e.prototype.removeUsage=function(e){if(e._component>-1){if(--this._usedSingleCount[e._component][e.index]<0)throw new Error("More usages removed than exist!")}else if(--this._usedVectorCount[e.index]<0)throw new Error("More usages removed than exist!")},e.prototype.dispose=function(){this._vectorRegisters=null,this._registerComponents=null,this._usedSingleCount=null,this._usedVectorCount=null},e.prototype.hasRegisteredRegs=function(){for(var e=0;e<this._regCount;++e)if(this.isRegisterUsed(e))return!0;return!1},e.prototype.initRegisters=function(t,i){var s=e._initPool(t,i);this._vectorRegisters=e._regPool[s],this._registerComponents=e._regCompsPool[s],this._usedVectorCount=this._initArray(Array(i),0),this._usedSingleCount=new Array(4),this._usedSingleCount[0]=this._initArray(new Array(i),0),this._usedSingleCount[1]=this._initArray(new Array(i),0),this._usedSingleCount[2]=this._initArray(new Array(i),0),this._usedSingleCount[3]=this._initArray(new Array(i),0)},e._initPool=function(t,s){var a=t+s;if(void 0!=e._regPool[a])return a;var r=new Array(s);e._regPool[a]=r;var n=[[],[],[],[]];e._regCompsPool[a]=n;for(var o=0;s>o;++o){r[o]=new i(t,o);for(var l=0;4>l;++l)n[l][o]=new i(t,o,l)}return a},e.prototype.isRegisterUsed=function(e){if(this._usedVectorCount[e]>0)return!0;for(var t=0;4>t;++t)if(this._usedSingleCount[t][e]>0)return!0;return!1},e.prototype._initArray=function(e,t){for(var i=e.length,s=0;i>s;s++)e[s]=t;return e},e._regPool=new Object,e._regCompsPool=new Object,e}();t.exports=s},{"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-stagegl/lib/materials/compilation/ShaderCompilerBase":[function(e,t){var i=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterCache"),s=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterData"),a=e("awayjs-stagegl/lib/materials/passes/MaterialPassMode"),r=function(){function e(e,t,a){this._pVertexCode="",this._pFragmentCode="",this._pPostAnimationFragmentCode="",this._pMaterial=e,this._pMaterialPass=t,this._pShaderObject=a,this._pProfile=a.profile,this._pSharedRegisters=new s,this._pRegisterCache=new i(this._pProfile),this._pRegisterCache.vertexAttributesOffset=1,this._pRegisterCache.reset()}return e.prototype.compile=function(){this._pShaderObject.reset(),this.pCalculateDependencies(),this.pInitRegisterIndices(),this.pCompileDependencies(),this._pVertexCode+=this._pMaterialPass._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pPostAnimationFragmentCode+=this._pMaterialPass._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pPostAnimationFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n",this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget),this._pShaderObject.initConstantData(this._pRegisterCache,this._pAnimatableAttributes,this._pAnimationTargetRegisters,this._uvSource,this._uvTarget),this._pMaterialPass._iInitConstantData(this._pShaderObject)},e.prototype.pCompileDependencies=function(){this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1),this._pShaderObject.globalPosDependencies>0&&this.compileGlobalPositionCode(),this._pShaderObject.uvDependencies>0&&this.compileUVCode(),this._pShaderObject.secondaryUVDependencies>0&&this.compileSecondaryUVCode(),this._pShaderObject.normalDependencies>0&&this.compileNormalCode(),this._pShaderObject.viewDirDependencies>0&&this.compileViewDirCode(),this._pVertexCode+=this._pMaterial._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._pMaterial._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pVertexCode+=this._pMaterialPass._iGetPreLightingVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._pMaterialPass._iGetPreLightingFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)},e.prototype.compileGlobalPositionCode=function(){this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pShaderObject.globalPosDependencies);var e=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pShaderObject.sceneMatrixIndex=4*e.index,this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.localPosition+", "+e+"\n",this._pShaderObject.usesGlobalPosFragment&&(this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n")},e.prototype.compileUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.uvBufferIndex=e.index;var t=this._pRegisterCache.getFreeVarying();if(this._pSharedRegisters.uvVarying=t,this._pShaderObject.usesUVTransform){var i=this._pRegisterCache.getFreeVertexConstant(),s=this._pRegisterCache.getFreeVertexConstant();this._pShaderObject.uvTransformIndex=4*i.index,this._pVertexCode+="dp4 "+t+".x, "+e+", "+i+"\ndp4 "+t+".y, "+e+", "+s+"\nmov "+t+".zw, "+e+".zw \n"}else this._pShaderObject.uvTransformIndex=-1,this._uvTarget=t.toString(),this._uvSource=e.toString()},e.prototype.compileSecondaryUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.secondaryUVBufferIndex=e.index,this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+e+"\n"},e.prototype.compileViewDirCode=function(){var e=this._pRegisterCache.getFreeVertexConstant();if(this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pShaderObject.viewDirDependencies),this._pShaderObject.cameraPositionIndex=4*e.index,this._pShaderObject.usesTangentSpace){var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+t+", "+e+", "+this._pSharedRegisters.localPosition+"\nm33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+t+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+e+", "+this._pSharedRegisters.globalPositionVertex+"\n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\nmov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w\n"},e.prototype.compileNormalCode=function(){if(this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pShaderObject.normalDependencies),this._pShaderObject.outputsNormals&&!this._pShaderObject.outputsTangentNormals)return this._pVertexCode+=this._pMaterialPass._iGetNormalVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),void(this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters));var e;if(this._pShaderObject.outputsNormals&&this._pShaderObject.usesTangentSpace||(e=new Array(3),e[0]=this._pRegisterCache.getFreeVertexConstant(),e[1]=this._pRegisterCache.getFreeVertexConstant(),e[2]=this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pShaderObject.sceneNormalMatrixIndex=4*e[0].index,this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying()),this._pShaderObject.outputsNormals)if(this._pShaderObject.usesTangentSpace)this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\ncrs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n",this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);else{this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\nnrm "+this._pSharedRegisters.animatedNormal+".xyz, "+t+"\nm33 "+t+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+t+"\nmov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \nmov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \nmov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \ncrs "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.tangentVarying+".y, "+t+".x    \nmov "+this._pSharedRegisters.bitangentVarying+".y, "+t+".y  \nmov "+this._pSharedRegisters.normalVarying+".y, "+t+".z    \n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);var i,s,a;i=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(i,1),s=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(s,1),a=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(a,1),this._pFragmentCode+="nrm "+i+".xyz, "+this._pSharedRegisters.tangentVarying+"\nmov "+i+".w, "+this._pSharedRegisters.tangentVarying+".w	\nnrm "+s+".xyz, "+this._pSharedRegisters.bitangentVarying+"\nnrm "+a+".xyz, "+this._pSharedRegisters.normalVarying+"\n",this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalFragment+", "+i+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n",this._pRegisterCache.removeFragmentTempUsage(s),this._pRegisterCache.removeFragmentTempUsage(i),this._pRegisterCache.removeFragmentTempUsage(a)}else this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n",this._pShaderObject.tangentDependencies>0&&(this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="m33 "+this._pSharedRegisters.tangentVarying+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.animatedTangent+".w\n");this._pShaderObject.usesTangentSpace||this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal)},e.prototype.pInitRegisterIndices=function(){this._pShaderObject.pInitRegisterIndices(),this._pAnimatableAttributes=new Array("va0"),this._pAnimationTargetRegisters=new Array("vt0"),this._pVertexCode="",this._pFragmentCode="",this._pPostAnimationFragmentCode="",this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition=this._pRegisterCache.getFreeVertexVectorTemp(),1),this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant(),this._pShaderObject.commonsDataIndex=4*this._pSharedRegisters.commons.index,(this._pShaderObject.tangentDependencies>0||this._pShaderObject.outputsNormals)&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pShaderObject.tangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pShaderObject.usesTangentSpace&&(this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1)),this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString())),this._pShaderObject.normalDependencies>0&&(this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute(),this._pShaderObject.normalBufferIndex=this._pSharedRegisters.normalInput.index,this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1),this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString()))},e.prototype.pCalculateDependencies=function(){this._pShaderObject.useAlphaPremultiplied=this._pMaterial.alphaPremultiplied,this._pShaderObject.useBothSides=this._pMaterial.bothSides,this._pShaderObject.useMipmapping=this._pMaterial.mipmap,this._pShaderObject.useSmoothTextures=this._pMaterial.smooth,this._pShaderObject.repeatTextures=this._pMaterial.repeat,this._pShaderObject.usesUVTransform=this._pMaterial.animateUVs,this._pShaderObject.alphaThreshold=this._pMaterial.alphaThreshold,this._pShaderObject.texture=this._pMaterial.texture,this._pShaderObject.color=this._pMaterial.color,this._pShaderObject.usesFragmentAnimation=Boolean(this._pMaterialPass.passMode==a.SUPER_SHADER),this._pMaterialPass._iIncludeDependencies(this._pShaderObject)},e.prototype.dispose=function(){this._pRegisterCache.dispose(),this._pRegisterCache=null,this._pSharedRegisters=null},Object.defineProperty(e.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"postAnimationFragmentCode",{get:function(){return this._pPostAnimationFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget.toString()},enumerable:!0,configurable:!0}),e}();t.exports=r},{"awayjs-stagegl/lib/materials/compilation/ShaderRegisterCache":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterData":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassMode":void 0}],"awayjs-stagegl/lib/materials/compilation/ShaderLightingCompiler":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/materials/LightSources"),a=e("awayjs-stagegl/lib/base/ContextGLProfile"),r=e("awayjs-stagegl/lib/materials/compilation/ShaderCompilerBase"),n=function(e){function t(t,i,s){e.call(this,t,i,s),this._materialLightingPass=i,this._shaderLightingObject=s}return i(t,e),t.prototype.pCompileDependencies=function(){e.prototype.pCompileDependencies.call(this),this._shaderLightingObject.usesShadows&&this.pCompileShadowCode(),this._shaderLightingObject.usesLights&&(this.initLightRegisters(),this.compileLightCode()),this._shaderLightingObject.usesProbes&&this.compileLightProbeCode(),this._pVertexCode+=this._materialLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._materialLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters)},t.prototype.pCompileShadowCode=function(){this._shaderLightingObject.normalDependencies>0?this._pSharedRegisters.shadowTarget=this._pSharedRegisters.normalFragment:(this._pSharedRegisters.shadowTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget,1))},t.prototype.initLightRegisters=function(){var e,t;if(this._dirLightVertexConstants)for(t=this._dirLightVertexConstants.length,e=0;t>e;++e)this._dirLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant(),-1==this._shaderLightingObject.lightVertexConstantIndex&&(this._shaderLightingObject.lightVertexConstantIndex=4*this._dirLightVertexConstants[e].index);if(this._pointLightVertexConstants)for(t=this._pointLightVertexConstants.length,e=0;t>e;++e)this._pointLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant(),-1==this._shaderLightingObject.lightVertexConstantIndex&&(this._shaderLightingObject.lightVertexConstantIndex=4*this._pointLightVertexConstants[e].index);for(t=this._dirLightFragmentConstants.length,e=0;t>e;++e)this._dirLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*this._dirLightFragmentConstants[e].index);for(t=this._pointLightFragmentConstants.length,e=0;t>e;++e)this._pointLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*this._pointLightFragmentConstants[e].index)},t.prototype.compileLightCode=function(){for(var e,t,i,s,a=0,r=0,n=this._shaderLightingObject.usesLightsForSpecular,o=this._shaderLightingObject.usesLightsForDiffuse,l=0;l<this._materialLightingPass.iNumDirectionalLights;++l){if(this._shaderLightingObject.usesTangentSpace){s=this._dirLightVertexConstants[a++];var h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+h+".xyz, "+s+", "+this._pSharedRegisters.animatedTangent+"\nmov "+h+".w, "+s+".w\n",s=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addVertexTempUsages(s,1),this._pFragmentCode+="nrm "+s+".xyz, "+h+"\nmov "+s+".w, "+h+".w\n"}else s=this._dirLightFragmentConstants[r++];e=this._dirLightFragmentConstants[r++],t=this._dirLightFragmentConstants[r++],o&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,s,e,this._pRegisterCache,this._pSharedRegisters)),n&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,s,t,this._pRegisterCache,this._pSharedRegisters)),this._shaderLightingObject.usesTangentSpace&&this._pRegisterCache.removeVertexTempUsage(s)}a=0,r=0;for(var l=0;l<this._materialLightingPass.iNumPointLights;++l){i=this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment?this._pointLightVertexConstants[a++]:this._pointLightFragmentConstants[r++],e=this._pointLightFragmentConstants[r++],t=this._pointLightFragmentConstants[r++],s=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(s,1);var h;if(this._shaderLightingObject.usesTangentSpace){h=this._pRegisterCache.getFreeVarying();var p=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+p+", "+i+", "+this._pSharedRegisters.localPosition+"\nm33 "+h+".xyz, "+p+", "+this._pSharedRegisters.animatedTangent+"\nmov "+h+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._shaderLightingObject.usesGlobalPosFragment?(h=s,this._pFragmentCode+="sub "+s+", "+i+", "+this._pSharedRegisters.globalPositionVarying+"\n"):(h=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="sub "+h+", "+i+", "+this._pSharedRegisters.globalPositionVertex+"\n");this._pFragmentCode+=this._shaderLightingObject.usesLightFallOff?"dp3 "+s+".w, "+h+", "+h+"\nsub "+s+".w, "+s+".w, "+e+".w\nmul "+s+".w, "+s+".w, "+t+".w\nsat "+s+".w, "+s+".w\nsub "+s+".w, "+this._pSharedRegisters.commons+".w, "+s+".w\nnrm "+s+".xyz, "+h+"\n":"nrm "+s+".xyz, "+h+"\nmov "+s+".w, "+h+".w\n",-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*i.index),o&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,s,e,this._pRegisterCache,this._pSharedRegisters)),n&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,s,t,this._pRegisterCache,this._pSharedRegisters)),this._pRegisterCache.removeFragmentTempUsage(s)}},t.prototype.compileLightProbeCode=function(){var e,t,i,s=[".x",".y",".z",".w"],a=new Array,r=this._shaderLightingObject.usesProbesForSpecular,n=this._shaderLightingObject.usesProbesForDiffuse;for(n&&(this._shaderLightingObject.lightProbeDiffuseIndices=new Array),r&&(this._shaderLightingObject.lightProbeSpecularIndices=new Array),t=0;t<this._pNumProbeRegisters;++t)a[t]=this._pRegisterCache.getFreeFragmentConstant(),0==t&&(this._shaderLightingObject.probeWeightsIndex=4*a[t].index);for(t=0;t<this._materialLightingPass.iNumLightProbes;++t)e=a[Math.floor(t/4)].toString()+s[t%4],n&&(i=this._pRegisterCache.getFreeTextureReg(),this._shaderLightingObject.lightProbeDiffuseIndices[t]=i.index,this._pFragmentCode+=this._materialLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters)),r&&(i=this._pRegisterCache.getFreeTextureReg(),this._shaderLightingObject.lightProbeSpecularIndices[t]=i.index,this._pFragmentCode+=this._materialLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters))},t.prototype.pInitRegisterIndices=function(){e.prototype.pInitRegisterIndices.call(this),this._shaderLightingObject.lightVertexConstantIndex=-1,this._shaderLightingObject.lightFragmentConstantIndex=-1,this._shaderLightingObject.probeWeightsIndex=-1,this._pNumProbeRegisters=Math.ceil(this._materialLightingPass.iNumLightProbes/4),this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment?(this._pointLightVertexConstants=new Array(this._materialLightingPass.iNumPointLights),this._pointLightFragmentConstants=new Array(2*this._materialLightingPass.iNumPointLights)):this._pointLightFragmentConstants=new Array(3*this._materialLightingPass.iNumPointLights),this._shaderLightingObject.usesTangentSpace?(this._dirLightVertexConstants=new Array(this._materialLightingPass.iNumDirectionalLights),this._dirLightFragmentConstants=new Array(2*this._materialLightingPass.iNumDirectionalLights)):this._dirLightFragmentConstants=new Array(3*this._materialLightingPass.iNumDirectionalLights)},t.prototype.pCalculateDependencies=function(){var t=this._materialLightingPass.iNumPointLights+this._materialLightingPass.iNumDirectionalLights,i=this._materialLightingPass.iNumLightProbes,r=this._pMaterial.diffuseLightSources,n=this._materialLightingPass._iUsesSpecular()?this._pMaterial.specularLightSources:0,o=r|n;this._shaderLightingObject.usesLightFallOff=this._pMaterial.enableLightFallOff&&this._shaderLightingObject.profile!=a.BASELINE_CONSTRAINED,this._shaderLightingObject.numLights=t+i,this._shaderLightingObject.numPointLights=this._materialLightingPass.iNumPointLights,this._shaderLightingObject.numDirectionalLights=this._materialLightingPass.iNumDirectionalLights,this._shaderLightingObject.numLightProbes=i,this._shaderLightingObject.pointLightsOffset=this._materialLightingPass.pointLightsOffset,this._shaderLightingObject.directionalLightsOffset=this._materialLightingPass.directionalLightsOffset,this._shaderLightingObject.lightProbesOffset=this._materialLightingPass.lightProbesOffset,this._shaderLightingObject.lightPicker=this._materialLightingPass.lightPicker,this._shaderLightingObject.usesLights=t>0&&0!=(o&s.LIGHTS),this._shaderLightingObject.usesProbes=i>0&&0!=(o&s.PROBES),this._shaderLightingObject.usesLightsForSpecular=t>0&&0!=(n&s.LIGHTS),this._shaderLightingObject.usesProbesForSpecular=i>0&&0!=(n&s.PROBES),this._shaderLightingObject.usesLightsForDiffuse=t>0&&0!=(r&s.LIGHTS),this._shaderLightingObject.usesProbesForDiffuse=i>0&&0!=(r&s.PROBES),this._shaderLightingObject.usesShadows=this._materialLightingPass._iUsesShadows(),e.prototype.pCalculateDependencies.call(this)},t}(r);t.exports=n},{"awayjs-display/lib/materials/LightSources":void 0,"awayjs-stagegl/lib/base/ContextGLProfile":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderCompilerBase":void 0}],"awayjs-stagegl/lib/materials/compilation/ShaderLightingObject":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/compilation/ShaderLightingCompiler"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderObjectBase"),r=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.createCompiler=function(e,t){return new s(e,t,this)},t.prototype.reset=function(){e.prototype.reset.call(this),this.numLights=0,this.usesLightFallOff=!0},t.prototype.addWorldSpaceDependencies=function(t){e.prototype.addWorldSpaceDependencies.call(this,t),this.numPointLights>0&&this.usesLights&&(++this.globalPosDependencies,t&&(this.usesGlobalPosFragment=!0))},t.prototype.setRenderState=function(t,i,s,a){e.prototype.setRenderState.call(this,t,i,s,a),this.usesLights&&this.updateLights(),this.usesProbes&&this.updateProbes(i)},t.prototype.updateLights=function(){var e,t,i,s,a,r,n=0,o=0,l=0,h=this.usesShadows?2:1;this.ambientR=this.ambientG=this.ambientB=0,a=this.lightVertexConstantIndex,o=this.lightFragmentConstantIndex;var p=0,u=this.lightPicker.directionalLights;for(r=this.directionalLightsOffset,i=this.lightPicker.directionalLights.length,r>i&&(p=1,r-=i);h>p;++p)for(p&&(u=this.lightPicker.castingDirectionalLights),i=u.length,i>this.numDirectionalLights&&(i=this.numDirectionalLights),n=0;i>n;++n){if(e=u[r+n],s=e.sceneDirection,this.ambientR+=e._iAmbientR,this.ambientG+=e._iAmbientG,this.ambientB+=e._iAmbientB,this.usesTangentSpace){var d=-s.x,g=-s.y,c=-s.z;this.vertexConstantData[a++]=this._pInverseSceneMatrix[0]*d+this._pInverseSceneMatrix[4]*g+this._pInverseSceneMatrix[8]*c,this.vertexConstantData[a++]=this._pInverseSceneMatrix[1]*d+this._pInverseSceneMatrix[5]*g+this._pInverseSceneMatrix[9]*c,this.vertexConstantData[a++]=this._pInverseSceneMatrix[2]*d+this._pInverseSceneMatrix[6]*g+this._pInverseSceneMatrix[10]*c,this.vertexConstantData[a++]=1}else this.fragmentConstantData[o++]=-s.x,this.fragmentConstantData[o++]=-s.y,this.fragmentConstantData[o++]=-s.z,this.fragmentConstantData[o++]=1;this.fragmentConstantData[o++]=e._iDiffuseR,this.fragmentConstantData[o++]=e._iDiffuseG,this.fragmentConstantData[o++]=e._iDiffuseB,this.fragmentConstantData[o++]=1,this.fragmentConstantData[o++]=e._iSpecularR,this.fragmentConstantData[o++]=e._iSpecularG,this.fragmentConstantData[o++]=e._iSpecularB,this.fragmentConstantData[o++]=1,++l==this.numDirectionalLights&&(n=i,p=h)}if(this.numDirectionalLights>l)for(n=o+12*(this.numDirectionalLights-l);n>o;)this.fragmentConstantData[o++]=0;l=0;var _=this.lightPicker.pointLights;for(r=this.pointLightsOffset,i=this.lightPicker.pointLights.length,r>i?(p=1,r-=i):p=0;h>p;++p)for(p&&(_=this.lightPicker.castingPointLights),i=_.length,n=0;i>n;++n){t=_[r+n],s=t.scenePosition,this.ambientR+=t._iAmbientR,this.ambientG+=t._iAmbientG,this.ambientB+=t._iAmbientB,this.usesTangentSpace?(d=s.x,g=s.y,c=s.z,this.vertexConstantData[a++]=this._pInverseSceneMatrix[0]*d+this._pInverseSceneMatrix[4]*g+this._pInverseSceneMatrix[8]*c+this._pInverseSceneMatrix[12],this.vertexConstantData[a++]=this._pInverseSceneMatrix[1]*d+this._pInverseSceneMatrix[5]*g+this._pInverseSceneMatrix[9]*c+this._pInverseSceneMatrix[13],this.vertexConstantData[a++]=this._pInverseSceneMatrix[2]*d+this._pInverseSceneMatrix[6]*g+this._pInverseSceneMatrix[10]*c+this._pInverseSceneMatrix[14],this.vertexConstantData[a++]=1):this.usesGlobalPosFragment?(this.fragmentConstantData[o++]=s.x,this.fragmentConstantData[o++]=s.y,this.fragmentConstantData[o++]=s.z,this.fragmentConstantData[o++]=1):(this.vertexConstantData[a++]=s.x,this.vertexConstantData[a++]=s.y,this.vertexConstantData[a++]=s.z,this.vertexConstantData[a++]=1),this.fragmentConstantData[o++]=t._iDiffuseR,this.fragmentConstantData[o++]=t._iDiffuseG,this.fragmentConstantData[o++]=t._iDiffuseB;var f=t._pRadius;this.fragmentConstantData[o++]=f*f,this.fragmentConstantData[o++]=t._iSpecularR,this.fragmentConstantData[o++]=t._iSpecularG,this.fragmentConstantData[o++]=t._iSpecularB,this.fragmentConstantData[o++]=t._pFallOffFactor,++l==this.numPointLights&&(n=i,p=h)}if(this.numPointLights>l)for(n=o+12*(l-this.numPointLights);n>o;++o)this.fragmentConstantData[o]=0},t.prototype.updateProbes=function(e){var t,i=this.lightPicker.lightProbes,s=this.lightPicker.lightProbeWeights,a=i.length-this.lightProbesOffset,r=this.usesProbesForDiffuse,n=this.usesProbesForSpecular;if(r||n){a>this.numLightProbes&&(a=this.numLightProbes);for(var o=0;a>o;++o)t=i[this.lightProbesOffset+o],r&&e.context.activateCubeTexture(this.lightProbeDiffuseIndices[o],t.diffuseMap),n&&e.context.activateCubeTexture(this.lightProbeSpecularIndices[o],t.specularMap);for(o=0;a>o;++o)this.fragmentConstantData[this.probeWeightsIndex+o]=s[this.lightProbesOffset+o]}},t}(a);t.exports=r},{"awayjs-stagegl/lib/materials/compilation/ShaderLightingCompiler":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderObjectBase":void 0}],"awayjs-stagegl/lib/materials/compilation/ShaderObjectBase":[function(e,t){var i=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderCompilerBase"),r=function(){function e(e){this._defaultCulling=s.BACK,this._pInverseSceneMatrix=new Array,this.ambientR=255,this.ambientG=255,this.ambientB=255,this.usesGlobalPosFragment=!1,this.vertexConstantData=new Array,this.fragmentConstantData=new Array,this.profile=e}return e.prototype.createCompiler=function(e,t){return new a(e,t,this)},e.prototype.reset=function(){this.projectionDependencies=0,this.normalDependencies=0,this.viewDirDependencies=0,this.uvDependencies=0,this.secondaryUVDependencies=0,this.globalPosDependencies=0,this.tangentDependencies=0,this.usesGlobalPosFragment=!1,this.usesFragmentAnimation=!1,this.usesTangentSpace=!1,this.outputsNormals=!1,this.outputsTangentNormals=!1
},e.prototype.addWorldSpaceDependencies=function(){this.viewDirDependencies>0&&++this.globalPosDependencies},e.prototype.pInitRegisterIndices=function(){this.commonsDataIndex=-1,this.cameraPositionIndex=-1,this.uvBufferIndex=-1,this.uvTransformIndex=-1,this.secondaryUVBufferIndex=-1,this.normalBufferIndex=-1,this.tangentBufferIndex=-1,this.sceneMatrixIndex=-1,this.sceneNormalMatrixIndex=-1},e.prototype.initConstantData=function(e,t,i,s,a){this.numUsedVertexConstants=e.numUsedVertexConstants,this.numUsedFragmentConstants=e.numUsedFragmentConstants,this.numUsedStreams=e.numUsedStreams,this.numUsedTextures=e.numUsedTextures,this.numUsedVaryings=e.numUsedVaryings,this.numUsedFragmentConstants=e.numUsedFragmentConstants,this.animatableAttributes=t,this.animationTargetRegisters=i,this.uvSource=s,this.uvTarget=a,this.vertexConstantData.length=4*this.numUsedVertexConstants,this.fragmentConstantData.length=4*this.numUsedFragmentConstants,this.fragmentConstantData[this.commonsDataIndex]=.5,this.fragmentConstantData[this.commonsDataIndex+1]=0,this.fragmentConstantData[this.commonsDataIndex+2]=1/255,this.fragmentConstantData[this.commonsDataIndex+3]=1,this.uvTransformIndex>=0&&(this.vertexConstantData[this.uvTransformIndex]=1,this.vertexConstantData[this.uvTransformIndex+1]=0,this.vertexConstantData[this.uvTransformIndex+2]=0,this.vertexConstantData[this.uvTransformIndex+3]=0,this.vertexConstantData[this.uvTransformIndex+4]=0,this.vertexConstantData[this.uvTransformIndex+5]=1,this.vertexConstantData[this.uvTransformIndex+6]=0,this.vertexConstantData[this.uvTransformIndex+7]=0),this.cameraPositionIndex>=0&&(this.vertexConstantData[this.cameraPositionIndex+3]=1)},e.prototype.iActivate=function(e,t){if(e.context.setCulling(this.useBothSides?s.NONE:this._defaultCulling,t.projection.coordinateSystem),!this.usesTangentSpace&&this.cameraPositionIndex>=0){var i=t.scenePosition;this.vertexConstantData[this.cameraPositionIndex]=i.x,this.vertexConstantData[this.cameraPositionIndex+1]=i.y,this.vertexConstantData[this.cameraPositionIndex+2]=i.z}},e.prototype.iDeactivate=function(){},e.prototype.setRenderState=function(e,t,s){var a=t.context;if(e.materialOwner.animator&&e.materialOwner.animator.setRenderState(this,e,t,s,this.numUsedVertexConstants,this.numUsedStreams),this.uvBufferIndex>=0&&a.activateBuffer(this.uvBufferIndex,e.getVertexData(i.UV_DATA),e.getVertexOffset(i.UV_DATA),i.UV_FORMAT),this.secondaryUVBufferIndex>=0&&a.activateBuffer(this.secondaryUVBufferIndex,e.getVertexData(i.SECONDARY_UV_DATA),e.getVertexOffset(i.SECONDARY_UV_DATA),i.SECONDARY_UV_FORMAT),this.normalBufferIndex>=0&&a.activateBuffer(this.normalBufferIndex,e.getVertexData(i.NORMAL_DATA),e.getVertexOffset(i.NORMAL_DATA),i.NORMAL_FORMAT),this.tangentBufferIndex>=0&&a.activateBuffer(this.tangentBufferIndex,e.getVertexData(i.TANGENT_DATA),e.getVertexOffset(i.TANGENT_DATA),i.TANGENT_FORMAT),this.usesUVTransform){var r=e.materialOwner.uvTransform.matrix;r?(this.vertexConstantData[this.uvTransformIndex]=r.a,this.vertexConstantData[this.uvTransformIndex+1]=r.b,this.vertexConstantData[this.uvTransformIndex+3]=r.tx,this.vertexConstantData[this.uvTransformIndex+4]=r.c,this.vertexConstantData[this.uvTransformIndex+5]=r.d,this.vertexConstantData[this.uvTransformIndex+7]=r.ty):(this.vertexConstantData[this.uvTransformIndex]=1,this.vertexConstantData[this.uvTransformIndex+1]=0,this.vertexConstantData[this.uvTransformIndex+3]=0,this.vertexConstantData[this.uvTransformIndex+4]=0,this.vertexConstantData[this.uvTransformIndex+5]=1,this.vertexConstantData[this.uvTransformIndex+7]=0)}if(this.sceneNormalMatrixIndex>=0&&e.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData,this.sceneNormalMatrixIndex,!1),this.usesTangentSpace&&this.cameraPositionIndex>=0){e.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);var n=s.scenePosition,o=n.x,l=n.y,h=n.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*o+this._pInverseSceneMatrix[4]*l+this._pInverseSceneMatrix[8]*h+this._pInverseSceneMatrix[12],this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*o+this._pInverseSceneMatrix[5]*l+this._pInverseSceneMatrix[9]*h+this._pInverseSceneMatrix[13],this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*o+this._pInverseSceneMatrix[6]*l+this._pInverseSceneMatrix[10]*h+this._pInverseSceneMatrix[14]}},e.prototype.dispose=function(){},e}();t.exports=r},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderCompilerBase":void 0}],"awayjs-stagegl/lib/materials/compilation/ShaderRegisterCache":[function(e,t){var i=e("awayjs-stagegl/lib/materials/compilation/RegisterPool"),s=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),a=function(){function e(e){this._numUsedVertexConstants=0,this._numUsedFragmentConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._profile=e}return e.prototype.reset=function(){this._fragmentTempCache=new i("ft",8,!1),this._vertexTempCache=new i("vt",8,!1),this._varyingCache=new i("v",8),this._textureCache=new i("fs",8),this._vertexAttributesCache=new i("va",8),this._fragmentConstantsCache=new i("fc",28),this._vertexConstantsCache=new i("vc",128),this._fragmentOutputRegister=new s("oc",-1),this._vertexOutputRegister=new s("op",-1),this._numUsedVertexConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._numUsedFragmentConstants=0;var e;for(e=0;e<this._vertexAttributesOffset;++e)this.getFreeVertexAttribute();for(e=0;e<this._vertexConstantOffset;++e)this.getFreeVertexConstant();for(e=0;e<this._varyingsOffset;++e)this.getFreeVarying();for(e=0;e<this._fragmentConstantOffset;++e)this.getFreeFragmentConstant()},e.prototype.dispose=function(){this._fragmentTempCache.dispose(),this._vertexTempCache.dispose(),this._varyingCache.dispose(),this._fragmentConstantsCache.dispose(),this._vertexAttributesCache.dispose(),this._fragmentTempCache=null,this._vertexTempCache=null,this._varyingCache=null,this._fragmentConstantsCache=null,this._vertexAttributesCache=null,this._fragmentOutputRegister=null,this._vertexOutputRegister=null},e.prototype.addFragmentTempUsages=function(e,t){this._fragmentTempCache.addUsage(e,t)},e.prototype.removeFragmentTempUsage=function(e){this._fragmentTempCache.removeUsage(e)},e.prototype.addVertexTempUsages=function(e,t){this._vertexTempCache.addUsage(e,t)},e.prototype.removeVertexTempUsage=function(e){this._vertexTempCache.removeUsage(e)},e.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()},e.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()},e.prototype.getFreeVarying=function(){return++this._numUsedVaryings,this._varyingCache.requestFreeVectorReg()},e.prototype.getFreeFragmentConstant=function(){return++this._numUsedFragmentConstants,this._fragmentConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexConstant=function(){return++this._numUsedVertexConstants,this._vertexConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()},e.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()},e.prototype.getFreeVertexAttribute=function(){return++this._numUsedStreams,this._vertexAttributesCache.requestFreeVectorReg()},e.prototype.getFreeTextureReg=function(){return++this._numUsedTextures,this._textureCache.requestFreeVectorReg()},Object.defineProperty(e.prototype,"vertexConstantOffset",{get:function(){return this._vertexConstantOffset},set:function(e){this._vertexConstantOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributesOffset",{get:function(){return this._vertexAttributesOffset},set:function(e){this._vertexAttributesOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"varyingsOffset",{get:function(){return this._varyingsOffset},set:function(e){this._varyingsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentConstantOffset",{get:function(){return this._fragmentConstantOffset},set:function(e){this._fragmentConstantOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:!0,configurable:!0}),e}();t.exports=a},{"awayjs-stagegl/lib/materials/compilation/RegisterPool":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-stagegl/lib/materials/compilation/ShaderRegisterData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":[function(e,t){var i=function(){function e(t,i,s){void 0===s&&(s=-1),this._component=s,this._regName=t,this._index=i,this._toStr=this._regName,this._index>=0&&(this._toStr+=this._index),s>-1&&(this._toStr+="."+e.COMPONENTS[s])}return e.prototype.toString=function(){return this._toStr},Object.defineProperty(e.prototype,"regName",{get:function(){return this._regName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e.COMPONENTS=["x","y","z","w"],e}();t.exports=i},{}],"awayjs-stagegl/lib/materials/methods/AmbientBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/methods/ShadingMethodBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this),this._color=16777215,this._alpha=1,this._colorR=1,this._colorG=1,this._colorB=1,this._ambient=1}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsUV=Boolean(null!=e.texture)},t.prototype.iInitConstants=function(e,t){t.needsUV||(this._color=e.color,this.updateColor())},Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambient},set:function(e){this._ambient!=e&&(this._ambient=e,this.updateColor())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!=e&&(this._alpha=e,this.updateColor())},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(e){},t.prototype.iGetFragmentCode=function(e,t,i,s,a){var r,n="";if(t.needsUV){if(r=s.getFreeTextureReg(),t.texturesIndex=r.index,n+=o.getTex2DSampleCode(i,a,r,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping),e.alphaThreshold>0){var l=s.getFreeFragmentConstant();t.fragmentConstantsIndex=4*l.index,n+="sub "+i+".w, "+i+".w, "+l+".x\nkil "+i+".w\nadd "+i+".w, "+i+".w, "+l+".x\n"}}else r=s.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*r.index,n+="mov "+i+", "+r+"\n";return n},t.prototype.iActivate=function(e,t,i){if(t.needsUV)i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?s.MIPLINEAR:s.MIPNONE),i.context.activateTexture(t.texturesIndex,e.texture),e.alphaThreshold>0&&(e.fragmentConstantData[t.fragmentConstantsIndex]=e.alphaThreshold);else{var n=t.fragmentConstantsIndex,o=e.fragmentConstantData;o[n]=this._colorR,o[n+1]=this._colorG,o[n+2]=this._colorB,o[n+3]=this._alpha}},t.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._ambient,this._colorG=(this._color>>8&255)/255*this._ambient,this._colorB=(255&this._color)/255*this._ambient},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/methods/ShadingMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/methods/LightingMethodBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this),this._multiply=!0,this._diffuseColor=16777215,this._ambientColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._ambientR=1,this._ambientG=1,this._ambientB=1}return i(t,e),t.prototype.iIsUsed=function(e){return e.numLights?!0:!1},Object.defineProperty(t.prototype,"multiply",{get:function(){return this._multiply},set:function(e){this._multiply!=e&&(this._multiply=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture,t.needsNormals=e.numLights>0},t.prototype.generateMip=function(e){this._pUseTexture&&e.context.activateTexture(0,this._texture)},Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor!=e&&(this._diffuseColor=e,this.updateDiffuse())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(e){this._ambientColor!=e&&(this._ambientColor=e,this.updateAmbient())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._pUseTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._texture=null},t.prototype.copyFrom=function(e){var t=e;this.texture=t.texture,this.multiply=t.multiply,this.diffuseColor=t.diffuseColor,this.ambientColor=t.ambientColor},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pTotalLightColorReg=null,this._pDiffuseInputRegister=null},t.prototype.iGetFragmentPreLightingCode=function(e,t,i){var s="";return this._pIsFirstLight=!0,this._pTotalLightColorReg=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._pTotalLightColorReg,1),s},t.prototype.iGetFragmentCodePerLight=function(e,t,i,s,a,r){var n,o="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1)),o+="dp3 "+n+".x, "+i+", "+r.normalFragment+"\nmax "+n+".w, "+n+".x, "+r.commons+".y\n",e.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+i+".w\n"),null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,r)),o+="mul "+n+", "+n+".w, "+s+"\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,s,a,r){var n,o="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1)),o+="tex "+n+", "+r.normalFragment+", "+i+" <cube,linear,miplinear>\nmul "+n+".xyz, "+n+".xyz, "+s+"\n",null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,r)),this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,s,a){var r,n="";a.shadowTarget&&(n+=this.pApplyShadow(e,t,s,a)),r=s.getFreeFragmentVectorTemp(),s.addFragmentTempUsages(r,1);var l=s.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*l.index,this._pUseTexture?(this._pDiffuseInputRegister=s.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,n+=o.getTex2DSampleCode(r,a,this._pDiffuseInputRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)):(this._pDiffuseInputRegister=s.getFreeFragmentConstant(),n+="mov "+r+", "+this._pDiffuseInputRegister+"\n"),n+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\nmul "+r+".xyz, "+r+", "+this._pTotalLightColorReg+"\n",n+=this._multiply?"add "+r+".xyz, "+r+", "+l+"\nmul "+i+".xyz, "+i+", "+r+"\n":"mul "+i+".xyz, "+i+", "+l+"\nmul "+this._pTotalLightColorReg+".xyz, "+i+", "+this._pTotalLightColorReg+"\nsub "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\nadd "+i+".xyz, "+i+", "+r+"\n",s.removeFragmentTempUsage(this._pTotalLightColorReg),s.removeFragmentTempUsage(r),n},t.prototype.pApplyShadow=function(e,t,i,s){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s.shadowTarget+".w\n"},t.prototype.iActivate=function(e,t,i){if(this._pUseTexture)i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?s.MIPLINEAR:s.MIPNONE),i.context.activateTexture(t.texturesIndex,this._texture);else{var n=t.fragmentConstantsIndex,o=e.fragmentConstantData;o[n+4]=this._diffuseR,o[n+5]=this._diffuseG,o[n+6]=this._diffuseB,o[n+7]=1}},t.prototype.updateDiffuse=function(){this._diffuseR=(this._diffuseColor>>16&255)/255,this._diffuseG=(this._diffuseColor>>8&255)/255,this._diffuseB=(255&this._diffuseColor)/255},t.prototype.updateAmbient=function(){this._ambientR=(this._ambientColor>>16&255)/255,this._ambientG=(this._ambientColor>>8&255)/255,this._ambientB=(255&this._ambientColor)/255},t.prototype.iSetRenderState=function(e,t){if(e.numLights>0){var i=t.fragmentConstantsIndex,s=e.fragmentConstantData;s[i]=e.ambientR*this._ambientR,s[i+1]=e.ambientG*this._ambientG,s[i+2]=e.ambientB*this._ambientB,s[i+3]=1}},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/methods/LightingMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/methods/EffectColorTransformMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(){e.call(this)}return i(t,e),Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(e){this._colorTransform=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,i,s){var a="",r=s.getFreeFragmentConstant(),n=s.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*r.index,a+="mul "+i+", "+i+", "+r+"\nadd "+i+", "+i+", "+n+"\n"},t.prototype.iActivate=function(e,t){var i=1/255,s=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[s]=this._colorTransform.redMultiplier,a[s+1]=this._colorTransform.greenMultiplier,a[s+2]=this._colorTransform.blueMultiplier,a[s+3]=this._colorTransform.alphaMultiplier,a[s+4]=this._colorTransform.redOffset*i,a[s+5]=this._colorTransform.greenOffset*i,a[s+6]=this._colorTransform.blueOffset*i,a[s+7]=this._colorTransform.alphaOffset*i},t}(s);t.exports=a},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-stagegl/lib/materials/methods/EffectMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/errors/AbstractMethodError"),r=e("awayjs-stagegl/lib/materials/methods/ShadingMethodBase"),n=function(e){function t(){e.call(this)}return i(t,e),Object.defineProperty(t.prototype,"assetType",{get:function(){return s.EFFECTS_METHOD},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(){throw new a},t}(r);t.exports=n},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-stagegl/lib/materials/methods/ShadingMethodBase":void 0}],"awayjs-stagegl/lib/materials/methods/LightingMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/methods/ShadingMethodBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iGetFragmentPreLightingCode=function(){return""},t.prototype.iGetFragmentCodePerLight=function(){return""},t.prototype.iGetFragmentCodePerProbe=function(){return""},t.prototype.iGetFragmentPostLightingCode=function(){return""},t}(s);t.exports=a},{"awayjs-stagegl/lib/materials/methods/ShadingMethodBase":void 0}],"awayjs-stagegl/lib/materials/methods/NormalBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/methods/ShadingMethodBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iIsUsed=function(e){return this._useTexture&&e.normalDependencies?!0:!1},t.prototype.iInitVO=function(e,t){t.needsUV=this._useTexture},t.prototype.iOutputsTangentNormals=function(){return!0},t.prototype.copyFrom=function(e){var t=e;null!=t.normalMap&&(this.normalMap=t.normalMap)},Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._useTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._useTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pNormalTextureRegister=null},t.prototype.dispose=function(){this._texture&&(this._texture=null)},t.prototype.iActivate=function(e,t,i){t.texturesIndex>=0&&(i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?s.MIPLINEAR:s.MIPNONE),i.context.activateTexture(t.texturesIndex,this._texture))},t.prototype.iGetFragmentCode=function(e,t,i,s,a){return this._pNormalTextureRegister=s.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,o.getTex2DSampleCode(i,a,this._pNormalTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"sub "+i+".xyz, "+i+".xyz, "+a.commons+".xxx\nnrm "+i+".xyz, "+i+"\n"},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/methods/ShadingMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/methods/ShadingMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/library/NamedAssetBase"),a=e("awayjs-stagegl/lib/events/ShadingMethodEvent"),r=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iIsUsed=function(){return!0},t.prototype.iInitVO=function(){},t.prototype.iInitConstants=function(){},t.prototype.iUsesTangentSpace=function(){return!0},Object.defineProperty(t.prototype,"passes",{get:function(){return this._passes},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.iReset=function(){this.iCleanCompilationData()},t.prototype.iCleanCompilationData=function(){},t.prototype.iGetVertexCode=function(){return""},t.prototype.iGetFragmentCode=function(){return null},t.prototype.iActivate=function(){},t.prototype.iSetRenderState=function(){},t.prototype.iDeactivate=function(){},t.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new a(a.SHADER_INVALIDATED))},t.prototype.copyFrom=function(){},t}(s);t.exports=r},{"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-stagegl/lib/events/ShadingMethodEvent":void 0}],"awayjs-stagegl/lib/materials/methods/ShadowHardMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/methods/ShadowMethodBase"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype._pGetPlanarFragmentCode=function(e,t,i){var s=i.getFreeTextureReg(),a=i.getFreeFragmentConstant(),r=(i.getFreeFragmentConstant(),i.getFreeFragmentVectorTemp()),n="";return e.fragmentConstantsIndex=4*a.index,e.texturesIndex=s.index,n+="tex "+r+", "+this._pDepthMapCoordReg+", "+s+" <2d, nearest, clamp>\ndp4 "+r+".z, "+r+", "+a+"\nslt "+t+".w, "+this._pDepthMapCoordReg+".z, "+r+".z\n"},t.prototype._pGetPointFragmentCode=function(e,t,i,s){var a=i.getFreeTextureReg(),r=i.getFreeFragmentConstant(),n=i.getFreeFragmentConstant(),o=i.getFreeFragmentConstant(),l=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(l,1);var h=i.getFreeFragmentVectorTemp(),p="";return e.fragmentConstantsIndex=4*r.index,e.texturesIndex=a.index,p+="sub "+h+", "+s.globalPositionVarying+", "+o+"\ndp3 "+h+".w, "+h+".xyz, "+h+".xyz\nmul "+h+".w, "+h+".w, "+o+".w\nnrm "+h+".xyz, "+h+".xyz\ntex "+l+", "+h+", "+a+" <cube, nearest, clamp>\ndp4 "+l+".z, "+l+", "+r+"\nadd "+t+".w, "+h+".w, "+n+".x\nslt "+t+".w, "+t+".w, "+l+".z\n",i.removeFragmentTempUsage(l),p},t.prototype._iGetCascadeFragmentCode=function(e,t,i,s,a,r,n){var o=n.getFreeFragmentVectorTemp();return"tex "+o+", "+a+", "+s+" <2d, nearest, clamp>\ndp4 "+o+".z, "+o+", "+i+"\nslt "+r+".w, "+a+".z, "+o+".z\n"},t.prototype.iActivateForCascade=function(){},t}(s);t.exports=a},{"awayjs-stagegl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-stagegl/lib/materials/methods/ShadowMapMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-stagegl/lib/materials/methods/ShadingMethodBase"),r=function(e){function t(t){e.call(this),this._pEpsilon=.02,this._pAlpha=1,this._pCastingLight=t,t.castsShadows=!0,this._pShadowMapper=t.shadowMapper}return i(t,e),Object.defineProperty(t.prototype,"assetType",{get:function(){return s.SHADOW_MAP_METHOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._pAlpha},set:function(e){this._pAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(e){this._pEpsilon=e},enumerable:!0,configurable:!0}),t}(a);t.exports=r},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-stagegl/lib/materials/methods/ShadingMethodBase":void 0}],"awayjs-stagegl/lib/materials/methods/ShadowMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/errors/AbstractMethodError"),a=e("awayjs-display/lib/entities/PointLight"),r=e("awayjs-stagegl/lib/materials/methods/ShadowMapMethodBase"),n=function(e){function t(t){this._pUsePoint=t instanceof a,e.call(this,t)}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsView=!0,t.needsGlobalVertexPos=!0,t.needsGlobalFragmentPos=this._pUsePoint,t.needsNormals=e.numLights>0},t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,s=e.vertexConstantData,a=t.fragmentConstantsIndex;i[a]=1,i[a+1]=1/255,i[a+2]=1/65025,i[a+3]=1/16581375,i[a+6]=0,i[a+7]=1,this._pUsePoint&&(i[a+8]=0,i[a+9]=0,i[a+10]=0,i[a+11]=1),a=t.vertexConstantsIndex,-1!=a&&(s[a]=.5,s[a+1]=.5,s[a+2]=0,s[a+3]=1)},Object.defineProperty(t.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(e){this._pDepthMapCoordReg=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pDepthMapCoordReg=null},t.prototype.iGetVertexCode=function(e,t,i,s){return this._pUsePoint?this._pGetPointVertexCode(t,i,s):this.pGetPlanarVertexCode(t,i,s)},t.prototype._pGetPointVertexCode=function(e){return e.vertexConstantsIndex=-1,""},t.prototype.pGetPlanarVertexCode=function(e,t,i){var s="",a=t.getFreeVertexVectorTemp(),r=t.getFreeVertexConstant(),n=t.getFreeVertexConstant();return t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),this._pDepthMapCoordReg=t.getFreeVarying(),e.vertexConstantsIndex=4*r.index,s+="m44 "+a+", "+i.globalPositionVertex+", "+n+"\ndiv "+a+", "+a+", "+a+".w\nmul "+a+".xy, "+a+".xy, "+r+".xy\nadd "+this._pDepthMapCoordReg+", "+a+", "+r+".xxwz\n"},t.prototype.iGetFragmentCode=function(e,t,i,s,a){var r=this._pUsePoint?this._pGetPointFragmentCode(t,i,s,a):this._pGetPlanarFragmentCode(t,i,s,a);return r+="add "+i+".w, "+i+".w, fc"+(t.fragmentConstantsIndex/4+1)+".y\nsat "+i+".w, "+i+".w\n"},t.prototype._pGetPlanarFragmentCode=function(){throw new s},t.prototype._pGetPointFragmentCode=function(){throw new s},t.prototype.iSetRenderState=function(e,t){this._pUsePoint||this._pShadowMapper.iDepthProjection.copyRawDataTo(e.vertexConstantData,t.vertexConstantsIndex+4,!0)},t.prototype._iGetCascadeFragmentCode=function(){throw new Error("This shadow method is incompatible with cascade shadows")},t.prototype.iActivate=function(e,t,i){var s=e.fragmentConstantData,a=t.fragmentConstantsIndex;if(this._pUsePoint?s[a+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2):e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon),s[a+5]=1-this._pAlpha,this._pUsePoint){var r=this._pCastingLight.scenePosition;s[a+8]=r.x,s[a+9]=r.y,s[a+10]=r.z;var n=this._pCastingLight.fallOff;s[a+11]=1/(2*n*n)}this._pUsePoint||i.context.activateRenderTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap)},t.prototype.iActivateForCascade=function(){throw new Error("This shadow method is incompatible with cascade shadows")},t}(r);t.exports=n},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-display/lib/entities/PointLight":void 0,"awayjs-stagegl/lib/materials/methods/ShadowMapMethodBase":void 0}],"awayjs-stagegl/lib/materials/methods/SpecularBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/methods/LightingMethodBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this),this._gloss=50,this._specular=1,this._specularColor=16777215,this._iSpecularR=1,this._iSpecularG=1,this._iSpecularB=1
}return i(t,e),t.prototype.iIsUsed=function(e){return e.numLights?!0:!1},t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture,t.needsNormals=e.numLights>0,t.needsView=e.numLights>0},Object.defineProperty(t.prototype,"gloss",{get:function(){return this._gloss},set:function(e){this._gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._specular},set:function(e){e!=this._specular&&(this._specular=e,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularColor},set:function(e){this._specularColor!=e&&((0==this._specularColor||0==e)&&this.iInvalidateShaderProgram(),this._specularColor=e,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._pUseTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(e){var t=e,i=t;this.texture=i.texture,this.specular=i.specular,this.specularColor=i.specularColor,this.gloss=i.gloss},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pTotalLightColorReg=null,this._pSpecularTextureRegister=null,this._pSpecularTexData=null,this._pSpecularDataRegister=null},t.prototype.iGetFragmentPreLightingCode=function(e,t,i,s){var a="";return this._pIsFirstLight=!0,this._pSpecularDataRegister=i.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*this._pSpecularDataRegister.index,this._pUseTexture?(this._pSpecularTexData=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._pSpecularTexData,1),this._pSpecularTextureRegister=i.getFreeTextureReg(),t.texturesIndex=this._pSpecularTextureRegister.index,a=o.getTex2DSampleCode(this._pSpecularTexData,s,this._pSpecularTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)):this._pSpecularTextureRegister=null,this._pTotalLightColorReg=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._pTotalLightColorReg,1),a},t.prototype.iGetFragmentCodePerLight=function(e,t,i,s,a,r){var n,o="";this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1));var l=r.viewDirFragment,h=r.normalFragment;return o+="add "+n+", "+i+", "+l+"\nnrm "+n+".xyz, "+n+"\ndp3 "+n+".w, "+h+", "+n+"\nsat "+n+".w, "+n+".w\n",o+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n":"pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n",e.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+i+".w\n"),null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,r)),o+="mul "+n+".xyz, "+s+", "+n+".w\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,s,a,r){var n,o="";this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1));var l=r.normalFragment,h=r.viewDirFragment;return o+="dp3 "+n+".w, "+l+", "+h+"\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+", "+n+".w, "+l+"\nsub "+n+", "+n+", "+h+"\ntex "+n+", "+n+", "+i+" <cube,"+(e.useSmoothTextures?"linear":"nearest")+",miplinear>\nmul "+n+".xyz, "+n+", "+s+"\n",null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,r)),this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,s,a){var r="";return a.shadowTarget&&(r+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+a.shadowTarget+".w\n"),this._pUseTexture&&(r+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n",s.removeFragmentTempUsage(this._pSpecularTexData)),r+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\nadd "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\n",s.removeFragmentTempUsage(this._pTotalLightColorReg),r},t.prototype.iActivate=function(e,t,i){this._pUseTexture&&(i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?s.MIPLINEAR:s.MIPNONE),i.context.activateTexture(t.texturesIndex,this._texture));var n=t.fragmentConstantsIndex,o=e.fragmentConstantData;o[n]=this._iSpecularR,o[n+1]=this._iSpecularG,o[n+2]=this._iSpecularB,o[n+3]=this._gloss},t.prototype.updateSpecular=function(){this._iSpecularR=(this._specularColor>>16&255)/255*this._specular,this._iSpecularG=(this._specularColor>>8&255)/255*this._specular,this._iSpecularB=(255&this._specularColor)/255*this._specular},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/methods/LightingMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/passes/DepthMapPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex,s=t.fragmentConstantData;s[i]=1,s[i+1]=255,s[i+2]=65025,s[i+3]=16581375,s[i+4]=1/255,s[i+5]=1/255,s[i+6]=1/255,s[i+7]=0},t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++,e.alphaThreshold>0&&e.uvDependencies++},t.prototype._iGetFragmentCode=function(e,t,i){var s="",a=i.shadedTarget,r=t.getFreeTextureReg(),n=t.getFreeFragmentConstant(),l=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var h=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(h,1);var p=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(p,1),s+="div "+h+", "+i.projectionFragment+", "+i.projectionFragment+".w\nmul "+h+", "+n+", "+h+".z\nfrc "+h+", "+h+"\nmul "+p+", "+h+".yzww, "+l+"\n",e.alphaThreshold>0){r=t.getFreeTextureReg(),this._texturesIndex=r.index;var u=t.getFreeFragmentVectorTemp();s+=o.getTex2DSampleCode(u,i,r,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var d=t.getFreeFragmentConstant();s+="sub "+u+".w, "+u+".w, "+d+".x\nkil "+u+".w\n"}return s+="sub "+a+", "+h+", "+p+"\n",t.removeFragmentTempUsage(h),t.removeFragmentTempUsage(p),s},t.prototype._iRender=function(){},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=i.context,l=t.shaderObject;l.alphaThreshold>0&&(o.setSamplerStateAt(this._texturesIndex,l.repeatTextures?r.REPEAT:r.CLAMP,l.useSmoothTextures?a.LINEAR:a.NEAREST,l.useMipmapping?s.MIPLINEAR:s.MIPNONE),o.activateTexture(this._texturesIndex,l.texture),l.fragmentConstantData[this._fragmentConstantsIndex+8]=t.shaderObject.alphaThreshold)},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/passes/DistanceMapPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex,s=t.fragmentConstantData;s[i+4]=1/255,s[i+5]=1/255,s[i+6]=1/255,s[i+7]=0},t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++,e.viewDirDependencies++,e.alphaThreshold>0&&e.uvDependencies++,e.addWorldSpaceDependencies(!1)},t.prototype._iGetFragmentCode=function(e,t,i){var s,a=i.shadedTarget,r=t.getFreeTextureReg(),n=t.getFreeFragmentConstant(),l=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var h=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(h,1);var p=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(p,1),s="dp3 "+h+".z, "+i.viewDirVarying+".xyz, "+i.viewDirVarying+".xyz\nmul "+h+", "+n+", "+h+".z\nfrc "+h+", "+h+"\nmul "+p+", "+h+".yzww, "+l+"\n",e.alphaThreshold>0){r=t.getFreeTextureReg(),this._texturesIndex=r.index;var u=t.getFreeFragmentVectorTemp();s+=o.getTex2DSampleCode(u,i,r,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var d=t.getFreeFragmentConstant();s+="sub "+u+".w, "+u+".w, "+d+".x\nkil "+u+".w\n"}return s+="sub "+a+", "+h+", "+p+"\n"},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=i.context,l=t.shaderObject,h=n.projection.far;h=1/(2*h*h);var p=this._fragmentConstantsIndex,u=l.fragmentConstantData;u[p]=1*h,u[p+1]=255*h,u[p+2]=65025*h,u[p+3]=16581375*h,l.alphaThreshold>0&&(o.setSamplerStateAt(this._texturesIndex,l.repeatTextures?r.REPEAT:r.CLAMP,l.useSmoothTextures?a.LINEAR:a.NEAREST,l.useMipmapping?s.MIPLINEAR:s.MIPNONE),o.activateTexture(this._texturesIndex,l.texture),u[p+8]=t.shaderObject.alphaThreshold)},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/passes/ILightingPassStageGL":[function(){},{}],"awayjs-stagegl/lib/materials/passes/IMaterialPassStageGL":[function(){},{}],"awayjs-stagegl/lib/materials/passes/LineBasicPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iGetFragmentCode=function(e,t,i){var s=i.shadedTarget;return"mov "+s+", v0\n"},t}(s);t.exports=a},{"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0}],"awayjs-stagegl/lib/materials/passes/MaterialPassBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/library/NamedAssetBase"),a=e("awayjs-core/lib/errors/ArgumentError"),r=e("awayjs-core/lib/events/Event"),n=e("awayjs-display/lib/base/BlendMode"),o=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),l=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),h=e("awayjs-stagegl/lib/materials/compilation/ShaderObjectBase"),p=e("awayjs-stagegl/lib/materials/passes/MaterialPassMode"),u=function(e){function t(t){var i=this;void 0===t&&(t=3),e.call(this),this._materialPassData=new Array,this._maxLights=3,this._preserveAlpha=!0,this._includeCasters=!0,this._forceSeparateMVP=!1,this._directionalLightsOffset=0,this._pointLightsOffset=0,this._lightProbesOffset=0,this._pNumPointLights=0,this._pNumDirectionalLights=0,this._pNumLightProbes=0,this._pNumLights=0,this._depthCompareMode=l.LESS_EQUAL,this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1,this._writeDepth=!0,this._passMode=t,this._onLightsChangeDelegate=function(e){return i.onLightsChange(e)}}return i(t,e),Object.defineProperty(t.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(e){this._preserveAlpha!=e&&(this._preserveAlpha=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(e){this._includeCasters!=e&&(this._includeCasters=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(e){this._forceSeparateMVP!=e&&(this._forceSeparateMVP=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"directionalLightsOffset",{get:function(){return this._directionalLightsOffset},set:function(e){this._directionalLightsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointLightsOffset",{get:function(){return this._pointLightsOffset},set:function(e){this._pointLightsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightProbesOffset",{get:function(){return this._lightProbesOffset},set:function(e){this._lightProbesOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"passMode",{get:function(){return this._passMode},set:function(e){this._passMode=e,this._pInvalidatePass()},enumerable:!0,configurable:!0}),t.prototype.createShaderObject=function(e){return new h(e)},Object.defineProperty(t.prototype,"writeDepth",{get:function(){return this._writeDepth},set:function(e){this._writeDepth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(this._pLightPicker&&this._pLightPicker.removeEventListener(r.CHANGE,this._onLightsChangeDelegate);this._materialPassData.length;)this._materialPassData[0].dispose();this._materialPassData=null},t.prototype._iRender=function(e,t,i,s,a){this.setRenderState(e,t,i,s,a)},t.prototype.setRenderState=function(e,t,i,s,a){e.shaderObject.setRenderState(t,i,s,a)},t.prototype.setBlendMode=function(e){switch(e){case n.NORMAL:this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1;break;case n.LAYER:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE_MINUS_SOURCE_ALPHA,this._pEnableBlending=!0;break;case n.MULTIPLY:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_COLOR,this._pEnableBlending=!0;break;case n.ADD:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE,this._pEnableBlending=!0;break;case n.ALPHA:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_ALPHA,this._pEnableBlending=!0;break;default:throw new a("Unsupported blend mode!")}},t.prototype._iActivate=function(e,t,i){var s=t.context;s.setDepthTest(this._writeDepth&&!this._pEnableBlending,this._depthCompareMode),this._pEnableBlending&&s.setBlendFactors(this._blendFactorSource,this._blendFactorDest),s.activateMaterialPass(e,t,i)},t.prototype._iDeactivate=function(e,t){t.context.deactivateMaterialPass(e,t),t.context.setDepthTest(!0,l.LESS_EQUAL)},t.prototype._pInvalidatePass=function(){for(var e=this._materialPassData.length,t=0;e>t;t++)this._materialPassData[t].invalidate();this.dispatchEvent(new r(r.CHANGE))},Object.defineProperty(t.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(e){this._pLightPicker&&this._pLightPicker.removeEventListener(r.CHANGE,this._onLightsChangeDelegate),this._pLightPicker=e,this._pLightPicker&&this._pLightPicker.addEventListener(r.CHANGE,this._onLightsChangeDelegate),this.pUpdateLights()},enumerable:!0,configurable:!0}),t.prototype.onLightsChange=function(){this.pUpdateLights()},t.prototype.pUpdateLights=function(){var e=this._pNumDirectionalLights,t=this._pNumPointLights,i=this._pNumLightProbes;this._pLightPicker&&this._passMode&p.LIGHTING?(this._pNumDirectionalLights=this.calculateNumDirectionalLights(this._pLightPicker.numDirectionalLights),this._pNumPointLights=this.calculateNumPointLights(this._pLightPicker.numPointLights),this._pNumLightProbes=this.calculateNumProbes(this._pLightPicker.numLightProbes),this._includeCasters&&(this._pNumDirectionalLights+=this._pLightPicker.numCastingDirectionalLights,this._pNumPointLights+=this._pLightPicker.numCastingPointLights)):(this._pNumDirectionalLights=0,this._pNumPointLights=0,this._pNumLightProbes=0),this._pNumLights=this._pNumDirectionalLights+this._pNumPointLights,(e!=this._pNumDirectionalLights||t!=this._pNumPointLights||i!=this._pNumLightProbes)&&this._pInvalidatePass()},t.prototype._iIncludeDependencies=function(e){this._forceSeparateMVP&&e.globalPosDependencies++,e.outputsNormals=this._pOutputsNormals(e),e.outputsTangentNormals=e.outputsNormals&&this._pOutputsTangentNormals(e),e.usesTangentSpace=e.outputsTangentNormals&&this._pUsesTangentSpace(e),e.usesTangentSpace||e.addWorldSpaceDependencies(Boolean(this._passMode&p.EFFECTS))},t.prototype._iInitConstantData=function(){},t.prototype._iGetPreLightingVertexCode=function(){return""},t.prototype._iGetPreLightingFragmentCode=function(){return""},t.prototype._iGetVertexCode=function(){return""},t.prototype._iGetFragmentCode=function(){return""},t.prototype._iGetNormalVertexCode=function(){return""},t.prototype._iGetNormalFragmentCode=function(){return""},Object.defineProperty(t.prototype,"iNumPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumLightProbes",{get:function(){return this._pNumLightProbes},enumerable:!0,configurable:!0}),t.prototype._pOutputsNormals=function(){return!1},t.prototype._pOutputsTangentNormals=function(){return!1},t.prototype._pUsesTangentSpace=function(){return!1},t.prototype.calculateNumDirectionalLights=function(e){return Math.min(e-this._directionalLightsOffset,this._maxLights)},t.prototype.calculateNumPointLights=function(e){var t=this._maxLights-this._pNumDirectionalLights;return Math.min(e-this._pointLightsOffset,t)},t.prototype.calculateNumProbes=function(e){var t=0;return Math.min(e-this._lightProbesOffset,4/t|0)},t.prototype._iAddMaterialPassData=function(e){return this._materialPassData.push(e),e},t.prototype._iRemoveMaterialPassData=function(e){return this._materialPassData.splice(this._materialPassData.indexOf(e),1),e},t}(s);t.exports=u},{"awayjs-core/lib/errors/ArgumentError":void 0,"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderObjectBase":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassMode":void 0}],"awayjs-stagegl/lib/materials/passes/MaterialPassMode":[function(e,t){var i=function(){function e(){}return e.EFFECTS=1,e.LIGHTING=2,e.SUPER_SHADER=3,e}();t.exports=i},{}],"awayjs-stagegl/lib/materials/passes/SkyboxPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iIncludeDependencies=function(e){e.useMipmapping=!1},t}(s);t.exports=a},{"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0}],"awayjs-stagegl/lib/materials/passes/TriangleBasicPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),o=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this),this._diffuseColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._diffuseA=1}return i(t,e),Object.defineProperty(t.prototype,"diffuseAlpha",{get:function(){return this._diffuseA},set:function(e){this._diffuseA=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor=e,this._diffuseR=(this._diffuseColor>>16&255)/255,this._diffuseG=(this._diffuseColor>>8&255)/255,this._diffuseB=(255&this._diffuseColor)/255},enumerable:!0,configurable:!0}),t.prototype._iGetFragmentCode=function(e,t,i){var s,a="",r=i.shadedTarget;if(null!=e.texture){if(s=t.getFreeTextureReg(),this._texturesIndex=s.index,a+=o.getTex2DSampleCode(r,i,s,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping),e.alphaThreshold>0){var n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index,a+="sub "+r+".w, "+r+".w, "+n+".x\nkil "+r+".w\nadd "+r+".w, "+r+".w, "+n+".x\n"}}else s=t.getFreeFragmentConstant(),this._fragmentConstantsIndex=4*s.index,a+="mov "+r+", "+s+"\n";return a},t.prototype._iIncludeDependencies=function(e){null!=e.texture&&e.uvDependencies++},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=t.shaderObject;if(null!=o.texture)i.context.setSamplerStateAt(this._texturesIndex,o.repeatTextures?r.REPEAT:r.CLAMP,o.useSmoothTextures?a.LINEAR:a.NEAREST,o.useMipmapping?s.MIPLINEAR:s.MIPNONE),i.context.activateTexture(this._texturesIndex,o.texture),o.alphaThreshold>0&&(o.fragmentConstantData[this._fragmentConstantsIndex]=o.alphaThreshold);else{var l=this._fragmentConstantsIndex,h=o.fragmentConstantData;h[l]=this._diffuseR,h[l+1]=this._diffuseG,h[l+2]=this._diffuseB,h[l+3]=this._diffuseA}},t}(n);t.exports=l},{"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-stagegl/lib/materials/passes/TriangleMethodPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/events/ShadingMethodEvent"),a=e("awayjs-stagegl/lib/materials/compilation/MethodVO"),r=e("awayjs-stagegl/lib/materials/compilation/ShaderLightingObject"),n=e("awayjs-stagegl/lib/materials/compilation/ShaderObjectBase"),o=e("awayjs-stagegl/lib/materials/methods/EffectColorTransformMethod"),l=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),h=e("awayjs-stagegl/lib/materials/passes/MaterialPassMode"),p=function(e){function t(t){var i=this;void 0===t&&(t=3),e.call(this,t),this._iMethodVOs=new Array,this._numEffectDependencies=0,this._onShaderInvalidatedDelegate=function(e){return i.onShaderInvalidated(e)}}return i(t,e),t.prototype.createShaderObject=function(e){return this._pLightPicker&&this.passMode&h.LIGHTING?new r(e):new n(e)},t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);for(var i=this._iMethodVOs.length,s=0;i>s;++s)this._iMethodVOs[s].method.iInitConstants(t,this._iMethodVOs[s])},Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(e){e?(null==this.colorTransformMethod&&(this.colorTransformMethod=new o),this.colorTransformMethod.colorTransform=e):e||this.colorTransformMethod&&(this.colorTransformMethod=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTransformMethod",{get:function(){return this._iColorTransformMethodVO?this._iColorTransformMethodVO.method:null},set:function(e){this._iColorTransformMethodVO&&this._iColorTransformMethodVO.method==e||(this._iColorTransformMethodVO&&(this._removeDependency(this._iColorTransformMethodVO),this._iColorTransformMethodVO=null),e&&(this._iColorTransformMethodVO=new a(e),this._addDependency(this._iColorTransformMethodVO)))},enumerable:!0,configurable:!0}),t.prototype._removeDependency=function(e,t){void 0===t&&(t=!1);var i=this._iMethodVOs.indexOf(e);t||this._numEffectDependencies--,e.method.removeEventListener(s.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iMethodVOs.splice(i,1),this._pInvalidatePass()},t.prototype._addDependency=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=-1),e.method.addEventListener(s.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),t?(-1!=i?this._iMethodVOs.splice(i+this._iMethodVOs.length-this._numEffectDependencies,0,e):this._iMethodVOs.push(e),this._numEffectDependencies++):this._iMethodVOs.splice(this._iMethodVOs.length-this._numEffectDependencies,0,e),this._pInvalidatePass()},t.prototype.addEffectMethod=function(e){this._addDependency(new a(e),!0)},Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:!0,configurable:!0}),t.prototype.hasEffectMethod=function(e){return null!=this.getDependencyForMethod(e)},t.prototype.getEffectMethodAt=function(e){return 0>e||e>this._numEffectDependencies-1?null:this._iMethodVOs[e+this._iMethodVOs.length-this._numEffectDependencies].method},t.prototype.addEffectMethodAt=function(e,t){this._addDependency(new a(e),!0,t)},t.prototype.removeEffectMethod=function(e){var t=this.getDependencyForMethod(e);null!=t&&this._removeDependency(t,!0)},t.prototype.getDependencyForMethod=function(e){for(var t=this._iMethodVOs.length,i=0;t>i;++i)if(this._iMethodVOs[i].method==e)return this._iMethodVOs[i];return null},Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._iNormalMethodVO?this._iNormalMethodVO.method:null},set:function(e){this._iNormalMethodVO&&this._iNormalMethodVO.method==e||(this._iNormalMethodVO&&(this._removeDependency(this._iNormalMethodVO),this._iNormalMethodVO=null),e&&(this._iNormalMethodVO=new a(e),this._addDependency(this._iNormalMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._iAmbientMethodVO?this._iAmbientMethodVO.method:null},set:function(e){this._iAmbientMethodVO&&this._iAmbientMethodVO.method==e||(this._iAmbientMethodVO&&(this._removeDependency(this._iAmbientMethodVO),this._iAmbientMethodVO=null),e&&(this._iAmbientMethodVO=new a(e),this._addDependency(this._iAmbientMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._iShadowMethodVO?this._iShadowMethodVO.method:null},set:function(e){this._iShadowMethodVO&&this._iShadowMethodVO.method==e||(this._iShadowMethodVO&&(this._removeDependency(this._iShadowMethodVO),this._iShadowMethodVO=null),e&&(this._iShadowMethodVO=new a(e),this._addDependency(this._iShadowMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethodVO?this._iDiffuseMethodVO.method:null},set:function(e){this._iDiffuseMethodVO&&this._iDiffuseMethodVO.method==e||(this._iDiffuseMethodVO&&(this._removeDependency(this._iDiffuseMethodVO),this._iDiffuseMethodVO=null),e&&(this._iDiffuseMethodVO=new a(e),this._addDependency(this._iDiffuseMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._iSpecularMethodVO?this._iSpecularMethodVO.method:null},set:function(e){this._iSpecularMethodVO&&this._iSpecularMethodVO.method==e||(this._iSpecularMethodVO&&(this._removeDependency(this._iSpecularMethodVO),this._iSpecularMethodVO=null),e&&(this._iSpecularMethodVO=new a(e),this._addDependency(this._iSpecularMethodVO)))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(e.prototype.dispose.call(this);this._iMethodVOs.length;)this._removeDependency(this._iMethodVOs[0]);this._iMethodVOs=null},t.prototype.onShaderInvalidated=function(){this._pInvalidatePass()},t.prototype._iActivate=function(t,i,s){e.prototype._iActivate.call(this,t,i,s);for(var a,r=this._iMethodVOs.length,n=0;r>n;++n)a=this._iMethodVOs[n],a.useMethod&&a.method.iActivate(t.shaderObject,a,i)},t.prototype.setRenderState=function(t,i,s,a,r){e.prototype.setRenderState.call(this,t,i,s,a,r);for(var n,o=this._iMethodVOs.length,l=0;o>l;++l)n=this._iMethodVOs[l],n.useMethod&&n.method.iSetRenderState(t.shaderObject,n,i,s,a)},t.prototype._iDeactivate=function(t,i){e.prototype._iDeactivate.call(this,t,i);for(var s,a=this._iMethodVOs.length,r=0;a>r;++r)s=this._iMethodVOs[r],s.useMethod&&s.method.iDeactivate(t.shaderObject,s,i)},t.prototype._iIncludeDependencies=function(t){var i,s=this._iMethodVOs.length;for(i=0;s>i;++i)this.setupAndCountDependencies(t,this._iMethodVOs[i]);for(i=0;s>i;++i)this._iMethodVOs[i].useMethod=this._iMethodVOs[i].method.iIsUsed(t);e.prototype._iIncludeDependencies.call(this,t)},t.prototype.setupAndCountDependencies=function(e,t){t.reset(),t.method.iInitVO(e,t),t.needsProjection&&e.projectionDependencies++,t.needsGlobalVertexPos?(e.globalPosDependencies++,t.needsGlobalFragmentPos&&(e.usesGlobalPosFragment=!0)):t.needsGlobalFragmentPos&&(e.globalPosDependencies++,e.usesGlobalPosFragment=!0),t.needsNormals&&e.normalDependencies++,t.needsTangents&&e.tangentDependencies++,t.needsView&&e.viewDirDependencies++,t.needsUV&&e.uvDependencies++,t.needsSecondaryUV&&e.secondaryUVDependencies++},t.prototype._iGetPreLightingVertexCode=function(e,t,i){var s="";return this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod&&(s+=this._iAmbientMethodVO.method.iGetVertexCode(e,this._iAmbientMethodVO,t,i)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(s+=this._iDiffuseMethodVO.method.iGetVertexCode(e,this._iDiffuseMethodVO,t,i)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(s+=this._iSpecularMethodVO.method.iGetVertexCode(e,this._iSpecularMethodVO,t,i)),s},t.prototype._iGetPreLightingFragmentCode=function(e,t,i){var s="";return this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod&&(s+=this._iAmbientMethodVO.method.iGetFragmentCode(e,this._iAmbientMethodVO,i.shadedTarget,t,i),this._iAmbientMethodVO.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),this._iAmbientMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(s+=this._iDiffuseMethodVO.method.iGetFragmentPreLightingCode(e,this._iDiffuseMethodVO,t,i)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(s+=this._iSpecularMethodVO.method.iGetFragmentPreLightingCode(e,this._iSpecularMethodVO,t,i)),s},t.prototype._iGetPerLightDiffuseFragmentCode=function(e,t,i,s,a){return this._iDiffuseMethodVO.method.iGetFragmentCodePerLight(e,this._iDiffuseMethodVO,t,i,s,a)},t.prototype._iGetPerLightSpecularFragmentCode=function(e,t,i,s,a){return this._iSpecularMethodVO.method.iGetFragmentCodePerLight(e,this._iSpecularMethodVO,t,i,s,a)},t.prototype._iGetPerProbeDiffuseFragmentCode=function(e,t,i,s,a){return this._iDiffuseMethodVO.method.iGetFragmentCodePerProbe(e,this._iDiffuseMethodVO,t,i,s,a)},t.prototype._iGetPerProbeSpecularFragmentCode=function(e,t,i,s,a){return this._iSpecularMethodVO.method.iGetFragmentCodePerProbe(e,this._iSpecularMethodVO,t,i,s,a)},t.prototype._iGetPostLightingVertexCode=function(e,t,i){var s="";return this._iShadowMethodVO&&(s+=this._iShadowMethodVO.method.iGetVertexCode(e,this._iShadowMethodVO,t,i)),s},t.prototype._iGetPostLightingFragmentCode=function(e,t,i){var s="";
return e.useAlphaPremultiplied&&this._pEnableBlending&&(s+="add "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+i.commons+".z\ndiv "+i.shadedTarget+".xyz, "+i.shadedTarget+", "+i.shadedTarget+".w\nsub "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+i.commons+".z\nsat "+i.shadedTarget+".xyz, "+i.shadedTarget+"\n"),this._iShadowMethodVO&&(s+=this._iShadowMethodVO.method.iGetFragmentCode(e,this._iShadowMethodVO,i.shadowTarget,t,i)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(s+=this._iDiffuseMethodVO.method.iGetFragmentPostLightingCode(e,this._iDiffuseMethodVO,i.shadedTarget,t,i),this._iDiffuseMethodVO.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),this._iDiffuseMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(s+=this._iSpecularMethodVO.method.iGetFragmentPostLightingCode(e,this._iSpecularMethodVO,i.shadedTarget,t,i),this._iSpecularMethodVO.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),this._iSpecularMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment)),this._iShadowMethodVO&&t.removeFragmentTempUsage(i.shadowTarget),s},t.prototype._pUsesTangentSpace=function(e){if(e.usesProbes)return!1;for(var t,i=this._iMethodVOs.length,s=0;i>s;++s)if(t=this._iMethodVOs[s],t.useMethod&&!t.method.iUsesTangentSpace())return!1;return!0},t.prototype._pOutputsTangentNormals=function(){return this._iNormalMethodVO.method.iOutputsTangentNormals()},t.prototype._pOutputsNormals=function(){return this._iNormalMethodVO&&this._iNormalMethodVO.useMethod},t.prototype._iGetNormalVertexCode=function(e,t,i){return this._iNormalMethodVO.method.iGetVertexCode(e,this._iNormalMethodVO,t,i)},t.prototype._iGetNormalFragmentCode=function(e,t,i){var s=this._iNormalMethodVO.method.iGetFragmentCode(e,this._iNormalMethodVO,i.normalFragment,t,i);return this._iNormalMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment),(this._iNormalMethodVO.needsGlobalFragmentPos||this._iNormalMethodVO.needsGlobalVertexPos)&&t.removeVertexTempUsage(i.globalPositionVertex),s},t.prototype._iGetVertexCode=function(e,t,i){for(var s,a="",r=this._iMethodVOs.length,n=r-this._numEffectDependencies;r>n;n++)s=this._iMethodVOs[n],s.useMethod&&(a+=s.method.iGetVertexCode(e,s,t,i),(s.needsGlobalVertexPos||s.needsGlobalFragmentPos)&&t.removeVertexTempUsage(i.globalPositionVertex));return this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod&&(a+=this._iColorTransformMethodVO.method.iGetVertexCode(e,this._iColorTransformMethodVO,t,i)),a},t.prototype._iGetFragmentCode=function(e,t,i){var s,a="";this.preserveAlpha&&this._numEffectDependencies>0&&(s=t.getFreeFragmentSingleTemp(),t.addFragmentTempUsages(s,1),a+="mov "+s+", "+i.shadedTarget+".w\n");for(var r,n=this._iMethodVOs.length,o=n-this._numEffectDependencies;n>o;o++)r=this._iMethodVOs[o],r.useMethod&&(a+=r.method.iGetFragmentCode(e,r,i.shadedTarget,t,i),r.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),r.needsView&&t.removeFragmentTempUsage(i.viewDirFragment));return this.preserveAlpha&&this._numEffectDependencies>0&&(a+="mov "+i.shadedTarget+".w, "+s+"\n",t.removeFragmentTempUsage(s)),this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod&&(a+=this._iColorTransformMethodVO.method.iGetFragmentCode(e,this._iColorTransformMethodVO,i.shadedTarget,t,i)),a},t.prototype._iUsesShadows=function(){return Boolean(this._iShadowMethodVO||this.lightPicker.castingDirectionalLights.length>0||this.lightPicker.castingPointLights.length>0)},t.prototype._iUsesSpecular=function(){return Boolean(this._iSpecularMethodVO)},t}(l);t.exports=p},{"awayjs-stagegl/lib/events/ShadingMethodEvent":void 0,"awayjs-stagegl/lib/materials/compilation/MethodVO":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderLightingObject":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderObjectBase":void 0,"awayjs-stagegl/lib/materials/methods/EffectColorTransformMethod":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassMode":void 0}],"awayjs-stagegl/lib/materials/utils/DefaultMaterialManager":[function(e,t){var i=e("awayjs-core/lib/base/BitmapData"),s=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/textures/BitmapTexture"),r=e("awayjs-stagegl/lib/materials/LineBasicMaterial"),n=e("awayjs-stagegl/lib/materials/TriangleBasicMaterial"),o=function(){function e(){}return e.getDefaultMaterial=function(t){return void 0===t&&(t=null),null!=t&&t.assetType==s.LINE_SUB_MESH?(e._defaultLineMaterial||e.createDefaultLineMaterial(),e._defaultLineMaterial):(e._defaultTriangleMaterial||e.createDefaultTriangleMaterial(),e._defaultTriangleMaterial)},e.getDefaultTexture=function(t){return void 0===t&&(t=null),e._defaultTexture||e.createDefaultTexture(),e._defaultTexture},e.createDefaultTexture=function(){e._defaultBitmapData=e.createCheckeredBitmapData(),e._defaultTexture=new a(e._defaultBitmapData,!0),e._defaultTexture.name="defaultTexture"},e.createCheckeredBitmapData=function(){var e,t,s=new i(8,8,!1,0);for(e=0;8>e;e++)for(t=0;8>t;t++)1&t^1&e&&s.setPixel(e,t,16777215);return s},e.createDefaultTriangleMaterial=function(){e._defaultTexture||e.createDefaultTexture(),e._defaultTriangleMaterial=new n(e._defaultTexture),e._defaultTriangleMaterial.mipmap=!1,e._defaultTriangleMaterial.smooth=!1,e._defaultTriangleMaterial.name="defaultTriangleMaterial"},e.createDefaultLineMaterial=function(){e._defaultLineMaterial=new r,e._defaultLineMaterial.name="defaultSegmentMaterial"},e}();t.exports=o},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/textures/BitmapTexture":void 0,"awayjs-stagegl/lib/materials/LineBasicMaterial":void 0,"awayjs-stagegl/lib/materials/TriangleBasicMaterial":void 0}],"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":[function(e,t){var i=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),s=function(){function e(){}return e.getTex2DSampleCode=function(t,i,s,a,r,n,o,l,h){void 0===l&&(l=null),void 0===h&&(h=null);var p=h||(n?"wrap":"clamp"),u=e.getFormatStringForTexture(a),d=o&&a.hasMipmaps,g=r?d?"linear,miplinear":"linear":d?"nearest,mipnearest":"nearest";return null==l&&(l=i.uvVarying),"tex "+t+", "+l+", "+s+" <2d,"+g+","+u+p+">\n"},e.getTexCubeSampleCode=function(t,i,s,a,r,n){var o,l=e.getFormatStringForTexture(s),h=r&&s.hasMipmaps,o=a?h?"linear,miplinear":"linear":h?"nearest,mipnearest":"nearest";return"tex "+t+", "+n+", "+i+" <cube,"+l+o+">\n"},e.getFormatStringForTexture=function(e){switch(e.format){case i.COMPRESSED:return"dxt1,";case i.COMPRESSED_ALPHA:return"dxt5,";default:return""}},e}();t.exports=s},{"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0}],"awayjs-stagegl/lib/pool/BillboardRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/pool/RenderableBase"),r=function(e){function t(t,i){e.call(this,t,i,i),this._billboard=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=this._billboard.material,i=t._materialGeometry[e.id];return i?i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0)):(i=t._materialGeometry[e.id]=new s(!0),i.autoDeriveNormals=!1,i.autoDeriveTangents=!1,i.updateIndices(Array(0,1,2,0,2,3)),i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0)),i.updateVertexNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0)),i.updateVertexTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i.updateUVs(Array(0,0,1,0,1,1,0,1))),this._pVertexDataDirty[s.POSITION_DATA]=!0,this._pVertexDataDirty[s.NORMAL_DATA]=!0,this._pVertexDataDirty[s.TANGENT_DATA]=!0,this._pVertexDataDirty[s.UV_DATA]=!0,i},t._materialGeometry=new Object,t.id="billboard",t}(a);t.exports=r},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/pool/RenderableBase":void 0}],"awayjs-stagegl/lib/pool/IndexDataPool":[function(e,t){var i=e("awayjs-stagegl/lib/pool/IndexData"),s=function(){function e(){}return e.getItem=function(t,s,a){var r=e._pool[t.id]||(e._pool[t.id]=new Array),n=r[s]||(r[s]=new i(s));return n.updateData(a,t.indices,t.numVertices),n},e.disposeItem=function(e,t){var i=this._pool[e];i[t].dispose(),i[t]=null},e.prototype.disposeData=function(t){for(var i=e._pool[t],s=i.length,a=0;s>a;a++)i[a].dispose(),i[a]=null;e._pool[t]=null},e._pool=new Object,e}();t.exports=s},{"awayjs-stagegl/lib/pool/IndexData":void 0}],"awayjs-stagegl/lib/pool/IndexData":[function(e,t){var i=function(){function e(e){this._dataDirty=!0,this.invalid=new Array(8),this.contexts=new Array(8),this.buffers=new Array(8),this.level=e}return e.prototype.updateData=function(t,i,s){if(this._dataDirty)if(this._dataDirty=!1,i.length<e.LIMIT_INDICES&&s<e.LIMIT_VERTS)this.indexMappings=null,this.originalIndices=null,this.setData(i),this.offset=i.length;else{var a,r,n,o,l,h=new Array;for(this.indexMappings=new Array(i.length),this.originalIndices=new Array,a=this.indexMappings.length;a--;)this.indexMappings[a]=-1;var p,u;for(n=0,r=i.length,a=t,l=0;r>a&&n+3<e.LIMIT_INDICES&&l+3<e.LIMIT_VERTS;){for(o=0;3>o;o++)p=i[a+o],this.indexMappings[p]>=0?u=this.indexMappings[p]:(u=l++,this.indexMappings[p]=u,this.originalIndices.push(p)),h[n+o]=u;n+=3,a+=3}this.setData(h),this.offset=a}},e.prototype.invalidateData=function(){this._dataDirty=!0},e.prototype.dispose=function(){for(var e=0;8>e;++e)this.contexts[e]&&(this.contexts[e].disposeIndexData(this),this.contexts[e]=null)},e.prototype.disposeBuffers=function(){for(var e=0;8>e;++e)this.buffers[e]&&(this.buffers[e].dispose(),this.buffers[e]=null)},e.prototype.invalidateBuffers=function(){for(var e=0;8>e;++e)this.invalid[e]=!0},e.prototype.setData=function(e){this.data&&this.data.length!=e.length?this.disposeBuffers():this.invalidateBuffers(),this.data=e},e.LIMIT_VERTS=65535,e.LIMIT_INDICES=16777215,e}();t.exports=i},{}],"awayjs-stagegl/lib/pool/LineSubMeshRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/base/LineSubGeometry"),a=e("awayjs-stagegl/lib/pool/RenderableBase"),r=function(e){function t(t,i,s,a){void 0===s&&(s=0),void 0===a&&(a=0),e.call(this,t,i.parentMesh,i,s,a),this.subMesh=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=this.subMesh.subGeometry;return this._pVertexDataDirty[s.START_POSITION_DATA]=!0,this._pVertexDataDirty[s.END_POSITION_DATA]=!0,e.thickness&&(this._pVertexDataDirty[s.THICKNESS_DATA]=!0),e.startColors&&(this._pVertexDataDirty[s.COLOR_DATA]=!0),e},t.prototype._pGetOverflowRenderable=function(e,i,s,a){return new t(e,i,s,a)},t.id="linesubmesh",t}(a);t.exports=r},{"awayjs-display/lib/base/LineSubGeometry":void 0,"awayjs-stagegl/lib/pool/RenderableBase":void 0}],"awayjs-stagegl/lib/pool/MaterialDataPool":[function(e,t){var i=e("awayjs-stagegl/lib/pool/MaterialData"),s=function(){function e(e){this._pool=new Object,this._context=e}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=e._iAddMaterialData(new i(this,this._context,e)))},e.prototype.disposeItem=function(e){e._iRemoveMaterialData(this._pool[e.id]),this._pool[e.id]=null},e}();t.exports=s},{"awayjs-stagegl/lib/pool/MaterialData":void 0}],"awayjs-stagegl/lib/pool/MaterialData":[function(e,t){var i=e("awayjs-stagegl/lib/pool/MaterialPassDataPool"),s=function(){function e(e,t,s){this.invalidAnimation=!0,this._pool=e,this.context=t,this.material=s,this._materialPassDataPool=new i(s)}return e.prototype.getMaterialPass=function(e,t){var i=this._materialPassDataPool.getItem(e);if(i.shaderObject||(i.shaderObject=e.createShaderObject(t),i.invalid=!0),i.invalid){i.invalid=!1;var s=i.shaderObject.createCompiler(this.material,e);s.compile(),i.shadedTarget=s.shadedTarget,i.vertexCode=s.vertexCode,i.fragmentCode=s.fragmentCode,i.postAnimationFragmentCode=s.postAnimationFragmentCode,i.key=""}return i},e.prototype.getMaterialPasses=function(e){if(null==this._passes){var t=this.material._iScreenPasses,i=t.length;this._passes=new Array(i);for(var s=0;i>s;s++)this._passes[s]=this.getMaterialPass(t[s],e)}return this._passes},e.prototype.dispose=function(){this._materialPassDataPool.disposePool(),this._materialPassDataPool=null,this._pool.disposeItem(this.material),this._passes=null},e.prototype.invalidateMaterial=function(){this._passes=null,this.invalidateAnimation()},e.prototype.invalidateAnimation=function(){this.invalidAnimation=!0},e}();t.exports=s},{"awayjs-stagegl/lib/pool/MaterialPassDataPool":void 0}],"awayjs-stagegl/lib/pool/MaterialPassDataPool":[function(e,t){var i=e("awayjs-stagegl/lib/pool/MaterialPassData"),s=function(){function e(e){this._pool=new Object,this._material=e}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=this._material._iAddMaterialPassData(e._iAddMaterialPassData(new i(this,this._material,e))))},e.prototype.disposeItem=function(e){e._iRemoveMaterialPassData(this._pool[e.id]),delete this._pool[e.id]},e.prototype.disposePool=function(){for(var e in this._pool)this._pool[e].materialPass._iRemoveMaterialPassData(this._pool[e]);delete this._pool},e}();t.exports=s},{"awayjs-stagegl/lib/pool/MaterialPassData":void 0}],"awayjs-stagegl/lib/pool/MaterialPassData":[function(e,t){var i=function(){function e(e,t,i){this.animationVertexCode="",this.animationFragmentCode="",this._pool=e,this.material=t,this.materialPass=i}return e.prototype.dispose=function(){this._pool.disposeItem(this.materialPass),this.shaderObject.dispose(),this.shaderObject=null,this.programData.dispose(),this.programData=null},e.prototype.invalidate=function(){this.invalid=!0},e}();t.exports=i},{}],"awayjs-stagegl/lib/pool/ProgramDataPool":[function(e,t){var i=e("awayjs-stagegl/lib/pool/ProgramData"),s=function(){function e(e){this._pool=new Object,this._context=e}return e.prototype.getItem=function(e){return this._pool[e]||(this._pool[e]=new i(this,this._context,e))},e.prototype.disposeItem=function(e){this._pool[e]=null},e}();t.exports=s},{"awayjs-stagegl/lib/pool/ProgramData":void 0}],"awayjs-stagegl/lib/pool/ProgramData":[function(e,t){var i=function(){function e(e,t,i){this.usages=0,this._pool=e,this.context=t,this._key=i,this.context.registerProgram(this)}return e.prototype.dispose=function(){this.usages--,this.usages||(this._pool.disposeItem(this._key),this.context.unRegisterProgram(this),this.program&&this.program.dispose()),this.program=null},e.PROGRAMDATA_ID_COUNT=0,e}();t.exports=i},{}],"awayjs-stagegl/lib/pool/RenderableBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-display/lib/base/SubGeometryBase"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),r=e("awayjs-display/lib/events/SubGeometryEvent"),n=e("awayjs-stagegl/lib/pool/IndexDataPool"),o=e("awayjs-stagegl/lib/pool/VertexDataPool"),l=function(){function e(e,t,i,s,a){var r=this;void 0===s&&(s=0),void 0===a&&(a=0),this._geometryDirty=!0,this._indexDataDirty=!0,this._vertexData=new Object,this._pVertexDataDirty=new Object,this._vertexOffset=new Object,this._onIndicesUpdatedDelegate=function(e){return r._onIndicesUpdated(e)},this._onVerticesUpdatedDelegate=function(e){return r._onVerticesUpdated(e)},this._pool=e,this._level=s,this._indexOffset=a,this.sourceEntity=t,this.materialOwner=i}return Object.defineProperty(e.prototype,"overflow",{get:function(){return this._indexDataDirty&&this._updateIndexData(),this._overflow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:!0,configurable:!0}),e.prototype.getIndexData=function(){return this._indexDataDirty&&this._updateIndexData(),this._indexData},e.prototype.getVertexData=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexData[this._concatenateArrays?a.VERTEX_DATA:e]},e.prototype.getVertexOffset=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexOffset[e]},e.prototype.dispose=function(){this._pool.disposeItem(this.materialOwner),this._indexData.dispose(),this._indexData=null;for(var e in this._vertexData)this._vertexData[e].dispose(),this._vertexData[e]=null;this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype.invalidateGeometry=function(){this._geometryDirty=!0,0==this._level&&(this._indexDataDirty=!0),this._overflow&&this._overflow.invalidateGeometry()},e.prototype.invalidateIndexData=function(){this._indexDataDirty=!0},e.prototype.invalidateVertexData=function(e){this._pVertexDataDirty[e]=!0},e.prototype._pGetSubGeometry=function(){throw new i},e.prototype._iFillIndexData=function(e){this._geometryDirty&&this._updateGeometry(),this._indexData=n.getItem(this._subGeometry,this._level,e),this._numTriangles=this._indexData.data.length/3,e=this._indexData.offset,e<this._subGeometry.indices.length?(this._overflow||(this._overflow=this._pGetOverflowRenderable(this._pool,this.materialOwner,e,this._level+1)),this._overflow._iFillIndexData(e)):this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype._pGetOverflowRenderable=function(){throw new i},e.prototype._updateGeometry=function(){this._subGeometry&&(0==this._level&&this._subGeometry.removeEventListener(r.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.removeEventListener(r.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._subGeometry=this._pGetSubGeometry(),this._concatenateArrays=this._subGeometry.concatenateArrays,this._subGeometry&&(0==this._level&&this._subGeometry.addEventListener(r.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.addEventListener(r.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._geometryDirty=!1},e.prototype._updateIndexData=function(){this._iFillIndexData(this._indexOffset),this._indexDataDirty=!1},e.prototype._updateVertexData=function(e){this._vertexOffset[e]=this._subGeometry.getOffset(e),this._subGeometry.concatenateArrays&&(e=s.VERTEX_DATA),this._vertexData[e]=o.getItem(this._subGeometry,this.getIndexData(),e),this._pVertexDataDirty[e]=!1},e.prototype._onIndicesUpdated=function(){this.invalidateIndexData()},e.prototype._onVerticesUpdated=function(e){this._concatenateArrays=e.target.concatenateArrays,this.invalidateVertexData(e.dataType)},e}();t.exports=l},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-display/lib/base/SubGeometryBase":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0,"awayjs-stagegl/lib/pool/IndexDataPool":void 0,"awayjs-stagegl/lib/pool/VertexDataPool":void 0}],"awayjs-stagegl/lib/pool/SkyboxRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/pool/RenderableBase"),r=function(e){function t(t,i){e.call(this,t,i,i)}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=t._geometry;return e||(e=t._geometry=new s(!0),e.autoDeriveNormals=!1,e.autoDeriveTangents=!1,e.updateIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2)),e.updatePositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1))),this._pVertexDataDirty[s.POSITION_DATA]=!0,e},t.id="skybox",t}(a);t.exports=r},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/pool/RenderableBase":void 0}],"awayjs-stagegl/lib/pool/TextureDataPool":[function(e,t){var i=e("awayjs-stagegl/lib/pool/TextureData"),s=function(){function e(e){this._pool=new Object,this._context=e}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=e._iAddTextureData(new i(this,this._context,e)))},e.prototype.disposeItem=function(e){e._iRemoveTextureData(this._pool[e.id]),this._pool[e.id]=null},e}();t.exports=s},{"awayjs-stagegl/lib/pool/TextureData":void 0}],"awayjs-stagegl/lib/pool/TextureData":[function(e,t){var i=function(){function e(e,t,i){this._pool=e,this.context=t,this.textureProxy=i}return e.prototype.dispose=function(){this._pool.disposeItem(this.textureProxy),this.texture.dispose(),this.texture=null},e.prototype.invalidate=function(){this.invalid=!0},e}();t.exports=i},{}],"awayjs-stagegl/lib/pool/TriangleSubMeshRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/pool/RenderableBase"),r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),n=function(e){function t(t,i,s,a){void 0===s&&(s=0),void 0===a&&(a=0),e.call(this,t,i.parentMesh,i,s,a),this.subMesh=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e;switch(e=this.subMesh.animator?this.subMesh.animator.getRenderableSubGeometry(this,this.subMesh.subGeometry):this.subMesh.subGeometry,this._pVertexDataDirty[s.POSITION_DATA]=!0,e.vertexNormals&&(this._pVertexDataDirty[s.NORMAL_DATA]=!0),e.vertexTangents&&(this._pVertexDataDirty[s.TANGENT_DATA]=!0),e.uvs&&(this._pVertexDataDirty[s.UV_DATA]=!0),e.secondaryUVs&&(this._pVertexDataDirty[s.SECONDARY_UV_DATA]=!0),e.jointIndices&&(this._pVertexDataDirty[s.JOINT_INDEX_DATA]=!0),e.jointWeights&&(this._pVertexDataDirty[s.JOINT_WEIGHT_DATA]=!0),e.jointsPerVertex){case 1:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=r.FLOAT_1;break;case 2:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=r.FLOAT_2;break;case 3:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=r.FLOAT_3;break;case 4:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=r.FLOAT_4}return e},t.prototype._pGetOverflowRenderable=function(e,i,s,a){return new t(e,i,s,a)},t.id="trianglesubmesh",t}(a);t.exports=n},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0,"awayjs-stagegl/lib/pool/RenderableBase":void 0}],"awayjs-stagegl/lib/pool/VertexDataPool":[function(e,t){var i=e("awayjs-display/lib/base/SubGeometryBase"),s=e("awayjs-stagegl/lib/pool/VertexData"),a=function(){function e(){}return e.getItem=function(t,a,r){t.concatenateArrays&&(r=i.VERTEX_DATA);var n=e._pool[t.id]||(e._pool[t.id]=new Object),o=n[r]||(n[r]=new Array),l=o[a.level]||(o[a.level]=new s(t,r));return l.updateData(a.originalIndices,a.indexMappings),l},e.disposeItem=function(t,i,s){var a=e._pool[t.id],r=a[s];r[i].dispose(),r[i]=null},e.prototype.disposeData=function(t){var i=e._pool[t.id];for(var s in i)for(var a=i[s],r=a.length,n=0;r>n;n++)a[n].dispose(),a[n]=null;e._pool[t.id]=null},e._pool=new Object,e}();t.exports=a},{"awayjs-display/lib/base/SubGeometryBase":void 0,"awayjs-stagegl/lib/pool/VertexData":void 0}],"awayjs-stagegl/lib/pool/VertexData":[function(e,t){var i=e("awayjs-display/lib/base/SubGeometryBase"),s=e("awayjs-display/lib/events/SubGeometryEvent"),a=function(){function e(e,t){var i=this;this._dataDirty=!0,this.invalid=new Array(8),this.buffers=new Array(8),this.contexts=new Array(8),this._subGeometry=e,this._dataType=t,this._onVerticesUpdatedDelegate=function(e){return i._onVerticesUpdated(e)},this._subGeometry.addEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)}return e.prototype.updateData=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),this._dataDirty){this._dataDirty=!1,this.dataPerVertex=this._subGeometry.getStride(this._dataType);var i=this._subGeometry[this._dataType];if(null==t)this.setData(i);else{for(var s,a,r=new Array(e.length*this.dataPerVertex),n=0,o=0;n<e.length;){for(s=e[n],a=t[s]*this.dataPerVertex,s*=this.dataPerVertex,o=0;o<this.dataPerVertex;o++)r[a+o]=i[s+o];n++}this.setData(r)}}},e.prototype.dispose=function(){for(var e=0;8>e;++e)this.contexts[e]&&(this.contexts[e].disposeVertexData(this),this.contexts[e]=null)},e.prototype.disposeBuffers=function(){for(var e=0;8>e;++e)this.buffers[e]&&(this.buffers[e].dispose(),this.buffers[e]=null)},e.prototype.invalidateBuffers=function(){for(var e=0;8>e;++e)this.invalid[e]=!0},e.prototype.setData=function(e){this.data&&this.data.length!=e.length?this.disposeBuffers():this.invalidateBuffers(),this.data=e},e.prototype._onVerticesUpdated=function(e){var t=this._subGeometry.concatenateArrays?i.VERTEX_DATA:e.dataType;t==this._dataType&&(this._dataDirty=!0)},e}();t.exports=a},{"awayjs-display/lib/base/SubGeometryBase":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0}],"awayjs-stagegl/lib/render/DefaultRenderer":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),r=e("awayjs-core/lib/textures/RenderTexture"),n=e("awayjs-display/lib/pool/RenderablePool"),o=e("awayjs-stagegl/lib/pool/SkyboxRenderable"),l=e("awayjs-stagegl/lib/render/DepthRenderer"),h=e("awayjs-stagegl/lib/render/Filter3DRenderer"),p=e("awayjs-stagegl/lib/render/RendererBase"),u=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),d=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),g=e("awayjs-stagegl/lib/base/ContextGLClearMask"),c=e("awayjs-stagegl/lib/managers/RTTBufferManager"),_=e("awayjs-stagegl/lib/managers/StageManager"),f=e("awayjs-stagegl/lib/materials/passes/DepthMapPass"),m=e("awayjs-stagegl/lib/materials/passes/DistanceMapPass"),y=function(e){function t(t,i,a){void 0===t&&(t=!1),void 0===i&&(i="baseline"),void 0===a&&(a="auto"),e.call(this),this._skyboxProjection=new s,this._skyboxRenderablePool=n.getPool(o),this._pDepthRenderer=new l(new f),this._pDistanceRenderer=new l(new m),null==this._pStage&&(this.stage=_.getInstance().getFreeStage(t,i,a)),this._pRttBufferManager=c.getInstance(this._pStage),0==this._width?this.width=window.innerWidth:this._pRttBufferManager.viewWidth=this._width,0==this._height?this.height=window.innerHeight:this._pRttBufferManager.viewHeight=this._height}return i(t,e),Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){this._antiAlias!=e&&(this._antiAlias=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(e){this._depthPrepass=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(e){e&&0==e.length&&(e=null),this._pFilter3DRenderer&&!e?(this._pFilter3DRenderer.dispose(),this._pFilter3DRenderer=null):!this._pFilter3DRenderer&&e&&(this._pFilter3DRenderer=new h(this._pStage),this._pFilter3DRenderer.filters=e),this._pFilter3DRenderer?(this._pFilter3DRenderer.filters=e,this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender):(this._pRequireDepthRender=!1,this._pDepthRender&&(this._pDepthRender.dispose(),this._pDepthRender=null))},enumerable:!0,configurable:!0}),t.prototype.render=function(t){return e.prototype.render.call(this,t),this._pStage.recoverFromDisposal()?(this._pBackBufferInvalid&&this.pUpdateBackBuffer(),this._shareContext&&this._pContext&&this._pContext.clear(0,0,0,1,1,0,g.DEPTH),this._pFilter3DRenderer?(this.textureRatioX=this._pRttBufferManager.textureRatioX,this.textureRatioY=this._pRttBufferManager.textureRatioY):(this.textureRatioX=1,this.textureRatioY=1),this._pRequireDepthRender&&this.pRenderSceneDepthToTexture(t),this._depthPrepass&&this.pRenderDepthPrepass(t),this._pFilter3DRenderer&&this._pContext||(this._shareContext?this._iRender(t,null,this._pScissorRect):this._iRender(t)),e.prototype.render.call(this,t),!this._shareContext&&this._pContext&&this._pContext.present(),void(this._pStage.bufferClear=!1)):void(this._pBackBufferInvalid=!0)},t.prototype.pExecuteRender=function(t,i,s,a){void 0===i&&(i=null),void 0===s&&(s=null),void 0===a&&(a=0),this.updateLights(t),i&&(this.pCollectRenderables(t),this.drawRenderables(this._pOpaqueRenderableHead,t),this.drawRenderables(this._pBlendedRenderableHead,t)),e.prototype.pExecuteRender.call(this,t,i,s,a)},t.prototype.updateLights=function(e){var t,i,s,a,r=e.directionalLights,n=e.pointLights;for(t=r.length,i=0;t>i;++i)s=r[i],a=s.shadowMapper,s.castsShadows&&(a.autoUpdateShadows||a._iShadowsInvalid)&&a.iRenderDepthMap(e,this._pDepthRenderer);for(t=n.length,i=0;t>i;++i)s=n[i],a=s.shadowMapper,s.castsShadows&&(a.autoUpdateShadows||a._iShadowsInvalid)&&a.iRenderDepthMap(e,this._pDistanceRenderer)},t.prototype.pDraw=function(e,t){t||this.pCollectRenderables(e),this._pContext.setBlendFactors(u.ONE,u.ZERO),e.skyBox&&(this._pContext.setDepthTest(!1,d.ALWAYS),this.drawSkybox(e)),this._pContext.setDepthTest(!0,d.LESS_EQUAL),this.drawRenderables(this._pOpaqueRenderableHead,e),this.drawRenderables(this._pBlendedRenderableHead,e)},t.prototype.drawSkybox=function(e){var t=this._skyboxRenderablePool.getItem(e.skyBox),i=e.skyBox.material,s=e.camera;this.updateSkyboxProjection(s);var a=this._pStage.context.getMaterial(i,this._pStage.profile).getMaterialPass(i._iScreenPasses[0],this._pStage.profile);i._iActivatePass(a,this._pStage,s),i._iRenderPass(a,t,this._pStage,s,this._skyboxProjection),i._iDeactivatePass(a,this._pStage)},t.prototype.updateSkyboxProjection=function(e){var t=new a;this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix),this._skyboxProjection.copyRowTo(2,t);var i=e.scenePosition,s=t.x,r=t.y,n=t.z,o=-(t.x*i.x+t.y*i.y+t.z*i.z+Math.sqrt(s*s+r*r+n*n)),l=s>=0?1:-1,h=r>=0?1:-1,p=new a(l,h,1,1),u=this._skyboxProjection.clone();u.invert();var d=u.transformVector(p);this._skyboxProjection.copyRowTo(3,p);var g=(d.x*p.x+d.y*p.y+d.z*p.z+d.w*p.w)/(s*d.x+r*d.y+n*d.z+o*d.w);this._skyboxProjection.copyRowFrom(2,new a(s*g,r*g,n*g,o*g))},t.prototype.drawRenderables=function(e,t){for(var i,s,a,r,n,o,l=this._pStage.context,h=t.camera;e;){for(n=l.getMaterial(e.material,this._pStage.profile),a=e.material._iScreenPasses,s=e.material._iNumScreenPasses(),i=0;s>i;i++){o=e,r=n.getMaterialPass(a[i],this._pStage.profile),e.material._iActivatePass(r,this._pStage,h);do e.material._iRenderPass(r,o,this._pStage,h,this._pRttViewProjectionMatrix),o=o.next;while(o&&o.material==e.material);n.material._iDeactivatePass(r,this._pStage)}e=o}},t.prototype.dispose=function(){this._shareContext||this._pStage.dispose(),this._pDepthRenderer.dispose(),this._pDistanceRenderer.dispose(),this._pDepthRenderer=null,this._pDistanceRenderer=null,this._pDepthRender=null,e.prototype.dispose.call(this)},t.prototype.pRenderDepthPrepass=function(e){this._pDepthRenderer.disableColor=!0,this._pFilter3DRenderer||(this._pDepthRenderer.textureRatioX=1,this._pDepthRenderer.textureRatioY=1,this._pDepthRenderer._iRender(e)),this._pDepthRenderer.disableColor=!1},t.prototype.pRenderSceneDepthToTexture=function(e){(this._pDepthTextureInvalid||!this._pDepthRender)&&this.initDepthTexture(this._pStage.context),this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX,this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY,this._pDepthRenderer._iRender(e,this._pDepthRender)},t.prototype.pUpdateBackBuffer=function(){this._pStage.context&&!this._shareContext&&this._width&&this._height&&(this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,!0),this._pBackBufferInvalid=!1)},t.prototype.iSetStage=function(t){e.prototype.iSetStage.call(this,t),this._pDistanceRenderer.iSetStage(t),this._pDepthRenderer.iSetStage(t)},t.prototype.initDepthTexture=function(){this._pDepthTextureInvalid=!1,this._pDepthRender&&this._pDepthRender.dispose(),this._pDepthRender=new r(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)},t}(p);t.exports=y},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/managers/RTTBufferManager":void 0,"awayjs-stagegl/lib/managers/StageManager":void 0,"awayjs-stagegl/lib/materials/passes/DepthMapPass":void 0,"awayjs-stagegl/lib/materials/passes/DistanceMapPass":void 0,"awayjs-stagegl/lib/pool/SkyboxRenderable":void 0,"awayjs-stagegl/lib/render/DepthRenderer":void 0,"awayjs-stagegl/lib/render/Filter3DRenderer":void 0,"awayjs-stagegl/lib/render/RendererBase":void 0}],"awayjs-stagegl/lib/render/DepthRenderer":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e
}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-stagegl/lib/render/RendererBase"),a=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),r=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),n=function(e){function t(t,i){void 0===i&&(i=!1),e.call(this),this._pass=t,this._renderBlended=i,this._iBackgroundR=1,this._iBackgroundG=1,this._iBackgroundB=1}return i(t,e),Object.defineProperty(t.prototype,"disableColor",{get:function(){return this._disableColor},set:function(e){this._disableColor=e},enumerable:!0,configurable:!0}),t.prototype._iRenderCascades=function(e,t,i,s,n){this.pCollectRenderables(e),this._pContext.setRenderTarget(t,!0,0),this._pContext.clear(1,1,1,1,1,0),this._pContext.setBlendFactors(a.ONE,a.ZERO),this._pContext.setDepthTest(!0,r.LESS);for(var o=this._pOpaqueRenderableHead,l=!0,h=i-1;h>=0;--h)this._pStage.scissorRect=s[h],this.drawCascadeRenderables(o,n[h],l?null:n[h].frustumPlanes),l=!1;this._pContext.setDepthTest(!1,r.LESS_EQUAL),this._pStage.scissorRect=null},t.prototype.drawCascadeRenderables=function(e,t,i){for(var s,a,r,n=this._pStage.context;e;){a=n.getMaterial(e.material,this._pStage.profile),r=e,s=a.getMaterialPass(this._pass,this._pStage.profile),""==s.key&&this._pContext.calcAnimationCode(e.material,s),e.material._iActivatePass(s,this._pStage,t);do!i||r.sourceEntity.worldBounds.isInFrustum(i,4)?r.material._iRenderPass(s,r,this._pStage,t,this._pRttViewProjectionMatrix):r.cascaded=!0,r=r.next;while(r&&r.material==e.material&&!r.cascaded);e.material._iDeactivatePass(s,this._pStage),e=r}},t.prototype.pDraw=function(e){this.pCollectRenderables(e),this._pContext.setBlendFactors(a.ONE,a.ZERO),this._pContext.setDepthTest(!0,r.LESS),this.drawRenderables(this._pOpaqueRenderableHead,e),this._disableColor&&this._pContext.setColorMask(!1,!1,!1,!1),this._renderBlended&&this.drawRenderables(this._pBlendedRenderableHead,e),this._disableColor&&this._pContext.setColorMask(!0,!0,!0,!0)},t.prototype.drawRenderables=function(e,t){for(var i,s,a,r=this._pStage.context,n=t.camera;e;){if(s=r.getMaterial(e.material,this._pStage.profile),this._disableColor&&0!=e.material.alphaThreshold){a=e;do a=a.next;while(a&&a.material==e.material)}else{a=e,i=s.getMaterialPass(this._pass,this._pStage.profile),""==i.key&&this._pContext.calcAnimationCode(e.material,i),e.material._iActivatePass(i,this._pStage,n);do a.material._iRenderPass(i,a,this._pStage,n,this._pRttViewProjectionMatrix),a=a.next;while(a&&a.material==e.material);e.material._iDeactivatePass(i,this._pStage)}e=a}},t}(s);t.exports=n},{"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/render/RendererBase":void 0}],"awayjs-stagegl/lib/render/Filter3DRenderer":[function(e,t){var i=e("awayjs-core/lib/events/Event"),s=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),r=e("awayjs-stagegl/lib/managers/RTTBufferManager"),n=function(){function e(e){var t=this;this._filterSizesInvalid=!0,this._onRTTResizeDelegate=function(e){return t.onRTTResize(e)},this._stage=e,this._rttManager=r.getInstance(e),this._rttManager.addEventListener(i.RESIZE,this._onRTTResizeDelegate)}return e.prototype.onRTTResize=function(){this._filterSizesInvalid=!0},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._filterTasksInvalid&&this.updateFilterTasks(e),this._mainInputTexture},Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){if(this._filters=e,this._filterTasksInvalid=!0,this._requireDepthRender=!1,this._filters){for(var t=0;t<this._filters.length;++t){var i=this._filters[t],s=null==i.requireDepthRender?!1:i.requireDepthRender;this._requireDepthRender=this._requireDepthRender||s}this._filterSizesInvalid=!0}},enumerable:!0,configurable:!0}),e.prototype.updateFilterTasks=function(e){var t;if(this._filterSizesInvalid&&this.updateFilterSizes(),!this._filters)return void(this._tasks=null);this._tasks=new Array,t=this._filters.length-1;for(var i,s=0;t>=s;++s)i=this._filters[s],i.setRenderTargets(s==t?null:this._filters[s+1].getMainInputTexture(e),e),this._tasks=this._tasks.concat(i.tasks);this._mainInputTexture=this._filters[0].getMainInputTexture(e)},e.prototype.render=function(e,t,i){var r,n,o,l=e.context,h=this._rttManager.indexBuffer,p=this._rttManager.renderToTextureVertexBuffer;if(this._filters){for(this._filterSizesInvalid&&this.updateFilterSizes(),this._filterTasksInvalid&&this.updateFilterTasks(e),r=this._filters.length,n=0;r>n;++n)this._filters[n].update(e,t);for(r=this._tasks.length,r>1&&(l.setVertexBufferAt(0,p,0,a.FLOAT_2),l.setVertexBufferAt(1,p,2,a.FLOAT_2)),n=0;r>n;++n)o=this._tasks[n],o.target||(e.scissorRect=null,p=this._rttManager.renderToScreenVertexBuffer,l.setVertexBufferAt(0,p,0,a.FLOAT_2),l.setVertexBufferAt(1,p,2,a.FLOAT_2)),l.setTextureAt(0,o.getMainInputTexture(e)),l.setProgram(o.getProgram(e)),l.clear(0,0,0,0),o.activate(e,t,i),l.setBlendFactors(s.ONE,s.ZERO),l.drawTriangles(h,0,2),o.deactivate(e);l.setTextureAt(0,null),l.setVertexBufferAt(0,null),l.setVertexBufferAt(1,null)}},e.prototype.updateFilterSizes=function(){for(var e=0;e<this._filters.length;++e)this._filters[e].textureWidth=this._rttManager.textureWidth,this._filters[e].textureHeight=this._rttManager.textureHeight;this._filterSizesInvalid=!0},e.prototype.dispose=function(){this._rttManager.removeEventListener(i.RESIZE,this._onRTTResizeDelegate),this._rttManager=null,this._stage=null},e}();t.exports=n},{"awayjs-core/lib/events/Event":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0,"awayjs-stagegl/lib/managers/RTTBufferManager":void 0}],"awayjs-stagegl/lib/render/RendererBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},s=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Rectangle"),n=e("awayjs-core/lib/errors/AbstractMethodError"),o=e("awayjs-core/lib/events/EventDispatcher"),l=e("awayjs-display/lib/pool/RenderablePool"),h=e("awayjs-display/lib/sort/RenderableMergeSort"),p=e("awayjs-display/lib/events/RendererEvent"),u=e("awayjs-display/lib/events/StageEvent"),d=e("awayjs-display/lib/traverse/EntityCollector"),g=e("awayjs-stagegl/lib/pool/BillboardRenderable"),c=e("awayjs-stagegl/lib/pool/LineSubMeshRenderable"),_=e("awayjs-stagegl/lib/pool/TriangleSubMeshRenderable"),f=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),m=e("awayjs-stagegl/lib/materials/utils/DefaultMaterialManager"),y=function(e){function t(){var t=this;e.call(this),this._viewPort=new r,this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this._depthPrepass=!1,this._backgroundR=0,this._backgroundG=0,this._backgroundB=0,this._backgroundAlpha=1,this._shareContext=!1,this.textureRatioX=1,this.textureRatioY=1,this._pRttViewProjectionMatrix=new s,this._localPos=new a,this._globalPos=new a,this._pScissorRect=new r,this._pNumTriangles=0,this._onViewportUpdatedDelegate=function(e){return t.onViewportUpdated(e)},this._billboardRenderablePool=l.getPool(g),this._triangleSubMeshRenderablePool=l.getPool(_),this._lineSubMeshRenderablePool=l.getPool(c),this._onContextUpdateDelegate=function(e){return t.onContextUpdate(e)},this.renderableSorter=new h}return i(t,e),Object.defineProperty(t.prototype,"numTriangles",{get:function(){return this._pNumTriangles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._localPos.x},set:function(e){this.x!=e&&(this._globalPos.x=this._localPos.x=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._localPos.y},set:function(e){this.y!=e&&(this._globalPos.y=this._localPos.y=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width!=e&&(this._width=e,this._pScissorRect.width=e,this._pRttBufferManager&&(this._pRttBufferManager.viewWidth=e),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height!=e&&(this._height=e,this._pScissorRect.height=e,this._pRttBufferManager&&(this._pRttBufferManager.viewHeight=e),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),t.prototype._iCreateEntityCollector=function(){return new d},Object.defineProperty(t.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(e){this._backgroundR!=e&&(this._backgroundR=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(e){this._backgroundG!=e&&(this._backgroundG=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(e){this._backgroundB!=e&&(this._backgroundB=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stage",{get:function(){return this._pStage},set:function(e){e!=this._pStage&&this.iSetStage(e)},enumerable:!0,configurable:!0}),t.prototype.iSetStage=function(e){this._pStage&&(this._pStage.removeEventListener(u.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(u.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(u.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate)),e?(this._pStage=e,this._pStage.addEventListener(u.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(u.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(u.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage.context&&(this._pContext=this._pStage.context)):(this._pStage=null,this._pContext=null),this._pBackBufferInvalid=!0,this.updateGlobalPos()},Object.defineProperty(t.prototype,"shareContext",{get:function(){return this._shareContext},set:function(e){this._shareContext!=e&&(this._shareContext=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._pRttBufferManager&&this._pRttBufferManager.dispose(),this._pRttBufferManager=null,this._pStage.removeEventListener(u.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(u.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(u.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage=null},t.prototype.render=function(){this._viewportDirty=!1,this._scissorDirty=!1},t.prototype._iRender=function(e,t,i,s){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=0),this._pStage&&this._pContext){this._pRttViewProjectionMatrix.copyFrom(e.camera.viewProjection),this._pRttViewProjectionMatrix.appendScale(this.textureRatioX,this.textureRatioY,1),this.pExecuteRender(e,t,i,s);for(var a=0;8>a;++a)this._pContext.setVertexBufferAt(a,null),this._pContext.setTextureAt(a,null)}},t.prototype._iRenderCascades=function(){},t.prototype.pCollectRenderables=function(e){this._pBlendedRenderableHead=null,this._pOpaqueRenderableHead=null,this._pNumTriangles=0;var t=e.entityHead;for(this._pCamera=e.camera,this._iEntryPoint=this._pCamera.scenePosition,this._pCameraForward=this._pCamera.transform.forwardVector;t;)t.entity._iCollectRenderables(this),t=t.next;this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead),this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)},t.prototype.pExecuteRender=function(e,t,i,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=0),this._pContext.setRenderTarget(t,!0,s),!t&&this._shareContext||this._depthPrepass||this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0),this._pContext.setDepthTest(!1,f.ALWAYS),this._pStage.scissorRect=i,this.pDraw(e,t),this._shareContext||this._snapshotRequired&&this._snapshotBitmapData&&(this._pContext.drawToBitmapData(this._snapshotBitmapData),this._snapshotRequired=!1),this._pStage.scissorRect=null},t.prototype.queueSnapshot=function(e){this._snapshotRequired=!0,this._snapshotBitmapData=e},t.prototype.pDraw=function(){throw new n},t.prototype.onContextUpdate=function(){this._pContext=this._pStage.context},Object.defineProperty(t.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(e){this._backgroundAlpha!=e&&(this._backgroundAlpha=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),t.prototype.notifyScissorUpdate=function(){this._scissorDirty||(this._scissorDirty=!0,this._scissorUpdated||(this._scissorUpdated=new p(p.SCISSOR_UPDATED)),this.dispatchEvent(this._scissorUpdated))},t.prototype.notifyViewportUpdate=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewPortUpdated||(this._viewPortUpdated=new p(p.VIEWPORT_UPDATED)),this.dispatchEvent(this._viewPortUpdated))},t.prototype.onViewportUpdated=function(){this._viewPort=this._pStage.viewPort,this._shareContext&&(this._pScissorRect.x=this._globalPos.x-this._pStage.x,this._pScissorRect.y=this._globalPos.y-this._pStage.y,this.notifyScissorUpdate()),this.notifyViewportUpdate()},t.prototype.updateGlobalPos=function(){this._shareContext?(this._pScissorRect.x=this._globalPos.x-this._viewPort.x,this._pScissorRect.y=this._globalPos.y-this._viewPort.y):(this._pScissorRect.x=0,this._pScissorRect.y=0,this._viewPort.x=this._globalPos.x,this._viewPort.y=this._globalPos.y),this.notifyScissorUpdate()},t.prototype.applyBillboard=function(e){this._applyRenderable(this._billboardRenderablePool.getItem(e))},t.prototype.applyTriangleSubMesh=function(e){this._applyRenderable(this._triangleSubMeshRenderablePool.getItem(e))},t.prototype.applyLineSubMesh=function(e){this._applyRenderable(this._lineSubMeshRenderablePool.getItem(e))},t.prototype._applyRenderable=function(e){var t=e.materialOwner.material,i=e.sourceEntity,s=i.scenePosition;t||(t=m.getDefaultMaterial(e.materialOwner)),t._iUpdateMaterial(),e.material=t,e.materialId=t._iMaterialId,e.renderOrderId=this._pContext.getMaterial(t,this._pStage.profile).renderOrderId,e.cascaded=!1,s=this._iEntryPoint.subtract(s),e.zIndex=i.zOffset+s.dotProduct(this._pCameraForward),e.renderSceneTransform=e.sourceEntity.getRenderSceneTransform(this._pCamera),t.requiresBlending?(e.next=this._pBlendedRenderableHead,this._pBlendedRenderableHead=e):(e.next=this._pOpaqueRenderableHead,this._pOpaqueRenderableHead=e),this._pNumTriangles+=e.numTriangles,e.overflow&&this._applyRenderable(e.overflow)},t}(o);t.exports=y},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-display/lib/events/RendererEvent":void 0,"awayjs-display/lib/events/StageEvent":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-display/lib/sort/RenderableMergeSort":void 0,"awayjs-display/lib/traverse/EntityCollector":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/materials/utils/DefaultMaterialManager":void 0,"awayjs-stagegl/lib/pool/BillboardRenderable":void 0,"awayjs-stagegl/lib/pool/LineSubMeshRenderable":void 0,"awayjs-stagegl/lib/pool/TriangleSubMeshRenderable":void 0}],"awayjs-stagegl/lib/swfobject":[function(e,t){var i=function(){function e(){if(!H){try{var e=V.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(t){return}H=!0;for(var i=U.length,s=0;i>s;s++)U[s]()}}function t(e){H?e():U[U.length]=e}function s(e){if(typeof I.addEventListener!=M)I.addEventListener("load",e,!1);else if(typeof V.addEventListener!=M)V.addEventListener("load",e,!1);else if(typeof I.attachEvent!=M)y(I,"onload",e);else if("function"==typeof I.onload){var t=I.onload;I.onload=function(){t(),e()}}else I.onload=e}function a(){N?r():n()}function r(){var e=V.getElementsByTagName("body")[0],t=m(j);t.setAttribute("type",L);var i=e.appendChild(t);if(i){var s=0;!function(){if(typeof i.GetVariable!=M){var a=i.GetVariable("$version");a&&(a=a.split(" ")[1].split(","),q.pv=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)])}else if(10>s)return s++,void setTimeout(arguments.callee,10);e.removeChild(t),i=null,n()}()}else n()}function n(){var e=G.length;if(e>0)for(var t=0;e>t;t++){var i=G[t].id,s=G[t].callbackFn,a={success:!1,id:i};if(q.pv[0]>0){var r=f(i);if(r)if(!b(G[t].swfVersion)||q.wk&&q.wk<312)if(G[t].expressInstall&&l()){var n={};n.data=G[t].expressInstall,n.width=r.getAttribute("width")||"0",n.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(n.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(n.align=r.getAttribute("align"));for(var u={},d=r.getElementsByTagName("param"),g=d.length,c=0;g>c;c++)"movie"!=d[c].getAttribute("name").toLowerCase()&&(u[d[c].getAttribute("name")]=d[c].getAttribute("value"));h(n,u,i,s)}else p(r),s&&s(a);else v(i,!0),s&&(a.success=!0,a.ref=o(i),s(a))}else if(v(i,!0),s){var _=o(i);_&&typeof _.SetVariable!=M&&(a.success=!0,a.ref=_),s(a)}}}function o(e){var t=null,i=f(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=M)t=i;else{var s=i.getElementsByTagName(j)[0];s&&(t=s)}return t}function l(){return!W&&b("6.0.65")&&(q.win||q.mac)&&!(q.wk&&q.wk<312)}function h(e,t,i,s){W=!0,S=s||null,P={success:!1,id:i};var a=f(i);if(a){"OBJECT"==a.nodeName?(C=u(a),T=null):(C=a,T=i),e.id=E,(typeof e.width==M||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==M||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),V.title=V.title.slice(0,47)+" - Flash Player Installation";var r=q.ie&&q.win?"ActiveX":"PlugIn",n="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+V.title;if(typeof t.flashvars!=M?t.flashvars+="&"+n:t.flashvars=n,q.ie&&q.win&&4!=a.readyState){var o=m("div");i+="SWFObjectNew",o.setAttribute("id",i),a.parentNode.insertBefore(o,a),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}d(e,t,i)}}function p(e){if(q.ie&&q.win&&4!=e.readyState){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=m("div");if(q.win&&q.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(j)[0];if(i){var s=i.childNodes;if(s)for(var a=s.length,r=0;a>r;r++)1==s[r].nodeType&&"PARAM"==s[r].nodeName||8==s[r].nodeType||t.appendChild(s[r].cloneNode(!0))}}return t}function d(e,t,i){var s,a=f(i);if(q.wk&&q.wk<312)return s;if(a)if(typeof e.id==M&&(e.id=i),q.ie&&q.win){var r="";for(var n in e)e[n]!=Object.prototype[n]&&("data"==n.toLowerCase()?t.movie=e[n]:"styleclass"==n.toLowerCase()?r+=' class="'+e[n]+'"':"classid"!=n.toLowerCase()&&(r+=" "+n+'="'+e[n]+'"'));var o="";for(var l in t)t[l]!=Object.prototype[l]&&(o+='<param name="'+l+'" value="'+t[l]+'" />');a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+o+"</object>",k[k.length]=e.id,s=f(e.id)}else{var h=m(j);h.setAttribute("type",L);for(var p in e)e[p]!=Object.prototype[p]&&("styleclass"==p.toLowerCase()?h.setAttribute("class",e[p]):"classid"!=p.toLowerCase()&&h.setAttribute(p,e[p]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&g(h,u,t[u]);a.parentNode.replaceChild(h,a),s=h}return s}function g(e,t,i){var s=m("param");s.setAttribute("name",t),s.setAttribute("value",i),e.appendChild(s)}function c(e){var t=f(e);t&&"OBJECT"==t.nodeName&&(q.ie&&q.win?(t.style.display="none",function(){4==t.readyState?_(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function _(e){var t=f(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function f(e){var t=null;try{t=V.getElementById(e)}catch(i){}return t}function m(e){return V.createElement(e)}function y(e,t,i){e.attachEvent(t,i),z[z.length]=[e,t,i]}function b(e){var t=q.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?!0:!1}function x(e,t,i,s){if(!q.ie||!q.mac){var a=V.getElementsByTagName("head")[0];if(a){var r=i&&"string"==typeof i?i:"screen";if(s&&(R=null,D=null),!R||D!=r){var n=m("style");n.setAttribute("type","text/css"),n.setAttribute("media",r),R=a.appendChild(n),q.ie&&q.win&&typeof V.styleSheets!=M&&V.styleSheets.length>0&&(R=V.styleSheets[V.styleSheets.length-1]),D=r}q.ie&&q.win?R&&typeof R.addRule==j&&R.addRule(e,t):R&&typeof V.createTextNode!=M&&R.appendChild(V.createTextNode(e+" {"+t+"}"))}}}function v(e,t){if(X){var i=t?"visible":"hidden";H&&f(e)?f(e).style.visibility=i:x("#"+e,"visibility:"+i)}}function w(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=M?encodeURIComponent(e):e}{var C,T,S,P,R,D,M="undefined",j="object",A="Shockwave Flash",O="ShockwaveFlash.ShockwaveFlash",L="application/x-shockwave-flash",E="SWFObjectExprInst",F="onreadystatechange",I=window,V=document,B=navigator,N=!1,U=[a],G=[],k=[],z=[],H=!1,W=!1,X=!0,q=function(){var e=typeof V.getElementById!=M&&typeof V.getElementsByTagName!=M&&typeof V.createElement!=M,t=B.userAgent.toLowerCase(),i=B.platform.toLowerCase(),s=/win/.test(i?i:t),a=/mac/.test(i?i:t),r=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,n=!1,o=[0,0,0],l=null;if(typeof B.plugins!=M&&typeof B.plugins[A]==j)l=B.plugins[A].description,!l||typeof B.mimeTypes!=M&&B.mimeTypes[L]&&!B.mimeTypes[L].enabledPlugin||(N=!0,n=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof I.ActiveXObject!=M)try{var h=new ActiveXObject(O);h&&(l=h.GetVariable("$version"),l&&(n=!0,l=l.split(" ")[1].split(","),o=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(p){}return{w3:e,pv:o,wk:r,ie:n,win:s,mac:a}}();!function(){q.w3&&((typeof V.readyState!=M&&"complete"==V.readyState||typeof V.readyState==M&&(V.getElementsByTagName("body")[0]||V.body))&&e(),H||(typeof V.addEventListener!=M&&V.addEventListener("DOMContentLoaded",e,!1),q.ie&&q.win&&(V.attachEvent(F,function(){"complete"==V.readyState&&(V.detachEvent(F,arguments.callee),e())}),I==top&&!function(){if(!H){try{V.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),q.wk&&!function(){return H?void 0:/loaded|complete/.test(V.readyState)?void e():void setTimeout(arguments.callee,0)}(),s(e)))}(),function(){q.ie&&q.win&&window.attachEvent("onunload",function(){for(var e=z.length,t=0;e>t;t++)z[t][0].detachEvent(z[t][1],z[t][2]);for(var s=k.length,a=0;s>a;a++)c(k[a]);for(var r in q)q[r]=null;q=null;for(var n in i)i[n]=null;i=null})}()}return{registerObject:function(e,t,i,s){if(q.w3&&e&&t){var a={};a.id=e,a.swfVersion=t,a.expressInstall=i,a.callbackFn=s,G[G.length]=a,v(e,!1)}else s&&s({success:!1,id:e})},getObjectById:function(e){return q.w3?o(e):void 0},embedSWF:function(e,i,s,a,r,n,o,p,u,g){var c={success:!1,id:i};q.w3&&!(q.wk&&q.wk<312)&&e&&i&&s&&a&&r?(v(i,!1),t(function(){s+="",a+="";var t={};if(u&&typeof u===j)for(var _ in u)t[_]=u[_];t.data=e,t.width=s,t.height=a;var f={};if(p&&typeof p===j)for(var m in p)f[m]=p[m];if(o&&typeof o===j)for(var y in o)typeof f.flashvars!=M?f.flashvars+="&"+y+"="+o[y]:f.flashvars=y+"="+o[y];if(b(r)){var x=d(t,f,i);t.id==i&&v(i,!0),c.success=!0,c.ref=x}else{if(n&&l())return t.data=n,void h(t,f,i,g);v(i,!0)}g&&g(c)})):g&&g(c)},switchOffAutoHideShow:function(){X=!1},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:b,createSWF:function(e,t,i){return q.w3?d(e,t,i):void 0},showExpressInstall:function(e,t,i,s){q.w3&&l()&&h(e,t,i,s)},removeSWF:function(e){q.w3&&c(e)},createCSS:function(e,t,i,s){q.w3&&x(e,t,i,s)},addDomLoadEvent:t,addLoadEvent:s,getQueryParamValue:function(e){var t=V.location.search||V.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return w(t);for(var i=t.split("&"),s=0;s<i.length;s++)if(i[s].substring(0,i[s].indexOf("="))==e)return w(i[s].substring(i[s].indexOf("=")+1))}return""},expressInstallCallback:function(){if(W){var e=f(E);e&&C&&(e.parentNode.replaceChild(C,e),T&&(v(T,!0),q.ie&&q.win&&(C.style.display="block")),S&&S(P)),W=!1}}}}();t.exports=i},{}]},{},[]);
//# sourceMappingURL=awayjs-stagegl.min.js.map
{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","awayjs-stagegl/lib/aglsl/agaltokenizer.ts","awayjs-stagegl/lib/aglsl/aglslparser.ts","awayjs-stagegl/lib/aglsl/description.ts","awayjs-stagegl/lib/aglsl/destination.ts","awayjs-stagegl/lib/aglsl/header.ts","awayjs-stagegl/lib/aglsl/mapping.ts","awayjs-stagegl/lib/aglsl/oplut.ts","awayjs-stagegl/lib/aglsl/sampler.ts","awayjs-stagegl/lib/aglsl/token.ts","awayjs-stagegl/lib/aglsl/assembler/agalminiassembler.ts","awayjs-stagegl/lib/aglsl/assembler/fs.ts","awayjs-stagegl/lib/aglsl/assembler/flags.ts","awayjs-stagegl/lib/aglsl/assembler/opcodemap.ts","awayjs-stagegl/lib/aglsl/assembler/opcode.ts","awayjs-stagegl/lib/aglsl/assembler/part.ts","awayjs-stagegl/lib/aglsl/assembler/regmap.ts","awayjs-stagegl/lib/aglsl/assembler/samplermap.ts","awayjs-stagegl/lib/aglsl/assembler/sampler.ts","awayjs-stagegl/lib/base/contextglblendfactor.ts","awayjs-stagegl/lib/base/contextglclearmask.ts","awayjs-stagegl/lib/base/contextglcomparemode.ts","awayjs-stagegl/lib/base/contextglmipfilter.ts","awayjs-stagegl/lib/base/contextglprofile.ts","awayjs-stagegl/lib/base/contextglprogramtype.ts","awayjs-stagegl/lib/base/contextglstencilaction.ts","awayjs-stagegl/lib/base/contextgltexturefilter.ts","awayjs-stagegl/lib/base/contextgltextureformat.ts","awayjs-stagegl/lib/base/contextgltriangleface.ts","awayjs-stagegl/lib/base/contextglvertexbufferformat.ts","awayjs-stagegl/lib/base/contextglwrapmode.ts","awayjs-stagegl/lib/base/contextstage3d.ts","awayjs-stagegl/lib/base/contextwebgl.ts","awayjs-stagegl/lib/base/cubetextureflash.ts","awayjs-stagegl/lib/base/cubetexturewebgl.ts","awayjs-stagegl/lib/base/indexbufferflash.ts","awayjs-stagegl/lib/base/indexbufferwebgl.ts","awayjs-stagegl/lib/base/opcodes.ts","awayjs-stagegl/lib/base/programflash.ts","awayjs-stagegl/lib/base/programwebgl.ts","awayjs-stagegl/lib/base/resourcebaseflash.ts","awayjs-stagegl/lib/base/samplerstate.ts","awayjs-stagegl/lib/base/stage.ts","awayjs-stagegl/lib/base/texturebasewebgl.ts","awayjs-stagegl/lib/base/textureflash.ts","awayjs-stagegl/lib/base/texturewebgl.ts","awayjs-stagegl/lib/base/vertexbufferflash.ts","awayjs-stagegl/lib/base/vertexbufferwebgl.ts","awayjs-stagegl/lib/managers/stagemanager.ts","awayjs-stagegl/lib/pool/indexdatapool.ts","awayjs-stagegl/lib/pool/indexdata.ts","awayjs-stagegl/lib/pool/programdatapool.ts","awayjs-stagegl/lib/pool/programdata.ts","awayjs-stagegl/lib/pool/texturedatapool.ts","awayjs-stagegl/lib/pool/texturedata.ts","awayjs-stagegl/lib/pool/vertexdatapool.ts","awayjs-stagegl/lib/pool/vertexdata.ts","lib/swfobject.js"],"names":[],"mappings":"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","file":"awayjs-stagegl.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport Description\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Description\");\nimport Header\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Header\");\nimport Mapping\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Mapping\");\nimport Token\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Token\");\n\nclass AGALTokenizer\n{\n\tconstructor()\n\t{\n\t}\n\n\tpublic decribeAGALByteArray(bytes:ByteArray)\n\t{\n\t\tvar header:Header = new Header();\n\n\t\tif (bytes.readUnsignedByte() != 0xa0) {\n\t\t\tthrow \"Bad AGAL: Missing 0xa0 magic byte.\";\n\t\t}\n\n\t\theader.version = bytes.readUnsignedInt();\n\t\tif (header.version >= 0x10) {\n\t\t\tbytes.readUnsignedByte();\n\t\t\theader.version >>= 1;\n\t\t}\n\t\tif (bytes.readUnsignedByte() != 0xa1) {\n\t\t\tthrow \"Bad AGAL: Missing 0xa1 magic byte.\";\n\t\t}\n\n\t\theader.progid = bytes.readUnsignedByte();\n\t\tswitch (header.progid) {\n\t\t\tcase 1:\n\t\t\t\theader.type = \"fragment\";\n\t\t\t\tbreak;\n\t\t\tcase 0:\n\t\t\t\theader.type = \"vertex\";\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\theader.type = \"cpu\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\theader.type = \"\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar desc:Description = new Description();\n\t\tvar tokens:Token[] = [];\n\t\twhile (bytes.position < bytes.length) {\n\t\t\tvar token:Token = new Token();\n\n\t\t\ttoken.opcode = bytes.readUnsignedInt();\n\t\t\tvar lutentry = Mapping.agal2glsllut[token.opcode];\n\t\t\tif (!lutentry) {\n\t\t\t\tthrow \"Opcode not valid or not implemented yet: \" + token.opcode;\n\t\t\t}\n\t\t\tif (lutentry.matrixheight) {\n\t\t\t\tdesc.hasmatrix = true;\n\t\t\t}\n\t\t\tif (lutentry.dest) {\n\t\t\t\ttoken.dest.regnum = bytes.readUnsignedShort();\n\t\t\t\ttoken.dest.mask = bytes.readUnsignedByte();\n\t\t\t\ttoken.dest.regtype = bytes.readUnsignedByte();\n\t\t\t\tdesc.regwrite[token.dest.regtype][token.dest.regnum] |= token.dest.mask;\n\t\t\t} else {\n\t\t\t\ttoken.dest = null;\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t}\n\t\t\tif (lutentry.a) {\n\t\t\t\tthis.readReg(token.a, 1, desc, bytes);\n\t\t\t} else {\n\t\t\t\ttoken.a = null;\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t}\n\t\t\tif (lutentry.b) {\n\t\t\t\tthis.readReg(token.b, lutentry.matrixheight | 0, desc, bytes);\n\t\t\t} else {\n\t\t\t\ttoken.b = null;\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t}\n\t\t\ttokens.push(token);\n\t\t}\n\t\tdesc.header = header;\n\t\tdesc.tokens = tokens;\n\n\t\treturn desc;\n\t}\n\n\tpublic readReg(s, mh, desc, bytes)\n\t{\n\t\ts.regnum = bytes.readUnsignedShort();\n\t\ts.indexoffset = bytes.readByte();\n\t\ts.swizzle = bytes.readUnsignedByte();\n\t\ts.regtype = bytes.readUnsignedByte();\n\t\tdesc.regread[s.regtype][s.regnum] = 0xf; // sould be swizzle to mask? should be |=                                                 \n\t\tif (s.regtype == 0x5) {\n\t\t\t// sampler\n\t\t\ts.lodbiad = s.indexoffset;\n\t\t\ts.indexoffset = undefined;\n\t\t\ts.swizzle = undefined;\n\n\t\t\t// sampler \n\t\t\ts.readmode = bytes.readUnsignedByte();\n\t\t\ts.dim = s.readmode >> 4;\n\t\t\ts.readmode &= 0xf;\n\t\t\ts.special = bytes.readUnsignedByte();\n\t\t\ts.wrap = s.special >> 4;\n\t\t\ts.special &= 0xf;\n\t\t\ts.mipmap = bytes.readUnsignedByte();\n\t\t\ts.filter = s.mipmap >> 4;\n\t\t\ts.mipmap &= 0xf;\n\t\t\tdesc.samplers[s.regnum] = s;\n\t\t} else {\n\t\t\ts.indexregtype = bytes.readUnsignedByte();\n\t\t\ts.indexselect = bytes.readUnsignedByte();\n\t\t\ts.indirectflag = bytes.readUnsignedByte();\n\t\t}\n\t\tif (s.indirectflag) {\n\t\t\tdesc.hasindirect = true;\n\t\t}\n\t\tif (!s.indirectflag && mh) {\n\t\t\tfor (var mhi:number = 0; mhi < mh; mhi++) //TODO wrong, should be |=\n\t\t\t{\n\t\t\t\tdesc.regread[s.regtype][s.regnum + mhi] = desc.regread[s.regtype][s.regnum];\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport = AGALTokenizer;","import Description\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Description\");\nimport Mapping\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Mapping\");\nimport ContextStage3D\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\n\nclass AGLSLParser\n{\n\tpublic parse(desc:Description)\n\t{\n\t\tvar header:string = \"\";\n\t\tvar body:string = \"\";\n\n\t\theader += \"precision highp float;\\n\";\n\t\tvar tag = desc.header.type[0]; //TODO\n\n\t\t// declare uniforms\n\t\tif (desc.header.type == \"vertex\") {\n\t\t\theader += \"uniform float yflip;\\n\";\n\t\t}\n\t\tif (!desc.hasindirect) {\n\t\t\tfor (var i:number = 0; i < desc.regread[0x1].length; i++) {\n\t\t\t\tif (desc.regread[0x1][i]) {\n\t\t\t\t\theader += \"uniform vec4 \" + tag + \"c\" + i + \";\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\theader += \"uniform vec4 \" + tag + \"carrr[\" + ContextStage3D.maxvertexconstants + \"];\\n\";                // use max const count instead\n\t\t}\n\n\t\t// declare temps\n\t\tfor (var i = 0; i < desc.regread[0x2].length || i < desc.regwrite[0x2].length; i++) {\n\t\t\tif (desc.regread[0x2][i] || desc.regwrite[0x2][i]) // duh, have to check write only also...\n\t\t\t{\n\t\t\t\theader += \"vec4 \" + tag + \"t\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// declare streams\n\t\tfor (var i:number = 0; i < desc.regread[0x0].length; i++) {\n\t\t\tif (desc.regread[0x0][i]) {\n\t\t\t\theader += \"attribute vec4 va\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// declare interpolated\n\t\tfor (var i:number = 0; i < desc.regread[0x4].length || i < desc.regwrite[0x4].length; i++) {\n\t\t\tif (desc.regread[0x4][i] || desc.regwrite[0x4][i]) {\n\t\t\t\theader += \"varying vec4 vi\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// declare samplers\n\t\tvar samptype:Array<string> = [\"2D\", \"Cube\", \"3D\", \"\"];\n\t\tfor (var i:number = 0; i < desc.samplers.length; i++) {\n\t\t\tif (desc.samplers[i]) {\n\t\t\t\theader += \"uniform sampler\" + samptype[ desc.samplers[i].dim & 3 ] + \" fs\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// extra gl fluff: setup position and depth adjust temps\n\t\tif (desc.header.type == \"vertex\") {\n\t\t\theader += \"vec4 outpos;\\n\";\n\t\t}\n\t\tif (desc.writedepth) {\n\t\t\theader += \"vec4 tmp_FragDepth;\\n\";\n\t\t}\n\t\t//if ( desc.hasmatrix ) \n\t\t//    header += \"vec4 tmp_matrix;\\n\";\n\n\t\t// start body of code\n\t\tbody += \"void main() {\\n\";\n\n\t\tfor (var i:number = 0; i < desc.tokens.length; i++) {\n\t\t\tvar lutentry = Mapping.agal2glsllut[desc.tokens[i].opcode];\n\t\t\tif (!lutentry) {\n\t\t\t\tthrow \"Opcode not valid or not implemented yet: \"\n\t\t\t\t/*+token.opcode;*/\n\t\t\t}\n\t\t\tvar sublines = lutentry.matrixheight || 1;\n\n\t\t\tfor (var sl:number = 0; sl < sublines; sl++) {\n\t\t\t\tvar line:string = \"  \" + lutentry.s;\n\t\t\t\tif (desc.tokens[i].dest) {\n\t\t\t\t\tif (lutentry.matrixheight) {\n\t\t\t\t\t\tif (((desc.tokens[i].dest.mask >> sl) & 1) != 1) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar destregstring:string = this.regtostring(desc.tokens[i].dest.regtype, desc.tokens[i].dest.regnum, desc, tag);\n\t\t\t\t\t\tvar destcaststring:string = \"float\";\n\t\t\t\t\t\tvar destmaskstring = [\"x\", \"y\", \"z\", \"w\"][sl];\n\t\t\t\t\t\tdestregstring += \".\" + destmaskstring;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar destregstring:string = this.regtostring(desc.tokens[i].dest.regtype, desc.tokens[i].dest.regnum, desc, tag);\n\t\t\t\t\t\tvar destcaststring:string;\n\t\t\t\t\t\tvar destmaskstring:string;\n\t\t\t\t\t\tif (desc.tokens[i].dest.mask != 0xf) {\n\t\t\t\t\t\t\tvar ndest:number = 0;\n\t\t\t\t\t\t\tdestmaskstring = \"\";\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 1) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"x\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 2) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"y\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 4) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"z\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 8) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"w\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdestregstring += \".\" + destmaskstring;\n\t\t\t\t\t\t\tswitch (ndest) {\n\t\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t\tdestcaststring = \"float\";\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t\tdestcaststring = \"vec2\";\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\tdestcaststring = \"vec3\";\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tthrow \"Unexpected destination mask\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdestcaststring = \"vec4\";\n\t\t\t\t\t\t\tdestmaskstring = \"xyzw\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tline = line.replace(\"%dest\", destregstring);\n\t\t\t\t\tline = line.replace(\"%cast\", destcaststring);\n\t\t\t\t\tline = line.replace(\"%dm\", destmaskstring);\n\t\t\t\t}\n\t\t\t\tvar dwm:number = 0xf;\n\t\t\t\tif (!lutentry.ndwm && lutentry.dest && desc.tokens[i].dest) {\n\t\t\t\t\tdwm = desc.tokens[i].dest.mask;\n\t\t\t\t}\n\t\t\t\tif (desc.tokens[i].a) {\n\t\t\t\t\tline = line.replace(\"%a\", this.sourcetostring(desc.tokens[i].a, 0, dwm, lutentry.scalar, desc, tag));\n\t\t\t\t}\n\t\t\t\tif (desc.tokens[i].b) {\n\t\t\t\t\tline = line.replace(\"%b\", this.sourcetostring(desc.tokens[i].b, sl, dwm, lutentry.scalar, desc, tag));\n\t\t\t\t\tif (desc.tokens[i].b.regtype == 0x5) {\n\t\t\t\t\t\t// sampler dim\n\t\t\t\t\t\tvar texdim = [\"2D\", \"Cube\", \"3D\"][desc.tokens[i].b.dim];\n\t\t\t\t\t\tvar texsize = [\"vec2\", \"vec3\", \"vec3\"][desc.tokens[i].b.dim];\n\t\t\t\t\t\tline = line.replace(\"%texdim\", texdim);\n\t\t\t\t\t\tline = line.replace(\"%texsize\", texsize);\n\t\t\t\t\t\tvar texlod:string = \"\";\n\t\t\t\t\t\tline = line.replace(\"%lod\", texlod);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbody += line;\n\t\t\t}\n\t\t}\n\n\t\t// adjust z from opengl range of -1..1 to 0..1 as in d3d, this also enforces a left handed coordinate system\n\t\tif (desc.header.type == \"vertex\") {\n\t\t\tbody += \"  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\\n\";\n\t\t}\n\n\t\t// clamp fragment depth\n\t\tif (desc.writedepth) {\n\t\t\tbody += \"  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\\n\";\n\t\t}\n\n\t\t// close main\n\t\tbody += \"}\\n\";\n\n\t\treturn header + body;\n\t}\n\n\tpublic regtostring(regtype:number, regnum:number, desc:Description, tag)\n\t{\n\t\tswitch (regtype) {\n\t\t\tcase 0x0:\n\t\t\t\treturn \"va\" + regnum;\n\t\t\tcase 0x1:\n\t\t\t\tif (desc.hasindirect && desc.header.type == \"vertex\") {\n\t\t\t\t\treturn \"vcarrr[\" + regnum + \"]\";\n\t\t\t\t} else {\n\t\t\t\t\treturn tag + \"c\" + regnum;\n\t\t\t\t}\n\t\t\tcase 0x2:\n\t\t\t\treturn tag + \"t\" + regnum;\n\t\t\tcase 0x3:\n\t\t\t\treturn desc.header.type == \"vertex\"? \"outpos\" : \"gl_FragColor\";\n\t\t\tcase 0x4:\n\t\t\t\treturn \"vi\" + regnum;\n\t\t\tcase 0x5:\n\t\t\t\treturn \"fs\" + regnum;\n\t\t\tcase 0x6:\n\t\t\t\treturn \"tmp_FragDepth\";\n\t\t\tdefault:\n\t\t\t\tthrow \"Unknown register type\";\n\t\t}\n\t}\n\n\tpublic sourcetostring(s, subline, dwm, isscalar, desc, tag):string\n\t{\n\t\tvar swiz = [ \"x\", \"y\", \"z\", \"w\" ];\n\t\tvar r;\n\n\t\tif (s.indirectflag) {\n\t\t\tr = \"vcarrr[int(\" + this.regtostring(s.indexregtype, s.regnum, desc, tag) + \".\" + swiz[s.indexselect] + \")\";\n\t\t\tvar realofs = subline + s.indexoffset;\n\t\t\tif (realofs < 0) r += realofs.toString();\n\t\t\tif (realofs > 0) r += \"+\" + realofs.toString();\n\t\t\tr += \"]\";\n\t\t} else {\n\t\t\tr = this.regtostring(s.regtype, s.regnum + subline, desc, tag);\n\t\t}\n\n\t\t// samplers never add swizzle        \n\t\tif (s.regtype == 0x5) {\n\t\t\treturn r;\n\t\t}\n\n\t\t// scalar, first component only\n\t\tif (isscalar) {\n\t\t\treturn r + \".\" + swiz[(s.swizzle >> 0) & 3];\n\t\t}\n\n\t\t// identity\n\t\tif (s.swizzle == 0xe4 && dwm == 0xf) {\n\t\t\treturn r;\n\t\t}\n\n\t\t// with destination write mask folded in\n\t\tr += \".\";\n\t\tif (dwm & 1) r += swiz[(s.swizzle >> 0) & 3];\n\t\tif (dwm & 2) r += swiz[(s.swizzle >> 2) & 3];\n\t\tif (dwm & 4) r += swiz[(s.swizzle >> 4) & 3];\n\t\tif (dwm & 8) r += swiz[(s.swizzle >> 6) & 3];\n\t\treturn r;\n\t}\n}\n\nexport = AGLSLParser;","import Header\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Header\");\nimport Token\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Token\");\n\nclass Description\n{\n\tpublic regread:any[] = [\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[]\n\t];\n\tpublic regwrite:any[] = [\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[]\n\t];\n\tpublic hasindirect:boolean = false;\n\tpublic writedepth:boolean = false;\n\tpublic hasmatrix:boolean = false;\n\tpublic samplers:any[] = [];\n\n\t// added due to dynamic assignment 3*0xFFFFFFuuuu\n\tpublic tokens:Token[] = [];\n\tpublic header:Header = new Header();\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Description;","class Destination\n{\n\tpublic mask:number = 0;\n\tpublic regnum:number = 0;\n\tpublic regtype:number = 0;\n\tpublic dim:number = 0;\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Destination;","class Header\n{\n\tpublic progid:number = 0;\n\tpublic version:number = 0;\n\tpublic type:string = \"\";\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Header;","import OpLUT\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/OpLUT\");\n\nclass Mapping\n{\n\tstatic agal2glsllut:Array<OpLUT> = [\n\n\t\t//         s \t\t\t\t\t\t\t\t\t\t\t\tflags   dest    a     b \t    mw \t  mh    ndwm  scale dm\t  lod\n\t\tnew OpLUT(\"%dest = %cast(%a);\\n\", 0, true, true, false, null, null, null, null, null, null), //mov\n\t\tnew OpLUT(\"%dest = %cast(%a + %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //add\n\t\tnew OpLUT(\"%dest = %cast(%a - %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //sub\n\t\tnew OpLUT(\"%dest = %cast(%a * %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //mul\n\t\tnew OpLUT(\"%dest = %cast(%a / %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //div\n\t\tnew OpLUT(\"%dest = %cast(1.0) / %a;\\n\", 0, true, true, false, null, null, null, null, null, null), //rcp\n\t\tnew OpLUT(\"%dest = %cast(min(%a,%b));\\n\", 0, true, true, true, null, null, null, null, null, null), //min\n\t\tnew OpLUT(\"%dest = %cast(max(%a,%b));\\n\", 0, true, true, true, null, null, null, null, null, null), //max\n\t\tnew OpLUT(\"%dest = %cast(fract(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //frc\n\t\tnew OpLUT(\"%dest = %cast(sqrt(abs(%a)));\\n\", 0, true, true, false, null, null, null, null, null, null), //sqt\n\t\tnew OpLUT(\"%dest = %cast(inversesqrt(abs(%a)));\\n\", 0, true, true, false, null, null, null, null, null, null), //rsq\n\t\tnew OpLUT(\"%dest = %cast(pow(abs(%a),%b));\\n\", 0, true, true, true, null, null, null, null, null, null), //pow\n\t\tnew OpLUT(\"%dest = %cast(log2(abs(%a)));\\n\", 0, true, true, false, null, null, null, null, null, null), //log\n\t\tnew OpLUT(\"%dest = %cast(exp2(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //exp\n\n\t\t//         s \t\t\t\t\t\t\t\t\t\t\t\tflags  \tdest    a     b \t    mw \t  mh    ndwm  scale dm\t  lod\n\t\tnew OpLUT(\"%dest = %cast(normalize(vec3( %a ) ));\\n\", 0, true, true, false, null, null, true, null, null, null), //nrm\n\t\tnew OpLUT(\"%dest = %cast(sin(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //sin\n\t\tnew OpLUT(\"%dest = %cast(cos(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //cos\n\t\tnew OpLUT(\"%dest = %cast(cross(vec3(%a),vec3(%b)));\\n\", 0, true, true, true, null, null, true, null, null, null), //crs\n\t\tnew OpLUT(\"%dest = %cast(dot(vec3(%a),vec3(%b)));\\n\", 0, true, true, true, null, null, true, null, null, null), //dp3\n\t\tnew OpLUT(\"%dest = %cast(dot(vec4(%a),vec4(%b)));\\n\", 0, true, true, true, null, null, true, null, null, null), //dp4\n\t\tnew OpLUT(\"%dest = %cast(abs(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //abs\n\t\tnew OpLUT(\"%dest = %cast(%a * -1.0);\\n\", 0, true, true, false, null, null, null, null, null, null), //neg\n\t\tnew OpLUT(\"%dest = %cast(clamp(%a,0.0,1.0));\\n\", 0, true, true, false, null, null, null, null, null, null), //sat\n\t\tnew OpLUT(\"%dest = %cast(dot(vec3(%a),vec3(%b)));\\n\", null, true, true, true, 3, 3, true, null, null, null), //m33\n\t\tnew OpLUT(\"%dest = %cast(dot(vec4(%a),vec4(%b)));\\n\", null, true, true, true, 4, 4, true, null, null, null), //m44\n\t\tnew OpLUT(\"%dest = %cast(dot(vec4(%a),vec4(%b)));\\n\", null, true, true, true, 4, 3, true, null, null, null), //m43\n\t\tnew OpLUT(\"%dest = %cast(dFdx(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //dFdx\n\t\tnew OpLUT(\"%dest = %cast(dFdx(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //dFdx\n\t\tnew OpLUT(\"if (float(%a)==float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"if (float(%a)!=float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"if (float(%a)>=float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"if (float(%a)<float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"} else {;\\n\", 0, false, false, false, null, null, null, null, null, null), new OpLUT(\"};\\n\", 0, false, false, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null),\n\n\t\t//         s \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tflags  \tdest    a     b \t    mw \t  mh    ndwm  scale dm\t  lod\n\t\tnew OpLUT(\"%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\\n\", null, true, true, true, null, null, null, null, true, null), new OpLUT(\"if ( float(%a)<0.0 ) discard;\\n\", null, false, true, false, null, null, null, true, null, null), new OpLUT(\"%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\\n\", null, true, true, true, null, null, true, null, true, true), new OpLUT(\"%dest = %cast(greaterThanEqual(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null), new OpLUT(\"%dest = %cast(lessThan(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null), new OpLUT(\"%dest = %cast(sign(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), new OpLUT(\"%dest = %cast(equal(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null), new OpLUT(\"%dest = %cast(notEqual(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null)\n\n\t];\n\n\t//TODO: get rid of hack that fixes including definition file\n\tconstructor(include?:OpLUT)\n\t{\n\n\t}\n}\n\nexport = Mapping;","class OpLUT\n{\n\n\tpublic s:string;\n\tpublic flags:number;\n\tpublic dest:boolean;\n\tpublic a:boolean;\n\tpublic b:boolean;\n\tpublic matrixwidth:number;\n\tpublic matrixheight:number;\n\tpublic ndwm:boolean;\n\tpublic scalar:boolean;\n\tpublic dm:boolean;\n\tpublic lod:boolean;\n\n\tconstructor(s:string, flags:number, dest:boolean, a:boolean, b:boolean, matrixwidth:number, matrixheight:number, ndwm:boolean, scaler:boolean, dm:boolean, lod:boolean)\n\t{\n\t\tthis.s = s;\n\t\tthis.flags = flags;\n\t\tthis.dest = dest;\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.matrixwidth = matrixwidth;\n\t\tthis.matrixheight = matrixheight;\n\t\tthis.ndwm = ndwm;\n\t\tthis.scalar = scaler;\n\t\tthis.dm = dm;\n\t\tthis.lod = lod;\n\t}\n}\n\nexport = OpLUT;","class Sampler\n{\n\tpublic lodbias:number = 0;\n\tpublic dim:number = 0;\n\tpublic readmode:number = 0;\n\tpublic special:number = 0;\n\tpublic wrap:number = 0;\n\tpublic mipmap:number = 0;\n\tpublic filter:number = 0;\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Sampler;","import Destination\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Destination\");\n\nclass Token\n{\n\tpublic dest:Destination = new Destination();\n\tpublic opcode:number = 0;\n\tpublic a:Destination = new Destination();\n\tpublic b:Destination = new Destination();\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Token;","import Sampler\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Sampler\");\nimport Opcode\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Opcode\");\nimport OpcodeMap\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap\");\nimport Part\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Part\");\nimport RegMap\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/RegMap\");\nimport SamplerMap\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/SamplerMap\");\n\n\nclass AGALMiniAssembler\n{\n\tpublic r:Object;\n\tpublic cur:Part;\n\n\tconstructor()\n\t{\n\t\tthis.r = {};\n\t\tthis.cur = new Part();\n\t}\n\n\tpublic assemble(source:string, ext_part = null, ext_version = null)\n\t{\n\t\tif (!ext_version) {\n\t\t\text_version = 1;\n\t\t}\n\n\t\tif (ext_part) {\n\t\t\tthis.addHeader(ext_part, ext_version);\n\t\t}\n\n\t\tvar lines = source.replace(/[\\f\\n\\r\\v]+/g, \"\\n\").split(\"\\n\"); // handle breaks, then split into lines\n\n\t\tfor (var i in lines) {\n\t\t\tthis.processLine(lines[i], i);\n\t\t}\n\n\t\treturn this.r;\n\t}\n\n\tprivate processLine(line, linenr)\n\t{\n\t\tvar startcomment:number = line.search(\"//\");  // remove comments\n\t\tif (startcomment != -1) {\n\t\t\tline = line.slice(0, startcomment);\n\t\t}\n\t\tline = line.replace(/^\\s+|\\s+$/g, \"\"); // remove outer space\n\t\tif (!(line.length > 0 )) {\n\t\t\treturn;\n\t\t}\n\t\tvar optsi:number = line.search(/<.*>/g); // split of options part <*> if there\n\t\tvar opts:string[] = null;\n\t\tif (optsi != -1) {\n\t\t\topts = line.slice(optsi).match(/([\\w\\.\\-\\+]+)/gi);\n\t\t\tline = line.slice(0, optsi);\n\t\t}\n\n\t\t// get opcode/command\t\t\t\t            \n\t\tvar tokens = line.match(/([\\w\\.\\+\\[\\]]+)/gi); // get tokens in line\n\t\tif (!tokens || tokens.length < 1) {\n\t\t\tif (line.length >= 3) {\n\t\t\t\tconsole.log(\"Warning: bad line \" + linenr + \": \" + line);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t//console.log ( linenr, line, cur, tokens ); \n\t\tswitch (tokens[0]) {\n\t\t\tcase \"part\":\n\t\t\t\tthis.addHeader(tokens[1], Number(tokens[2]));\n\t\t\t\tbreak;\n\t\t\tcase \"endpart\":\n\t\t\t\tif (!this.cur) {\n\t\t\t\t\tthrow \"Unexpected endpart\";\n\t\t\t\t}\n\t\t\t\tthis.cur.data.position = 0;\n\t\t\t\tthis.cur = null;\n\t\t\t\treturn;\n\t\t\tdefault:\n\t\t\t\tif (!this.cur) {\n\t\t\t\t\tconsole.log(\"Warning: bad line \" + linenr + \": \" + line + \" (Outside of any part definition)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.cur.name == \"comment\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar op:Opcode = <Opcode> OpcodeMap.map[tokens[0]];\n\t\t\t\tif (!op) {\n\t\t\t\t\tthrow \"Bad opcode \" + tokens[0] + \" \" + linenr + \": \" + line;\n\t\t\t\t}\n\t\t\t\t// console.log( 'AGALMiniAssembler' , 'op' , op );\n\n\t\t\t\tthis.emitOpcode(this.cur, op.opcode);\n\t\t\t\tvar ti:number = 1;\n\t\t\t\tif (op.dest && op.dest != \"none\") {\n\t\t\t\t\tif (!this.emitDest(this.cur, tokens[ti++], op.dest)) {\n\t\t\t\t\t\tthrow \"Bad destination register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.emitZeroDword(this.cur);\n\t\t\t\t}\n\n\t\t\t\tif (op.a && op.a.format != \"none\") {\n\t\t\t\t\tif (!this.emitSource(this.cur, tokens[ti++], op.a)) throw \"Bad source register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t} else {\n\t\t\t\t\tthis.emitZeroQword(this.cur);\n\t\t\t\t}\n\n\t\t\t\tif (op.b && op.b.format != \"none\") {\n\t\t\t\t\tif (op.b.format == \"sampler\") {\n\t\t\t\t\t\tif (!this.emitSampler(this.cur, tokens[ti++], op.b, opts)) {\n\t\t\t\t\t\t\tthrow \"Bad sampler register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!this.emitSource(this.cur, tokens[ti++], op.b)) {\n\t\t\t\t\t\t\tthrow \"Bad source register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.emitZeroQword(this.cur);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tpublic emitHeader(pr:Part)\n\t{\n\t\tpr.data.writeUnsignedByte(0xa0); \t// tag version\n\t\tpr.data.writeUnsignedInt(pr.version);\n\t\tif (pr.version >= 0x10) {\n\t\t\tpr.data.writeUnsignedByte(0); // align, for higher versions\n\t\t}\n\t\tpr.data.writeUnsignedByte(0xa1);\t\t// tag program id\n\t\tswitch (pr.name) {\n\t\t\tcase \"fragment\" :\n\t\t\t\tpr.data.writeUnsignedByte(1);\n\t\t\t\tbreak;\n\t\t\tcase \"vertex\" :\n\t\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\t\tbreak;\n\t\t\tcase \"cpu\" :\n\t\t\t\tpr.data.writeUnsignedByte(2);\n\t\t\t\tbreak;\n\t\t\tdefault :\n\t\t\t\tpr.data.writeUnsignedByte(0xff);\n\t\t\t\tbreak; // unknown/comment\n\t\t}\n\t}\n\n\tpublic emitOpcode(pr:Part, opcode)\n\t{\n\t\tpr.data.writeUnsignedInt(opcode);\n\t\t//console.log ( \"Emit opcode: \", opcode ); \n\t}\n\n\tpublic emitZeroDword(pr:Part)\n\t{\n\t\tpr.data.writeUnsignedInt(0);\n\t}\n\n\tpublic emitZeroQword(pr)\n\t{\n\t\tpr.data.writeUnsignedInt(0);\n\t\tpr.data.writeUnsignedInt(0);\n\t}\n\n\tpublic emitDest(pr, token, opdest)\n\t{\n\n\t\t//console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map' , RegMap.map);\n\t\tvar reg = token.match(/([fov]?[tpocidavs])(\\d*)(\\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:mask\n\n\t\t// console.log( 'AGALMiniAssembler' , 'emitDest' , 'reg' , reg , reg[1] , RegMap.map[reg[1]] );\n\t\t// console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map[reg[1]]' , RegMap.map[reg[1]] , 'bool' , !RegMap.map[reg[1]] ) ;\n\n\t\tif (!RegMap.map[reg[1]]) return false;\n\t\tvar em = { num:reg[2]? reg[2] : 0, code:RegMap.map[reg[1]].code, mask:this.stringToMask(reg[3]) };\n\t\tpr.data.writeUnsignedShort(em.num);\n\t\tpr.data.writeUnsignedByte(em.mask);\n\t\tpr.data.writeUnsignedByte(em.code);\n\t\t//console.log ( \"  Emit dest: \", em );\n\t\treturn true;\n\t}\n\n\tpublic stringToMask(s:string):number\n\t{\n\t\tif (!s) return 0xf;\n\t\tvar r = 0;\n\t\tif (s.indexOf(\"x\") != -1) r |= 1;\n\t\tif (s.indexOf(\"y\") != -1) r |= 2;\n\t\tif (s.indexOf(\"z\") != -1) r |= 4;\n\t\tif (s.indexOf(\"w\") != -1) r |= 8;\n\t\treturn r;\n\t}\n\n\tpublic stringToSwizzle(s)\n\t{\n\t\tif (!s) {\n\t\t\treturn 0xe4;\n\t\t}\n\t\tvar chartoindex = { x:0, y:1, z:2, w:3 };\n\t\tvar sw = 0;\n\n\t\tif (s.charAt(0) != \".\") {\n\t\t\tthrow \"Missing . for swizzle\";\n\t\t}\n\n\t\tif (s.length > 1) {\n\t\t\tsw |= chartoindex[s.charAt(1)];\n\t\t}\n\n\t\tif (s.length > 2) {\n\t\t\tsw |= chartoindex[s.charAt(2)] << 2;\n\t\t} else {\n\t\t\tsw |= (sw & 3) << 2;\n\t\t}\n\n\t\tif (s.length > 3) {\n\t\t\tsw |= chartoindex[s.charAt(3)] << 4;\n\t\t} else {\n\t\t\tsw |= (sw & (3 << 2)) << 2;\n\t\t}\n\n\t\tif (s.length > 4) {\n\t\t\tsw |= chartoindex[s.charAt(4)] << 6;\n\t\t} else {\n\t\t\tsw |= (sw & (3 << 4)) << 2;\n\t\t}\n\n\t\treturn sw;\n\t}\n\n\tpublic emitSampler(pr:Part, token, opsrc, opts)\n\t{\n\t\tvar reg:string[] = token.match(/fs(\\d*)/i); // g1:regnum\n\t\tif (!reg || !reg[1]) {\n\t\t\treturn false;\n\t\t}\n\t\tpr.data.writeUnsignedShort(parseInt(reg[1]));\n\t\tpr.data.writeUnsignedByte(0);   // bias\n\t\tpr.data.writeUnsignedByte(0);\n\t\t/*\n\t\t pr.data.writeUnsignedByte ( 0x5 );\n\t\t pr.data.writeUnsignedByte ( 0 );   // readmode, dim\n\t\t pr.data.writeUnsignedByte ( 0 );   // special, wrap\n\t\t pr.data.writeUnsignedByte ( 0 );   // mip, filter\n\t\t */\n\t\tvar samplerbits:number = 0x5;\n\t\tvar sampleroptset:number = 0;\n\t\tfor (var i:number = 0; i < opts.length; i++) {\n\t\t\tvar o:Sampler = <Sampler> SamplerMap.map[ opts[i].toLowerCase() ];\n\n\t\t\t//console.log( 'AGALMiniAssembler' , 'emitSampler' , 'SampleMap opt:' , o , '<-------- WATCH FOR THIS');\n\n\t\t\tif (o) {\n\t\t\t\tif (((sampleroptset >> o.shift) & o.mask) != 0) {\n\t\t\t\t\tconsole.log(\"Warning, duplicate sampler option\");\n\t\t\t\t}\n\t\t\t\tsampleroptset |= o.mask << o.shift;\n\t\t\t\tsamplerbits &= ~(o.mask << o.shift);\n\t\t\t\tsamplerbits |= o.value << o.shift;\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Warning, unknown sampler option: \", opts[i]);\n\t\t\t\t// todo bias\n\t\t\t}\n\t\t}\n\t\tpr.data.writeUnsignedInt(samplerbits);\n\t\treturn true;\n\t}\n\n\tpublic emitSource(pr, token, opsrc)\n\t{\n\t\tvar indexed = token.match(/vc\\[(v[tcai])(\\d+)\\.([xyzw])([\\+\\-]\\d+)?\\](\\.[xyzw]{1,4})?/i); // g1: indexregname, g2:indexregnum, g3:select, [g4:offset], [g5:swizzle]\n\t\tvar reg;\n\t\tif (indexed) {\n\t\t\tif (!RegMap.map[indexed[1]]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar selindex = { x:0, y:1, z:2, w:3 };\n\t\t\tvar em:any = { num:indexed[2] | 0, code:RegMap.map[indexed[1]].code, swizzle:this.stringToSwizzle(indexed[5]), select:selindex[indexed[3]], offset:indexed[4] | 0 };\n\t\t\tpr.data.writeUnsignedShort(em.num);\n\t\t\tpr.data.writeByte(em.offset);\n\t\t\tpr.data.writeUnsignedByte(em.swizzle);\n\t\t\tpr.data.writeUnsignedByte(0x1); // constant reg\n\t\t\tpr.data.writeUnsignedByte(em.code);\n\t\t\tpr.data.writeUnsignedByte(em.select);\n\t\t\tpr.data.writeUnsignedByte(1 << 7);\n\t\t} else {\n\t\t\treg = token.match(/([fov]?[tpocidavs])(\\d*)(\\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:swizzle\n\t\t\tif (!RegMap.map[reg[1]]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar em:any = { num:reg[2] | 0, code:RegMap.map[reg[1]].code, swizzle:this.stringToSwizzle(reg[3]) };\n\t\t\tpr.data.writeUnsignedShort(em.num);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\tpr.data.writeUnsignedByte(em.swizzle);\n\t\t\tpr.data.writeUnsignedByte(em.code);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\t//console.log ( \"  Emit source: \", em, pr.data.length );\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic addHeader(partname, version)\n\t{\n\t\tif (!version) {\n\t\t\tversion = 1;\n\t\t}\n\t\tif (this.r[partname] == undefined) {\n\t\t\tthis.r[partname] = new Part(partname, version);\n\t\t\tthis.emitHeader(this.r[ partname ]);\n\t\t} else if (this.r[partname].version != version) {\n\t\t\tthrow \"Multiple versions for part \" + partname;\n\t\t}\n\t\tthis.cur = this.r[partname];\n\t}\n}\n\nexport = AGALMiniAssembler;","class FS\n{\n\tpublic format:string;\n\tpublic size:number;\n}\n\nexport = FS;\n","class Flags\n{\n\tpublic simple:boolean;\n\tpublic horizontal:boolean;\n\tpublic fragonly:boolean;\n\tpublic matrix:boolean;\n}\n\nexport = Flags;\n","import Opcode\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Opcode\");\n\nclass OpcodeMap\n{\n\t// dest:\t\t\t\t\t  \t\t\t\t\t   string,  aformat, asize, bformat,   bsize, opcode, simple, horizontal, fragonly   matrix\n\t/*\n\t public static mov:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x00,   true,   null,       null,      null );\n\t public static add:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x01,   true,   null,       null,      null );\n\n\t public static sub:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x02,   true,   null,       null,      null );\n\t public static mul:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x03,   true,   null,       null,      null );\n\t public static div:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x04,   true,   null,       null,      null );\n\t public static rcp:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x05,   true,   null,       null,      null );\n\t public static min:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x06,   true,   null,       null,      null );\n\t public static max:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x07,   true,   null,       null,      null );\n\t public static frc:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x08,   true,   null,       null,      null );\n\t public static sqt:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x09,   true,   null,       null,      null );\n\t public static rsq:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0a,   true,   null,       null,      null );\n\t public static pow:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x0b,   true,   null,       null,      null );\n\t public static log:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0c,   true,   null,       null,      null );\n\t public static exp:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0d,   true,   null,       null,      null );\n\t public static nrm:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0e,   true,   null,       null,      null );\n\t public static sin:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0f,   true,   null,       null,      null );\n\t public static cos:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x10,   true,   null,       null,      null );\n\t public static crs:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x11,   true,   true,       null,      null );\n\t public static dp3:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x12,   true,   true,       null,      null );\n\t public static dp4:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x13,   true,   true,       null,      null );\n\t public static abs:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x14,   true,   null,       null,      null );\n\t public static neg:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x15,   true,   null,       null,      null );\n\t public static sat:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x16,   true,   null,       null,      null );\n\n\t public static ted:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"sampler\", 1,     0x26,   true,   null,       true,      null );\n\t public static kil:Opcode = new Opcode( \"none\",   \"scalar\", 1,    \"none\",    0,     0x27,   true,   null,       true,      null );\n\t public static tex:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"sampler\", 1,     0x28,   true,   null,       true,      null );\n\n\t public static m33:Opcode = new Opcode( \"vector\", \"matrix\", 3,    \"vector\",  3,     0x17,   true,   null,       null,      true );\n\t public static m44:Opcode = new Opcode( \"vector\", \"matrix\", 4,    \"vector\",  4,     0x18,   true,   null,       null,      true );\n\t public static m43:Opcode = new Opcode( \"vector\", \"matrix\", 3,    \"vector\",  4,     0x19,   true,   null,       null,      true );\n\n\t public static sge:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x29,   true,   null,       null,      null );\n\t public static slt:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2a,   true,   null,       null,      null );\n\t public static sgn:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2b,   true,   null,       null,      null );\n\t public static seq:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2c,   true,   null,       null,      null );\n\t public static sne:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2d,   true,   null,       null,      null );\n\t */\n\n\n\tprivate static _map:Object[];\n\n\tpublic static get map():Object[]\n\t{\n\n\t\tif (!OpcodeMap._map) {\n\n\t\t\tOpcodeMap._map = new Array<Object>();\n\t\t\tOpcodeMap._map['mov'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x00, true, null, null, null);\n\t\t\tOpcodeMap._map['add'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x01, true, null, null, null);\n\t\t\tOpcodeMap._map['sub'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x02, true, null, null, null);\n\t\t\tOpcodeMap._map['mul'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x03, true, null, null, null);\n\t\t\tOpcodeMap._map['div'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x04, true, null, null, null);\n\t\t\tOpcodeMap._map['rcp'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x05, true, null, null, null);\n\t\t\tOpcodeMap._map['min'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x06, true, null, null, null);\n\t\t\tOpcodeMap._map['max'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x07, true, null, null, null);\n\t\t\tOpcodeMap._map['frc'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x08, true, null, null, null);\n\t\t\tOpcodeMap._map['sqt'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x09, true, null, null, null);\n\t\t\tOpcodeMap._map['rsq'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0a, true, null, null, null);\n\t\t\tOpcodeMap._map['pow'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x0b, true, null, null, null);\n\t\t\tOpcodeMap._map['log'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0c, true, null, null, null);\n\t\t\tOpcodeMap._map['exp'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0d, true, null, null, null);\n\t\t\tOpcodeMap._map['nrm'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0e, true, null, null, null);\n\t\t\tOpcodeMap._map['sin'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0f, true, null, null, null);\n\t\t\tOpcodeMap._map['cos'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x10, true, null, null, null);\n\t\t\tOpcodeMap._map['crs'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x11, true, true, null, null);\n\t\t\tOpcodeMap._map['dp3'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x12, true, true, null, null);\n\t\t\tOpcodeMap._map['dp4'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x13, true, true, null, null);\n\t\t\tOpcodeMap._map['abs'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x14, true, null, null, null);\n\t\t\tOpcodeMap._map['neg'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x15, true, null, null, null);\n\t\t\tOpcodeMap._map['sat'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x16, true, null, null, null);\n\n\t\t\tOpcodeMap._map['ted'] = new Opcode(\"vector\", \"vector\", 4, \"sampler\", 1, 0x26, true, null, true, null);\n\t\t\tOpcodeMap._map['kil'] = new Opcode(\"none\", \"scalar\", 1, \"none\", 0, 0x27, true, null, true, null);\n\t\t\tOpcodeMap._map['tex'] = new Opcode(\"vector\", \"vector\", 4, \"sampler\", 1, 0x28, true, null, true, null);\n\n\t\t\tOpcodeMap._map['m33'] = new Opcode(\"vector\", \"matrix\", 3, \"vector\", 3, 0x17, true, null, null, true);\n\t\t\tOpcodeMap._map['m44'] = new Opcode(\"vector\", \"matrix\", 4, \"vector\", 4, 0x18, true, null, null, true);\n\t\t\tOpcodeMap._map['m43'] = new Opcode(\"vector\", \"matrix\", 3, \"vector\", 4, 0x19, true, null, null, true);\n\n\t\t\tOpcodeMap._map['sge'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x29, true, null, null, null);\n\t\t\tOpcodeMap._map['slt'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2a, true, null, null, null);\n\t\t\tOpcodeMap._map['sgn'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2b, true, null, null, null);\n\t\t\tOpcodeMap._map['seq'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2c, true, null, null, null);\n\t\t\tOpcodeMap._map['sne'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2d, true, null, null, null);\n\n\n\t\t}\n\n\t\treturn OpcodeMap._map;\n\n\t}\n\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = OpcodeMap;","import Flags\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Flags\");\nimport FS\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/FS\");\n\n/**\n *\n */\nclass Opcode\n{\n\tpublic dest:string;\n\tpublic a:FS;\n\tpublic b:FS;\n\tpublic opcode:number;\n\tpublic flags:Flags;\n\n\tconstructor(dest:string, aformat:string, asize:number, bformat:string, bsize:number, opcode:number, simple:boolean, horizontal:boolean, fragonly:boolean, matrix:boolean)\n\t{\n\t\tthis.a = new FS();\n\t\tthis.b = new FS();\n\t\tthis.flags = new Flags();\n\n\t\tthis.dest = dest;\n\t\tthis.a.format = aformat;\n\t\tthis.a.size = asize;\n\t\tthis.b.format = bformat;\n\t\tthis.b.size = bsize;\n\t\tthis.opcode = opcode;\n\t\tthis.flags.simple = simple;\n\t\tthis.flags.horizontal = horizontal;\n\t\tthis.flags.fragonly = fragonly;\n\t\tthis.flags.matrix = matrix;\n\t}\n}\n\nexport = Opcode;\n","import ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nclass Part\n{\n\tpublic name:string = \"\";\n\tpublic version:number = 0;\n\tpublic data:ByteArray;\n\n\tconstructor(name:string = null, version:number = null)\n\t{\n\t\tthis.name = name;\n\t\tthis.version = version;\n\t\tthis.data = new ByteArray();\n\t}\n}\n\nexport = Part;","\nclass Reg\n{\n\n\tpublic code:number;\n\tpublic desc:string;\n\n\tconstructor(code:number, desc:string)\n\t{\n\t\tthis.code = code;\n\t\tthis.desc = desc;\n\t}\n}\n\nclass RegMap\n{\n\n\t/*\n\t public static map = [ new Reg( 0x00, \"vertex attribute\" ),\n\t new Reg( 0x01, \"fragment constant\" ),\n\t new Reg( 0x01, \"vertex constant\" ),\n\t new Reg( 0x02, \"fragment temporary\" ),\n\t new Reg( 0x02, \"vertex temporary\" ),\n\t new Reg( 0x03, \"vertex output\" ),\n\t new Reg( 0x03, \"vertex output\" ),\n\t new Reg( 0x03, \"fragment depth output\" ),\n\t new Reg( 0x03, \"fragment output\" ),\n\t new Reg( 0x03, \"fragment output\" ),\n\t new Reg( 0x04, \"varying\" ),\n\t new Reg( 0x04, \"varying output\" ),\n\t new Reg( 0x04, \"varying input\" ),\n\t new Reg( 0x05, \"sampler\" ) ];\n\t */\n\n\tprivate static _map:any[];\n\tpublic static get map():any[]\n\t{\n\n\t\tif (!RegMap._map) {\n\n\t\t\tRegMap._map = new Array<Object>();\n\t\t\tRegMap._map['va'] = new Reg(0x00, \"vertex attribute\");\n\t\t\tRegMap._map['fc'] = new Reg(0x01, \"fragment constant\");\n\t\t\tRegMap._map['vc'] = new Reg(0x01, \"vertex constant\")\n\t\t\tRegMap._map['ft'] = new Reg(0x02, \"fragment temporary\");\n\t\t\tRegMap._map['vt'] = new Reg(0x02, \"vertex temporary\");\n\t\t\tRegMap._map['vo'] = new Reg(0x03, \"vertex output\");\n\t\t\tRegMap._map['op'] = new Reg(0x03, \"vertex output\");\n\t\t\tRegMap._map['fd'] = new Reg(0x03, \"fragment depth output\");\n\t\t\tRegMap._map['fo'] = new Reg(0x03, \"fragment output\");\n\t\t\tRegMap._map['oc'] = new Reg(0x03, \"fragment output\");\n\t\t\tRegMap._map['v'] = new Reg(0x04, \"varying\")\n\t\t\tRegMap._map['vi'] = new Reg(0x04, \"varying output\");\n\t\t\tRegMap._map['fi'] = new Reg(0x04, \"varying input\");\n\t\t\tRegMap._map['fs'] = new Reg(0x05, \"sampler\");\n\n\n\t\t}\n\n\t\treturn RegMap._map;\n\n\t}\n\n\t/*\n\t public static va:Reg = new Reg( 0x00, \"vertex attribute\" );\n\t public static fc:Reg = new Reg( 0x01, \"fragment constant\" );\n\t public static vc:Reg = new Reg( 0x01, \"vertex constant\" );\n\t public static ft:Reg = new Reg( 0x02, \"fragment temporary\" );\n\t public static vt:Reg = new Reg( 0x02, \"vertex temporary\" );\n\t public static vo:Reg = new Reg( 0x03, \"vertex output\" );\n\t public static op:Reg = new Reg( 0x03, \"vertex output\" );\n\t public static fd:Reg = new Reg( 0x03, \"fragment depth output\" );\n\t public static fo:Reg = new Reg( 0x03, \"fragment output\" );\n\t public static oc:Reg = new Reg( 0x03, \"fragment output\" );\n\t public static v: Reg = new Reg( 0x04, \"varying\" );\n\t public static vi:Reg = new Reg( 0x04, \"varying output\" );\n\t public static fi:Reg = new Reg( 0x04, \"varying input\" );\n\t public static fs:Reg = new Reg( 0x05, \"sampler\" );\n\t */\n\tconstructor()\n\t{\n\t}\n}\n\nexport = RegMap;","import Sampler\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Sampler\");\n\nclass SamplerMap\n{\n\n\tprivate static _map:Object[];\n\n\tpublic static get map():Object[]\n\t{\n\n\t\tif (!SamplerMap._map) {\n\n\t\t\tSamplerMap._map = new Array<Object>();\n\t\t\tSamplerMap._map['rgba'] = new Sampler(8, 0xf, 0);\n\t\t\tSamplerMap._map['rg'] = new Sampler(8, 0xf, 5);\n\t\t\tSamplerMap._map['r'] = new Sampler(8, 0xf, 4);\n\t\t\tSamplerMap._map['compressed'] = new Sampler(8, 0xf, 1);\n\t\t\tSamplerMap._map['compressed_alpha'] = new Sampler(8, 0xf, 2);\n\t\t\tSamplerMap._map['dxt1'] = new Sampler(8, 0xf, 1);\n\t\t\tSamplerMap._map['dxt5'] = new Sampler(8, 0xf, 2);\n\n\t\t\t// dimension\n\t\t\tSamplerMap._map['2d'] = new Sampler(12, 0xf, 0);\n\t\t\tSamplerMap._map['cube'] = new Sampler(12, 0xf, 1);\n\t\t\tSamplerMap._map['3d'] = new Sampler(12, 0xf, 2);\n\n\t\t\t// special\n\t\t\tSamplerMap._map['centroid'] = new Sampler(16, 1, 1);\n\t\t\tSamplerMap._map['ignoresampler'] = new Sampler(16, 4, 4);\n\n\t\t\t// repeat\n\t\t\tSamplerMap._map['clamp'] = new Sampler(20, 0xf, 0);\n\t\t\tSamplerMap._map['repeat'] = new Sampler(20, 0xf, 1);\n\t\t\tSamplerMap._map['wrap'] = new Sampler(20, 0xf, 1);\n\n\t\t\t// mip\n\t\t\tSamplerMap._map['nomip'] = new Sampler(24, 0xf, 0);\n\t\t\tSamplerMap._map['mipnone'] = new Sampler(24, 0xf, 0);\n\t\t\tSamplerMap._map['mipnearest'] = new Sampler(24, 0xf, 1);\n\t\t\tSamplerMap._map['miplinear'] = new Sampler(24, 0xf, 2);\n\n\t\t\t// filter\n\t\t\tSamplerMap._map['nearest'] = new Sampler(28, 0xf, 0);\n\t\t\tSamplerMap._map['linear'] = new Sampler(28, 0xf, 1);\n\n\t\t}\n\n\t\treturn SamplerMap._map;\n\n\t}\n\n\t/*\n\t public static map =     [ new Sampler( 8, 0xf, 0 ),\n\t new Sampler( 8, 0xf, 5 ),\n\t new Sampler( 8, 0xf, 4 ),\n\t new Sampler( 8, 0xf, 1 ),\n\t new Sampler( 8, 0xf, 2 ),\n\t new Sampler( 8, 0xf, 1 ),\n\t new Sampler( 8, 0xf, 2 ),\n\n\t // dimension\n\t new Sampler( 12, 0xf, 0 ),\n\t new Sampler( 12, 0xf, 1 ),\n\t new Sampler( 12, 0xf, 2 ),\n\n\t // special\n\t new Sampler( 16, 1, 1 ),\n\t new Sampler( 16, 4, 4 ),\n\n\t // repeat\n\t new Sampler( 20, 0xf, 0 ),\n\t new Sampler( 20, 0xf, 1 ),\n\t new Sampler( 20, 0xf, 1 ),\n\n\t // mip\n\t new Sampler( 24, 0xf, 0 ),\n\t new Sampler( 24, 0xf, 0 ),\n\t new Sampler( 24, 0xf, 1 ),\n\t new Sampler( 24, 0xf, 2 ),\n\n\t // filter\n\t new Sampler( 28, 0xf, 0 ),\n\t new Sampler( 28, 0xf, 1 ) ]\n\t */\n\t/*\n\t public static rgba: Sampler = new Sampler( 8, 0xf, 0 );\n\t public static rg: Sampler = new Sampler( 8, 0xf, 5 );\n\t public static r: Sampler = new Sampler( 8, 0xf, 4 );\n\t public static compressed: Sampler = new Sampler( 8, 0xf, 1 );\n\t public static compressed_alpha: Sampler = new Sampler( 8, 0xf, 2 );\n\t public static dxt1: Sampler = new Sampler( 8, 0xf, 1 );\n\t public static dxt5: Sampler = new Sampler( 8, 0xf, 2 );\n\n\t // dimension\n\t public static sampler2d: Sampler = new Sampler( 12, 0xf, 0 );\n\t public static cube: Sampler = new Sampler( 12, 0xf, 1 );\n\t public static sampler3d: Sampler = new Sampler( 12, 0xf, 2 );\n\n\t // special\n\t public static centroid: Sampler = new Sampler( 16, 1, 1 );\n\t public static ignoresampler: Sampler = new Sampler( 16, 4, 4 );\n\n\t // repeat\n\t public static clamp: Sampler = new Sampler( 20, 0xf, 0 );\n\t public static repeat: Sampler = new Sampler( 20, 0xf, 1 );\n\t public static wrap: Sampler = new Sampler( 20, 0xf, 1 );\n\n\t // mip\n\t public static nomip: Sampler = new Sampler( 24, 0xf, 0 );\n\t public static mipnone: Sampler = new Sampler( 24, 0xf, 0 );\n\t public static mipnearest: Sampler = new Sampler( 24, 0xf, 1 );\n\t public static miplinear: Sampler = new Sampler( 24, 0xf, 2 );\n\n\t // filter\n\t public static nearest: Sampler = new Sampler( 28, 0xf, 0 );\n\t public static linear: Sampler = new Sampler( 28, 0xf, 1 );\n\t */\n\tconstructor()\n\t{\n\t}\n}\n\nexport = SamplerMap;","class Sampler\n{\n\tpublic shift:number;\n\tpublic mask:number;\n\tpublic value:number;\n\n\tconstructor(shift:number, mask:number, value:number)\n\t{\n\t\tthis.shift = shift;\n\t\tthis.mask = mask;\n\t\tthis.value = value;\n\t}\n}\n\nexport = Sampler;","class ContextGLBlendFactor\n{\n\tpublic static DESTINATION_ALPHA:string = \"destinationAlpha\";\n\tpublic static DESTINATION_COLOR:string = \"destinationColor\";\n\tpublic static ONE:string = \"one\";\n\tpublic static ONE_MINUS_DESTINATION_ALPHA:string = \"oneMinusDestinationAlpha\";\n\tpublic static ONE_MINUS_DESTINATION_COLOR:string = \"oneMinusDestinationColor\";\n\tpublic static ONE_MINUS_SOURCE_ALPHA:string = \"oneMinusSourceAlpha\";\n\tpublic static ONE_MINUS_SOURCE_COLOR:string = \"oneMinusSourceColor\";\n\tpublic static SOURCE_ALPHA:string = \"sourceAlpha\";\n\tpublic static SOURCE_COLOR:string = \"sourceColor\";\n\tpublic static ZERO:string = \"zero\";\n}\n\nexport = ContextGLBlendFactor;","class ContextGLClearMask\n{\n\tstatic COLOR:number = 1;\n\tstatic DEPTH:number = 2;\n\tstatic STENCIL:number = 4;\n\tstatic ALL:number = ContextGLClearMask.COLOR | ContextGLClearMask.DEPTH | ContextGLClearMask.STENCIL;\n}\n\nexport = ContextGLClearMask;","class ContextGLCompareMode\n{\n\tpublic static ALWAYS:string = \"always\";\n\tpublic static EQUAL:string = \"equal\";\n\tpublic static GREATER:string = \"greater\";\n\tpublic static GREATER_EQUAL:string = \"greaterEqual\";\n\tpublic static LESS:string = \"less\";\n\tpublic static LESS_EQUAL:string = \"lessEqual\";\n\tpublic static NEVER:string = \"never\";\n\tpublic static NOT_EQUAL:string = \"notEqual\";\n}\n\nexport = ContextGLCompareMode;","class ContextGLMipFilter\n{\n\tpublic static MIPLINEAR:string = \"miplinear\";\n\tpublic static MIPNEAREST:string = \"mipnearest\";\n\tpublic static MIPNONE:string = \"mipnone\";\n}\n\nexport = ContextGLMipFilter;","class ContextGLProfile\n{\n\tpublic static BASELINE:string = \"baseline\";\n\tpublic static BASELINE_CONSTRAINED:string = \"baselineConstrained\";\n\tpublic static BASELINE_EXTENDED:string = \"baselineExtended\";\n}\nexport = ContextGLProfile;","class ContextGLProgramType\n{\n\tstatic FRAGMENT:string = \"fragment\";\n\tstatic VERTEX:string = \"vertex\";\n}\n\nexport = ContextGLProgramType;","class ContextGLStencilAction\n{\n\tpublic static DECREMENT_SATURATE:string = \"decrementSaturate\";\n\tpublic static DECREMENT_WRAP:string = \"decrementWrap\";\n\tpublic static INCREMENT_SATURATE:string = \"incrementSaturate\";\n\tpublic static INCREMENT_WRAP:string = \"incrementWrap\";\n\tpublic static INVERT:string = \"invert\";\n\tpublic static KEEP:string = \"keep\";\n\tpublic static SET:string = \"set\";\n\tpublic static ZERO:string = \"zero\";\n}\n\nexport = ContextGLStencilAction;","class ContextGLTextureFilter\n{\n\tpublic static LINEAR:string = \"linear\";\n\tpublic static NEAREST:string = \"nearest\";\n}\n\nexport = ContextGLTextureFilter;","class ContextGLTextureFormat\n{\n\tstatic BGRA:string = \"bgra\";\n\tstatic BGRA_PACKED:string = \"bgraPacked4444\";\n\tstatic BGR_PACKED:string = \"bgrPacked565\";\n\tstatic COMPRESSED:string = \"compressed\";\n\tstatic COMPRESSED_ALPHA:string = \"compressedAlpha\";\n}\n\nexport = ContextGLTextureFormat;","class ContextGLTriangleFace\n{\n\tstatic BACK:string = \"back\";\n\tstatic FRONT:string = \"front\";\n\tstatic FRONT_AND_BACK:string = \"frontAndBack\";\n\tstatic NONE:string = \"none\";\n}\n\nexport = ContextGLTriangleFace;","class ContextGLVertexBufferFormat\n{\n\tstatic BYTES_4:string = \"bytes4\";\n\tstatic FLOAT_1:string = \"float1\";\n\tstatic FLOAT_2:string = \"float2\";\n\tstatic FLOAT_3:string = \"float3\";\n\tstatic FLOAT_4:string = \"float4\";\n}\n\nexport = ContextGLVertexBufferFormat;","class ContextGLWrapMode\n{\n\tpublic static CLAMP:string = \"clamp\";\n\tpublic static REPEAT:string = \"repeat\";\n}\n\nexport = ContextGLWrapMode;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\n\nimport swfobject\t\t\t\t\t= require(\"awayjs-stagegl/lib/swfobject\");\nimport Sampler\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Sampler\");\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport CubeTextureFlash\t\t\t\t= require(\"awayjs-stagegl/lib/base/CubeTextureFlash\");\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IndexBufferFlash\t\t\t\t= require(\"awayjs-stagegl/lib/base/IndexBufferFlash\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ProgramFlash\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ProgramFlash\");\nimport TextureFlash\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureFlash\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\nimport VertexBufferFlash\t\t\t= require(\"awayjs-stagegl/lib/base/VertexBufferFlash\");\n\nclass ContextStage3D implements IContextGL\n{\n\tpublic static contexts:Object = new Object();\n\tpublic static maxvertexconstants:number = 128;\n\tpublic static maxfragconstants:number = 28;\n\tpublic static maxtemp:number = 8;\n\tpublic static maxstreams:number = 8;\n\tpublic static maxtextures:number = 8;\n\tpublic static defaultsampler = new Sampler();\n\n\tpublic _iDriverInfo;\n\n\tprivate _container:HTMLElement;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _cmdStream:string = \"\";\n\tprivate _errorCheckingEnabled:boolean;\n\tprivate _resources:Array<ResourceBaseFlash>;\n\tprivate _oldCanvas:HTMLCanvasElement;\n\tprivate _oldParent:HTMLElement;\n\n\n\tpublic static debug:boolean = false;\n\tpublic static logStream:boolean = false;\n\n\tpublic _iCallback:(context:IContextGL) => void;\n\n\tpublic get container():HTMLElement\n\t{\n\t\treturn this._container;\n\t}\n\n\tpublic get driverInfo()\n\t{\n\t\treturn this._iDriverInfo;\n\t}\n\n\tpublic get errorCheckingEnabled():boolean\n\t{\n\t\treturn this._errorCheckingEnabled;\n\t}\n\n\tpublic set errorCheckingEnabled(value:boolean)\n\t{\n\t\tif (this._errorCheckingEnabled == value)\n\t\t\treturn;\n\n\t\tthis._errorCheckingEnabled = value;\n\n\t\tthis.addStream(String.fromCharCode(OpCodes.enableErrorChecking, value? OpCodes.trueValue : OpCodes.falseValue));\n\t\tthis.execute();\n\t}\n\n\t//TODO: get rid of hack that fixes including definition file\n\tconstructor(container:HTMLCanvasElement, callback:(context:IContextGL) => void, include?:Sampler)\n\t{\n\t\tthis._resources = new Array<ResourceBaseFlash>();\n\n\t\tvar swfVersionStr = \"11.0.0\";\n\n\t\t// To use express install, set to playerProductInstall.swf, otherwise the empty string.\n\t\tvar flashvars = {\n\t\t\tid:container.id\n\t\t};\n\n\t\tvar params = {\n\t\t\tquality:\"high\",\n\t\t\tbgcolor:\"#ffffff\",\n\t\t\tallowscriptaccess:\"sameDomain\",\n\t\t\tallowfullscreen:\"true\",\n\t\t\twmode:\"direct\"\n\t\t};\n\n\t\tthis._errorCheckingEnabled = false;\n\t\tthis._iDriverInfo = \"Unknown\";\n\n\t\tvar attributes = {\n\t\t\tsalign:\"tl\",\n\t\t\tid:container.id,\n\t\t\tname:container[\"name\"] //TODO: needed?\n\t\t};\n\n\t\tthis._oldCanvas = <HTMLCanvasElement> container.cloneNode(); // keep the old one to restore on dispose\n\t\tthis._oldParent = <HTMLElement> container.parentNode;\n\n\t\tvar context3dObj = this;\n\t\tContextStage3D.contexts[container.id] = this;\n\n\t\tfunction callbackSWFObject(callbackInfo)\n\t\t{\n\t\t\tif (!callbackInfo.success)\n\t\t\t\treturn;\n\n\t\t\tcontext3dObj._container = callbackInfo.ref;\n\t\t\tcontext3dObj._iCallback = callback;\n\t\t}\n\n\t\tswfobject.embedSWF(\"libs/molehill_js_flashbridge.swf\", container.id, String(container.width), String(container.height), swfVersionStr, \"\", flashvars, params, attributes, callbackSWFObject);\n\t}\n\n\tpublic _iAddResource(resource:ResourceBaseFlash)\n\t{\n\t\tthis._resources.push(resource);\n\t}\n\n\tpublic _iRemoveResource(resource:ResourceBaseFlash)\n\t{\n\t\tthis._resources.splice(this._resources.indexOf(resource));\n\t}\n\n\tpublic createTexture(width:number, height:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):TextureFlash\n\t{\n\t\t//TODO:streaming\n\t\treturn new TextureFlash(this, width, height, format, optimizeForRenderToTexture);\n\t}\n\n\tpublic createCubeTexture(size:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):CubeTextureFlash\n\t{\n\t\t//TODO:streaming\n\t\treturn new CubeTextureFlash(this, size, format, optimizeForRenderToTexture);\n\t}\n\n\n\tpublic setTextureAt(sampler:number, texture:ResourceBaseFlash)\n\t{\n\t\tif (texture) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setTextureAt) + sampler + \",\" + texture.id + \",\");\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearTextureAt) + sampler.toString() + \",\");\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setSamplerStateAt(sampler:number, wrap:string, filter:string, mipfilter:string):void\n\t{\n\t\t//nothing to do here\n\t}\n\n\tpublic setStencilActions(triangleFace:string = \"frontAndBack\", compareMode:string = \"always\", actionOnBothPass:string = \"keep\", actionOnDepthFail:string = \"keep\", actionOnDepthPassStencilFail:string = \"keep\")\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setStencilActions) + triangleFace + \"$\" + compareMode + \"$\" + actionOnBothPass + \"$\" + actionOnDepthFail + \"$\" + actionOnDepthPassStencilFail + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setStencilReferenceValue(referenceValue:number, readMask:number = 255, writeMask:number = 255)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setStencilReferenceValue, referenceValue + OpCodes.intMask, readMask + OpCodes.intMask, writeMask + OpCodes.intMask));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setCulling(triangleFaceToCull:string, coordinateSystem:string = \"leftHanded\")\n\t{\n\t\t//TODO implement coordinateSystem option\n\t\tthis.addStream(String.fromCharCode(OpCodes.setCulling) + triangleFaceToCull + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic drawTriangles(indexBuffer:IndexBufferFlash, firstIndex:number = 0, numTriangles:number = -1)\n\t{\n\t\tfirstIndex = firstIndex || 0;\n\t\tif (!numTriangles || numTriangles < 0)\n\t\t\tnumTriangles = indexBuffer.numIndices/3;\n\n\t\tthis.addStream(String.fromCharCode(OpCodes.drawTriangles, indexBuffer.id + OpCodes.intMask) + firstIndex + \",\" + numTriangles + \",\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setProgramConstantsFromMatrix(programType:string, firstRegister:number, matrix:Matrix3D, transposedMatrix:boolean = false)\n\t{\n\t\t//this._gl.uniformMatrix4fv(this._gl.getUniformLocation(this._currentProgram.glProgram, this._uniformLocationNameDictionary[programType]), !transposedMatrix, new Float32Array(matrix.rawData));\n\n\t\t//TODO remove special case for WebGL matrix calls?\n\t\tvar d:number[] = matrix.rawData;\n\t\tif (transposedMatrix) {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[4], d[8], d[12] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[1], d[5], d[9], d[13] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[2], d[6], d[10], d[14] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[3], d[7], d[11], d[15] ], 1);\n\t\t} else {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[1], d[2], d[3] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[4], d[5], d[6], d[7] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[8], d[9], d[10], d[11] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[12], d[13], d[14], d[15] ], 1);\n\t\t}\n\t}\n\n\tpublic setProgramConstantsFromArray(programType:string, firstRegister:number, data:number[], numRegisters:number = -1)\n\t{\n\t\tvar startIndex:number;\n\t\tvar target:number = (programType == ContextGLProgramType.VERTEX)? OpCodes.trueValue : OpCodes.falseValue;\n\t\tfor (var i:number = 0; i < numRegisters; i++) {\n\t\t\tstartIndex = i*4;\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setProgramConstant, target, (firstRegister + i) + OpCodes.intMask) + data[startIndex] + \",\" + data[startIndex + 1] + \",\" + data[startIndex + 2] + \",\" + data[startIndex + 3] + \",\");\n\n\t\t\tif (ContextStage3D.debug)\n\t\t\t\tthis.execute();\n\t\t}\n\t}\n\n\tpublic setProgram(program:ProgramFlash)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setProgram, program.id + OpCodes.intMask));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic present()\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.present));\n\t\tthis.execute();\n\t}\n\n\tpublic clear(red:number = 0, green:number = 0, blue:number = 0, alpha:number = 1, depth:number = 1, stencil:number = 0, mask:number = ContextGLClearMask.ALL)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.clear) + red + \",\" + green + \",\" + blue + \",\" + alpha + \",\" + depth + \",\" + stencil + \",\" + mask + \",\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic createProgram():ProgramFlash\n\t{\n\t\treturn new ProgramFlash(this);\n\t}\n\n\tpublic createVertexBuffer(numVertices:number, data32PerVertex:number):VertexBufferFlash\n\t{\n\t\treturn new VertexBufferFlash(this, numVertices, data32PerVertex);\n\t}\n\n\tpublic createIndexBuffer(numIndices:number):IndexBufferFlash\n\t{\n\t\treturn new IndexBufferFlash(this, numIndices);\n\t}\n\n\tpublic configureBackBuffer(width:number, height:number, antiAlias:number, enableDepthAndStencil:boolean = true)\n\t{\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\t//TODO: add Anitalias setting\n\t\tthis.addStream(String.fromCharCode(OpCodes.configureBackBuffer) + width + \",\" + height + \",\");\n\t}\n\n\tpublic drawToBitmapData(destination:BitmapData)\n\t{\n\t\t//TODO\n\t}\n\n\tpublic setVertexBufferAt(index:number, buffer:VertexBufferFlash, bufferOffset:number = 0, format:string = null)\n\t{\n\t\tif (buffer) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setVertexBufferAt, index + OpCodes.intMask) + buffer.id + \",\" + bufferOffset + \",\" + format + \"$\");\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearVertexBufferAt, index + OpCodes.intMask));\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setColorMask(red:boolean, green:boolean, blue:boolean, alpha:boolean)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setColorMask, red? OpCodes.trueValue : OpCodes.falseValue, green? OpCodes.trueValue : OpCodes.falseValue, blue? OpCodes.trueValue : OpCodes.falseValue, alpha? OpCodes.trueValue : OpCodes.falseValue));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setBlendFactors(sourceFactor:string, destinationFactor:string)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setBlendFactors) + sourceFactor + \"$\" + destinationFactor + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setRenderToTexture(target:ResourceBaseFlash, enableDepthAndStencil:boolean = false, antiAlias:number = 0, surfaceSelector:number = 0)\n\t{\n\t\tif (target === null || target === undefined) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearRenderToTexture));\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setRenderToTexture, enableDepthAndStencil? OpCodes.trueValue : OpCodes.falseValue) + target.id + \",\" + (antiAlias || 0) + \",\");\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\n\tpublic setRenderToBackBuffer()\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.clearRenderToTexture));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setScissorRectangle(rectangle:Rectangle)\n\t{\n\t\tif (rectangle) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setScissorRect) + rectangle.x + \",\" + rectangle.y + \",\" + rectangle.width + \",\" + rectangle.height + \",\");\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearScissorRect));\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setDepthTest(depthMask:boolean, passCompareMode:string)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setDepthTest, depthMask? OpCodes.trueValue : OpCodes.falseValue) + passCompareMode + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic dispose()\n\t{\n\t\tif (this._container == null)\n\t\t\treturn;\n\n\t\tconsole.log(\"Context3D dispose, releasing \" + this._resources.length + \" resources.\");\n\n\t\twhile (this._resources.length)\n\t\t\tthis._resources[0].dispose();\n\n\t\tif (this._container) {\n\t\t\t// encode command\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.disposeContext));\n\t\t\tthis.execute();\n\t\t\tswfobject.removeSWF(this._oldCanvas.id);\n\t\t\tif (this._oldCanvas && this._oldParent) {\n\t\t\t\tthis._oldParent.appendChild(this._oldCanvas);\n\t\t\t\tthis._oldParent = null;\n\t\t\t}\n\t\t\tthis._container = null;\n\t\t}\n\n\t\tthis._oldCanvas = null;\n\t}\n\n\tpublic addStream(stream:string)\n\t{\n\t\tthis._cmdStream += stream;\n\t}\n\n\tpublic execute():number\n\t{\n\t\tif (ContextStage3D.logStream)\n\t\t\tconsole.log(this._cmdStream);\n\n\t\tvar result:number = this._container[\"CallFunction\"](\"<invoke name=\\\"execStage3dOpStream\\\" returntype=\\\"javascript\\\"><arguments><string>\" + this._cmdStream + \"</string></arguments></invoke>\");\n\n\t\tif (Number(result) <= -3)\n\t\t\tthrow \"Exec stream failed\";\n\n\t\tthis._cmdStream = \"\";\n\n\t\treturn Number(result);\n\t}\n}\n\nexport = ContextStage3D;\n\n/**\n* global function for flash callback\n*/\nfunction mountain_js_context_available(id, driverInfo)\n{\n\tvar ctx:ContextStage3D = ContextStage3D.contexts[id];\n\tif (ctx._iCallback) {\n\t\tctx._iDriverInfo = driverInfo;\n\t\t// get out of the current JS stack frame and call back from flash player\n\t\tvar timeOutId = window.setTimeout(function ()\n\t\t{\n\t\t\twindow.clearTimeout(timeOutId);\n\t\t\ttry {\n\t\t\t\tctx._iCallback(ctx);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(\"Callback failed during flash initialization with '\" + e.toString() + \"'\");\n\t\t\t}\n\t\t}, 1);\n\t}\n}\n","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLTriangleFace\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport CubeTextureWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/CubeTextureWebGL\");\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IndexBufferWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IndexBufferWebGL\");\nimport ProgramWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ProgramWebGL\");\nimport TextureBaseWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureBaseWebGL\");\nimport TextureWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureWebGL\");\nimport SamplerState\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/SamplerState\");\nimport VertexBufferWebGL\t\t\t= require(\"awayjs-stagegl/lib/base/VertexBufferWebGL\");\n\nclass ContextWebGL implements IContextGL\n{\n\tprivate _blendFactorDictionary:Object = new Object();\n\tprivate _depthTestDictionary:Object = new Object();\n\tprivate _textureIndexDictionary:Array<number> = new Array<number>(8);\n\tprivate _textureTypeDictionary:Object = new Object();\n\tprivate _wrapDictionary:Object = new Object();\n\tprivate _filterDictionary:Object = new Object();\n\tprivate _mipmapFilterDictionary:Object = new Object();\n\tprivate _uniformLocationNameDictionary:Object = new Object();\n\tprivate _vertexBufferDimensionDictionary:Object = new Object();\n\n\tprivate _container:HTMLElement;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _drawing:boolean;\n\tprivate _blendEnabled:boolean;\n\tprivate _blendSourceFactor:number;\n\tprivate _blendDestinationFactor:number;\n\n\tprivate _indexBufferList:Array<IndexBufferWebGL> = new Array<IndexBufferWebGL>();\n\tprivate _vertexBufferList:Array<VertexBufferWebGL> = new Array<VertexBufferWebGL>();\n\tprivate _textureList:Array<TextureBaseWebGL> = new Array<TextureBaseWebGL>();\n\tprivate _programList:Array<ProgramWebGL> = new Array<ProgramWebGL>();\n\n\tprivate _samplerStates:Array<SamplerState> = new Array<SamplerState>(8);\n\n\tpublic static MAX_SAMPLERS:number = 8;\n\n\t//@protected\n\tpublic _gl:WebGLRenderingContext;\n\n\t//@protected\n\tpublic _currentProgram:ProgramWebGL;\n\tprivate _activeTexture:number;\n\n\n\tpublic get container():HTMLElement\n\t{\n\t\treturn this._container;\n\t}\n\n\tconstructor(canvas:HTMLCanvasElement)\n\t{\n\t\tthis._container = canvas;\n\n\t\ttry {\n\t\t\tthis._gl = <WebGLRenderingContext> canvas.getContext(\"experimental-webgl\", { premultipliedAlpha:false, alpha:false });\n\n\t\t\tif (!this._gl)\n\t\t\t\tthis._gl = <WebGLRenderingContext> canvas.getContext(\"webgl\", { premultipliedAlpha:false, alpha:false });\n\t\t} catch (e) {\n\t\t\t//this.dispatchEvent( new away.events.AwayEvent( away.events.AwayEvent.INITIALIZE_FAILED, e ) );\n\t\t}\n\n\t\tif (this._gl) {\n\t\t\t//this.dispatchEvent( new away.events.AwayEvent( away.events.AwayEvent.INITIALIZE_SUCCESS ) );\n\t\t\t//setup shortcut dictionaries\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE] = this._gl.ONE;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_ALPHA] = this._gl.DST_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_COLOR] = this._gl.DST_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE] = this._gl.ONE;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA] = this._gl.ONE_MINUS_DST_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR] = this._gl.ONE_MINUS_DST_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA] = this._gl.ONE_MINUS_SRC_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR] = this._gl.ONE_MINUS_SRC_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.SOURCE_ALPHA] = this._gl.SRC_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.SOURCE_COLOR] = this._gl.SRC_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ZERO] = this._gl.ZERO;\n\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.ALWAYS] = this._gl.ALWAYS;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.EQUAL] = this._gl.EQUAL;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.GREATER] = this._gl.GREATER;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.GREATER_EQUAL] = this._gl.GEQUAL;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.LESS] = this._gl.LESS;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.LESS_EQUAL] = this._gl.LEQUAL;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.NEVER] = this._gl.NEVER;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.NOT_EQUAL] = this._gl.NOTEQUAL;\n\n\t\t\tthis._textureIndexDictionary[0] = this._gl.TEXTURE0;\n\t\t\tthis._textureIndexDictionary[1] = this._gl.TEXTURE1;\n\t\t\tthis._textureIndexDictionary[2] = this._gl.TEXTURE2;\n\t\t\tthis._textureIndexDictionary[3] = this._gl.TEXTURE3;\n\t\t\tthis._textureIndexDictionary[4] = this._gl.TEXTURE4;\n\t\t\tthis._textureIndexDictionary[5] = this._gl.TEXTURE5;\n\t\t\tthis._textureIndexDictionary[6] = this._gl.TEXTURE6;\n\t\t\tthis._textureIndexDictionary[7] = this._gl.TEXTURE7;\n\n\t\t\tthis._textureTypeDictionary[\"texture2d\"] = this._gl.TEXTURE_2D;\n\t\t\tthis._textureTypeDictionary[\"textureCube\"] = this._gl.TEXTURE_CUBE_MAP;\n\n\t\t\tthis._wrapDictionary[ContextGLWrapMode.REPEAT] = this._gl.REPEAT;\n\t\t\tthis._wrapDictionary[ContextGLWrapMode.CLAMP] = this._gl.CLAMP_TO_EDGE;\n\n\t\t\tthis._filterDictionary[ContextGLTextureFilter.LINEAR] = this._gl.LINEAR;\n\t\t\tthis._filterDictionary[ContextGLTextureFilter.NEAREST] = this._gl.NEAREST;\n\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR] = new Object();\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNEAREST] = this._gl.LINEAR_MIPMAP_NEAREST;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPLINEAR] = this._gl.LINEAR_MIPMAP_LINEAR;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNONE] = this._gl.LINEAR;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST] = new Object();\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNEAREST] = this._gl.NEAREST_MIPMAP_NEAREST;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPLINEAR] = this._gl.NEAREST_MIPMAP_LINEAR;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNONE] = this._gl.NEAREST;\n\n\t\t\tthis._uniformLocationNameDictionary[ContextGLProgramType.VERTEX] = \"vc\";\n\t\t\tthis._uniformLocationNameDictionary[ContextGLProgramType.FRAGMENT] = \"fc\";\n\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_1] = 1;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_2] = 2;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_3] = 3;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_4] = 4;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.BYTES_4] = 4;\n\t\t} else {\n\t\t\t//this.dispatchEvent( new away.events.AwayEvent( away.events.AwayEvent.INITIALIZE_FAILED, e ) );\n\t\t\talert(\"WebGL is not available.\");\n\t\t}\n\n\t\t//defaults\n\t\tfor (var i:number = 0; i < ContextWebGL.MAX_SAMPLERS; ++i) {\n\t\t\tthis._samplerStates[i] = new SamplerState();\n\t\t\tthis._samplerStates[i].wrap = this._gl.REPEAT;\n\t\t\tthis._samplerStates[i].filter = this._gl.LINEAR;\n\t\t\tthis._samplerStates[i].mipfilter = this._gl.LINEAR;\n\t\t}\n\t}\n\n\tpublic gl():WebGLRenderingContext\n\t{\n\t\treturn this._gl;\n\t}\n\n\tpublic clear(red:number = 0, green:number = 0, blue:number = 0, alpha:number = 1, depth:number = 1, stencil:number = 0, mask:number = ContextGLClearMask.ALL)\n\t{\n\t\tif (!this._drawing) {\n\t\t\tthis.updateBlendStatus();\n\t\t\tthis._drawing = true;\n\t\t}\n\n\t\tvar glmask:number = 0;\n\t\tif (mask & ContextGLClearMask.COLOR) glmask |= this._gl.COLOR_BUFFER_BIT;\n\t\tif (mask & ContextGLClearMask.STENCIL) glmask |= this._gl.STENCIL_BUFFER_BIT;\n\t\tif (mask & ContextGLClearMask.DEPTH) glmask |= this._gl.DEPTH_BUFFER_BIT;\n\n\t\tthis._gl.clearColor(red, green, blue, alpha);\n\t\tthis._gl.clearDepth(depth);\n\t\tthis._gl.clearStencil(stencil);\n\t\tthis._gl.clear(glmask);\n\t}\n\n\tpublic configureBackBuffer(width:number, height:number, antiAlias:number, enableDepthAndStencil:boolean = true)\n\t{\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tif (enableDepthAndStencil) {\n\t\t\tthis._gl.enable(this._gl.STENCIL_TEST);\n\t\t\tthis._gl.enable(this._gl.DEPTH_TEST);\n\t\t}\n\n\t\tthis._gl.viewport['width'] = width;\n\t\tthis._gl.viewport['height'] = height;\n\n\t\tthis._gl.viewport(0, 0, width, height);\n\t}\n\n\tpublic createCubeTexture(size:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):CubeTextureWebGL\n\t{\n\t\tvar texture:CubeTextureWebGL = new CubeTextureWebGL(this._gl, size);\n\t\tthis._textureList.push(texture);\n\t\treturn texture;\n\t}\n\n\tpublic createIndexBuffer(numIndices:number):IndexBufferWebGL\n\t{\n\t\tvar indexBuffer:IndexBufferWebGL = new IndexBufferWebGL(this._gl, numIndices);\n\t\tthis._indexBufferList.push(indexBuffer);\n\t\treturn indexBuffer;\n\t}\n\n\tpublic createProgram():ProgramWebGL\n\t{\n\t\tvar program:ProgramWebGL = new ProgramWebGL(this._gl);\n\t\tthis._programList.push(program);\n\t\treturn program;\n\t}\n\n\tpublic createTexture(width:number, height:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):TextureWebGL\n\t{\n\t\t//TODO streaming\n\t\tvar texture:TextureWebGL = new TextureWebGL(this._gl, width, height);\n\t\tthis._textureList.push(texture);\n\t\treturn texture;\n\t}\n\n\tpublic createVertexBuffer(numVertices:number, data32PerVertex:number):VertexBufferWebGL\n\t{\n\t\tvar vertexBuffer:VertexBufferWebGL = new VertexBufferWebGL(this._gl, numVertices, data32PerVertex);\n\t\tthis._vertexBufferList.push(vertexBuffer);\n\t\treturn vertexBuffer;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tvar i:number;\n\t\tfor (i = 0; i < this._indexBufferList.length; ++i)\n\t\t\tthis._indexBufferList[i].dispose();\n\n\t\tthis._indexBufferList = null;\n\n\t\tfor (i = 0; i < this._vertexBufferList.length; ++i)\n\t\t\tthis._vertexBufferList[i].dispose();\n\n\t\tthis._vertexBufferList = null;\n\n\t\tfor (i = 0; i < this._textureList.length; ++i)\n\t\t\tthis._textureList[i].dispose();\n\n\t\tthis._textureList = null;\n\n\t\tfor (i = 0; i < this._programList.length; ++i)\n\t\t\tthis._programList[i].dispose();\n\n\t\tfor (i = 0; i < this._samplerStates.length; ++i)\n\t\t\tthis._samplerStates[i] = null;\n\n\t\tthis._programList = null;\n\t}\n\n\tpublic drawToBitmapData(destination:BitmapData)\n\t{\n\t\tvar arrayBuffer:ArrayBuffer = new ArrayBuffer(destination.width*destination.height*4);\n\n\t\tthis._gl.readPixels(0, 0, destination.width, destination.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, new Uint8Array(arrayBuffer));\n\n\t\tvar byteArray:ByteArray = new ByteArray();\n\t\tbyteArray.setArrayBuffer(arrayBuffer);\n\n\t\tdestination.setPixels(new Rectangle(0, 0, destination.width, destination.height), byteArray);\n\t}\n\n\tpublic drawTriangles(indexBuffer:IndexBufferWebGL, firstIndex:number = 0, numTriangles:number = -1)\n\t{\n\t\tif (!this._drawing)\n\t\t\tthrow \"Need to clear before drawing if the buffer has not been cleared since the last present() call.\";\n\n\t\tthis._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, indexBuffer.glBuffer);\n\t\tthis._gl.drawElements(this._gl.TRIANGLES, (numTriangles == -1)? indexBuffer.numIndices : numTriangles*3, this._gl.UNSIGNED_SHORT, firstIndex);\n\t}\n\n\tpublic present()\n\t{\n\t\tthis._drawing = false;\n\t}\n\n\tpublic setBlendFactors(sourceFactor:string, destinationFactor:string)\n\t{\n\t\tthis._blendEnabled = true;\n\n\t\tthis._blendSourceFactor = this._blendFactorDictionary[sourceFactor];\n\n\t\tthis._blendDestinationFactor = this._blendFactorDictionary[destinationFactor];\n\n\t\tthis.updateBlendStatus();\n\t}\n\n\tpublic setColorMask(red:boolean, green:boolean, blue:boolean, alpha:boolean)\n\t{\n\t\tthis._gl.colorMask(red, green, blue, alpha);\n\t}\n\n\tpublic setCulling(triangleFaceToCull:string, coordinateSystem:string = \"leftHanded\")\n\t{\n\t\tif (triangleFaceToCull == ContextGLTriangleFace.NONE) {\n\t\t\tthis._gl.disable(this._gl.CULL_FACE);\n\t\t} else {\n\t\t\tthis._gl.enable(this._gl.CULL_FACE);\n\t\t\tswitch (triangleFaceToCull) {\n\t\t\t\tcase ContextGLTriangleFace.BACK:\n\t\t\t\t\tthis._gl.cullFace((coordinateSystem == \"leftHanded\")? this._gl.FRONT : this._gl.BACK);\n\t\t\t\t\tbreak\n\t\t\t\tcase ContextGLTriangleFace.FRONT:\n\t\t\t\t\tthis._gl.cullFace((coordinateSystem == \"leftHanded\")? this._gl.BACK : this._gl.FRONT);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextGLTriangleFace.FRONT_AND_BACK:\n\t\t\t\t\tthis._gl.cullFace(this._gl.FRONT_AND_BACK);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow \"Unknown ContextGLTriangleFace type.\"; // TODO error\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO ContextGLCompareMode\n\tpublic setDepthTest(depthMask:boolean, passCompareMode:string)\n\t{\n\t\tthis._gl.depthFunc(this._depthTestDictionary[passCompareMode]);\n\n\t\tthis._gl.depthMask(depthMask);\n\t}\n\n\tpublic setProgram(program:ProgramWebGL)\n\t{\n\t\t//TODO decide on construction/reference resposibilities\n\t\tthis._currentProgram = program;\n\t\tprogram.focusProgram();\n\t}\n\n\tpublic setProgramConstantsFromMatrix(programType:string, firstRegister:number, matrix:Matrix3D, transposedMatrix:boolean = false)\n\t{\n\t\t//this._gl.uniformMatrix4fv(this._gl.getUniformLocation(this._currentProgram.glProgram, this._uniformLocationNameDictionary[programType]), !transposedMatrix, new Float32Array(matrix.rawData));\n\n\t\t//TODO remove special case for WebGL matrix calls?\n\t\tvar d:number[] = matrix.rawData;\n\t\tif (transposedMatrix) {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[4], d[8], d[12] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[1], d[5], d[9], d[13] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[2], d[6], d[10], d[14] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[3], d[7], d[11], d[15] ], 1);\n\t\t} else {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[1], d[2], d[3] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[4], d[5], d[6], d[7] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[8], d[9], d[10], d[11] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[12], d[13], d[14], d[15] ], 1);\n\t\t}\n\t}\n\n\tpublic static modulo:number = 0;\n\n\tpublic setProgramConstantsFromArray(programType:string, firstRegister:number, data:number[], numRegisters:number = -1)\n\t{\n\t\tvar locationName:string = this._uniformLocationNameDictionary[programType];\n\t\tvar startIndex:number;\n\t\tfor (var i:number = 0; i < numRegisters; i++) {\n\t\t\tstartIndex = i*4;\n\t\t\tthis._gl.uniform4f(this._gl.getUniformLocation(this._currentProgram.glProgram, locationName + (firstRegister + i)), data[startIndex], data[startIndex + 1], data[startIndex + 2], data[startIndex + 3]);\n\t\t}\n\t}\n\n\tpublic setScissorRectangle(rectangle:Rectangle)\n\t{\n\t\tif (!rectangle) {\n\t\t\tthis._gl.disable(this._gl.SCISSOR_TEST);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.enable(this._gl.SCISSOR_TEST);\n\t\tthis._gl.scissor(rectangle.x, rectangle.y, rectangle.width, rectangle.height);\n\t}\n\n\tpublic setTextureAt(sampler:number, texture:TextureBaseWebGL)\n\t{\n\t\tvar samplerState:SamplerState = this._samplerStates[sampler];\n\n\t\tif (this._activeTexture != sampler && (texture || samplerState.type)) {\n\t\t\tthis._activeTexture = sampler;\n\t\t\tthis._gl.activeTexture(this._textureIndexDictionary[sampler]);\n\t\t}\n\n\t\tif (!texture) {\n\t\t\tif (samplerState.type) {\n\t\t\t\tthis._gl.bindTexture(samplerState.type, null);\n\t\t\t\tsamplerState.type = null;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar textureType:number = this._textureTypeDictionary[texture.textureType];\n\t\tsamplerState.type = textureType;\n\n\t\tthis._gl.bindTexture(textureType, texture.glTexture);\n\n\t\tthis._gl.uniform1i(this._gl.getUniformLocation(this._currentProgram.glProgram, \"fs\" + sampler), sampler);\n\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_WRAP_S, samplerState.wrap);\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_WRAP_T, samplerState.wrap);\n\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_MAG_FILTER, samplerState.filter);\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_MIN_FILTER, samplerState.mipfilter);\n\t}\n\n\tpublic setSamplerStateAt(sampler:number, wrap:string, filter:string, mipfilter:string):void\n\t{\n\t\tif (0 <= sampler && sampler < ContextWebGL.MAX_SAMPLERS) {\n\t\t\tthis._samplerStates[sampler].wrap = this._wrapDictionary[wrap];\n\t\t\tthis._samplerStates[sampler].filter = this._filterDictionary[filter];\n\t\t\tthis._samplerStates[sampler].mipfilter = this._mipmapFilterDictionary[filter][mipfilter];\n\t\t} else {\n\t\t\tthrow \"Sampler is out of bounds.\";\n\t\t}\n\t}\n\n\tpublic setVertexBufferAt(index:number, buffer:VertexBufferWebGL, bufferOffset:number = 0, format:string = null)\n\t{\n\t\tvar location:number = this._currentProgram? this._gl.getAttribLocation(this._currentProgram.glProgram, \"va\" + index) : -1;\n\n\t\tif (!buffer) {\n\t\t\tif (location > -1)\n\t\t\t\tthis._gl.disableVertexAttribArray(location);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.bindBuffer(this._gl.ARRAY_BUFFER, buffer.glBuffer);\n\t\tthis._gl.enableVertexAttribArray(location);\n\t\tthis._gl.vertexAttribPointer(location, this._vertexBufferDimensionDictionary[format], this._gl.FLOAT, false, buffer.data32PerVertex*4, bufferOffset*4);\n\t}\n\n\tpublic setRenderToTexture(target:TextureBaseWebGL, enableDepthAndStencil:boolean = false, antiAlias:number = 0, surfaceSelector:number = 0)\n\t{\n\t\tvar texture:TextureWebGL = <TextureWebGL> target;\n\t\tvar frameBuffer:WebGLFramebuffer = texture.frameBuffer;\n\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, frameBuffer);\n\n\t\tif (enableDepthAndStencil) {\n\t\t\tthis._gl.enable(this._gl.STENCIL_TEST);\n\t\t\tthis._gl.enable(this._gl.DEPTH_TEST);\n\t\t}\n\n\t\tthis._gl.viewport(0, 0, texture.width, texture.height );\n\t}\n\n\tpublic setRenderToBackBuffer()\n\t{\n\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);\n\t}\n\n\tprivate updateBlendStatus()\n\t{\n\t\tif (this._blendEnabled) {\n\t\t\tthis._gl.enable(this._gl.BLEND);\n\t\t\tthis._gl.blendEquation(this._gl.FUNC_ADD);\n\t\t\tthis._gl.blendFunc(this._blendSourceFactor, this._blendDestinationFactor);\n\t\t} else {\n\t\t\tthis._gl.disable(this._gl.BLEND);\n\t\t}\n\t}\n}\n\nexport = ContextWebGL;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\nimport ByteArrayBase\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArrayBase\");\n\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport ICubeTexture\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ICubeTexture\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass CubeTextureFlash extends ResourceBaseFlash implements ICubeTexture\n{\n\tprivate _context:ContextStage3D;\n\tprivate _size:number;\n\n\tpublic get size():number\n\t{\n\t\treturn this._size;\n\t}\n\n\tconstructor(context:ContextStage3D, size:number, format:string, forRTT:boolean, streaming:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._size = size;\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initCubeTexture, (forRTT? OpCodes.trueValue : OpCodes.falseValue)) + size + \",\" + streaming + \",\" + format + \"$\");\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeCubeTexture) + this._pId.toString() + \",\");\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, side:number, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, side:number, miplevel?:number);\n\tpublic uploadFromData(data:any, side:number, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData) {\n\t\t\tdata = (<BitmapData> data).imageData.data;\n\t\t} else if (data instanceof HTMLImageElement) {\n\t\t\tvar can = document.createElement(\"canvas\");\n\t\t\tvar w = data.width;\n\t\t\tvar h = data.height;\n\t\t\tcan.width = w;\n\t\t\tcan.height = h;\n\t\t\tvar ctx = can.getContext(\"2d\");\n\t\t\tctx.drawImage(data, 0, 0);\n\t\t\tdata = ctx.getImageData(0, 0, w, h).data;\n\t\t}\n\n\t\tvar pos = 0;\n\t\tvar bytes = ByteArrayBase.internalGetBase64String(data.length, function () {\n\t\t\treturn data[pos++];\n\t\t}, null);\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadBytesCubeTexture) + this._pId + \",\" + miplevel + \",\" + side + \",\" + (this.size >> miplevel) + \",\" + bytes + \"%\");\n\t\tthis._context.execute();\n\t}\n\n\tpublic uploadCompressedTextureFromByteArray(data:ByteArray, byteArrayOffset:number /*uint*/, async:boolean = false)\n\t{\n\n\t}\n}\n\nexport = CubeTextureFlash;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ICubeTexture\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ICubeTexture\");\nimport TextureBaseWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureBaseWebGL\");\n\nclass CubeTextureWebGL extends TextureBaseWebGL implements ICubeTexture\n{\n\n\tprivate _textureSelectorDictionary:Array<number> = new Array<number>(6);\n\n\tpublic textureType:string = \"textureCube\";\n\tprivate _texture:WebGLTexture;\n\tprivate _size:number;\n\n\tconstructor(gl:WebGLRenderingContext, size:number)\n\t{\n\t\tsuper(gl);\n\t\tthis._size = size;\n\t\tthis._texture = this._gl.createTexture();\n\n\t\tthis._textureSelectorDictionary[0] = gl.TEXTURE_CUBE_MAP_POSITIVE_X;\n\t\tthis._textureSelectorDictionary[1] = gl.TEXTURE_CUBE_MAP_NEGATIVE_X;\n\t\tthis._textureSelectorDictionary[2] = gl.TEXTURE_CUBE_MAP_POSITIVE_Y;\n\t\tthis._textureSelectorDictionary[3] = gl.TEXTURE_CUBE_MAP_NEGATIVE_Y;\n\t\tthis._textureSelectorDictionary[4] = gl.TEXTURE_CUBE_MAP_POSITIVE_Z;\n\t\tthis._textureSelectorDictionary[5] = gl.TEXTURE_CUBE_MAP_NEGATIVE_Z;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteTexture(this._texture);\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, side:number, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, side:number, miplevel?:number);\n\tpublic uploadFromData(data:any, side:number, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData)\n\t\t\tdata = (<BitmapData> data).imageData;\n\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, this._texture);\n\t\tthis._gl.texImage2D(this._textureSelectorDictionary[side], miplevel, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, null);\n\t}\n\n\tpublic uploadCompressedTextureFromByteArray(data:ByteArray, byteArrayOffset:number /*uint*/, async:boolean = false)\n\t{\n\n\t}\n\n\tpublic get size():number\n\t{\n\t\treturn this._size;\n\t}\n\n\tpublic get glTexture():WebGLTexture\n\t{\n\t\treturn this._texture;\n\t}\n}\n\nexport = CubeTextureWebGL;","import ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass IndexBufferFlash extends ResourceBaseFlash implements IIndexBuffer\n{\n\tprivate _context:ContextStage3D;\n\tprivate _numIndices:number;\n\n\tconstructor(context:ContextStage3D, numIndices:number)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._numIndices = numIndices;\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initIndexBuffer, numIndices + OpCodes.intMask));\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic uploadFromArray(data:number[], startOffset:number, count:number):void\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadArrayIndexBuffer, this._pId + OpCodes.intMask) + data.join() + \"#\" + startOffset + \",\" + count + \",\");\n\t\tthis._context.execute();\n\t}\n\n\tpublic dispose():void\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeIndexBuffer, this._pId + OpCodes.intMask));\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n\n\tpublic get numIndices():number\n\t{\n\t\treturn this._numIndices;\n\t}\n}\n\nexport = IndexBufferFlash;","import IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\n\nclass IndexBufferWebGL implements IIndexBuffer\n{\n\n\tprivate _gl:WebGLRenderingContext;\n\tprivate _numIndices:number;\n\tprivate _buffer:WebGLBuffer;\n\n\tconstructor(gl:WebGLRenderingContext, numIndices:number)\n\t{\n\t\tthis._gl = gl;\n\t\tthis._buffer = this._gl.createBuffer();\n\t\tthis._numIndices = numIndices;\n\t}\n\n\tpublic uploadFromArray(data:number[], startOffset:number, count:number):void\n\t{\n\t\tthis._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, this._buffer);\n\n\t\t// TODO add index offsets\n\t\tthis._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data), this._gl.STATIC_DRAW);\n\t}\n\n\tpublic dispose():void\n\t{\n\t\tthis._gl.deleteBuffer(this._buffer);\n\t}\n\n\tpublic get numIndices():number\n\t{\n\t\treturn this._numIndices;\n\t}\n\n\tpublic get glBuffer():WebGLBuffer\n\t{\n\t\treturn this._buffer;\n\t}\n}\n\nexport = IndexBufferWebGL;","class OpCodes\n{\n\tpublic static trueValue:number = 32;\n\tpublic static falseValue:number = 33;\n\tpublic static intMask:number = 63;\n\tpublic static drawTriangles:number = 41;\n\tpublic static setProgramConstant:number = 42;\n\tpublic static setProgram:number = 43;\n\tpublic static present:number = 44;\n\tpublic static clear:number = 45;\n\tpublic static initProgram:number = 46;\n\tpublic static initVertexBuffer:number = 47;\n\tpublic static initIndexBuffer:number = 48;\n\tpublic static configureBackBuffer:number = 49;\n\tpublic static uploadArrayIndexBuffer:number = 50;\n\tpublic static uploadArrayVertexBuffer:number = 51;\n\tpublic static uploadAGALBytesProgram:number = 52;\n\tpublic static setVertexBufferAt:number = 53;\n\tpublic static uploadBytesIndexBuffer:number = 54;\n\tpublic static uploadBytesVertexBuffer:number = 55;\n\tpublic static setColorMask:number = 56;\n\tpublic static setDepthTest:number = 57;\n\tpublic static disposeProgram:number = 58;\n\tpublic static disposeContext:number = 59;\n\t// must skip 60 '<' as it will invalidate xml being passed over the bridge\n\tpublic static disposeVertexBuffer:number = 61;\n\t// must skip 62 '>' as it will invalidate xml being passed over the bridge\n\tpublic static disposeIndexBuffer:number = 63;\n\tpublic static initTexture:number = 64;\n\tpublic static setTextureAt:number = 65;\n\tpublic static uploadBytesTexture:number = 66;\n\tpublic static disposeTexture:number = 67;\n\tpublic static setCulling:number = 68;\n\tpublic static setScissorRect:number = 69;\n\tpublic static clearScissorRect:number = 70;\n\tpublic static setBlendFactors:number = 71;\n\tpublic static setRenderToTexture:number = 72;\n\tpublic static clearTextureAt:number = 73;\n\tpublic static clearVertexBufferAt:number = 74;\n\tpublic static setStencilActions:number = 75;\n\tpublic static setStencilReferenceValue:number = 76;\n\tpublic static initCubeTexture:number = 77;\n\tpublic static disposeCubeTexture:number = 78;\n\tpublic static uploadBytesCubeTexture:number = 79;\n\tpublic static clearRenderToTexture:number = 80;\n\tpublic static enableErrorChecking:number = 81;\n}\n\nexport = OpCodes;","import ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass ProgramFlash extends ResourceBaseFlash implements IProgram\n{\n\tprivate _context:ContextStage3D;\n\n\tconstructor(context:ContextStage3D)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initProgram));\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic upload(vertexProgram:ByteArray, fragmentProgram:ByteArray)\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadAGALBytesProgram, this._pId + OpCodes.intMask) + vertexProgram.readBase64String(vertexProgram.length) + \"%\" + fragmentProgram.readBase64String(fragmentProgram.length) + \"%\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis._context.execute();\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeProgram, this._pId + OpCodes.intMask));\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n}\n\nexport = ProgramFlash;","import ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport AGALTokenizer\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/AGALTokenizer\");\nimport AGLSLParser\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/AGLSLParser\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\n\n\nclass ProgramWebGL implements IProgram\n{\n\tprivate static _tokenizer:AGALTokenizer = new AGALTokenizer();\n\tprivate static _aglslParser:AGLSLParser = new AGLSLParser();\n\n\tprivate _gl:WebGLRenderingContext;\n\tprivate _program:WebGLProgram;\n\tprivate _vertexShader:WebGLShader;\n\tprivate _fragmentShader:WebGLShader;\n\n\tconstructor(gl:WebGLRenderingContext)\n\t{\n\t\tthis._gl = gl;\n\t\tthis._program = this._gl.createProgram();\n\t}\n\n\tpublic upload(vertexProgram:ByteArray, fragmentProgram:ByteArray)\n\t{\n\t\tvar vertexString:string = ProgramWebGL._aglslParser.parse(ProgramWebGL._tokenizer.decribeAGALByteArray(vertexProgram));\n\t\tvar fragmentString:string = ProgramWebGL._aglslParser.parse(ProgramWebGL._tokenizer.decribeAGALByteArray(fragmentProgram));\n\n\t\tthis._vertexShader = this._gl.createShader(this._gl.VERTEX_SHADER);\n\t\tthis._fragmentShader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\n\n\t\tthis._gl.shaderSource(this._vertexShader, vertexString);\n\t\tthis._gl.compileShader(this._vertexShader);\n\n\t\tif (!this._gl.getShaderParameter(this._vertexShader, this._gl.COMPILE_STATUS)) {\n\t\t\tthrow new Error(this._gl.getShaderInfoLog(this._vertexShader));\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.shaderSource(this._fragmentShader, fragmentString);\n\t\tthis._gl.compileShader(this._fragmentShader);\n\n\t\tif (!this._gl.getShaderParameter(this._fragmentShader, this._gl.COMPILE_STATUS)) {\n\t\t\tthrow new Error(this._gl.getShaderInfoLog(this._fragmentShader));\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.attachShader(this._program, this._vertexShader);\n\t\tthis._gl.attachShader(this._program, this._fragmentShader);\n\t\tthis._gl.linkProgram(this._program);\n\n\t\tif (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\n\t\t\tthrow new Error(this._gl.getProgramInfoLog(this._program));\n\t\t}\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteProgram(this._program);\n\t}\n\n\tpublic focusProgram()\n\t{\n\t\tthis._gl.useProgram(this._program);\n\t}\n\n\tpublic get glProgram():WebGLProgram\n\t{\n\t\treturn this._program;\n\t}\n}\n\nexport = ProgramWebGL;","class ResourceBaseFlash\n{\n\tpublic _pId:number;\n\n\tpublic get id():number\n\t{\n\t\treturn this._pId;\n\t}\n\n\tpublic dispose()\n\t{\n\n\t}\n}\n\nexport = ResourceBaseFlash;","class SamplerState\n{\n\tpublic type:number;\n\tpublic wrap:number;\n\tpublic filter:number;\n\tpublic mipfilter:number;\n}\n\nexport = SamplerState;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\nimport CSS\t\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/CSS\");\n\nimport ContextMode\t\t\t\t\t= require(\"awayjs-display/lib/display/ContextMode\");\nimport StageEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/StageEvent\");\n\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport ContextWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextWebGL\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ICubeTexture\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ICubeTexture\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport ITextureBase\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\nimport TextureData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureData\");\nimport TextureDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureDataPool\");\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\nimport ProgramDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramDataPool\");\nimport VertexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexData\");\nimport StageManager\t\t\t\t\t= require(\"awayjs-stagegl/lib/managers/StageManager\");\n\n/**\n * Stage provides a proxy class to handle the creation and attachment of the Context\n * (and in turn the back buffer) it uses. Stage should never be created directly,\n * but requested through StageManager.\n *\n * @see away.managers.StageManager\n *\n */\nclass Stage extends EventDispatcher\n{\n\tprivate _programData:Array<ProgramData> = new Array<ProgramData>();\n\tprivate _texturePool:TextureDataPool;\n\tprivate _programDataPool:ProgramDataPool;\n\tprivate _context:IContextGL;\n\tprivate _container:HTMLElement;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _x:number = 0;\n\tprivate _y:number = 0;\n\n\t//private static _frameEventDriver:Shape = new Shape(); // TODO: add frame driver / request animation frame\n\n\tprivate _stageIndex:number = -1;\n\n\tprivate _usesSoftwareRendering:boolean;\n\tprivate _profile:string;\n\tprivate _stageManager:StageManager;\n\tprivate _antiAlias:number = 0;\n\tprivate _enableDepthAndStencil:boolean;\n\tprivate _contextRequested:boolean;\n\n\t//private var _activeVertexBuffers : Vector.<VertexBuffer> = new Vector.<VertexBuffer>(8, true);\n\t//private var _activeTextures : Vector.<TextureBase> = new Vector.<TextureBase>(8, true);\n\tprivate _renderTarget:TextureProxyBase = null;\n\tprivate _renderSurfaceSelector:number = 0;\n\tprivate _scissorRect:Rectangle;\n\tprivate _color:number;\n\tprivate _backBufferDirty:boolean;\n\tprivate _viewPort:Rectangle;\n\tprivate _enterFrame:Event;\n\tprivate _exitFrame:Event;\n\tprivate _viewportUpdated:StageEvent;\n\tprivate _viewportDirty:boolean;\n\tprivate _bufferClear:boolean;\n\n\t//private _mouse3DManager:away.managers.Mouse3DManager;\n\t//private _touch3DManager:Touch3DManager; //TODO: imeplement dependency Touch3DManager\n\n\tprivate _initialised:boolean = false;\n\n\tconstructor(container:HTMLCanvasElement, stageIndex:number, stageManager:StageManager, forceSoftware:boolean = false, profile:string = \"baseline\")\n\t{\n\t\tsuper();\n\n\t\tthis._texturePool = new TextureDataPool();\n\t\tthis._programDataPool = new ProgramDataPool(this);\n\n\t\tthis._container = container;\n\n\t\tthis._stageIndex = stageIndex;\n\n\t\tthis._stageManager = stageManager;\n\n\t\tthis._viewPort = new Rectangle();\n\n\t\tthis._enableDepthAndStencil = true;\n\n\t\tCSS.setElementX(this._container, 0);\n\t\tCSS.setElementY(this._container, 0);\n\n\t\tthis.visible = true;\n\t}\n\n\tpublic getProgramData(key:string):ProgramData\n\t{\n\t\treturn this._programDataPool.getItem(key);\n\t}\n\n\tpublic setRenderTarget(target:TextureProxyBase, enableDepthAndStencil:boolean = false, surfaceSelector:number = 0)\n\t{\n\t\tif (this._renderTarget === target && surfaceSelector == this._renderSurfaceSelector && this._enableDepthAndStencil == enableDepthAndStencil)\n\t\t\treturn;\n\n\t\tthis._renderTarget = target;\n\t\tthis._renderSurfaceSelector = surfaceSelector;\n\t\tthis._enableDepthAndStencil = enableDepthAndStencil;\n\t\tif (target instanceof RenderTexture) {\n\t\t\tthis._context.setRenderToTexture(this.getRenderTexture(<RenderTexture> target), enableDepthAndStencil, this._antiAlias, surfaceSelector);\n\t\t} else {\n\t\t\tthis._context.setRenderToBackBuffer();\n\t\t\tthis.configureBackBuffer(this._width, this._height, this._antiAlias, this._enableDepthAndStencil);\n\t\t}\n\t}\n\n\tpublic getRenderTexture(textureProxy:RenderTexture):ITextureBase\n\t{\n\t\tvar textureData:TextureData = this._texturePool.getItem(textureProxy);\n\n\t\tif (!textureData.texture)\n\t\t\ttextureData.texture = this._context.createTexture(textureProxy.width, textureProxy.height, ContextGLTextureFormat.BGRA, true);\n\n\t\treturn textureData.texture;\n\t}\n\n\t/**\n\t * Assigns an attribute stream\n\t *\n\t * @param index The attribute stream index for the vertex shader\n\t * @param buffer\n\t * @param offset\n\t * @param stride\n\t * @param format\n\t */\n\tpublic activateBuffer(index:number, buffer:VertexData, offset:number, format:string)\n\t{\n\t\tif (!buffer.contexts[this._stageIndex])\n\t\t\tbuffer.contexts[this._stageIndex] = this._context;\n\n\t\tif (!buffer.buffers[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex] = this._context.createVertexBuffer(buffer.data.length/buffer.dataPerVertex, buffer.dataPerVertex);\n\t\t\tbuffer.invalid[this._stageIndex] = true;\n\t\t}\n\n\t\tif (buffer.invalid[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex].uploadFromArray(buffer.data, 0, buffer.data.length/buffer.dataPerVertex);\n\t\t\tbuffer.invalid[this._stageIndex] = false;\n\t\t}\n\n\t\tthis._context.setVertexBufferAt(index, buffer.buffers[this._stageIndex], offset, format);\n\t}\n\n\tpublic disposeVertexData(buffer:VertexData)\n\t{\n\t\tbuffer.buffers[this._stageIndex].dispose();\n\t\tbuffer.buffers[this._stageIndex] = null;\n\t}\n\n\tpublic activateRenderTexture(index:number, textureProxy:RenderTexture)\n\t{\n\t\tthis._context.setTextureAt(index, this.getRenderTexture(textureProxy));\n\t}\n\n\tpublic activateTexture(index:number, textureProxy:Texture2DBase)\n\t{\n\t\tvar textureData:TextureData = <TextureData> this._texturePool.getItem(textureProxy);\n\n\t\tif (!textureData.texture) {\n\t\t\ttextureData.texture = this._context.createTexture(textureProxy.width, textureProxy.height, ContextGLTextureFormat.BGRA, true);\n\t\t\ttextureData.invalid = true;\n\t\t}\n\n\t\tif (textureData.invalid) {\n\t\t\ttextureData.invalid = false;\n\t\t\tif (textureProxy.generateMipmaps) {\n\t\t\t\tvar mipmapData:Array<BitmapData> = textureProxy._iGetMipmapData();\n\t\t\t\tvar len:number = mipmapData.length;\n\t\t\t\tfor (var i:number = 0; i < len; i++)\n\t\t\t\t\t(<ITexture> textureData.texture).uploadFromData(mipmapData[i], i);\n\t\t\t} else {\n\t\t\t\t(<ITexture> textureData.texture).uploadFromData(textureProxy._iGetTextureData(), 0);\n\t\t\t}\n\t\t}\n\n\t\tthis._context.setTextureAt(index, textureData.texture);\n\t}\n\n\tpublic activateCubeTexture(index:number, textureProxy:CubeTextureBase)\n\t{\n\t\tvar textureData:TextureData = <TextureData> this._texturePool.getItem(textureProxy);\n\n\t\tif (!textureData.texture) {\n\t\t\ttextureData.texture = this._context.createCubeTexture(textureProxy.size, ContextGLTextureFormat.BGRA, false);\n\t\t\ttextureData.invalid = true;\n\t\t}\n\n\t\tif (textureData.invalid) {\n\t\t\ttextureData.invalid = false;\n\t\t\tfor (var i:number = 0; i < 6; ++i) {\n\t\t\t\tif (textureProxy.generateMipmaps) {\n\t\t\t\t\tvar mipmapData:Array<BitmapData> = textureProxy._iGetMipmapData(i);\n\t\t\t\t\tvar len:number = mipmapData.length;\n\t\t\t\t\tfor (var j:number = 0; j < len; j++)\n\t\t\t\t\t\t(<ICubeTexture> textureData.texture).uploadFromData(mipmapData[j], i, j);\n\t\t\t\t} else {\n\t\t\t\t\t(<ICubeTexture> textureData.texture).uploadFromData(textureProxy._iGetTextureData(i), i, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._context.setTextureAt(index, textureData.texture);\n\t}\n\n\t/**\n\t * Retrieves the VertexBuffer object that contains triangle indices.\n\t * @param context The ContextWeb for which we request the buffer\n\t * @return The VertexBuffer object that contains triangle indices.\n\t */\n\tpublic getIndexBuffer(buffer:IndexData):IIndexBuffer\n\t{\n\t\tif (!buffer.contexts[this._stageIndex])\n\t\t\tbuffer.contexts[this._stageIndex] = this._context;\n\n\t\tif (!buffer.buffers[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex] = this._context.createIndexBuffer(buffer.data.length);\n\t\t\tbuffer.invalid[this._stageIndex] = true;\n\t\t}\n\n\t\tif (buffer.invalid[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex].uploadFromArray(buffer.data, 0, buffer.data.length);\n\t\t\tbuffer.invalid[this._stageIndex] = false;\n\t\t}\n\n\t\treturn buffer.buffers[this._stageIndex];\n\t}\n\n\tpublic disposeIndexData(buffer:IndexData)\n\t{\n\t\tbuffer.buffers[this._stageIndex].dispose();\n\t\tbuffer.buffers[this._stageIndex] = null;\n\t}\n\n\t/**\n\t * Requests a Context object to attach to the managed gl canvas.\n\t */\n\tpublic requestContext(forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\")\n\t{\n\t\t// If forcing software, we can be certain that the\n\t\t// returned Context will be running software mode.\n\t\t// If not, we can't be sure and should stick to the\n\t\t// old value (will likely be same if re-requesting.)\n\n\t\tif (this._usesSoftwareRendering != null)\n\t\t\tthis._usesSoftwareRendering = forceSoftware;\n\n\t\tthis._profile = profile;\n\n\t\ttry {\n\t\t\tif (mode == ContextMode.FLASH)\n\t\t\t\tnew ContextStage3D(<HTMLCanvasElement> this._container, (context:IContextGL) => this._callback(context));\n\t\t\telse\n\t\t\t\tthis._context = new ContextWebGL(<HTMLCanvasElement> this._container);\n\n\t\t} catch (e) {\n\t\t\ttry {\n\t\t\t\tif (mode == ContextMode.AUTO)\n\t\t\t\t\tnew ContextStage3D(<HTMLCanvasElement> this._container, (context:IContextGL) => this._callback(context));\n\t\t\t\telse\n\t\t\t\t\tthis.dispatchEvent(new Event(Event.ERROR));\n\t\t\t} catch (e) {\n\t\t\t\tthis.dispatchEvent(new Event(Event.ERROR));\n\t\t\t}\n\n\t\t}\n\n\t\tif (this._context)\n\t\t\tthis._callback(this._context);\n\t}\n\n\t/**\n\t * The width of the gl canvas\n\t */\n\tpublic get width()\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(val:number)\n\t{\n\t\tif (this._width == val)\n\t\t\treturn;\n\n\t\tCSS.setElementWidth(this._container, val);\n\n\t\tthis._width = this._viewPort.width = val;\n\n\t\tthis._backBufferDirty = true;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\t/**\n\t * The height of the gl canvas\n\t */\n\tpublic get height()\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(val:number)\n\t{\n\t\tif (this._height == val)\n\t\t\treturn;\n\n\t\tCSS.setElementHeight(this._container, val);\n\n\t\tthis._height = this._viewPort.height = val;\n\n\t\tthis._backBufferDirty = true;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\t/**\n\t * The x position of the gl canvas\n\t */\n\tpublic get x()\n\t{\n\t\treturn this._x;\n\t}\n\n\tpublic set x(val:number)\n\t{\n\t\tif (this._x == val)\n\t\t\treturn;\n\n\t\tCSS.setElementX(this._container, val);\n\n\t\tthis._x = this._viewPort.x = val;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\t/**\n\t * The y position of the gl canvas\n\t */\n\tpublic get y()\n\t{\n\t\treturn this._y;\n\t}\n\n\tpublic set y(val:number)\n\t{\n\t\tif (this._y == val)\n\t\t\treturn;\n\n\t\tCSS.setElementY(this._container, val);\n\n\t\tthis._y = this._viewPort.y = val;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\tpublic set visible(val:boolean)\n\t{\n\t\tCSS.setElementVisibility(this._container, val);\n\t}\n\n\tpublic get visible()\n\t{\n\t\treturn CSS.getElementVisibility(this._container);\n\t}\n\n\tpublic get container():HTMLElement\n\t{\n\t\treturn this._container;\n\t}\n\n\t/**\n\t * The Context object associated with the given stage object.\n\t */\n\tpublic get context():IContextGL\n\t{\n\t\treturn this._context;\n\t}\n\n\tprivate notifyViewportUpdated()\n\t{\n\t\tif (this._viewportDirty)\n\t\t\treturn;\n\n\t\tthis._viewportDirty = true;\n\n\t\t//if (!this.hasEventListener(StageEvent.VIEWPORT_UPDATED))\n\t\t//return;\n\n\t\t//if (!_viewportUpdated)\n\t\tthis._viewportUpdated = new StageEvent(StageEvent.VIEWPORT_UPDATED);\n\n\t\tthis.dispatchEvent(this._viewportUpdated);\n\t}\n\n\tprivate notifyEnterFrame()\n\t{\n\t\t//if (!hasEventListener(Event.ENTER_FRAME))\n\t\t//return;\n\n\t\tif (!this._enterFrame)\n\t\t\tthis._enterFrame = new Event(Event.ENTER_FRAME);\n\n\t\tthis.dispatchEvent(this._enterFrame);\n\n\t}\n\n\tprivate notifyExitFrame()\n\t{\n\t\t//if (!hasEventListener(Event.EXIT_FRAME))\n\t\t//return;\n\n\t\tif (!this._exitFrame)\n\t\t\tthis._exitFrame = new Event(Event.EXIT_FRAME);\n\n\t\tthis.dispatchEvent(this._exitFrame);\n\t}\n\n\tpublic get profile():string\n\t{\n\t\treturn this._profile;\n\t}\n\n\t/**\n\t * Disposes the Stage object, freeing the Context attached to the Stage.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._stageManager.iRemoveStage(this);\n\t\tthis.freeContext();\n\t\tthis._stageManager = null;\n\t\tthis._stageIndex = -1;\n\t}\n\n\t/**\n\t * Configures the back buffer associated with the Stage object.\n\t * @param backBufferWidth The width of the backbuffer.\n\t * @param backBufferHeight The height of the backbuffer.\n\t * @param antiAlias The amount of anti-aliasing to use.\n\t * @param enableDepthAndStencil Indicates whether the back buffer contains a depth and stencil buffer.\n\t */\n\tpublic configureBackBuffer(backBufferWidth:number, backBufferHeight:number, antiAlias:number, enableDepthAndStencil:boolean)\n\t{\n\t\tthis.width = backBufferWidth;\n\t\tthis.height = backBufferHeight;\n\n\t\tthis._antiAlias = antiAlias;\n\t\tthis._enableDepthAndStencil = enableDepthAndStencil;\n\n\t\tif (this._context)\n\t\t\tthis._context.configureBackBuffer(backBufferWidth, backBufferHeight, antiAlias, enableDepthAndStencil);\n\t}\n\n\t/*\n\t * Indicates whether the depth and stencil buffer is used\n\t */\n\tpublic get enableDepthAndStencil():boolean\n\t{\n\t\treturn this._enableDepthAndStencil;\n\t}\n\n\tpublic set enableDepthAndStencil(enableDepthAndStencil:boolean)\n\t{\n\t\tthis._enableDepthAndStencil = enableDepthAndStencil;\n\t\tthis._backBufferDirty = true;\n\t}\n\n\tpublic get renderTarget():TextureProxyBase\n\t{\n\t\treturn this._renderTarget;\n\t}\n\n\tpublic get renderSurfaceSelector():number\n\t{\n\t\treturn this._renderSurfaceSelector;\n\t}\n\n\t/*\n\t * Clear and reset the back buffer when using a shared context\n\t */\n\tpublic clear()\n\t{\n\t\tif (!this._context)\n\t\t\treturn;\n\n\t\tif (this._backBufferDirty) {\n\t\t\tthis.configureBackBuffer(this._width, this._height, this._antiAlias, this._enableDepthAndStencil);\n\t\t\tthis._backBufferDirty = false;\n\t\t}\n\n\t\tthis._context.clear(( this._color & 0xff000000 ) >>> 24, // <--------- Zero-fill right shift\n\t\t\t\t\t\t\t  ( this._color & 0xff0000 ) >>> 16, // <-------------|\n\t\t\t\t\t\t\t  ( this._color & 0xff00 ) >>> 8, // <----------------|\n\t\t\t\t\t\t\t\tthis._color & 0xff);\n\n\t\tthis._bufferClear = true;\n\t}\n\n\t/**\n\t * Registers an event listener object with an EventDispatcher object so that the listener receives notification of an event. Special case for enterframe and exitframe events - will switch StageProxy into automatic render mode.\n\t * You can register event listeners on all nodes in the display list for a specific type of event, phase, and priority.\n\t *\n\t * @param type The type of event.\n\t * @param listener The listener function that processes the event.\n\t * @param useCapture Determines whether the listener works in the capture phase or the target and bubbling phases. If useCapture is set to true, the listener processes the event only during the capture phase and not in the target or bubbling phase. If useCapture is false, the listener processes the event only during the target or bubbling phase. To listen for the event in all three phases, call addEventListener twice, once with useCapture set to true, then again with useCapture set to false.\n\t * @param priority The priority level of the event listener. The priority is designated by a signed 32-bit integer. The higher the number, the higher the priority. All listeners with priority n are processed before listeners of priority n-1. If two or more listeners share the same priority, they are processed in the order in which they were added. The default priority is 0.\n\t * @param useWeakReference Determines whether the reference to the listener is strong or weak. A strong reference (the default) prevents your listener from being garbage-collected. A weak reference does not.\n\t */\n\tpublic addEventListener(type:string, listener:Function)\n\t{\n\t\tsuper.addEventListener(type, listener);\n\n\t\t//away.Debug.throwPIR( 'StageProxy' , 'addEventListener' ,  'EnterFrame, ExitFrame');\n\n\t\t//if ((type == Event.ENTER_FRAME || type == Event.EXIT_FRAME) ){//&& ! this._frameEventDriver.hasEventListener(Event.ENTER_FRAME)){\n\n\t\t//_frameEventDriver.addEventListener(Event.ENTER_FRAME, onEnterFrame, useCapture, priority, useWeakReference);\n\n\t\t//}\n\n\t\t/* Original code\n\t\t if ((type == Event.ENTER_FRAME || type == Event.EXIT_FRAME) && ! _frameEventDriver.hasEventListener(Event.ENTER_FRAME)){\n\n\t\t _frameEventDriver.addEventListener(Event.ENTER_FRAME, onEnterFrame, useCapture, priority, useWeakReference);\n\n\n\t\t }\n\t\t */\n\t}\n\n\t/**\n\t * Removes a listener from the EventDispatcher object. Special case for enterframe and exitframe events - will switch StageProxy out of automatic render mode.\n\t * If there is no matching listener registered with the EventDispatcher object, a call to this method has no effect.\n\t *\n\t * @param type The type of event.\n\t * @param listener The listener object to remove.\n\t * @param useCapture Specifies whether the listener was registered for the capture phase or the target and bubbling phases. If the listener was registered for both the capture phase and the target and bubbling phases, two calls to removeEventListener() are required to remove both, one call with useCapture() set to true, and another call with useCapture() set to false.\n\t */\n\tpublic removeEventListener(type:string, listener:Function)\n\t{\n\t\tsuper.removeEventListener(type, listener);\n\n\t\t/*\n\t\t // Remove the main rendering listener if no EnterFrame listeners remain\n\t\t if (    ! this.hasEventListener(Event.ENTER_FRAME , this.onEnterFrame , this )\n\t\t &&  ! this.hasEventListener(Event.EXIT_FRAME , this.onEnterFrame , this) ) //&& _frameEventDriver.hasEventListener(Event.ENTER_FRAME))\n\t\t {\n\n\t\t //_frameEventDriver.removeEventListener(Event.ENTER_FRAME, this.onEnterFrame, this );\n\n\t\t }\n\t\t */\n\t}\n\n\tpublic get scissorRect():Rectangle\n\t{\n\t\treturn this._scissorRect;\n\t}\n\n\tpublic set scissorRect(value:Rectangle)\n\t{\n\t\tthis._scissorRect = value;\n\n\t\tthis._context.setScissorRectangle(this._scissorRect);\n\t}\n\n\t/**\n\t * The index of the Stage which is managed by this instance of StageProxy.\n\t */\n\tpublic get stageIndex():number\n\t{\n\t\treturn this._stageIndex;\n\t}\n\n\t/**\n\t * Indicates whether the Stage managed by this proxy is running in software mode.\n\t * Remember to wait for the CONTEXT_CREATED event before checking this property,\n\t * as only then will it be guaranteed to be accurate.\n\t */\n\tpublic get usesSoftwareRendering():boolean\n\t{\n\t\treturn this._usesSoftwareRendering;\n\t}\n\n\t/**\n\t * The antiAliasing of the Stage.\n\t */\n\tpublic get antiAlias():number\n\t{\n\t\treturn this._antiAlias;\n\t}\n\n\tpublic set antiAlias(antiAlias:number)\n\t{\n\t\tthis._antiAlias = antiAlias;\n\t\tthis._backBufferDirty = true;\n\t}\n\n\t/**\n\t * A viewPort rectangle equivalent of the Stage size and position.\n\t */\n\tpublic get viewPort():Rectangle\n\t{\n\t\tthis._viewportDirty = false;\n\n\t\treturn this._viewPort;\n\t}\n\n\t/**\n\t * The background color of the Stage.\n\t */\n\tpublic get color():number\n\t{\n\t\treturn this._color;\n\t}\n\n\tpublic set color(color:number)\n\t{\n\t\tthis._color = color;\n\t}\n\n\t/**\n\t * The freshly cleared state of the backbuffer before any rendering\n\t */\n\tpublic get bufferClear():boolean\n\t{\n\t\treturn this._bufferClear;\n\t}\n\n\tpublic set bufferClear(newBufferClear:boolean)\n\t{\n\t\tthis._bufferClear = newBufferClear;\n\t}\n\n\n\tpublic registerProgram(programData:ProgramData)\n\t{\n\t\tvar i:number = 0;\n\t\twhile (this._programData[i] != null)\n\t\t\ti++;\n\n\t\tthis._programData[i] = programData;\n\t\tprogramData.id = i;\n\t}\n\n\tpublic unRegisterProgram(programData:ProgramData)\n\t{\n\t\tthis._programData[programData.id] = null;\n\t\tprogramData.id = -1;\n\t}\n\n\t/*\n\t * Access to fire mouseevents across multiple layered view3D instances\n\t */\n\t//\t\tpublic get mouse3DManager():Mouse3DManager\n\t//\t\t{\n\t//\t\t\treturn this._mouse3DManager;\n\t//\t\t}\n\t//\n\t//\t\tpublic set mouse3DManager(value:Mouse3DManager)\n\t//\t\t{\n\t//\t\t\tthis._mouse3DManager = value;\n\t//\t\t}\n\n\t/* TODO: implement dependency Touch3DManager\n\t public get touch3DManager():Touch3DManager\n\t {\n\t return _touch3DManager;\n\t }\n\n\t public set touch3DManager(value:Touch3DManager)\n\t {\n\t _touch3DManager = value;\n\t }\n\t */\n\n\t/**\n\t * Frees the Context associated with this StageProxy.\n\t */\n\tprivate freeContext()\n\t{\n\t\tif (this._context) {\n\t\t\tthis._context.dispose();\n\n\t\t\tthis.dispatchEvent(new StageEvent(StageEvent.CONTEXT_DISPOSED));\n\t\t}\n\n\t\tthis._context = null;\n\n\t\tthis._initialised = false;\n\t}\n\n\t/**\n\t * The Enter_Frame handler for processing the proxy.ENTER_FRAME and proxy.EXIT_FRAME event handlers.\n\t * Typically the proxy.ENTER_FRAME listener would render the layers for this Stage instance.\n\t */\n\tprivate onEnterFrame(event:Event)\n\t{\n\t\tif (!this._context)\n\t\t\treturn;\n\n\t\t// Clear the stage instance\n\t\tthis.clear();\n\t\t//notify the enterframe listeners\n\t\tthis.notifyEnterFrame();\n\t\t// Call the present() to render the frame\n\t\tif (!this._context)\n\t\t\tthis._context.present();\n\t\t//notify the exitframe listeners\n\t\tthis.notifyExitFrame();\n\t}\n\n\tpublic recoverFromDisposal():boolean\n\t{\n\t\tif (!this._context)\n\t\t\treturn false;\n\n\t\t//away.Debug.throwPIR( 'StageProxy' , 'recoverFromDisposal' , '' );\n\n\t\t/*\n\t\t if (this._iContext.driverInfo == \"Disposed\")\n\t\t {\n\t\t this._iContext = null;\n\t\t this.dispatchEvent(new StageEvent(StageEvent.CONTEXT_DISPOSED));\n\t\t return false;\n\n\t\t }\n\t\t */\n\t\treturn true;\n\n\t}\n\n\tprivate _callback(context:IContextGL)\n\t{\n\t\tthis._context = context;\n\n\t\tthis._container = this._context.container;\n\n\t\t// Only configure back buffer if width and height have been set,\n\t\t// which they may not have been if View.render() has yet to be\n\t\t// invoked for the first time.\n\t\tif (this._width && this._height)\n\t\t\tthis._context.configureBackBuffer(this._width, this._height, this._antiAlias, this._enableDepthAndStencil);\n\n\t\t// Dispatch the appropriate event depending on whether context was\n\t\t// created for the first time or recreated after a device loss.\n\t\tthis.dispatchEvent(new StageEvent(this._initialised? StageEvent.CONTEXT_RECREATED : StageEvent.CONTEXT_CREATED));\n\n\t\tthis._initialised = true;\n\t}\n}\n\nexport = Stage;","import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nclass TextureBaseWebGL\n{\n\tpublic textureType:string = \"\";\n\tpublic _gl:WebGLRenderingContext;\n\n\tconstructor(gl:WebGLRenderingContext)\n\t{\n\t\tthis._gl = gl;\n\t}\n\n\tpublic dispose():void\n\t{\n\t\tthrow \"Abstract method must be overridden.\";\n\t}\n\n\tpublic get glTexture():WebGLTexture\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = TextureBaseWebGL;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArrayBase\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArrayBase\");\n\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass TextureFlash extends ResourceBaseFlash implements ITexture\n{\n\tprivate _context:ContextStage3D;\n\tprivate _width:number;\n\tprivate _height:number;\n\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tconstructor(context:ContextStage3D, width:number, height:number, format:string, forRTT:boolean, streaming:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initTexture, (forRTT? OpCodes.trueValue : OpCodes.falseValue)) + width + \",\" + height + \",\" + streaming + \",\" + format + \"$\");\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeTexture) + this._pId.toString() + \",\");\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, miplevel?:number);\n\tpublic uploadFromData(data:any, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData) {\n\t\t\tdata = (<BitmapData> data).imageData.data;\n\t\t} else if (data instanceof HTMLImageElement) {\n\t\t\tvar can = document.createElement(\"canvas\");\n\t\t\tvar w = data.width;\n\t\t\tvar h = data.height;\n\t\t\tcan.width = w;\n\t\t\tcan.height = h;\n\t\t\tvar ctx = can.getContext(\"2d\");\n\t\t\tctx.drawImage(data, 0, 0);\n\t\t\tdata = ctx.getImageData(0, 0, w, h).data;\n\t\t}\n\n\t\tvar pos = 0;\n\t\tvar bytes = ByteArrayBase.internalGetBase64String(data.length, function () {\n\t\t\treturn data[pos++];\n\t\t}, null);\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadBytesTexture) + this._pId + \",\" + miplevel + \",\" + (this._width >> miplevel) + \",\" + (this._height >> miplevel) + \",\" + bytes + \"%\");\n\t\tthis._context.execute();\n\t}\n}\n\nexport = TextureFlash;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport TextureBaseWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureBaseWebGL\");\n\nclass TextureWebGL extends TextureBaseWebGL implements ITexture\n{\n\n\tpublic textureType:string = \"texture2d\";\n\n\tprivate _width:number;\n\tprivate _height:number;\n\n\tprivate _frameBuffer:WebGLFramebuffer;\n\n\tprivate _glTexture:WebGLTexture;\n\n\tconstructor(gl:WebGLRenderingContext, width:number, height:number)\n\t{\n\t\tsuper(gl);\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tthis._glTexture = this._gl.createTexture();\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteTexture(this._glTexture);\n\t}\n\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic get frameBuffer():WebGLFramebuffer\n\t{\n\t\tif (!this._frameBuffer) {\n\t\t\tthis._frameBuffer = this._gl.createFramebuffer();\n\t\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, this._frameBuffer);\n\t\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);\n\t\t\tthis._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._width, this._height, 0, this._gl.RGBA, this._gl.UNSIGNED_BYTE, null);\n\n\t\t\tvar renderBuffer:WebGLRenderbuffer = this._gl.createRenderbuffer();\n\t\t\tthis._gl.bindRenderbuffer(this._gl.RENDERBUFFER, renderBuffer);\n\t\t\tthis._gl.renderbufferStorage(this._gl.RENDERBUFFER, this._gl.DEPTH_COMPONENT16, this._width, this._height);\n\n\t\t\tthis._gl.framebufferTexture2D(this._gl.FRAMEBUFFER, this._gl.COLOR_ATTACHMENT0, this._gl.TEXTURE_2D, this._glTexture, 0);\n\t\t\tthis._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER, this._gl.DEPTH_ATTACHMENT, this._gl.RENDERBUFFER, renderBuffer);\n\n\t\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, null);\n\t\t\tthis._gl.bindRenderbuffer(this._gl.RENDERBUFFER, null);\n\t\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);\n\t\t}\n\n\t\treturn this._frameBuffer;\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, miplevel?:number);\n\tpublic uploadFromData(data:any, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData)\n\t\t\tdata = (<BitmapData> data).imageData;\n\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);\n\t\tthis._gl.texImage2D(this._gl.TEXTURE_2D, miplevel, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, null);\n\t}\n\n\tpublic uploadCompressedTextureFromByteArray(data:ByteArray, byteArrayOffset:number /*uint*/, async:boolean = false)\n\t{\n\t\tvar ext:Object = this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");\n\t\t//this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this)\n\t}\n\n\tpublic get glTexture():WebGLTexture\n\t{\n\t\treturn this._glTexture;\n\t}\n\n\tpublic generateMipmaps()\n\t{\n\t\t//TODO: implement generating mipmaps\n\t\t//this._gl.bindTexture( this._gl.TEXTURE_2D, this._glTexture );\n\t\t//this._gl.generateMipmap(this._gl.TEXTURE_2D);\n\t\t//this._gl.bindTexture( this._gl.TEXTURE_2D, null );\n\t}\n}\n\nexport = TextureWebGL;","import ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass VertexBufferFlash extends ResourceBaseFlash implements IVertexBuffer\n{\n\tprivate _context:ContextStage3D;\n\tprivate _numVertices:number;\n\tprivate _data32PerVertex:number;\n\n\tconstructor(context:ContextStage3D, numVertices:number, data32PerVertex:number)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._numVertices = numVertices;\n\t\tthis._data32PerVertex = data32PerVertex;\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initVertexBuffer, data32PerVertex + OpCodes.intMask) + numVertices.toString() + \",\");\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic uploadFromArray(data:number[], startVertex:number, numVertices:number)\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadArrayVertexBuffer, this._pId + OpCodes.intMask) + data.join() + \"#\" + [startVertex, numVertices].join() + \",\");\n\t\tthis._context.execute();\n\t}\n\n\tpublic get numVertices():number\n\t{\n\t\treturn this._numVertices;\n\t}\n\n\tpublic get data32PerVertex():number\n\t{\n\t\treturn this._data32PerVertex;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeVertexBuffer, this._pId + OpCodes.intMask));\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n}\n\nexport = VertexBufferFlash;","import IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\nclass VertexBufferWebGL implements IVertexBuffer\n{\n\n\tprivate _gl:WebGLRenderingContext;\n\tprivate _numVertices:number;\n\tprivate _data32PerVertex:number;\n\tprivate _buffer:WebGLBuffer;\n\n\tconstructor(gl:WebGLRenderingContext, numVertices:number, data32PerVertex:number)\n\t{\n\t\tthis._gl = gl;\n\t\tthis._buffer = this._gl.createBuffer();\n\t\tthis._numVertices = numVertices;\n\t\tthis._data32PerVertex = data32PerVertex;\n\t}\n\n\tpublic uploadFromArray(vertices:number[], startVertex:number, numVertices:number)\n\t{\n\t\tthis._gl.bindBuffer(this._gl.ARRAY_BUFFER, this._buffer);\n\n\t\t//console.log( \"** WARNING upload not fully implemented, startVertex & numVertices not considered.\" );\n\t\t// TODO add offsets , startVertex, numVertices * this._data32PerVertex\n\t\tthis._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(vertices), this._gl.STATIC_DRAW);\n\t}\n\n\tpublic get numVertices():number\n\t{\n\t\treturn this._numVertices;\n\t}\n\n\tpublic get data32PerVertex():number\n\t{\n\t\treturn this._data32PerVertex;\n\t}\n\n\tpublic get glBuffer():WebGLBuffer\n\t{\n\t\treturn this._buffer;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteBuffer(this._buffer);\n\t}\n}\n\nexport = VertexBufferWebGL;","import EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\n\nimport StageEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/StageEvent\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\n/**\n * The StageManager class provides a multiton object that handles management for Stage objects.\n *\n * @see away.base.Stage\n */\nclass StageManager extends EventDispatcher\n{\n\tprivate static STAGE_MAX_QUANTITY:number = 8;\n\tprivate _stages:Array<Stage>;\n\n\tprivate static _instance:StageManager;\n\tprivate static _numStages:number = 0;\n\tprivate _onContextCreatedDelegate:(event:Event) => void;\n\n\t/**\n\t * Creates a new StageManager class.\n\t * @param stage The Stage object that contains the Stage objects to be managed.\n\t * @private\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._stages = new Array<Stage>(StageManager.STAGE_MAX_QUANTITY);\n\n\t\tthis._onContextCreatedDelegate = (event:Event) => this.onContextCreated(event);\n\t}\n\n\t/**\n\t * Gets a StageManager instance for the given Stage object.\n\t * @param stage The Stage object that contains the Stage objects to be managed.\n\t * @return The StageManager instance for the given Stage object.\n\t */\n\tpublic static getInstance():StageManager\n\t{\n\t\tif (this._instance == null)\n\t\t\tthis._instance = new StageManager();\n\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * Requests the Stage for the given index.\n\t *\n\t * @param index The index of the requested Stage.\n\t * @param forceSoftware Whether to force software mode even if hardware acceleration is available.\n\t * @param profile The compatibility profile, an enumeration of ContextProfile\n\t * @return The Stage for the given index.\n\t */\n\tpublic getStageAt(index:number, forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\"):Stage\n\t{\n\t\tif (index < 0 || index >= StageManager.STAGE_MAX_QUANTITY)\n\t\t\tthrow new ArgumentError(\"Index is out of bounds [0..\" + StageManager.STAGE_MAX_QUANTITY + \"]\");\n\n\t\tif (!this._stages[index]) {\n\t\t\tStageManager._numStages++;\n\n\t\t\tvar canvas:HTMLCanvasElement = document.createElement(\"canvas\");\n\t\t\tcanvas.id = \"stage\" + index;\n\t\t\tdocument.body.appendChild(canvas);\n\t\t\tvar stage:Stage = this._stages[index] = new Stage(canvas, index, this, forceSoftware, profile);\n\t\t\tstage.addEventListener(StageEvent.CONTEXT_CREATED, this._onContextCreatedDelegate);\n\t\t\tstage.requestContext(forceSoftware, profile, mode);\n\t\t}\n\n\t\treturn stage;\n\t}\n\n\t/**\n\t * Removes a Stage from the manager.\n\t * @param stage\n\t * @private\n\t */\n\tpublic iRemoveStage(stage:Stage)\n\t{\n\t\tStageManager._numStages--;\n\n\t\tstage.removeEventListener(StageEvent.CONTEXT_CREATED, this._onContextCreatedDelegate);\n\n\t\tthis._stages[stage.stageIndex] = null;\n\t}\n\n\t/**\n\t * Get the next available stage. An error is thrown if there are no StageProxies available\n\t * @param forceSoftware Whether to force software mode even if hardware acceleration is available.\n\t * @param profile The compatibility profile, an enumeration of ContextProfile\n\t * @return The allocated stage\n\t */\n\tpublic getFreeStage(forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\"):Stage\n\t{\n\t\tvar i:number = 0;\n\t\tvar len:number = this._stages.length;\n\n\t\twhile (i < len) {\n\t\t\tif (!this._stages[i])\n\t\t\t\treturn this.getStageAt(i, forceSoftware, profile, mode);\n\n\t\t\t++i;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Checks if a new stage can be created and managed by the class.\n\t * @return true if there is one slot free for a new stage\n\t */\n\tpublic get hasFreeStage():boolean\n\t{\n\t\treturn StageManager._numStages < StageManager.STAGE_MAX_QUANTITY? true : false;\n\t}\n\n\t/**\n\t * Returns the amount of stage objects that can be created and managed by the class\n\t * @return the amount of free slots\n\t */\n\tpublic get numSlotsFree():number\n\t{\n\t\treturn StageManager.STAGE_MAX_QUANTITY - StageManager._numStages;\n\t}\n\n\t/**\n\t * Returns the amount of Stage objects currently managed by the class.\n\t * @return the amount of slots used\n\t */\n\tpublic get numSlotsUsed():number\n\t{\n\t\treturn StageManager._numStages;\n\t}\n\n\t/**\n\t * The maximum amount of Stage objects that can be managed by the class\n\t */\n\tpublic get numSlotsTotal():number\n\t{\n\t\treturn this._stages.length;\n\t}\n\n\tprivate onContextCreated(event:Event):void\n\t{\n\t\t//var stage:Stage = <Stage> e.target;\n\t\t//document.body.appendChild(stage.canvas)\n\t}\n}\n\nexport = StageManager;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\n\n/**\n *\n */\nclass IndexDataPool\n{\n\tprivate static _pool:Object = new Object();\n\n\tconstructor()\n\t{\n\t}\n\n\tpublic static getItem(subGeometry:SubGeometryBase, level:number, indexOffset:number):IndexData\n\t{\n\t\tvar subGeometryData:Array<IndexData> = <Array<IndexData>> (IndexDataPool._pool[subGeometry.id] || (IndexDataPool._pool[subGeometry.id] = new Array<IndexData>()));\n\n\t\tvar indexData:IndexData = subGeometryData[level] || (subGeometryData[level] = new IndexData(level));\n\t\tindexData.updateData(indexOffset, subGeometry.indices, subGeometry.numVertices);\n\n\t\treturn indexData;\n\t}\n\n\tpublic static disposeItem(id:number, level:number)\n\t{\n\t\tvar subGeometryData:Array<IndexData> = <Array<IndexData>> this._pool[id];\n\n\t\tsubGeometryData[level].dispose();\n\t\tsubGeometryData[level] = null;\n\t}\n\n\tpublic disposeData(id:number)\n\t{\n\t\tvar subGeometryData:Array<IndexData> = <Array<IndexData>> IndexDataPool._pool[id];\n\n\t\tvar len:number = subGeometryData.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tsubGeometryData[i].dispose();\n\t\t\tsubGeometryData[i] = null;\n\t\t}\n\n\t\tIndexDataPool._pool[id] = null;\n\t}\n}\n\nexport = IndexDataPool;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\n\n/**\n *\n */\nclass IndexData\n{\n\tprivate static LIMIT_VERTS:number = 0xffff;\n\n\tprivate static LIMIT_INDICES:number = 0xffffff;\n\n\tprivate _dataDirty = true;\n\n\tpublic invalid:Array<boolean> = new Array(8);\n\n\tpublic contexts:Array<IContextGL> = new Array<IContextGL>(8);\n\n\tpublic buffers:Array<IIndexBuffer> = new Array<IIndexBuffer>(8);\n\n\tpublic data:Array<number>;\n\n\tpublic indexMappings:Array<number>;\n\n\tpublic originalIndices:Array<number>;\n\n\tpublic offset:number;\n\n\tpublic level:number;\n\n\tconstructor(level:number)\n\t{\n\t\tthis.level = level;\n\t}\n\n\tpublic updateData(offset:number, indices:Array<number>, numVertices:number)\n\t{\n\t\tif (this._dataDirty) {\n\t\t\tthis._dataDirty = false;\n\n\t\t\tif (indices.length < IndexData.LIMIT_INDICES && numVertices < IndexData.LIMIT_VERTS) {\n\t\t\t\t//shortcut for those buffers that fit into the maximum buffer sizes\n\t\t\t\tthis.indexMappings = null;\n\t\t\t\tthis.originalIndices = null;\n\t\t\t\tthis.setData(indices);\n\t\t\t\tthis.offset = indices.length;\n\t\t\t} else {\n\t\t\t\tvar i:number;\n\t\t\t\tvar len:number;\n\t\t\t\tvar outIndex:number;\n\t\t\t\tvar j:number;\n\t\t\t\tvar k:number;\n\t\t\t\tvar splitIndices:Array<number> = new Array<number>();\n\n\t\t\t\tthis.indexMappings = new Array<number>(indices.length);\n\t\t\t\tthis.originalIndices = new Array<number>();\n\n\t\t\t\ti = this.indexMappings.length;\n\n\t\t\t\twhile (i--)\n\t\t\t\t\tthis.indexMappings[i] = -1;\n\n\t\t\t\tvar originalIndex:number;\n\t\t\t\tvar splitIndex:number;\n\n\t\t\t\t// Loop over all triangles\n\t\t\t\toutIndex = 0;\n\t\t\t\tlen = indices.length;\n\t\t\t\ti = offset;\n\t\t\t\tk = 0;\n\t\t\t\twhile (i < len && outIndex + 3 < IndexData.LIMIT_INDICES && k + 3 < IndexData.LIMIT_VERTS) {\n\t\t\t\t\t// Loop over all vertices in a triangle //TODO ensure this works for segments or any grouping\n\t\t\t\t\tfor (j = 0; j < 3; j++) {\n\n\t\t\t\t\t\toriginalIndex = indices[i + j];\n\n\t\t\t\t\t\tif (this.indexMappings[originalIndex] >= 0) {\n\t\t\t\t\t\t\tsplitIndex = this.indexMappings[originalIndex];\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// This vertex does not yet exist in the split list and\n\t\t\t\t\t\t\t// needs to be copied from the long list.\n\t\t\t\t\t\t\tsplitIndex = k++;\n\t\t\t\t\t\t\tthis.indexMappings[originalIndex] = splitIndex;\n\t\t\t\t\t\t\tthis.originalIndices.push(originalIndex);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Store new index, which may have come from the mapping look-up,\n\t\t\t\t\t\t// or from copying a new set of vertex data from the original vector\n\t\t\t\t\t\tsplitIndices[outIndex + j] = splitIndex;\n\t\t\t\t\t}\n\n\t\t\t\t\toutIndex += 3;\n\t\t\t\t\ti += 3\n\t\t\t\t}\n\n\t\t\t\tthis.setData(splitIndices);\n\t\t\t\tthis.offset = i;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic invalidateData()\n\t{\n\t\tthis._dataDirty = true;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.contexts[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t\tthis.contexts[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate disposeBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.buffers[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidateBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i)\n\t\t\tthis.invalid[i] = true;\n\t}\n\n\t/**\n\t *\n\t * @param data\n\t * @private\n\t */\n\tprivate setData(data:Array<number>)\n\t{\n\t\tif (this.data && this.data.length != data.length)\n\t\t\tthis.disposeBuffers();\n\t\telse\n\t\t\tthis.invalidateBuffers();\n\n\t\tthis.data = data;\n\t}\n}\n\nexport = IndexData;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\n\n/**\n * @class away.pool.ProgramDataPool\n */\nclass ProgramDataPool\n{\n\tprivate _pool:Object = new Object();\n\tprivate _stage:Stage;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param textureDataClass\n\t */\n\tconstructor(stage:Stage)\n\t{\n\t\tthis._stage = stage;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t * @returns ITexture\n\t */\n\tpublic getItem(key:string):ProgramData\n\t{\n\t\treturn this._pool[key] || (this._pool[key] = new ProgramData(this, this._stage, key));\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t */\n\tpublic disposeItem(key:string)\n\t{\n\t\tthis._pool[key] = null;\n\t}\n}\n\nexport = ProgramDataPool;","import ProgramDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramDataPool\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\n/**\n *\n * @class away.pool.ProgramDataBase\n */\nclass ProgramData\n{\n\tpublic static PROGRAMDATA_ID_COUNT:number = 0;\n\n\tprivate _pool:ProgramDataPool;\n\tprivate _key:string;\n\n\tpublic stage:Stage;\n\n\tpublic usages:number = 0;\n\n\tpublic program:IProgram;\n\n\tpublic id:number;\n\n\tconstructor(pool:ProgramDataPool, context:Stage, key:string)\n\t{\n\t\tthis._pool = pool;\n\t\tthis.stage = context;\n\t\tthis._key = key;\n\t\tthis.stage.registerProgram(this);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.usages--;\n\n\t\tif (!this.usages) {\n\t\t\tthis._pool.disposeItem(this._key);\n\n\t\t\tthis.stage.unRegisterProgram(this);\n\n\t\t\tif (this.program)\n\t\t\t\tthis.program.dispose();\n\t\t}\n\n\t\tthis.program = null;\n\t}\n}\n\nexport = ProgramData;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport TextureData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureData\");\n\n/**\n * @class away.pool.TextureDataPool\n */\nclass TextureDataPool\n{\n\tprivate _pool:Object = new Object();\n\n\t/**\n\t * //TODO\n\t *\n\t * @param textureDataClass\n\t */\n\tconstructor()\n\t{\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t * @returns ITexture\n\t */\n\tpublic getItem(textureProxy:TextureProxyBase):TextureData\n\t{\n\t\treturn (this._pool[textureProxy.id] || (this._pool[textureProxy.id] = textureProxy._iAddTextureData(new TextureData(this, textureProxy))))\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t */\n\tpublic disposeItem(textureProxy:TextureProxyBase)\n\t{\n\t\ttextureProxy._iRemoveTextureData(this._pool[textureProxy.id]);\n\n\t\tthis._pool[textureProxy.id] = null;\n\t}\n}\n\nexport = TextureDataPool;","import ITextureData\t\t\t\t\t= require(\"awayjs-core/lib/pool/ITextureData\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport TextureDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureDataPool\");\nimport ITextureBase\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\n\n/**\n *\n * @class away.pool.TextureDataBase\n */\nclass TextureData implements ITextureData\n{\n\tprivate _pool:TextureDataPool;\n\n\tpublic texture:ITextureBase;\n\n\tpublic textureProxy:TextureProxyBase;\n\n\tpublic invalid:boolean;\n\n\tconstructor(pool:TextureDataPool, textureProxy:TextureProxyBase)\n\t{\n\t\tthis._pool = pool;\n\t\tthis.textureProxy = textureProxy;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pool.disposeItem(this.textureProxy);\n\n\t\tthis.texture.dispose();\n\t\tthis.texture = null;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidate()\n\t{\n\t\tthis.invalid = true;\n\t}\n}\n\nexport = TextureData;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\nimport VertexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexData\");\n\n/**\n *\n */\nclass VertexDataPool\n{\n\tprivate static _pool:Object = new Object();\n\n\tconstructor()\n\t{\n\t}\n\n\tpublic static getItem(subGeometry:SubGeometryBase, indexData:IndexData, dataType:string):VertexData\n\t{\n\t\tif (subGeometry.concatenateArrays)\n\t\t\tdataType = SubGeometryBase.VERTEX_DATA;\n\n\t\tvar subGeometryDictionary:Object = <Object> (VertexDataPool._pool[subGeometry.id] || (VertexDataPool._pool[subGeometry.id] = new Object()));\n\t\tvar subGeometryData:Array<VertexData> = <Array<VertexData>> (subGeometryDictionary[dataType] || (subGeometryDictionary[dataType] = new Array<VertexData>()));\n\n\t\tvar vertexData:VertexData = subGeometryData[indexData.level] || (subGeometryData[indexData.level] = new VertexData(subGeometry, dataType));\n\t\tvertexData.updateData(indexData.originalIndices, indexData.indexMappings);\n\n\t\treturn vertexData;\n\t}\n\n\tpublic static disposeItem(subGeometry:SubGeometryBase, level:number, dataType:string)\n\t{\n\t\tvar subGeometryDictionary:Object = <Object> VertexDataPool._pool[subGeometry.id];\n\t\tvar subGeometryData:Array<VertexData> = <Array<VertexData>> subGeometryDictionary[dataType];\n\n\t\tsubGeometryData[level].dispose();\n\t\tsubGeometryData[level] = null;\n\t}\n\n\tpublic disposeData(subGeometry:SubGeometryBase)\n\t{\n\t\tvar subGeometryDictionary:Object = <Object> VertexDataPool._pool[subGeometry.id];\n\n\t\tfor (var key in subGeometryDictionary) {\n\t\t\tvar subGeometryData:Array<VertexData> = <Array<VertexData>> subGeometryDictionary[key];\n\n\t\t\tvar len:number = subGeometryData.length;\n\t\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\t\tsubGeometryData[i].dispose();\n\t\t\t\tsubGeometryData[i] = null;\n\t\t\t}\n\t\t}\n\n\t\tVertexDataPool._pool[subGeometry.id] = null;\n\t}\n}\n\nexport = VertexDataPool;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\n\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\n/**\n *\n */\nclass VertexData\n{\n\tprivate _onVerticesUpdatedDelegate:(event:SubGeometryEvent) => void;\n\tprivate _subGeometry:SubGeometryBase;\n\tprivate _dataType:string;\n\tprivate _dataDirty = true;\n\n\tpublic invalid:Array<boolean> = new Array<boolean>(8);\n\n\tpublic buffers:Array<IVertexBuffer> = new Array<IVertexBuffer>(8);\n\n\tpublic contexts:Array<IContextGL> = new Array<IContextGL>(8);\n\n\tpublic data:Array<number>;\n\n\tpublic dataPerVertex:number;\n\n\tconstructor(subGeometry:SubGeometryBase, dataType:string)\n\t{\n\t\tthis._subGeometry = subGeometry;\n\t\tthis._dataType = dataType;\n\n\t\tthis._onVerticesUpdatedDelegate = (event:SubGeometryEvent) => this._onVerticesUpdated(event);\n\t\tthis._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\n\t}\n\n\tpublic updateData(originalIndices:Array<number> = null, indexMappings:Array<number> = null)\n\t{\n\t\tif (this._dataDirty) {\n\t\t\tthis._dataDirty = false;\n\n\t\t\tthis.dataPerVertex = this._subGeometry.getStride(this._dataType);\n\n\t\t\tvar vertices:Array<number> = this._subGeometry[this._dataType];\n\n\t\t\tif (indexMappings == null) {\n\t\t\t\tthis.setData(vertices);\n\t\t\t} else {\n\t\t\t\tvar splitVerts:Array<number> = new Array<number>(originalIndices.length*this.dataPerVertex);\n\t\t\t\tvar originalIndex:number;\n\t\t\t\tvar splitIndex:number;\n\t\t\t\tvar i:number = 0;\n\t\t\t\tvar j:number = 0;\n\t\t\t\twhile(i < originalIndices.length) {\n\t\t\t\t\toriginalIndex = originalIndices[i];\n\n\t\t\t\t\tsplitIndex = indexMappings[originalIndex]*this.dataPerVertex;\n\t\t\t\t\toriginalIndex *= this.dataPerVertex;\n\n\t\t\t\t\tfor (j = 0; j < this.dataPerVertex; j++)\n\t\t\t\t\t\tsplitVerts[splitIndex + j] = vertices[originalIndex + j];\n\n\t\t\t\t\ti++;\n\t\t\t\t}\n\n\t\t\t\tthis.setData(splitVerts);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.contexts[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t\tthis.contexts[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate disposeBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.buffers[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidateBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i)\n\t\t\tthis.invalid[i] = true;\n\t}\n\n\t/**\n\t *\n\t * @param data\n\t * @param dataPerVertex\n\t * @private\n\t */\n\tprivate setData(data:Array<number>)\n\t{\n\t\tif (this.data && this.data.length != data.length)\n\t\t\tthis.disposeBuffers();\n\t\telse\n\t\t\tthis.invalidateBuffers();\n\n\t\tthis.data = data;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param event\n\t * @private\n\t */\n\tprivate _onVerticesUpdated(event:SubGeometryEvent)\n\t{\n\t\tvar dataType:string = this._subGeometry.concatenateArrays? SubGeometryBase.VERTEX_DATA : event.dataType;\n\n\t\tif (dataType == this._dataType)\n\t\t\tthis._dataDirty = true;\n\t}\n}\n\nexport = VertexData;","/*!\tSWFObject v2.2 <http://code.google.com/p/swfobject/> \n\tis released under the MIT License <http://www.opensource.org/licenses/mit-license.php> \n*/\n\nvar swfobject = function() {\n\t\n\tvar UNDEF = \"undefined\",\n\t\tOBJECT = \"object\",\n\t\tSHOCKWAVE_FLASH = \"Shockwave Flash\",\n\t\tSHOCKWAVE_FLASH_AX = \"ShockwaveFlash.ShockwaveFlash\",\n\t\tFLASH_MIME_TYPE = \"application/x-shockwave-flash\",\n\t\tEXPRESS_INSTALL_ID = \"SWFObjectExprInst\",\n\t\tON_READY_STATE_CHANGE = \"onreadystatechange\",\n\t\t\n\t\twin = window,\n\t\tdoc = document,\n\t\tnav = navigator,\n\t\t\n\t\tplugin = false,\n\t\tdomLoadFnArr = [main],\n\t\tregObjArr = [],\n\t\tobjIdArr = [],\n\t\tlistenersArr = [],\n\t\tstoredAltContent,\n\t\tstoredAltContentId,\n\t\tstoredCallbackFn,\n\t\tstoredCallbackObj,\n\t\tisDomLoaded = false,\n\t\tisExpressInstallActive = false,\n\t\tdynamicStylesheet,\n\t\tdynamicStylesheetMedia,\n\t\tautoHideShow = true,\n\t\n\t/* Centralized function for browser feature detection\n\t\t- User agent string detection is only used when no good alternative is possible\n\t\t- Is executed directly for optimal performance\n\t*/\t\n\tua = function() {\n\t\tvar w3cdom = typeof doc.getElementById != UNDEF && typeof doc.getElementsByTagName != UNDEF && typeof doc.createElement != UNDEF,\n\t\t\tu = nav.userAgent.toLowerCase(),\n\t\t\tp = nav.platform.toLowerCase(),\n\t\t\twindows = p ? /win/.test(p) : /win/.test(u),\n\t\t\tmac = p ? /mac/.test(p) : /mac/.test(u),\n\t\t\twebkit = /webkit/.test(u) ? parseFloat(u.replace(/^.*webkit\\/(\\d+(\\.\\d+)?).*$/, \"$1\")) : false, // returns either the webkit version or false if not webkit\n\t\t\tie = !+\"\\v1\", // feature detection based on Andrea Giammarchi's solution: http://webreflection.blogspot.com/2009/01/32-bytes-to-know-if-your-browser-is-ie.html\n\t\t\tplayerVersion = [0,0,0],\n\t\t\td = null;\n\t\tif (typeof nav.plugins != UNDEF && typeof nav.plugins[SHOCKWAVE_FLASH] == OBJECT) {\n\t\t\td = nav.plugins[SHOCKWAVE_FLASH].description;\n\t\t\tif (d && !(typeof nav.mimeTypes != UNDEF && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) { // navigator.mimeTypes[\"application/x-shockwave-flash\"].enabledPlugin indicates whether plug-ins are enabled or disabled in Safari 3+\n\t\t\t\tplugin = true;\n\t\t\t\tie = false; // cascaded feature detection for Internet Explorer\n\t\t\t\td = d.replace(/^.*\\s+(\\S+\\s+\\S+$)/, \"$1\");\n\t\t\t\tplayerVersion[0] = parseInt(d.replace(/^(.*)\\..*$/, \"$1\"), 10);\n\t\t\t\tplayerVersion[1] = parseInt(d.replace(/^.*\\.(.*)\\s.*$/, \"$1\"), 10);\n\t\t\t\tplayerVersion[2] = /[a-zA-Z]/.test(d) ? parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/, \"$1\"), 10) : 0;\n\t\t\t}\n\t\t}\n\t\telse if (typeof win.ActiveXObject != UNDEF) {\n\t\t\ttry {\n\t\t\t\tvar a = new ActiveXObject(SHOCKWAVE_FLASH_AX);\n\t\t\t\tif (a) { // a will return null when ActiveX is disabled\n\t\t\t\t\td = a.GetVariable(\"$version\");\n\t\t\t\t\tif (d) {\n\t\t\t\t\t\tie = true; // cascaded feature detection for Internet Explorer\n\t\t\t\t\t\td = d.split(\" \")[1].split(\",\");\n\t\t\t\t\t\tplayerVersion = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch(e) {}\n\t\t}\n\t\treturn { w3:w3cdom, pv:playerVersion, wk:webkit, ie:ie, win:windows, mac:mac };\n\t}(),\n\t\n\t/* Cross-browser onDomLoad\n\t\t- Will fire an event as soon as the DOM of a web page is loaded\n\t\t- Internet Explorer workaround based on Diego Perini's solution: http://javascript.nwbox.com/IEContentLoaded/\n\t\t- Regular onload serves as fallback\n\t*/ \n\tonDomLoad = function() {\n\t\tif (!ua.w3) { return; }\n\t\tif ((typeof doc.readyState != UNDEF && doc.readyState == \"complete\") || (typeof doc.readyState == UNDEF && (doc.getElementsByTagName(\"body\")[0] || doc.body))) { // function is fired after onload, e.g. when script is inserted dynamically \n\t\t\tcallDomLoadFunctions();\n\t\t}\n\t\tif (!isDomLoaded) {\n\t\t\tif (typeof doc.addEventListener != UNDEF) {\n\t\t\t\tdoc.addEventListener(\"DOMContentLoaded\", callDomLoadFunctions, false);\n\t\t\t}\t\t\n\t\t\tif (ua.ie && ua.win) {\n\t\t\t\tdoc.attachEvent(ON_READY_STATE_CHANGE, function() {\n\t\t\t\t\tif (doc.readyState == \"complete\") {\n\t\t\t\t\t\tdoc.detachEvent(ON_READY_STATE_CHANGE, arguments.callee);\n\t\t\t\t\t\tcallDomLoadFunctions();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (win == top) { // if not inside an iframe\n\t\t\t\t\t(function(){\n\t\t\t\t\t\tif (isDomLoaded) { return; }\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdoc.documentElement.doScroll(\"left\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallDomLoadFunctions();\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ua.wk) {\n\t\t\t\t(function(){\n\t\t\t\t\tif (isDomLoaded) { return; }\n\t\t\t\t\tif (!/loaded|complete/.test(doc.readyState)) {\n\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcallDomLoadFunctions();\n\t\t\t\t})();\n\t\t\t}\n\t\t\taddLoadEvent(callDomLoadFunctions);\n\t\t}\n\t}();\n\t\n\tfunction callDomLoadFunctions() {\n\t\tif (isDomLoaded) { return; }\n\t\ttry { // test if we can really add/remove elements to/from the DOM; we don't want to fire it too early\n\t\t\tvar t = doc.getElementsByTagName(\"body\")[0].appendChild(createElement(\"span\"));\n\t\t\tt.parentNode.removeChild(t);\n\t\t}\n\t\tcatch (e) { return; }\n\t\tisDomLoaded = true;\n\t\tvar dl = domLoadFnArr.length;\n\t\tfor (var i = 0; i < dl; i++) {\n\t\t\tdomLoadFnArr[i]();\n\t\t}\n\t}\n\t\n\tfunction addDomLoadEvent(fn) {\n\t\tif (isDomLoaded) {\n\t\t\tfn();\n\t\t}\n\t\telse { \n\t\t\tdomLoadFnArr[domLoadFnArr.length] = fn; // Array.push() is only available in IE5.5+\n\t\t}\n\t}\n\t\n\t/* Cross-browser onload\n\t\t- Based on James Edwards' solution: http://brothercake.com/site/resources/scripts/onload/\n\t\t- Will fire an event as soon as a web page including all of its assets are loaded \n\t */\n\tfunction addLoadEvent(fn) {\n\t\tif (typeof win.addEventListener != UNDEF) {\n\t\t\twin.addEventListener(\"load\", fn, false);\n\t\t}\n\t\telse if (typeof doc.addEventListener != UNDEF) {\n\t\t\tdoc.addEventListener(\"load\", fn, false);\n\t\t}\n\t\telse if (typeof win.attachEvent != UNDEF) {\n\t\t\taddListener(win, \"onload\", fn);\n\t\t}\n\t\telse if (typeof win.onload == \"function\") {\n\t\t\tvar fnOld = win.onload;\n\t\t\twin.onload = function() {\n\t\t\t\tfnOld();\n\t\t\t\tfn();\n\t\t\t};\n\t\t}\n\t\telse {\n\t\t\twin.onload = fn;\n\t\t}\n\t}\n\t\n\t/* Main function\n\t\t- Will preferably execute onDomLoad, otherwise onload (as a fallback)\n\t*/\n\tfunction main() { \n\t\tif (plugin) {\n\t\t\ttestPlayerVersion();\n\t\t}\n\t\telse {\n\t\t\tmatchVersions();\n\t\t}\n\t}\n\t\n\t/* Detect the Flash Player version for non-Internet Explorer browsers\n\t\t- Detecting the plug-in version via the object element is more precise than using the plugins collection item's description:\n\t\t  a. Both release and build numbers can be detected\n\t\t  b. Avoid wrong descriptions by corrupt installers provided by Adobe\n\t\t  c. Avoid wrong descriptions by multiple Flash Player entries in the plugin Array, caused by incorrect browser imports\n\t\t- Disadvantage of this method is that it depends on the availability of the DOM, while the plugins collection is immediately available\n\t*/\n\tfunction testPlayerVersion() {\n\t\tvar b = doc.getElementsByTagName(\"body\")[0];\n\t\tvar o = createElement(OBJECT);\n\t\to.setAttribute(\"type\", FLASH_MIME_TYPE);\n\t\tvar t = b.appendChild(o);\n\t\tif (t) {\n\t\t\tvar counter = 0;\n\t\t\t(function(){\n\t\t\t\tif (typeof t.GetVariable != UNDEF) {\n\t\t\t\t\tvar d = t.GetVariable(\"$version\");\n\t\t\t\t\tif (d) {\n\t\t\t\t\t\td = d.split(\" \")[1].split(\",\");\n\t\t\t\t\t\tua.pv = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (counter < 10) {\n\t\t\t\t\tcounter++;\n\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tb.removeChild(o);\n\t\t\t\tt = null;\n\t\t\t\tmatchVersions();\n\t\t\t})();\n\t\t}\n\t\telse {\n\t\t\tmatchVersions();\n\t\t}\n\t}\n\t\n\t/* Perform Flash Player and SWF version matching; static publishing only\n\t*/\n\tfunction matchVersions() {\n\t\tvar rl = regObjArr.length;\n\t\tif (rl > 0) {\n\t\t\tfor (var i = 0; i < rl; i++) { // for each registered object element\n\t\t\t\tvar id = regObjArr[i].id;\n\t\t\t\tvar cb = regObjArr[i].callbackFn;\n\t\t\t\tvar cbObj = {success:false, id:id};\n\t\t\t\tif (ua.pv[0] > 0) {\n\t\t\t\t\tvar obj = getElementById(id);\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (hasPlayerVersion(regObjArr[i].swfVersion) && !(ua.wk && ua.wk < 312)) { // Flash Player version >= published SWF version: Houston, we have a match!\n\t\t\t\t\t\t\tsetVisibility(id, true);\n\t\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\t\tcbObj.success = true;\n\t\t\t\t\t\t\t\tcbObj.ref = getObjectById(id);\n\t\t\t\t\t\t\t\tcb(cbObj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (regObjArr[i].expressInstall && canExpressInstall()) { // show the Adobe Express Install dialog if set by the web page author and if supported\n\t\t\t\t\t\t\tvar att = {};\n\t\t\t\t\t\t\tatt.data = regObjArr[i].expressInstall;\n\t\t\t\t\t\t\tatt.width = obj.getAttribute(\"width\") || \"0\";\n\t\t\t\t\t\t\tatt.height = obj.getAttribute(\"height\") || \"0\";\n\t\t\t\t\t\t\tif (obj.getAttribute(\"class\")) { att.styleclass = obj.getAttribute(\"class\"); }\n\t\t\t\t\t\t\tif (obj.getAttribute(\"align\")) { att.align = obj.getAttribute(\"align\"); }\n\t\t\t\t\t\t\t// parse HTML object param element's name-value pairs\n\t\t\t\t\t\t\tvar par = {};\n\t\t\t\t\t\t\tvar p = obj.getElementsByTagName(\"param\");\n\t\t\t\t\t\t\tvar pl = p.length;\n\t\t\t\t\t\t\tfor (var j = 0; j < pl; j++) {\n\t\t\t\t\t\t\t\tif (p[j].getAttribute(\"name\").toLowerCase() != \"movie\") {\n\t\t\t\t\t\t\t\t\tpar[p[j].getAttribute(\"name\")] = p[j].getAttribute(\"value\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tshowExpressInstall(att, par, id, cb);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse { // Flash Player and SWF version mismatch or an older Webkit engine that ignores the HTML object element's nested param elements: display alternative content instead of SWF\n\t\t\t\t\t\t\tdisplayAltContent(obj);\n\t\t\t\t\t\t\tif (cb) { cb(cbObj); }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\t// if no Flash Player is installed or the fp version cannot be detected we let the HTML object element do its job (either show a SWF or alternative content)\n\t\t\t\t\tsetVisibility(id, true);\n\t\t\t\t\tif (cb) {\n\t\t\t\t\t\tvar o = getObjectById(id); // test whether there is an HTML object element or not\n\t\t\t\t\t\tif (o && typeof o.SetVariable != UNDEF) { \n\t\t\t\t\t\t\tcbObj.success = true;\n\t\t\t\t\t\t\tcbObj.ref = o;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcb(cbObj);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getObjectById(objectIdStr) {\n\t\tvar r = null;\n\t\tvar o = getElementById(objectIdStr);\n\t\tif (o && o.nodeName == \"OBJECT\") {\n\t\t\tif (typeof o.SetVariable != UNDEF) {\n\t\t\t\tr = o;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar n = o.getElementsByTagName(OBJECT)[0];\n\t\t\t\tif (n) {\n\t\t\t\t\tr = n;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}\n\t\n\t/* Requirements for Adobe Express Install\n\t\t- only one instance can be active at a time\n\t\t- fp 6.0.65 or higher\n\t\t- Win/Mac OS only\n\t\t- no Webkit engines older than version 312\n\t*/\n\tfunction canExpressInstall() {\n\t\treturn !isExpressInstallActive && hasPlayerVersion(\"6.0.65\") && (ua.win || ua.mac) && !(ua.wk && ua.wk < 312);\n\t}\n\t\n\t/* Show the Adobe Express Install dialog\n\t\t- Reference: http://www.adobe.com/cfusion/knowledgebase/index.cfm?id=6a253b75\n\t*/\n\tfunction showExpressInstall(att, par, replaceElemIdStr, callbackFn) {\n\t\tisExpressInstallActive = true;\n\t\tstoredCallbackFn = callbackFn || null;\n\t\tstoredCallbackObj = {success:false, id:replaceElemIdStr};\n\t\tvar obj = getElementById(replaceElemIdStr);\n\t\tif (obj) {\n\t\t\tif (obj.nodeName == \"OBJECT\") { // static publishing\n\t\t\t\tstoredAltContent = abstractAltContent(obj);\n\t\t\t\tstoredAltContentId = null;\n\t\t\t}\n\t\t\telse { // dynamic publishing\n\t\t\t\tstoredAltContent = obj;\n\t\t\t\tstoredAltContentId = replaceElemIdStr;\n\t\t\t}\n\t\t\tatt.id = EXPRESS_INSTALL_ID;\n\t\t\tif (typeof att.width == UNDEF || (!/%$/.test(att.width) && parseInt(att.width, 10) < 310)) { att.width = \"310\"; }\n\t\t\tif (typeof att.height == UNDEF || (!/%$/.test(att.height) && parseInt(att.height, 10) < 137)) { att.height = \"137\"; }\n\t\t\tdoc.title = doc.title.slice(0, 47) + \" - Flash Player Installation\";\n\t\t\tvar pt = ua.ie && ua.win ? \"ActiveX\" : \"PlugIn\",\n\t\t\t\tfv = \"MMredirectURL=\" + encodeURI(window.location).toString().replace(/&/g,\"%26\") + \"&MMplayerType=\" + pt + \"&MMdoctitle=\" + doc.title;\n\t\t\tif (typeof par.flashvars != UNDEF) {\n\t\t\t\tpar.flashvars += \"&\" + fv;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpar.flashvars = fv;\n\t\t\t}\n\t\t\t// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,\n\t\t\t// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work\n\t\t\tif (ua.ie && ua.win && obj.readyState != 4) {\n\t\t\t\tvar newObj = createElement(\"div\");\n\t\t\t\treplaceElemIdStr += \"SWFObjectNew\";\n\t\t\t\tnewObj.setAttribute(\"id\", replaceElemIdStr);\n\t\t\t\tobj.parentNode.insertBefore(newObj, obj); // insert placeholder div that will be replaced by the object element that loads expressinstall.swf\n\t\t\t\tobj.style.display = \"none\";\n\t\t\t\t(function(){\n\t\t\t\t\tif (obj.readyState == 4) {\n\t\t\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\t\t\tcreateSWF(att, par, replaceElemIdStr);\n\t\t}\n\t}\n\t\n\t/* Functions to abstract and display alternative content\n\t*/\n\tfunction displayAltContent(obj) {\n\t\tif (ua.ie && ua.win && obj.readyState != 4) {\n\t\t\t// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,\n\t\t\t// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work\n\t\t\tvar el = createElement(\"div\");\n\t\t\tobj.parentNode.insertBefore(el, obj); // insert placeholder div that will be replaced by the alternative content\n\t\t\tel.parentNode.replaceChild(abstractAltContent(obj), el);\n\t\t\tobj.style.display = \"none\";\n\t\t\t(function(){\n\t\t\t\tif (obj.readyState == 4) {\n\t\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\telse {\n\t\t\tobj.parentNode.replaceChild(abstractAltContent(obj), obj);\n\t\t}\n\t} \n\n\tfunction abstractAltContent(obj) {\n\t\tvar ac = createElement(\"div\");\n\t\tif (ua.win && ua.ie) {\n\t\t\tac.innerHTML = obj.innerHTML;\n\t\t}\n\t\telse {\n\t\t\tvar nestedObj = obj.getElementsByTagName(OBJECT)[0];\n\t\t\tif (nestedObj) {\n\t\t\t\tvar c = nestedObj.childNodes;\n\t\t\t\tif (c) {\n\t\t\t\t\tvar cl = c.length;\n\t\t\t\t\tfor (var i = 0; i < cl; i++) {\n\t\t\t\t\t\tif (!(c[i].nodeType == 1 && c[i].nodeName == \"PARAM\") && !(c[i].nodeType == 8)) {\n\t\t\t\t\t\t\tac.appendChild(c[i].cloneNode(true));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ac;\n\t}\n\t\n\t/* Cross-browser dynamic SWF creation\n\t*/\n\tfunction createSWF(attObj, parObj, id) {\n\t\tvar r, el = getElementById(id);\n\t\tif (ua.wk && ua.wk < 312) { return r; }\n\t\tif (el) {\n\t\t\tif (typeof attObj.id == UNDEF) { // if no 'id' is defined for the object element, it will inherit the 'id' from the alternative content\n\t\t\t\tattObj.id = id;\n\t\t\t}\n\t\t\tif (ua.ie && ua.win) { // Internet Explorer + the HTML object element + W3C DOM methods do not combine: fall back to outerHTML\n\t\t\t\tvar att = \"\";\n\t\t\t\tfor (var i in attObj) {\n\t\t\t\t\tif (attObj[i] != Object.prototype[i]) { // filter out prototype additions from other potential libraries\n\t\t\t\t\t\tif (i.toLowerCase() == \"data\") {\n\t\t\t\t\t\t\tparObj.movie = attObj[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (i.toLowerCase() == \"styleclass\") { // 'class' is an ECMA4 reserved keyword\n\t\t\t\t\t\t\tatt += ' class=\"' + attObj[i] + '\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (i.toLowerCase() != \"classid\") {\n\t\t\t\t\t\t\tatt += ' ' + i + '=\"' + attObj[i] + '\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar par = \"\";\n\t\t\t\tfor (var j in parObj) {\n\t\t\t\t\tif (parObj[j] != Object.prototype[j]) { // filter out prototype additions from other potential libraries\n\t\t\t\t\t\tpar += '<param name=\"' + j + '\" value=\"' + parObj[j] + '\" />';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tel.outerHTML = '<object classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\"' + att + '>' + par + '</object>';\n\t\t\t\tobjIdArr[objIdArr.length] = attObj.id; // stored to fix object 'leaks' on unload (dynamic publishing only)\n\t\t\t\tr = getElementById(attObj.id);\t\n\t\t\t}\n\t\t\telse { // well-behaving browsers\n\t\t\t\tvar o = createElement(OBJECT);\n\t\t\t\to.setAttribute(\"type\", FLASH_MIME_TYPE);\n\t\t\t\tfor (var m in attObj) {\n\t\t\t\t\tif (attObj[m] != Object.prototype[m]) { // filter out prototype additions from other potential libraries\n\t\t\t\t\t\tif (m.toLowerCase() == \"styleclass\") { // 'class' is an ECMA4 reserved keyword\n\t\t\t\t\t\t\to.setAttribute(\"class\", attObj[m]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (m.toLowerCase() != \"classid\") { // filter out IE specific attribute\n\t\t\t\t\t\t\to.setAttribute(m, attObj[m]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var n in parObj) {\n\t\t\t\t\tif (parObj[n] != Object.prototype[n] && n.toLowerCase() != \"movie\") { // filter out prototype additions from other potential libraries and IE specific param element\n\t\t\t\t\t\tcreateObjParam(o, n, parObj[n]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tel.parentNode.replaceChild(o, el);\n\t\t\t\tr = o;\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}\n\t\n\tfunction createObjParam(el, pName, pValue) {\n\t\tvar p = createElement(\"param\");\n\t\tp.setAttribute(\"name\", pName);\t\n\t\tp.setAttribute(\"value\", pValue);\n\t\tel.appendChild(p);\n\t}\n\t\n\t/* Cross-browser SWF removal\n\t\t- Especially needed to safely and completely remove a SWF in Internet Explorer\n\t*/\n\tfunction removeSWF(id) {\n\t\tvar obj = getElementById(id);\n\t\tif (obj && obj.nodeName == \"OBJECT\") {\n\t\t\tif (ua.ie && ua.win) {\n\t\t\t\tobj.style.display = \"none\";\n\t\t\t\t(function(){\n\t\t\t\t\tif (obj.readyState == 4) {\n\t\t\t\t\t\tremoveObjectInIE(id);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction removeObjectInIE(id) {\n\t\tvar obj = getElementById(id);\n\t\tif (obj) {\n\t\t\tfor (var i in obj) {\n\t\t\t\tif (typeof obj[i] == \"function\") {\n\t\t\t\t\tobj[i] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tobj.parentNode.removeChild(obj);\n\t\t}\n\t}\n\t\n\t/* Functions to optimize JavaScript compression\n\t*/\n\tfunction getElementById(id) {\n\t\tvar el = null;\n\t\ttry {\n\t\t\tel = doc.getElementById(id);\n\t\t}\n\t\tcatch (e) {}\n\t\treturn el;\n\t}\n\t\n\tfunction createElement(el) {\n\t\treturn doc.createElement(el);\n\t}\n\t\n\t/* Updated attachEvent function for Internet Explorer\n\t\t- Stores attachEvent information in an Array, so on unload the detachEvent functions can be called to avoid memory leaks\n\t*/\t\n\tfunction addListener(target, eventType, fn) {\n\t\ttarget.attachEvent(eventType, fn);\n\t\tlistenersArr[listenersArr.length] = [target, eventType, fn];\n\t}\n\t\n\t/* Flash Player and SWF content version matching\n\t*/\n\tfunction hasPlayerVersion(rv) {\n\t\tvar pv = ua.pv, v = rv.split(\".\");\n\t\tv[0] = parseInt(v[0], 10);\n\t\tv[1] = parseInt(v[1], 10) || 0; // supports short notation, e.g. \"9\" instead of \"9.0.0\"\n\t\tv[2] = parseInt(v[2], 10) || 0;\n\t\treturn (pv[0] > v[0] || (pv[0] == v[0] && pv[1] > v[1]) || (pv[0] == v[0] && pv[1] == v[1] && pv[2] >= v[2])) ? true : false;\n\t}\n\t\n\t/* Cross-browser dynamic CSS creation\n\t\t- Based on Bobby van der Sluis' solution: http://www.bobbyvandersluis.com/articles/dynamicCSS.php\n\t*/\t\n\tfunction createCSS(sel, decl, media, newStyle) {\n\t\tif (ua.ie && ua.mac) { return; }\n\t\tvar h = doc.getElementsByTagName(\"head\")[0];\n\t\tif (!h) { return; } // to also support badly authored HTML pages that lack a head element\n\t\tvar m = (media && typeof media == \"string\") ? media : \"screen\";\n\t\tif (newStyle) {\n\t\t\tdynamicStylesheet = null;\n\t\t\tdynamicStylesheetMedia = null;\n\t\t}\n\t\tif (!dynamicStylesheet || dynamicStylesheetMedia != m) { \n\t\t\t// create dynamic stylesheet + get a global reference to it\n\t\t\tvar s = createElement(\"style\");\n\t\t\ts.setAttribute(\"type\", \"text/css\");\n\t\t\ts.setAttribute(\"media\", m);\n\t\t\tdynamicStylesheet = h.appendChild(s);\n\t\t\tif (ua.ie && ua.win && typeof doc.styleSheets != UNDEF && doc.styleSheets.length > 0) {\n\t\t\t\tdynamicStylesheet = doc.styleSheets[doc.styleSheets.length - 1];\n\t\t\t}\n\t\t\tdynamicStylesheetMedia = m;\n\t\t}\n\t\t// add style rule\n\t\tif (ua.ie && ua.win) {\n\t\t\tif (dynamicStylesheet && typeof dynamicStylesheet.addRule == OBJECT) {\n\t\t\t\tdynamicStylesheet.addRule(sel, decl);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (dynamicStylesheet && typeof doc.createTextNode != UNDEF) {\n\t\t\t\tdynamicStylesheet.appendChild(doc.createTextNode(sel + \" {\" + decl + \"}\"));\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction setVisibility(id, isVisible) {\n\t\tif (!autoHideShow) { return; }\n\t\tvar v = isVisible ? \"visible\" : \"hidden\";\n\t\tif (isDomLoaded && getElementById(id)) {\n\t\t\tgetElementById(id).style.visibility = v;\n\t\t}\n\t\telse {\n\t\t\tcreateCSS(\"#\" + id, \"visibility:\" + v);\n\t\t}\n\t}\n\n\t/* Filter to avoid XSS attacks\n\t*/\n\tfunction urlEncodeIfNecessary(s) {\n\t\tvar regex = /[\\\\\\\"<>\\.;]/;\n\t\tvar hasBadChars = regex.exec(s) != null;\n\t\treturn hasBadChars && typeof encodeURIComponent != UNDEF ? encodeURIComponent(s) : s;\n\t}\n\t\n\t/* Release memory to avoid memory leaks caused by closures, fix hanging audio/video threads and force open sockets/NetConnections to disconnect (Internet Explorer only)\n\t*/\n\tvar cleanup = function() {\n\t\tif (ua.ie && ua.win) {\n\t\t\twindow.attachEvent(\"onunload\", function() {\n\t\t\t\t// remove listeners to avoid memory leaks\n\t\t\t\tvar ll = listenersArr.length;\n\t\t\t\tfor (var i = 0; i < ll; i++) {\n\t\t\t\t\tlistenersArr[i][0].detachEvent(listenersArr[i][1], listenersArr[i][2]);\n\t\t\t\t}\n\t\t\t\t// cleanup dynamically embedded objects to fix audio/video threads and force open sockets and NetConnections to disconnect\n\t\t\t\tvar il = objIdArr.length;\n\t\t\t\tfor (var j = 0; j < il; j++) {\n\t\t\t\t\tremoveSWF(objIdArr[j]);\n\t\t\t\t}\n\t\t\t\t// cleanup library's main closures to avoid memory leaks\n\t\t\t\tfor (var k in ua) {\n\t\t\t\t\tua[k] = null;\n\t\t\t\t}\n\t\t\t\tua = null;\n\t\t\t\tfor (var l in swfobject) {\n\t\t\t\t\tswfobject[l] = null;\n\t\t\t\t}\n\t\t\t\tswfobject = null;\n\t\t\t});\n\t\t}\n\t}();\n\t\n\treturn {\n\t\t/* Public API\n\t\t\t- Reference: http://code.google.com/p/swfobject/wiki/documentation\n\t\t*/ \n\t\tregisterObject: function(objectIdStr, swfVersionStr, xiSwfUrlStr, callbackFn) {\n\t\t\tif (ua.w3 && objectIdStr && swfVersionStr) {\n\t\t\t\tvar regObj = {};\n\t\t\t\tregObj.id = objectIdStr;\n\t\t\t\tregObj.swfVersion = swfVersionStr;\n\t\t\t\tregObj.expressInstall = xiSwfUrlStr;\n\t\t\t\tregObj.callbackFn = callbackFn;\n\t\t\t\tregObjArr[regObjArr.length] = regObj;\n\t\t\t\tsetVisibility(objectIdStr, false);\n\t\t\t}\n\t\t\telse if (callbackFn) {\n\t\t\t\tcallbackFn({success:false, id:objectIdStr});\n\t\t\t}\n\t\t},\n\t\t\n\t\tgetObjectById: function(objectIdStr) {\n\t\t\tif (ua.w3) {\n\t\t\t\treturn getObjectById(objectIdStr);\n\t\t\t}\n\t\t},\n\t\t\n\t\tembedSWF: function(swfUrlStr, replaceElemIdStr, widthStr, heightStr, swfVersionStr, xiSwfUrlStr, flashvarsObj, parObj, attObj, callbackFn) {\n\t\t\tvar callbackObj = {success:false, id:replaceElemIdStr};\n\t\t\tif (ua.w3 && !(ua.wk && ua.wk < 312) && swfUrlStr && replaceElemIdStr && widthStr && heightStr && swfVersionStr) {\n\t\t\t\tsetVisibility(replaceElemIdStr, false);\n\t\t\t\taddDomLoadEvent(function() {\n\t\t\t\t\twidthStr += \"\"; // auto-convert to string\n\t\t\t\t\theightStr += \"\";\n\t\t\t\t\tvar att = {};\n\t\t\t\t\tif (attObj && typeof attObj === OBJECT) {\n\t\t\t\t\t\tfor (var i in attObj) { // copy object to avoid the use of references, because web authors often reuse attObj for multiple SWFs\n\t\t\t\t\t\t\tatt[i] = attObj[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tatt.data = swfUrlStr;\n\t\t\t\t\tatt.width = widthStr;\n\t\t\t\t\tatt.height = heightStr;\n\t\t\t\t\tvar par = {}; \n\t\t\t\t\tif (parObj && typeof parObj === OBJECT) {\n\t\t\t\t\t\tfor (var j in parObj) { // copy object to avoid the use of references, because web authors often reuse parObj for multiple SWFs\n\t\t\t\t\t\t\tpar[j] = parObj[j];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (flashvarsObj && typeof flashvarsObj === OBJECT) {\n\t\t\t\t\t\tfor (var k in flashvarsObj) { // copy object to avoid the use of references, because web authors often reuse flashvarsObj for multiple SWFs\n\t\t\t\t\t\t\tif (typeof par.flashvars != UNDEF) {\n\t\t\t\t\t\t\t\tpar.flashvars += \"&\" + k + \"=\" + flashvarsObj[k];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tpar.flashvars = k + \"=\" + flashvarsObj[k];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (hasPlayerVersion(swfVersionStr)) { // create SWF\n\t\t\t\t\t\tvar obj = createSWF(att, par, replaceElemIdStr);\n\t\t\t\t\t\tif (att.id == replaceElemIdStr) {\n\t\t\t\t\t\t\tsetVisibility(replaceElemIdStr, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallbackObj.success = true;\n\t\t\t\t\t\tcallbackObj.ref = obj;\n\t\t\t\t\t}\n\t\t\t\t\telse if (xiSwfUrlStr && canExpressInstall()) { // show Adobe Express Install\n\t\t\t\t\t\tatt.data = xiSwfUrlStr;\n\t\t\t\t\t\tshowExpressInstall(att, par, replaceElemIdStr, callbackFn);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse { // show alternative content\n\t\t\t\t\t\tsetVisibility(replaceElemIdStr, true);\n\t\t\t\t\t}\n\t\t\t\t\tif (callbackFn) { callbackFn(callbackObj); }\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (callbackFn) { callbackFn(callbackObj);\t}\n\t\t},\n\t\t\n\t\tswitchOffAutoHideShow: function() {\n\t\t\tautoHideShow = false;\n\t\t},\n\t\t\n\t\tua: ua,\n\t\t\n\t\tgetFlashPlayerVersion: function() {\n\t\t\treturn { major:ua.pv[0], minor:ua.pv[1], release:ua.pv[2] };\n\t\t},\n\t\t\n\t\thasFlashPlayerVersion: hasPlayerVersion,\n\t\t\n\t\tcreateSWF: function(attObj, parObj, replaceElemIdStr) {\n\t\t\tif (ua.w3) {\n\t\t\t\treturn createSWF(attObj, parObj, replaceElemIdStr);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t},\n\t\t\n\t\tshowExpressInstall: function(att, par, replaceElemIdStr, callbackFn) {\n\t\t\tif (ua.w3 && canExpressInstall()) {\n\t\t\t\tshowExpressInstall(att, par, replaceElemIdStr, callbackFn);\n\t\t\t}\n\t\t},\n\t\t\n\t\tremoveSWF: function(objElemIdStr) {\n\t\t\tif (ua.w3) {\n\t\t\t\tremoveSWF(objElemIdStr);\n\t\t\t}\n\t\t},\n\t\t\n\t\tcreateCSS: function(selStr, declStr, mediaStr, newStyleBoolean) {\n\t\t\tif (ua.w3) {\n\t\t\t\tcreateCSS(selStr, declStr, mediaStr, newStyleBoolean);\n\t\t\t}\n\t\t},\n\t\t\n\t\taddDomLoadEvent: addDomLoadEvent,\n\t\t\n\t\taddLoadEvent: addLoadEvent,\n\t\t\n\t\tgetQueryParamValue: function(param) {\n\t\t\tvar q = doc.location.search || doc.location.hash;\n\t\t\tif (q) {\n\t\t\t\tif (/\\?/.test(q)) { q = q.split(\"?\")[1]; } // strip question mark\n\t\t\t\tif (param == null) {\n\t\t\t\t\treturn urlEncodeIfNecessary(q);\n\t\t\t\t}\n\t\t\t\tvar pairs = q.split(\"&\");\n\t\t\t\tfor (var i = 0; i < pairs.length; i++) {\n\t\t\t\t\tif (pairs[i].substring(0, pairs[i].indexOf(\"=\")) == param) {\n\t\t\t\t\t\treturn urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf(\"=\") + 1)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn \"\";\n\t\t},\n\t\t\n\t\t// For internal usage only\n\t\texpressInstallCallback: function() {\n\t\t\tif (isExpressInstallActive) {\n\t\t\t\tvar obj = getElementById(EXPRESS_INSTALL_ID);\n\t\t\t\tif (obj && storedAltContent) {\n\t\t\t\t\tobj.parentNode.replaceChild(storedAltContent, obj);\n\t\t\t\t\tif (storedAltContentId) {\n\t\t\t\t\t\tsetVisibility(storedAltContentId, true);\n\t\t\t\t\t\tif (ua.ie && ua.win) { storedAltContent.style.display = \"block\"; }\n\t\t\t\t\t}\n\t\t\t\t\tif (storedCallbackFn) { storedCallbackFn(storedCallbackObj); }\n\t\t\t\t}\n\t\t\t\tisExpressInstallActive = false;\n\t\t\t} \n\t\t}\n\t};\n}();\n\nmodule.exports = swfobject;"],"sourceRoot":"./"}
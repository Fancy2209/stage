var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var RenderablePool = require("awayjs-display/lib/pool/RenderablePool");
var SkyboxRenderable = require("awayjs-stagegl/lib/core/pool/SkyboxRenderable");
var DepthRenderer = require("awayjs-stagegl/lib/core/render/DepthRenderer");
var Filter3DRenderer = require("awayjs-stagegl/lib/core/render/Filter3DRenderer");
var RendererBase = require("awayjs-stagegl/lib/core/render/RendererBase");
var ContextGLBlendFactor = require("awayjs-stagegl/lib/core/stagegl/ContextGLBlendFactor");
var ContextGLCompareMode = require("awayjs-stagegl/lib/core/stagegl/ContextGLCompareMode");
var ContextGLClearMask = require("awayjs-stagegl/lib/core/stagegl/ContextGLClearMask");
var RTTBufferManager = require("awayjs-stagegl/lib/managers/RTTBufferManager");
var StageManager = require("awayjs-stagegl/lib/managers/StageManager");
var DepthMapPass = require("awayjs-stagegl/lib/materials/passes/DepthMapPass");
var DistanceMapPass = require("awayjs-stagegl/lib/materials/passes/DistanceMapPass");
/**
 * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the
 * materials assigned to them.
 *
 * @class away.render.DefaultRenderer
 */
var DefaultRenderer = (function (_super) {
    __extends(DefaultRenderer, _super);
    /**
     * Creates a new DefaultRenderer object.
     *
     * @param antiAlias The amount of anti-aliasing to use.
     * @param renderMode The render mode to use.
     */
    function DefaultRenderer(forceSoftware, profile, mode) {
        if (forceSoftware === void 0) { forceSoftware = false; }
        if (profile === void 0) { profile = "baseline"; }
        if (mode === void 0) { mode = "auto"; }
        _super.call(this);
        this._skyboxProjection = new Matrix3D();
        this._skyboxRenderablePool = RenderablePool.getPool(SkyboxRenderable);
        this._pDepthRenderer = new DepthRenderer(new DepthMapPass());
        this._pDistanceRenderer = new DepthRenderer(new DistanceMapPass());
        if (this._pStage == null)
            this.stage = StageManager.getInstance().getFreeStage(forceSoftware, profile, mode);
        this._pRttBufferManager = RTTBufferManager.getInstance(this._pStage);
        if (this._width == 0)
            this.width = window.innerWidth;
        else
            this._pRttBufferManager.viewWidth = this._width;
        if (this._height == 0)
            this.height = window.innerHeight;
        else
            this._pRttBufferManager.viewHeight = this._height;
    }
    Object.defineProperty(DefaultRenderer.prototype, "antiAlias", {
        get: function () {
            return this._antiAlias;
        },
        set: function (value) {
            if (this._antiAlias == value)
                return;
            this._antiAlias = value;
            this._pBackBufferInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DefaultRenderer.prototype, "depthPrepass", {
        /**
         *
         */
        get: function () {
            return this._depthPrepass;
        },
        set: function (value) {
            this._depthPrepass = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DefaultRenderer.prototype, "filters3d", {
        /**
         *
         * @returns {*}
         */
        get: function () {
            return this._pFilter3DRenderer ? this._pFilter3DRenderer.filters : null;
        },
        set: function (value) {
            if (value && value.length == 0)
                value = null;
            if (this._pFilter3DRenderer && !value) {
                this._pFilter3DRenderer.dispose();
                this._pFilter3DRenderer = null;
            }
            else if (!this._pFilter3DRenderer && value) {
                this._pFilter3DRenderer = new Filter3DRenderer(this._pStage);
                this._pFilter3DRenderer.filters = value;
            }
            if (this._pFilter3DRenderer) {
                this._pFilter3DRenderer.filters = value;
                this._pRequireDepthRender = this._pFilter3DRenderer.requireDepthRender;
            }
            else {
                this._pRequireDepthRender = false;
                if (this._pDepthRender) {
                    this._pDepthRender.dispose();
                    this._pDepthRender = null;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    DefaultRenderer.prototype.render = function (entityCollector) {
        _super.prototype.render.call(this, entityCollector);
        if (!this._pStage.recoverFromDisposal()) {
            this._pBackBufferInvalid = true;
            return;
        }
        if (this._pBackBufferInvalid)
            this.pUpdateBackBuffer();
        if (this._shareContext && this._pContext)
            this._pContext.clear(0, 0, 0, 1, 1, 0, ContextGLClearMask.DEPTH);
        if (this._pFilter3DRenderer) {
            this.textureRatioX = this._pRttBufferManager.textureRatioX;
            this.textureRatioY = this._pRttBufferManager.textureRatioY;
        }
        else {
            this.textureRatioX = 1;
            this.textureRatioY = 1;
        }
        if (this._pRequireDepthRender)
            this.pRenderSceneDepthToTexture(entityCollector);
        if (this._depthPrepass)
            this.pRenderDepthPrepass(entityCollector);
        if (this._pFilter3DRenderer && this._pContext) {
        }
        else {
            if (this._shareContext)
                this._iRender(entityCollector, null, this._pScissorRect);
            else
                this._iRender(entityCollector);
        }
        _super.prototype.render.call(this, entityCollector);
        if (!this._shareContext && this._pContext)
            this._pContext.present();
        // register that a view has been rendered
        this._pStage.bufferClear = false;
    };
    DefaultRenderer.prototype.pExecuteRender = function (entityCollector, target, scissorRect, surfaceSelector) {
        if (target === void 0) { target = null; }
        if (scissorRect === void 0) { scissorRect = null; }
        if (surfaceSelector === void 0) { surfaceSelector = 0; }
        this.updateLights(entityCollector);
        // otherwise RTT will interfere with other RTTs
        if (target) {
            this.pCollectRenderables(entityCollector);
            this.drawRenderables(this._pOpaqueRenderableHead, entityCollector);
            this.drawRenderables(this._pBlendedRenderableHead, entityCollector);
        }
        _super.prototype.pExecuteRender.call(this, entityCollector, target, scissorRect, surfaceSelector);
    };
    DefaultRenderer.prototype.updateLights = function (entityCollector) {
        var dirLights = entityCollector.directionalLights;
        var pointLights = entityCollector.pointLights;
        var len, i;
        var light;
        var shadowMapper;
        len = dirLights.length;
        for (i = 0; i < len; ++i) {
            light = dirLights[i];
            shadowMapper = light.shadowMapper;
            if (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))
                shadowMapper.iRenderDepthMap(entityCollector, this._pDepthRenderer);
        }
        len = pointLights.length;
        for (i = 0; i < len; ++i) {
            light = pointLights[i];
            shadowMapper = light.shadowMapper;
            if (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))
                shadowMapper.iRenderDepthMap(entityCollector, this._pDistanceRenderer);
        }
    };
    /**
     * @inheritDoc
     */
    DefaultRenderer.prototype.pDraw = function (entityCollector, target) {
        if (!target)
            this.pCollectRenderables(entityCollector);
        this._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);
        if (entityCollector.skyBox) {
            this._pContext.setDepthTest(false, ContextGLCompareMode.ALWAYS);
            this.drawSkybox(entityCollector);
        }
        this._pContext.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);
        this.drawRenderables(this._pOpaqueRenderableHead, entityCollector);
        this.drawRenderables(this._pBlendedRenderableHead, entityCollector);
    };
    /**
     * Draw the skybox if present.
     *
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    DefaultRenderer.prototype.drawSkybox = function (entityCollector) {
        var skyBox = this._skyboxRenderablePool.getItem(entityCollector.skyBox);
        var material = entityCollector.skyBox.material;
        var camera = entityCollector.camera;
        this.updateSkyboxProjection(camera);
        var activePass = this._pStage.context.getMaterial(material, this._pStage.profile).getMaterialPass(material._iScreenPasses[0], this._pStage.profile);
        material._iActivatePass(activePass, this._pStage, camera);
        material._iRenderPass(activePass, skyBox, this._pStage, camera, this._skyboxProjection);
        material._iDeactivatePass(activePass, this._pStage);
    };
    DefaultRenderer.prototype.updateSkyboxProjection = function (camera) {
        var near = new Vector3D();
        this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);
        this._skyboxProjection.copyRowTo(2, near);
        var camPos = camera.scenePosition;
        var cx = near.x;
        var cy = near.y;
        var cz = near.z;
        var cw = -(near.x * camPos.x + near.y * camPos.y + near.z * camPos.z + Math.sqrt(cx * cx + cy * cy + cz * cz));
        var signX = cx >= 0 ? 1 : -1;
        var signY = cy >= 0 ? 1 : -1;
        var p = new Vector3D(signX, signY, 1, 1);
        var inverse = this._skyboxProjection.clone();
        inverse.invert();
        var q = inverse.transformVector(p);
        this._skyboxProjection.copyRowTo(3, p);
        var a = (q.x * p.x + q.y * p.y + q.z * p.z + q.w * p.w) / (cx * q.x + cy * q.y + cz * q.z + cw * q.w);
        this._skyboxProjection.copyRowFrom(2, new Vector3D(cx * a, cy * a, cz * a, cw * a));
    };
    /**
     * Draw a list of renderables.
     *
     * @param renderables The renderables to draw.
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    DefaultRenderer.prototype.drawRenderables = function (renderable, entityCollector) {
        var i;
        var len;
        var passes;
        var activePass;
        var activeMaterial;
        var context = this._pStage.context;
        var camera = entityCollector.camera;
        var renderable2;
        while (renderable) {
            activeMaterial = context.getMaterial(renderable.material, this._pStage.profile);
            //iterate through each screen pass
            passes = renderable.material._iScreenPasses;
            len = renderable.material._iNumScreenPasses();
            for (i = 0; i < len; i++) {
                renderable2 = renderable;
                activePass = activeMaterial.getMaterialPass(passes[i], this._pStage.profile);
                renderable.material._iActivatePass(activePass, this._pStage, camera);
                do {
                    renderable.material._iRenderPass(activePass, renderable2, this._pStage, camera, this._pRttViewProjectionMatrix);
                    renderable2 = renderable2.next;
                } while (renderable2 && renderable2.material == renderable.material);
                activeMaterial.material._iDeactivatePass(activePass, this._pStage);
            }
            renderable = renderable2;
        }
    };
    DefaultRenderer.prototype.dispose = function () {
        if (!this._shareContext)
            this._pStage.dispose();
        this._pDepthRenderer.dispose();
        this._pDistanceRenderer.dispose();
        this._pDepthRenderer = null;
        this._pDistanceRenderer = null;
        this._pDepthRender = null;
        _super.prototype.dispose.call(this);
    };
    /**
     *
     */
    DefaultRenderer.prototype.pRenderDepthPrepass = function (entityCollector) {
        this._pDepthRenderer.disableColor = true;
        if (this._pFilter3DRenderer) {
        }
        else {
            this._pDepthRenderer.textureRatioX = 1;
            this._pDepthRenderer.textureRatioY = 1;
            this._pDepthRenderer._iRender(entityCollector);
        }
        this._pDepthRenderer.disableColor = false;
    };
    /**
     *
     */
    DefaultRenderer.prototype.pRenderSceneDepthToTexture = function (entityCollector) {
        if (this._pDepthTextureInvalid || !this._pDepthRender)
            this.initDepthTexture(this._pStage.context);
        this._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;
        this._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;
        this._pDepthRenderer._iRender(entityCollector, this._pDepthRender);
    };
    /**
     * Updates the backbuffer dimensions.
     */
    DefaultRenderer.prototype.pUpdateBackBuffer = function () {
        // No reason trying to configure back buffer if there is no context available.
        // Doing this anyway (and relying on _stage to cache width/height for
        // context does get available) means usesSoftwareRendering won't be reliable.
        if (this._pStage.context && !this._shareContext) {
            if (this._width && this._height) {
                this._pStage.configureBackBuffer(this._width, this._height, this._antiAlias, true);
                this._pBackBufferInvalid = false;
            }
        }
    };
    DefaultRenderer.prototype.iSetStage = function (value) {
        _super.prototype.iSetStage.call(this, value);
        this._pDistanceRenderer.iSetStage(value);
        this._pDepthRenderer.iSetStage(value);
    };
    /**
     *
     */
    DefaultRenderer.prototype.initDepthTexture = function (context) {
        this._pDepthTextureInvalid = false;
        if (this._pDepthRender)
            this._pDepthRender.dispose();
        this._pDepthRender = new RenderTexture(this._pRttBufferManager.textureWidth, this._pRttBufferManager.textureHeight);
    };
    return DefaultRenderer;
})(RendererBase);
module.exports = DefaultRenderer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3JlbmRlci9kZWZhdWx0cmVuZGVyZXIudHMiXSwibmFtZXMiOlsiRGVmYXVsdFJlbmRlcmVyIiwiRGVmYXVsdFJlbmRlcmVyLmNvbnN0cnVjdG9yIiwiRGVmYXVsdFJlbmRlcmVyLmFudGlBbGlhcyIsIkRlZmF1bHRSZW5kZXJlci5kZXB0aFByZXBhc3MiLCJEZWZhdWx0UmVuZGVyZXIuZmlsdGVyczNkIiwiRGVmYXVsdFJlbmRlcmVyLnJlbmRlciIsIkRlZmF1bHRSZW5kZXJlci5wRXhlY3V0ZVJlbmRlciIsIkRlZmF1bHRSZW5kZXJlci51cGRhdGVMaWdodHMiLCJEZWZhdWx0UmVuZGVyZXIucERyYXciLCJEZWZhdWx0UmVuZGVyZXIuZHJhd1NreWJveCIsIkRlZmF1bHRSZW5kZXJlci51cGRhdGVTa3lib3hQcm9qZWN0aW9uIiwiRGVmYXVsdFJlbmRlcmVyLmRyYXdSZW5kZXJhYmxlcyIsIkRlZmF1bHRSZW5kZXJlci5kaXNwb3NlIiwiRGVmYXVsdFJlbmRlcmVyLnBSZW5kZXJEZXB0aFByZXBhc3MiLCJEZWZhdWx0UmVuZGVyZXIucFJlbmRlclNjZW5lRGVwdGhUb1RleHR1cmUiLCJEZWZhdWx0UmVuZGVyZXIucFVwZGF0ZUJhY2tCdWZmZXIiLCJEZWZhdWx0UmVuZGVyZXIuaVNldFN0YWdlIiwiRGVmYXVsdFJlbmRlcmVyLmluaXREZXB0aFRleHR1cmUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBRWhFLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBQ2hFLElBQU8sYUFBYSxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFJNUUsSUFBTyxjQUFjLFdBQWMsd0NBQXdDLENBQUMsQ0FBQztBQWU3RSxJQUFPLGdCQUFnQixXQUFjLCtDQUErQyxDQUFDLENBQUM7QUFDdEYsSUFBTyxhQUFhLFdBQWMsOENBQThDLENBQUMsQ0FBQztBQUNs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bkNBLElBQUlBLENBQUNBLEdBQVlBLElBQUlBLFFBQVFBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRWxEQSxJQUFJQSxPQUFPQSxHQUFZQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBQ3REQSxPQUFPQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUVqQkEsSUFBSUEsQ0FBQ0EsR0FBWUEsT0FBT0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFNUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFdkNBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEVBQUVBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRTNGQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLFFBQVFBLENBQUNBLEVBQUVBLEdBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUNBLENBQUNBLENBQUNBLENB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QUNBLGFBQWFBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1FBRTlCQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLFlBQVlBLEVBQUVBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7SUFDckhBLENBQUNBO0lBQ0ZqQixzQkFBQ0E7QUFBREEsQ0F4WkEsQUF3WkNBLEVBeFo2QixZQUFZLEVBd1p6QztBQUVELEFBQXlCLGlCQUFoQixlQUFlLENBQUMiLCJmaWxlIjoiY29yZS9yZW5kZXIvRGVmYXVsdFJlbmRlcmVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcbmltcG9ydCBUZXh0dXJlUHJveHlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZVByb3h5QmFzZVwiKTtcblxuaW1wb3J0IExpZ2h0QmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9MaWdodEJhc2VcIik7XG5pbXBvcnQgUmVuZGVyYWJsZVBvb2xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wb29sL1JlbmRlcmFibGVQb29sXCIpO1xuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBFbnRpdHlDb2xsZWN0b3JcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9FbnRpdHlDb2xsZWN0b3JcIik7XG5pbXBvcnQgSUNvbGxlY3Rvclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvdHJhdmVyc2UvSUNvbGxlY3RvclwiKTtcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuaW1wb3J0IFBvaW50TGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL1BvaW50TGlnaHRcIik7XG5pbXBvcnQgTWF0ZXJpYWxCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvTWF0ZXJpYWxCYXNlXCIpO1xuaW1wb3J0IElNYXRlcmlhbFBhc3NcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvcGFzc2VzL0lNYXRlcmlhbFBhc3NcIik7XG5pbXBvcnQgU2hhZG93TWFwcGVyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL1NoYWRvd01hcHBlckJhc2VcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgTWF0ZXJpYWxEYXRhXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3Bvb2wvTWF0ZXJpYWxEYXRhXCIpO1xuaW1wb3J0IE1hdGVyaWFsUGFzc0RhdGFcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3Bvb2wvTWF0ZXJpYWxQYXNzRGF0YVwiKTtcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcbmltcG9ydCBTa3lib3hSZW5kZXJhYmxlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9wb29sL1NreWJveFJlbmRlcmFibGVcIik7XG5pbXBvcnQgRGVwdGhSZW5kZXJlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvcmVuZGVyL0RlcHRoUmVuZGVyZXJcIik7XG5pbXBvcnQgRmlsdGVyM0RSZW5kZXJlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvcmVuZGVyL0ZpbHRlcjNEUmVuZGVyZXJcIik7XG5pbXBvcnQgUmVuZGVyZXJCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3JlbmRlci9SZW5kZXJlckJhc2VcIik7XG5pbXBvcnQgQ29udGV4dEdMQmxlbmRGYWN0b3JcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0NvbnRleHRHTEJsZW5kRmFjdG9yXCIpO1xuaW1wb3J0IENvbnRleHRHTENvbXBhcmVNb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9Db250ZXh0R0xDb21wYXJlTW9kZVwiKTtcbmltcG9ydCBDb250ZXh0R0xDbGVhck1hc2tcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0NvbnRleHRHTENsZWFyTWFza1wiKTtcbmltcG9ydCBJQ29udGV4dFN0YWdlR0xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3N0YWdlZ2wvSUNvbnRleHRTdGFnZUdMXCIpO1xuaW1wb3J0IEZpbHRlcjNEQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvZmlsdGVycy9GaWx0ZXIzREJhc2VcIik7XG5pbXBvcnQgUlRUQnVmZmVyTWFuYWdlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hbmFnZXJzL1JUVEJ1ZmZlck1hbmFnZXJcIik7XG5pbXBvcnQgU3RhZ2VNYW5hZ2VyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9tYW5hZ2Vycy9TdGFnZU1hbmFnZXJcIik7XG5pbXBvcnQgRGVwdGhNYXBQYXNzXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9tYXRlcmlhbHMvcGFzc2VzL0RlcHRoTWFwUGFzc1wiKTtcbmltcG9ydCBEaXN0YW5jZU1hcFBhc3NcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9tYXRlcmlhbHMvcGFzc2VzL0Rpc3RhbmNlTWFwUGFzc1wiKTtcbmltcG9ydCBNYXRlcmlhbFBhc3NCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL3Bhc3Nlcy9NYXRlcmlhbFBhc3NCYXNlXCIpO1xuXG4vKipcbiAqIFRoZSBEZWZhdWx0UmVuZGVyZXIgY2xhc3MgcHJvdmlkZXMgdGhlIGRlZmF1bHQgcmVuZGVyaW5nIG1ldGhvZC4gSXQgcmVuZGVycyB0aGUgc2NlbmUgZ3JhcGggb2JqZWN0cyB1c2luZyB0aGVcbiAqIG1hdGVyaWFscyBhc3NpZ25lZCB0byB0aGVtLlxuICpcbiAqIEBjbGFzcyBhd2F5LnJlbmRlci5EZWZhdWx0UmVuZGVyZXJcbiAqL1xuY2xhc3MgRGVmYXVsdFJlbmRlcmVyIGV4dGVuZHMgUmVuZGVyZXJCYXNlIGltcGxlbWVudHMgSVJlbmRlcmVyXG57XG5cdHB1YmxpYyBfcFJlcXVpcmVEZXB0aFJlbmRlcjpib29sZWFuO1xuXHRwcml2YXRlIF9za3lib3hSZW5kZXJhYmxlUG9vbDpSZW5kZXJhYmxlUG9vbDtcblxuLy9cdFx0cHJpdmF0ZSBfYWN0aXZlTWF0ZXJpYWw6TWF0ZXJpYWxCYXNlO1xuXHRwcml2YXRlIF9wRGlzdGFuY2VSZW5kZXJlcjpEZXB0aFJlbmRlcmVyO1xuXHRwcml2YXRlIF9wRGVwdGhSZW5kZXJlcjpEZXB0aFJlbmRlcmVyO1xuXHRwcml2YXRlIF9za3lib3hQcm9qZWN0aW9uOk1hdHJpeDNEID0gbmV3IE1hdHJpeDNEKCk7XG5cdHB1YmxpYyBfcEZpbHRlcjNEUmVuZGVyZXI6RmlsdGVyM0RSZW5kZXJlcjtcblxuXHRwdWJsaWMgX3BEZXB0aFJlbmRlcjpUZXh0dXJlUHJveHlCYXNlO1xuXG5cdHByaXZhdGUgX2FudGlBbGlhczpudW1iZXI7XG5cblx0cHVibGljIGdldCBhbnRpQWxpYXMoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9hbnRpQWxpYXM7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGFudGlBbGlhcyh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fYW50aUFsaWFzID09IHZhbHVlKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fYW50aUFsaWFzID0gdmFsdWU7XG5cblx0XHR0aGlzLl9wQmFja0J1ZmZlckludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IGRlcHRoUHJlcGFzcygpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9kZXB0aFByZXBhc3M7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGRlcHRoUHJlcGFzcyh2YWx1ZTpib29sZWFuKVxuXHR7XG5cdFx0dGhpcy5fZGVwdGhQcmVwYXNzID0gdmFsdWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHJldHVybnMgeyp9XG5cdCAqL1xuXHRwdWJsaWMgZ2V0IGZpbHRlcnMzZCgpOkFycmF5PEZpbHRlcjNEQmFzZT5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9wRmlsdGVyM0RSZW5kZXJlcj8gdGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIuZmlsdGVycyA6IG51bGw7XG5cdH1cblx0cHVibGljIHNldCBmaWx0ZXJzM2QodmFsdWU6QXJyYXk8RmlsdGVyM0RCYXNlPilcblx0e1xuXHRcdGlmICh2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPT0gMClcblx0XHRcdHZhbHVlID0gbnVsbDtcblxuXHRcdGlmICh0aGlzLl9wRmlsdGVyM0RSZW5kZXJlciAmJiAhdmFsdWUpIHtcblx0XHRcdHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLmRpc3Bvc2UoKTtcblx0XHRcdHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyID0gbnVsbDtcblx0XHR9IGVsc2UgaWYgKCF0aGlzLl9wRmlsdGVyM0RSZW5kZXJlciAmJiB2YWx1ZSkge1xuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIgPSBuZXcgRmlsdGVyM0RSZW5kZXJlcih0aGlzLl9wU3RhZ2UpO1xuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIuZmlsdGVycyA9IHZhbHVlO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLl9wRmlsdGVyM0RSZW5kZXJlcikge1xuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIuZmlsdGVycyA9IHZhbHVlO1xuXHRcdFx0dGhpcy5fcFJlcXVpcmVEZXB0aFJlbmRlciA9IHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLnJlcXVpcmVEZXB0aFJlbmRlcjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5fcFJlcXVpcmVEZXB0aFJlbmRlciA9IGZhbHNlO1xuXG5cdFx0XHRpZiAodGhpcy5fcERlcHRoUmVuZGVyKSB7XG5cdFx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlci5kaXNwb3NlKCk7XG5cdFx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlciA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgRGVmYXVsdFJlbmRlcmVyIG9iamVjdC5cblx0ICpcblx0ICogQHBhcmFtIGFudGlBbGlhcyBUaGUgYW1vdW50IG9mIGFudGktYWxpYXNpbmcgdG8gdXNlLlxuXHQgKiBAcGFyYW0gcmVuZGVyTW9kZSBUaGUgcmVuZGVyIG1vZGUgdG8gdXNlLlxuXHQgKi9cblx0Y29uc3RydWN0b3IoZm9yY2VTb2Z0d2FyZTpib29sZWFuID0gZmFsc2UsIHByb2ZpbGU6c3RyaW5nID0gXCJiYXNlbGluZVwiLCBtb2RlID0gXCJhdXRvXCIpXG5cdHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5fc2t5Ym94UmVuZGVyYWJsZVBvb2wgPSBSZW5kZXJhYmxlUG9vbC5nZXRQb29sKFNreWJveFJlbmRlcmFibGUpO1xuXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIgPSBuZXcgRGVwdGhSZW5kZXJlcihuZXcgRGVwdGhNYXBQYXNzKCkpO1xuXHRcdHRoaXMuX3BEaXN0YW5jZVJlbmRlcmVyID0gbmV3IERlcHRoUmVuZGVyZXIobmV3IERpc3RhbmNlTWFwUGFzcygpKTtcblxuXHRcdGlmICh0aGlzLl9wU3RhZ2UgPT0gbnVsbClcblx0XHRcdHRoaXMuc3RhZ2UgPSBTdGFnZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5nZXRGcmVlU3RhZ2UoZm9yY2VTb2Z0d2FyZSwgcHJvZmlsZSwgbW9kZSk7XG5cblx0XHR0aGlzLl9wUnR0QnVmZmVyTWFuYWdlciA9IFJUVEJ1ZmZlck1hbmFnZXIuZ2V0SW5zdGFuY2UodGhpcy5fcFN0YWdlKTtcblxuXHRcdGlmICh0aGlzLl93aWR0aCA9PSAwKVxuXHRcdFx0dGhpcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXHRcdGVsc2Vcblx0XHRcdHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnZpZXdXaWR0aCA9IHRoaXMuX3dpZHRoO1xuXG5cdFx0aWYgKHRoaXMuX2hlaWdodCA9PSAwKVxuXHRcdFx0dGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdFx0ZWxzZVxuXHRcdFx0dGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudmlld0hlaWdodCA9IHRoaXMuX2hlaWdodDtcblx0fVxuXG5cdHB1YmxpYyByZW5kZXIoZW50aXR5Q29sbGVjdG9yOklDb2xsZWN0b3IpXG5cdHtcblx0XHRzdXBlci5yZW5kZXIoZW50aXR5Q29sbGVjdG9yKTtcblxuXHRcdGlmICghdGhpcy5fcFN0YWdlLnJlY292ZXJGcm9tRGlzcG9zYWwoKSkgey8vaWYgY29udGV4dCBoYXMgRGlzcG9zZWQgYnkgdGhlIE9TLGRvbid0IHJlbmRlciBhdCB0aGlzIGZyYW1lXG5cdFx0XHR0aGlzLl9wQmFja0J1ZmZlckludmFsaWQgPSB0cnVlO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLl9wQmFja0J1ZmZlckludmFsaWQpLy8gcmVzZXQgb3IgdXBkYXRlIHJlbmRlciBzZXR0aW5nc1xuXHRcdFx0dGhpcy5wVXBkYXRlQmFja0J1ZmZlcigpO1xuXG5cdFx0aWYgKHRoaXMuX3NoYXJlQ29udGV4dCAmJiB0aGlzLl9wQ29udGV4dClcblx0XHRcdHRoaXMuX3BDb250ZXh0LmNsZWFyKDAsIDAsIDAsIDEsIDEsIDAsIENvbnRleHRHTENsZWFyTWFzay5ERVBUSCk7XG5cblx0XHRpZiAodGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIpIHtcblx0XHRcdHRoaXMudGV4dHVyZVJhdGlvWCA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1g7XG5cdFx0XHR0aGlzLnRleHR1cmVSYXRpb1kgPSB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlUmF0aW9ZO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnRleHR1cmVSYXRpb1ggPSAxO1xuXHRcdFx0dGhpcy50ZXh0dXJlUmF0aW9ZID0gMTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5fcFJlcXVpcmVEZXB0aFJlbmRlcilcblx0XHRcdHRoaXMucFJlbmRlclNjZW5lRGVwdGhUb1RleHR1cmUoPEVudGl0eUNvbGxlY3Rvcj4gZW50aXR5Q29sbGVjdG9yKTtcblxuXHRcdGlmICh0aGlzLl9kZXB0aFByZXBhc3MpXG5cdFx0XHR0aGlzLnBSZW5kZXJEZXB0aFByZXBhc3MoPEVudGl0eUNvbGxlY3Rvcj4gZW50aXR5Q29sbGVjdG9yKTtcblxuXHRcdGlmICh0aGlzLl9wRmlsdGVyM0RSZW5kZXJlciAmJiB0aGlzLl9wQ29udGV4dCkgeyAvL1RPRE9cblx0XHRcdC8vdGhpcy5faVJlbmRlcihlbnRpdHlDb2xsZWN0b3IsIHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLmdldE1haW5JbnB1dFRleHR1cmUodGhpcy5fcFN0YWdlKSwgdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIucmVuZGVyVG9UZXh0dXJlUmVjdCk7XG5cdFx0XHQvL3RoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLnJlbmRlcih0aGlzLl9wU3RhZ2UsIGVudGl0eUNvbGxlY3Rvci5jYW1lcmEsIHRoaXMuX3BEZXB0aFJlbmRlcik7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAodGhpcy5fc2hhcmVDb250ZXh0KVxuXHRcdFx0XHR0aGlzLl9pUmVuZGVyKGVudGl0eUNvbGxlY3RvciwgbnVsbCwgdGhpcy5fcFNjaXNzb3JSZWN0KTtcblx0XHRcdGVsc2Vcblx0XHRcdFx0dGhpcy5faVJlbmRlcihlbnRpdHlDb2xsZWN0b3IpO1xuXHRcdH1cblxuXHRcdHN1cGVyLnJlbmRlcihlbnRpdHlDb2xsZWN0b3IpO1xuXG5cdFx0aWYgKCF0aGlzLl9zaGFyZUNvbnRleHQgJiYgdGhpcy5fcENvbnRleHQpXG5cdFx0XHR0aGlzLl9wQ29udGV4dC5wcmVzZW50KCk7XG5cblx0XHQvLyByZWdpc3RlciB0aGF0IGEgdmlldyBoYXMgYmVlbiByZW5kZXJlZFxuXHRcdHRoaXMuX3BTdGFnZS5idWZmZXJDbGVhciA9IGZhbHNlO1xuXHR9XG5cblx0cHVibGljIHBFeGVjdXRlUmVuZGVyKGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IsIHRhcmdldDpUZXh0dXJlUHJveHlCYXNlID0gbnVsbCwgc2Npc3NvclJlY3Q6UmVjdGFuZ2xlID0gbnVsbCwgc3VyZmFjZVNlbGVjdG9yOm51bWJlciA9IDApXG5cdHtcblx0XHR0aGlzLnVwZGF0ZUxpZ2h0cyhlbnRpdHlDb2xsZWN0b3IpO1xuXG5cdFx0Ly8gb3RoZXJ3aXNlIFJUVCB3aWxsIGludGVyZmVyZSB3aXRoIG90aGVyIFJUVHNcblx0XHRpZiAodGFyZ2V0KSB7XG5cdFx0XHR0aGlzLnBDb2xsZWN0UmVuZGVyYWJsZXMoZW50aXR5Q29sbGVjdG9yKTtcblxuXHRcdFx0dGhpcy5kcmF3UmVuZGVyYWJsZXModGhpcy5fcE9wYXF1ZVJlbmRlcmFibGVIZWFkLCBlbnRpdHlDb2xsZWN0b3IpO1xuXHRcdFx0dGhpcy5kcmF3UmVuZGVyYWJsZXModGhpcy5fcEJsZW5kZWRSZW5kZXJhYmxlSGVhZCwgZW50aXR5Q29sbGVjdG9yKTtcblx0XHR9XG5cblx0XHRzdXBlci5wRXhlY3V0ZVJlbmRlcihlbnRpdHlDb2xsZWN0b3IsIHRhcmdldCwgc2Npc3NvclJlY3QsIHN1cmZhY2VTZWxlY3Rvcik7XG5cdH1cblxuXHRwcml2YXRlIHVwZGF0ZUxpZ2h0cyhlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yKVxuXHR7XG5cdFx0dmFyIGRpckxpZ2h0czpBcnJheTxEaXJlY3Rpb25hbExpZ2h0PiA9IGVudGl0eUNvbGxlY3Rvci5kaXJlY3Rpb25hbExpZ2h0cztcblx0XHR2YXIgcG9pbnRMaWdodHM6QXJyYXk8UG9pbnRMaWdodD4gPSBlbnRpdHlDb2xsZWN0b3IucG9pbnRMaWdodHM7XG5cdFx0dmFyIGxlbjpudW1iZXIsIGk6bnVtYmVyO1xuXHRcdHZhciBsaWdodDpMaWdodEJhc2U7XG5cdFx0dmFyIHNoYWRvd01hcHBlcjpTaGFkb3dNYXBwZXJCYXNlO1xuXG5cdFx0bGVuID0gZGlyTGlnaHRzLmxlbmd0aDtcblx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdGxpZ2h0ID0gZGlyTGlnaHRzW2ldO1xuXG5cdFx0XHRzaGFkb3dNYXBwZXIgPSBsaWdodC5zaGFkb3dNYXBwZXI7XG5cblx0XHRcdGlmIChsaWdodC5jYXN0c1NoYWRvd3MgJiYgKHNoYWRvd01hcHBlci5hdXRvVXBkYXRlU2hhZG93cyB8fCBzaGFkb3dNYXBwZXIuX2lTaGFkb3dzSW52YWxpZCApKVxuXHRcdFx0XHRzaGFkb3dNYXBwZXIuaVJlbmRlckRlcHRoTWFwKGVudGl0eUNvbGxlY3RvciwgdGhpcy5fcERlcHRoUmVuZGVyZXIpO1xuXHRcdH1cblxuXHRcdGxlbiA9IHBvaW50TGlnaHRzLmxlbmd0aDtcblx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdGxpZ2h0ID0gcG9pbnRMaWdodHNbaV07XG5cblx0XHRcdHNoYWRvd01hcHBlciA9IGxpZ2h0LnNoYWRvd01hcHBlcjtcblxuXHRcdFx0aWYgKGxpZ2h0LmNhc3RzU2hhZG93cyAmJiAoc2hhZG93TWFwcGVyLmF1dG9VcGRhdGVTaGFkb3dzIHx8IHNoYWRvd01hcHBlci5faVNoYWRvd3NJbnZhbGlkKSlcblx0XHRcdFx0c2hhZG93TWFwcGVyLmlSZW5kZXJEZXB0aE1hcChlbnRpdHlDb2xsZWN0b3IsIHRoaXMuX3BEaXN0YW5jZVJlbmRlcmVyKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBwRHJhdyhlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yLCB0YXJnZXQ6VGV4dHVyZVByb3h5QmFzZSlcblx0e1xuXHRcdGlmICghdGFyZ2V0KVxuXHRcdFx0dGhpcy5wQ29sbGVjdFJlbmRlcmFibGVzKGVudGl0eUNvbGxlY3Rvcik7XG5cblx0XHR0aGlzLl9wQ29udGV4dC5zZXRCbGVuZEZhY3RvcnMoQ29udGV4dEdMQmxlbmRGYWN0b3IuT05FLCBDb250ZXh0R0xCbGVuZEZhY3Rvci5aRVJPKTtcblxuXHRcdGlmIChlbnRpdHlDb2xsZWN0b3Iuc2t5Qm94KSB7XG5cdFx0XHR0aGlzLl9wQ29udGV4dC5zZXREZXB0aFRlc3QoZmFsc2UsIENvbnRleHRHTENvbXBhcmVNb2RlLkFMV0FZUyk7XG5cblx0XHRcdHRoaXMuZHJhd1NreWJveChlbnRpdHlDb2xsZWN0b3IpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3BDb250ZXh0LnNldERlcHRoVGVzdCh0cnVlLCBDb250ZXh0R0xDb21wYXJlTW9kZS5MRVNTX0VRVUFMKTtcblxuXHRcdHRoaXMuZHJhd1JlbmRlcmFibGVzKHRoaXMuX3BPcGFxdWVSZW5kZXJhYmxlSGVhZCwgZW50aXR5Q29sbGVjdG9yKTtcblx0XHR0aGlzLmRyYXdSZW5kZXJhYmxlcyh0aGlzLl9wQmxlbmRlZFJlbmRlcmFibGVIZWFkLCBlbnRpdHlDb2xsZWN0b3IpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERyYXcgdGhlIHNreWJveCBpZiBwcmVzZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gZW50aXR5Q29sbGVjdG9yIFRoZSBFbnRpdHlDb2xsZWN0b3IgY29udGFpbmluZyBhbGwgcG90ZW50aWFsbHkgdmlzaWJsZSBpbmZvcm1hdGlvbi5cblx0ICovXG5cdHByaXZhdGUgZHJhd1NreWJveChlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yKVxuXHR7XG5cdFx0dmFyIHNreUJveDpTa3lib3hSZW5kZXJhYmxlID0gPFNreWJveFJlbmRlcmFibGU+IHRoaXMuX3NreWJveFJlbmRlcmFibGVQb29sLmdldEl0ZW0oZW50aXR5Q29sbGVjdG9yLnNreUJveCk7XG5cblx0XHR2YXIgbWF0ZXJpYWw6TWF0ZXJpYWxCYXNlID0gZW50aXR5Q29sbGVjdG9yLnNreUJveC5tYXRlcmlhbDtcblxuXHRcdHZhciBjYW1lcmE6Q2FtZXJhID0gZW50aXR5Q29sbGVjdG9yLmNhbWVyYTtcblxuXHRcdHRoaXMudXBkYXRlU2t5Ym94UHJvamVjdGlvbihjYW1lcmEpO1xuXG5cdFx0dmFyIGFjdGl2ZVBhc3M6TWF0ZXJpYWxQYXNzRGF0YSA9ICg8SUNvbnRleHRTdGFnZUdMPiB0aGlzLl9wU3RhZ2UuY29udGV4dCkuZ2V0TWF0ZXJpYWwobWF0ZXJpYWwsIHRoaXMuX3BTdGFnZS5wcm9maWxlKS5nZXRNYXRlcmlhbFBhc3MoPE1hdGVyaWFsUGFzc0Jhc2U+IG1hdGVyaWFsLl9pU2NyZWVuUGFzc2VzWzBdLCB0aGlzLl9wU3RhZ2UucHJvZmlsZSk7XG5cblx0XHRtYXRlcmlhbC5faUFjdGl2YXRlUGFzcyhhY3RpdmVQYXNzLCB0aGlzLl9wU3RhZ2UsIGNhbWVyYSk7XG5cdFx0bWF0ZXJpYWwuX2lSZW5kZXJQYXNzKGFjdGl2ZVBhc3MsIHNreUJveCwgdGhpcy5fcFN0YWdlLCBjYW1lcmEsIHRoaXMuX3NreWJveFByb2plY3Rpb24pO1xuXHRcdG1hdGVyaWFsLl9pRGVhY3RpdmF0ZVBhc3MoYWN0aXZlUGFzcywgdGhpcy5fcFN0YWdlKTtcblx0fVxuXG5cdHByaXZhdGUgdXBkYXRlU2t5Ym94UHJvamVjdGlvbihjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0dmFyIG5lYXI6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoKTtcblxuXHRcdHRoaXMuX3NreWJveFByb2plY3Rpb24uY29weUZyb20odGhpcy5fcFJ0dFZpZXdQcm9qZWN0aW9uTWF0cml4KTtcblx0XHR0aGlzLl9za3lib3hQcm9qZWN0aW9uLmNvcHlSb3dUbygyLCBuZWFyKTtcblxuXHRcdHZhciBjYW1Qb3M6VmVjdG9yM0QgPSBjYW1lcmEuc2NlbmVQb3NpdGlvbjtcblxuXHRcdHZhciBjeDpudW1iZXIgPSBuZWFyLng7XG5cdFx0dmFyIGN5Om51bWJlciA9IG5lYXIueTtcblx0XHR2YXIgY3o6bnVtYmVyID0gbmVhci56O1xuXHRcdHZhciBjdzpudW1iZXIgPSAtKG5lYXIueCpjYW1Qb3MueCArIG5lYXIueSpjYW1Qb3MueSArIG5lYXIueipjYW1Qb3MueiArIE1hdGguc3FydChjeCpjeCArIGN5KmN5ICsgY3oqY3opKTtcblxuXHRcdHZhciBzaWduWDpudW1iZXIgPSBjeCA+PSAwPyAxIDogLTE7XG5cdFx0dmFyIHNpZ25ZOm51bWJlciA9IGN5ID49IDA/IDEgOiAtMTtcblxuXHRcdHZhciBwOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEKHNpZ25YLCBzaWduWSwgMSwgMSk7XG5cblx0XHR2YXIgaW52ZXJzZTpNYXRyaXgzRCA9IHRoaXMuX3NreWJveFByb2plY3Rpb24uY2xvbmUoKTtcblx0XHRpbnZlcnNlLmludmVydCgpO1xuXG5cdFx0dmFyIHE6VmVjdG9yM0QgPSBpbnZlcnNlLnRyYW5zZm9ybVZlY3RvcihwKTtcblxuXHRcdHRoaXMuX3NreWJveFByb2plY3Rpb24uY29weVJvd1RvKDMsIHApO1xuXG5cdFx0dmFyIGE6bnVtYmVyID0gKHEueCpwLnggKyBxLnkqcC55ICsgcS56KnAueiArIHEudypwLncpLyhjeCpxLnggKyBjeSpxLnkgKyBjeipxLnogKyBjdypxLncpO1xuXG5cdFx0dGhpcy5fc2t5Ym94UHJvamVjdGlvbi5jb3B5Um93RnJvbSgyLCBuZXcgVmVjdG9yM0QoY3gqYSwgY3kqYSwgY3oqYSwgY3cqYSkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERyYXcgYSBsaXN0IG9mIHJlbmRlcmFibGVzLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmVuZGVyYWJsZXMgVGhlIHJlbmRlcmFibGVzIHRvIGRyYXcuXG5cdCAqIEBwYXJhbSBlbnRpdHlDb2xsZWN0b3IgVGhlIEVudGl0eUNvbGxlY3RvciBjb250YWluaW5nIGFsbCBwb3RlbnRpYWxseSB2aXNpYmxlIGluZm9ybWF0aW9uLlxuXHQgKi9cblx0cHJpdmF0ZSBkcmF3UmVuZGVyYWJsZXMocmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgZW50aXR5Q29sbGVjdG9yOklDb2xsZWN0b3IpXG5cdHtcblx0XHR2YXIgaTpudW1iZXI7XG5cdFx0dmFyIGxlbjpudW1iZXI7XG5cdFx0dmFyIHBhc3NlczpBcnJheTxJTWF0ZXJpYWxQYXNzPjtcblx0XHR2YXIgYWN0aXZlUGFzczpNYXRlcmlhbFBhc3NEYXRhO1xuXHRcdHZhciBhY3RpdmVNYXRlcmlhbDpNYXRlcmlhbERhdGE7XG5cdFx0dmFyIGNvbnRleHQ6SUNvbnRleHRTdGFnZUdMID0gPElDb250ZXh0U3RhZ2VHTD4gdGhpcy5fcFN0YWdlLmNvbnRleHQ7XG5cdFx0dmFyIGNhbWVyYTpDYW1lcmEgPSBlbnRpdHlDb2xsZWN0b3IuY2FtZXJhO1xuXHRcdHZhciByZW5kZXJhYmxlMjpSZW5kZXJhYmxlQmFzZTtcblxuXHRcdHdoaWxlIChyZW5kZXJhYmxlKSB7XG5cdFx0XHRhY3RpdmVNYXRlcmlhbCA9IGNvbnRleHQuZ2V0TWF0ZXJpYWwocmVuZGVyYWJsZS5tYXRlcmlhbCwgdGhpcy5fcFN0YWdlLnByb2ZpbGUpO1xuXG5cdFx0XHQvL2l0ZXJhdGUgdGhyb3VnaCBlYWNoIHNjcmVlbiBwYXNzXG5cdFx0XHRwYXNzZXMgPSByZW5kZXJhYmxlLm1hdGVyaWFsLl9pU2NyZWVuUGFzc2VzO1xuXHRcdFx0bGVuID0gcmVuZGVyYWJsZS5tYXRlcmlhbC5faU51bVNjcmVlblBhc3NlcygpO1xuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHRcdHJlbmRlcmFibGUyID0gcmVuZGVyYWJsZTtcblxuXHRcdFx0XHRhY3RpdmVQYXNzID0gYWN0aXZlTWF0ZXJpYWwuZ2V0TWF0ZXJpYWxQYXNzKDxNYXRlcmlhbFBhc3NCYXNlPiBwYXNzZXNbaV0sIHRoaXMuX3BTdGFnZS5wcm9maWxlKTtcblxuXHRcdFx0XHRyZW5kZXJhYmxlLm1hdGVyaWFsLl9pQWN0aXZhdGVQYXNzKGFjdGl2ZVBhc3MsIHRoaXMuX3BTdGFnZSwgY2FtZXJhKTtcblxuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0cmVuZGVyYWJsZS5tYXRlcmlhbC5faVJlbmRlclBhc3MoYWN0aXZlUGFzcywgcmVuZGVyYWJsZTIsIHRoaXMuX3BTdGFnZSwgY2FtZXJhLCB0aGlzLl9wUnR0Vmlld1Byb2plY3Rpb25NYXRyaXgpO1xuXG5cdFx0XHRcdFx0cmVuZGVyYWJsZTIgPSByZW5kZXJhYmxlMi5uZXh0O1xuXG5cdFx0XHRcdH0gd2hpbGUgKHJlbmRlcmFibGUyICYmIHJlbmRlcmFibGUyLm1hdGVyaWFsID09IHJlbmRlcmFibGUubWF0ZXJpYWwpO1xuXG5cdFx0XHRcdGFjdGl2ZU1hdGVyaWFsLm1hdGVyaWFsLl9pRGVhY3RpdmF0ZVBhc3MoYWN0aXZlUGFzcywgdGhpcy5fcFN0YWdlKTtcblx0XHRcdH1cblxuXHRcdFx0cmVuZGVyYWJsZSA9IHJlbmRlcmFibGUyO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBkaXNwb3NlKClcblx0e1xuXHRcdGlmICghdGhpcy5fc2hhcmVDb250ZXh0KVxuXHRcdFx0dGhpcy5fcFN0YWdlLmRpc3Bvc2UoKTtcblxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLmRpc3Bvc2UoKTtcblx0XHR0aGlzLl9wRGlzdGFuY2VSZW5kZXJlci5kaXNwb3NlKCk7XG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIgPSBudWxsO1xuXHRcdHRoaXMuX3BEaXN0YW5jZVJlbmRlcmVyID0gbnVsbDtcblxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlciA9IG51bGw7XG5cblx0XHRzdXBlci5kaXNwb3NlKCk7XG5cdH1cblxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIHBSZW5kZXJEZXB0aFByZXBhc3MoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3Rvcilcblx0e1xuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLmRpc2FibGVDb2xvciA9IHRydWU7XG5cblx0XHRpZiAodGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIpIHsgLy9UT0RPXG4vL1x0XHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWCA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1g7XG4vL1x0XHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWSA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1k7XG4vL1x0XHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuX2lSZW5kZXIoZW50aXR5Q29sbGVjdG9yLCB0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5nZXRNYWluSW5wdXRUZXh0dXJlKHRoaXMuX3BTdGFnZSksIHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnJlbmRlclRvVGV4dHVyZVJlY3QpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci50ZXh0dXJlUmF0aW9YID0gMTtcblx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLnRleHR1cmVSYXRpb1kgPSAxO1xuXHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuX2lSZW5kZXIoZW50aXR5Q29sbGVjdG9yKTtcblx0XHR9XG5cblx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci5kaXNhYmxlQ29sb3IgPSBmYWxzZTtcblx0fVxuXG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgcFJlbmRlclNjZW5lRGVwdGhUb1RleHR1cmUoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3Rvcilcblx0e1xuXHRcdGlmICh0aGlzLl9wRGVwdGhUZXh0dXJlSW52YWxpZCB8fCAhdGhpcy5fcERlcHRoUmVuZGVyKVxuXHRcdFx0dGhpcy5pbml0RGVwdGhUZXh0dXJlKDxJQ29udGV4dFN0YWdlR0w+IHRoaXMuX3BTdGFnZS5jb250ZXh0KTtcblxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLnRleHR1cmVSYXRpb1ggPSB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlUmF0aW9YO1xuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLnRleHR1cmVSYXRpb1kgPSB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlUmF0aW9ZO1xuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLl9pUmVuZGVyKGVudGl0eUNvbGxlY3RvciwgdGhpcy5fcERlcHRoUmVuZGVyKTtcblx0fVxuXG5cblx0LyoqXG5cdCAqIFVwZGF0ZXMgdGhlIGJhY2tidWZmZXIgZGltZW5zaW9ucy5cblx0ICovXG5cdHB1YmxpYyBwVXBkYXRlQmFja0J1ZmZlcigpXG5cdHtcblx0XHQvLyBObyByZWFzb24gdHJ5aW5nIHRvIGNvbmZpZ3VyZSBiYWNrIGJ1ZmZlciBpZiB0aGVyZSBpcyBubyBjb250ZXh0IGF2YWlsYWJsZS5cblx0XHQvLyBEb2luZyB0aGlzIGFueXdheSAoYW5kIHJlbHlpbmcgb24gX3N0YWdlIHRvIGNhY2hlIHdpZHRoL2hlaWdodCBmb3Jcblx0XHQvLyBjb250ZXh0IGRvZXMgZ2V0IGF2YWlsYWJsZSkgbWVhbnMgdXNlc1NvZnR3YXJlUmVuZGVyaW5nIHdvbid0IGJlIHJlbGlhYmxlLlxuXHRcdGlmICh0aGlzLl9wU3RhZ2UuY29udGV4dCAmJiAhdGhpcy5fc2hhcmVDb250ZXh0KSB7XG5cdFx0XHRpZiAodGhpcy5fd2lkdGggJiYgdGhpcy5faGVpZ2h0KSB7XG5cdFx0XHRcdHRoaXMuX3BTdGFnZS5jb25maWd1cmVCYWNrQnVmZmVyKHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIHRoaXMuX2FudGlBbGlhcywgdHJ1ZSk7XG5cdFx0XHRcdHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBpU2V0U3RhZ2UodmFsdWU6U3RhZ2UpXG5cdHtcblx0XHRzdXBlci5pU2V0U3RhZ2UodmFsdWUpO1xuXG5cdFx0dGhpcy5fcERpc3RhbmNlUmVuZGVyZXIuaVNldFN0YWdlKHZhbHVlKTtcblx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci5pU2V0U3RhZ2UodmFsdWUpO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwcml2YXRlIGluaXREZXB0aFRleHR1cmUoY29udGV4dDpJQ29udGV4dFN0YWdlR0wpOnZvaWRcblx0e1xuXHRcdHRoaXMuX3BEZXB0aFRleHR1cmVJbnZhbGlkID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5fcERlcHRoUmVuZGVyKVxuXHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyLmRpc3Bvc2UoKTtcblxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlciA9IG5ldyBSZW5kZXJUZXh0dXJlKHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVXaWR0aCwgdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudGV4dHVyZUhlaWdodCk7XG5cdH1cbn1cblxuZXhwb3J0ID0gRGVmYXVsdFJlbmRlcmVyOyJdfQ==
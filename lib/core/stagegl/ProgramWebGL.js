var AGALTokenizer = require("awayjs-stagegl/lib/aglsl/AGALTokenizer");
var AGLSLParser = require("awayjs-stagegl/lib/aglsl/AGLSLParser");
var ProgramWebGL = (function () {
    function ProgramWebGL(gl) {
        this._gl = gl;
        this._program = this._gl.createProgram();
    }
    ProgramWebGL.prototype.upload = function (vertexProgram, fragmentProgram) {
        var vertexString = ProgramWebGL._aglslParser.parse(ProgramWebGL._tokenizer.decribeAGALByteArray(vertexProgram));
        var fragmentString = ProgramWebGL._aglslParser.parse(ProgramWebGL._tokenizer.decribeAGALByteArray(fragmentProgram));
        this._vertexShader = this._gl.createShader(this._gl.VERTEX_SHADER);
        this._fragmentShader = this._gl.createShader(this._gl.FRAGMENT_SHADER);
        this._gl.shaderSource(this._vertexShader, vertexString);
        this._gl.compileShader(this._vertexShader);
        if (!this._gl.getShaderParameter(this._vertexShader, this._gl.COMPILE_STATUS)) {
            throw new Error(this._gl.getShaderInfoLog(this._vertexShader));
            return;
        }
        this._gl.shaderSource(this._fragmentShader, fragmentString);
        this._gl.compileShader(this._fragmentShader);
        if (!this._gl.getShaderParameter(this._fragmentShader, this._gl.COMPILE_STATUS)) {
            throw new Error(this._gl.getShaderInfoLog(this._fragmentShader));
            return;
        }
        this._gl.attachShader(this._program, this._vertexShader);
        this._gl.attachShader(this._program, this._fragmentShader);
        this._gl.linkProgram(this._program);
        if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {
            throw new Error(this._gl.getProgramInfoLog(this._program));
        }
    };
    ProgramWebGL.prototype.dispose = function () {
        this._gl.deleteProgram(this._program);
    };
    ProgramWebGL.prototype.focusProgram = function () {
        this._gl.useProgram(this._program);
    };
    Object.defineProperty(ProgramWebGL.prototype, "glProgram", {
        get: function () {
            return this._program;
        },
        enumerable: true,
        configurable: true
    });
    ProgramWebGL._tokenizer = new AGALTokenizer();
    ProgramWebGL._aglslParser = new AGLSLParser();
    return ProgramWebGL;
})();
module.exports = ProgramWebGL;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3N0YWdlZ2wvcHJvZ3JhbXdlYmdsLnRzIl0sIm5hbWVzIjpbIlByb2dyYW1XZWJHTCIsIlByb2dyYW1XZWJHTC5jb25zdHJ1Y3RvciIsIlByb2dyYW1XZWJHTC51cGxvYWQiLCJQcm9ncmFtV2ViR0wuZGlzcG9zZSIsIlByb2dyYW1XZWJHTC5mb2N1c1Byb2dyYW0iLCJQcm9ncmFtV2ViR0wuZ2xQcm9ncmFtIl0sIm1hcHBpbmdzIjoiQUFFQSxJQUFPLGFBQWEsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBQzVFLElBQU8sV0FBVyxXQUFlLHNDQUFzQyxDQUFDLENBQUM7QUFJekUsSUFBTSxZQUFZO0lBVWpCQSxTQVZLQSxZQUFZQSxDQVVMQSxFQUF3QkE7UUFFbkNDLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ2RBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBO0lBQzFDQSxDQUFDQTtJQUVNRCw2QkFBTUEsR0FBYkEsVUFBY0EsYUFBdUJBLEVBQUVBLGVBQXlCQTtRQUUvREUsSUFBSUEsWUFBWUEsR0FBVUEsWUFBWUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsVUFBVUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2SEEsSUFBSUEsY0FBY0EsR0FBVUEsWUFBWUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsVUFBVUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUUzSEEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7UUFDbkVBLElBQUlB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QUN0QkEsQ0FBQ0E7OztPQUFBTDtJQTVEY0EsdUJBQVVBLEdBQWlCQSxJQUFJQSxhQUFhQSxFQUFFQSxDQUFDQTtJQUMvQ0EseUJBQVlBLEdBQWVBLElBQUlBLFdBQVdBLEVBQUVBLENBQUNBO0lBNEQ3REEsbUJBQUNBO0FBQURBLENBL0RBLEFBK0RDQSxJQUFBO0FBRUQsQUFBc0IsaUJBQWIsWUFBWSxDQUFDIiwiZmlsZSI6ImNvcmUvc3RhZ2VnbC9Qcm9ncmFtV2ViR0wuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJ5dGVBcnJheVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvQnl0ZUFycmF5XCIpO1xuXG5pbXBvcnQgQUdBTFRva2VuaXplclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL0FHQUxUb2tlbml6ZXJcIik7XG5pbXBvcnQgQUdMU0xQYXJzZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL0FHTFNMUGFyc2VyXCIpO1xuaW1wb3J0IElQcm9ncmFtXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9JUHJvZ3JhbVwiKTtcblxuXG5jbGFzcyBQcm9ncmFtV2ViR0wgaW1wbGVtZW50cyBJUHJvZ3JhbVxue1xuXHRwcml2YXRlIHN0YXRpYyBfdG9rZW5pemVyOkFHQUxUb2tlbml6ZXIgPSBuZXcgQUdBTFRva2VuaXplcigpO1xuXHRwcml2YXRlIHN0YXRpYyBfYWdsc2xQYXJzZXI6QUdMU0xQYXJzZXIgPSBuZXcgQUdMU0xQYXJzZXIoKTtcblxuXHRwcml2YXRlIF9nbDpXZWJHTFJlbmRlcmluZ0NvbnRleHQ7XG5cdHByaXZhdGUgX3Byb2dyYW06V2ViR0xQcm9ncmFtO1xuXHRwcml2YXRlIF92ZXJ0ZXhTaGFkZXI6V2ViR0xTaGFkZXI7XG5cdHByaXZhdGUgX2ZyYWdtZW50U2hhZGVyOldlYkdMU2hhZGVyO1xuXG5cdGNvbnN0cnVjdG9yKGdsOldlYkdMUmVuZGVyaW5nQ29udGV4dClcblx0e1xuXHRcdHRoaXMuX2dsID0gZ2w7XG5cdFx0dGhpcy5fcHJvZ3JhbSA9IHRoaXMuX2dsLmNyZWF0ZVByb2dyYW0oKTtcblx0fVxuXG5cdHB1YmxpYyB1cGxvYWQodmVydGV4UHJvZ3JhbTpCeXRlQXJyYXksIGZyYWdtZW50UHJvZ3JhbTpCeXRlQXJyYXkpXG5cdHtcblx0XHR2YXIgdmVydGV4U3RyaW5nOnN0cmluZyA9IFByb2dyYW1XZWJHTC5fYWdsc2xQYXJzZXIucGFyc2UoUHJvZ3JhbVdlYkdMLl90b2tlbml6ZXIuZGVjcmliZUFHQUxCeXRlQXJyYXkodmVydGV4UHJvZ3JhbSkpO1xuXHRcdHZhciBmcmFnbWVudFN0cmluZzpzdHJpbmcgPSBQcm9ncmFtV2ViR0wuX2FnbHNsUGFyc2VyLnBhcnNlKFByb2dyYW1XZWJHTC5fdG9rZW5pemVyLmRlY3JpYmVBR0FMQnl0ZUFycmF5KGZyYWdtZW50UHJvZ3JhbSkpO1xuXG5cdFx0dGhpcy5fdmVydGV4U2hhZGVyID0gdGhpcy5fZ2wuY3JlYXRlU2hhZGVyKHRoaXMuX2dsLlZFUlRFWF9TSEFERVIpO1xuXHRcdHRoaXMuX2ZyYWdtZW50U2hhZGVyID0gdGhpcy5fZ2wuY3JlYXRlU2hhZGVyKHRoaXMuX2dsLkZSQUdNRU5UX1NIQURFUik7XG5cblx0XHR0aGlzLl9nbC5zaGFkZXJTb3VyY2UodGhpcy5fdmVydGV4U2hhZGVyLCB2ZXJ0ZXhTdHJpbmcpO1xuXHRcdHRoaXMuX2dsLmNvbXBpbGVTaGFkZXIodGhpcy5fdmVydGV4U2hhZGVyKTtcblxuXHRcdGlmICghdGhpcy5fZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHRoaXMuX3ZlcnRleFNoYWRlciwgdGhpcy5fZ2wuQ09NUElMRV9TVEFUVVMpKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IodGhpcy5fZ2wuZ2V0U2hhZGVySW5mb0xvZyh0aGlzLl92ZXJ0ZXhTaGFkZXIpKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLl9nbC5zaGFkZXJTb3VyY2UodGhpcy5fZnJhZ21lbnRTaGFkZXIsIGZyYWdtZW50U3RyaW5nKTtcblx0XHR0aGlzLl9nbC5jb21waWxlU2hhZGVyKHRoaXMuX2ZyYWdtZW50U2hhZGVyKTtcblxuXHRcdGlmICghdGhpcy5fZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHRoaXMuX2ZyYWdtZW50U2hhZGVyLCB0aGlzLl9nbC5DT01QSUxFX1NUQVRVUykpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcih0aGlzLl9nbC5nZXRTaGFkZXJJbmZvTG9nKHRoaXMuX2ZyYWdtZW50U2hhZGVyKSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy5fZ2wuYXR0YWNoU2hhZGVyKHRoaXMuX3Byb2dyYW0sIHRoaXMuX3ZlcnRleFNoYWRlcik7XG5cdFx0dGhpcy5fZ2wuYXR0YWNoU2hhZGVyKHRoaXMuX3Byb2dyYW0sIHRoaXMuX2ZyYWdtZW50U2hhZGVyKTtcblx0XHR0aGlzLl9nbC5saW5rUHJvZ3JhbSh0aGlzLl9wcm9ncmFtKTtcblxuXHRcdGlmICghdGhpcy5fZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcih0aGlzLl9wcm9ncmFtLCB0aGlzLl9nbC5MSU5LX1NUQVRVUykpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcih0aGlzLl9nbC5nZXRQcm9ncmFtSW5mb0xvZyh0aGlzLl9wcm9ncmFtKSk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0dGhpcy5fZ2wuZGVsZXRlUHJvZ3JhbSh0aGlzLl9wcm9ncmFtKTtcblx0fVxuXG5cdHB1YmxpYyBmb2N1c1Byb2dyYW0oKVxuXHR7XG5cdFx0dGhpcy5fZ2wudXNlUHJvZ3JhbSh0aGlzLl9wcm9ncmFtKTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgZ2xQcm9ncmFtKCk6V2ViR0xQcm9ncmFtXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fcHJvZ3JhbTtcblx0fVxufVxuXG5leHBvcnQgPSBQcm9ncmFtV2ViR0w7Il19
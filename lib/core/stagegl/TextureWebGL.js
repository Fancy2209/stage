var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var BitmapData = require("awayjs-core/lib/base/BitmapData");
var TextureBaseWebGL = require("awayjs-stagegl/lib/core/stagegl/TextureBaseWebGL");
var TextureWebGL = (function (_super) {
    __extends(TextureWebGL, _super);
    function TextureWebGL(gl, width, height) {
        _super.call(this, gl);
        this.textureType = "texture2d";
        this._width = width;
        this._height = height;
        this._glTexture = this._gl.createTexture();
    }
    TextureWebGL.prototype.dispose = function () {
        this._gl.deleteTexture(this._glTexture);
    };
    Object.defineProperty(TextureWebGL.prototype, "width", {
        get: function () {
            return this._width;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TextureWebGL.prototype, "height", {
        get: function () {
            return this._height;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TextureWebGL.prototype, "frameBuffer", {
        get: function () {
            if (!this._frameBuffer) {
                this._frameBuffer = this._gl.createFramebuffer();
                this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, this._frameBuffer);
                this._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);
                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._width, this._height, 0, this._gl.RGBA, this._gl.UNSIGNED_BYTE, null);
                var renderBuffer = this._gl.createRenderbuffer();
                this._gl.bindRenderbuffer(this._gl.RENDERBUFFER, renderBuffer);
                this._gl.renderbufferStorage(this._gl.RENDERBUFFER, this._gl.DEPTH_COMPONENT16, this._width, this._height);
                this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER, this._gl.COLOR_ATTACHMENT0, this._gl.TEXTURE_2D, this._glTexture, 0);
                this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER, this._gl.DEPTH_ATTACHMENT, this._gl.RENDERBUFFER, renderBuffer);
                this._gl.bindTexture(this._gl.TEXTURE_2D, null);
                this._gl.bindRenderbuffer(this._gl.RENDERBUFFER, null);
                this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);
            }
            return this._frameBuffer;
        },
        enumerable: true,
        configurable: true
    });
    TextureWebGL.prototype.uploadFromData = function (data, miplevel) {
        if (miplevel === void 0) { miplevel = 0; }
        if (data instanceof BitmapData)
            data = data.imageData;
        this._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);
        this._gl.texImage2D(this._gl.TEXTURE_2D, miplevel, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);
        this._gl.bindTexture(this._gl.TEXTURE_2D, null);
    };
    TextureWebGL.prototype.uploadCompressedTextureFromByteArray = function (data, byteArrayOffset /*uint*/, async) {
        if (async === void 0) { async = false; }
        var ext = this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
        //this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this)
    };
    Object.defineProperty(TextureWebGL.prototype, "glTexture", {
        get: function () {
            return this._glTexture;
        },
        enumerable: true,
        configurable: true
    });
    TextureWebGL.prototype.generateMipmaps = function () {
        //TODO: implement generating mipmaps
        //this._gl.bindTexture( this._gl.TEXTURE_2D, this._glTexture );
        //this._gl.generateMipmap(this._gl.TEXTURE_2D);
        //this._gl.bindTexture( this._gl.TEXTURE_2D, null );
    };
    return TextureWebGL;
})(TextureBaseWebGL);
module.exports = TextureWebGL;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3N0YWdlZ2wvdGV4dHVyZXdlYmdsLnRzIl0sIm5hbWVzIjpbIlRleHR1cmVXZWJHTCIsIlRleHR1cmVXZWJHTC5jb25zdHJ1Y3RvciIsIlRleHR1cmVXZWJHTC5kaXNwb3NlIiwiVGV4dHVyZVdlYkdMLndpZHRoIiwiVGV4dHVyZVdlYkdMLmhlaWdodCIsIlRleHR1cmVXZWJHTC5mcmFtZUJ1ZmZlciIsIlRleHR1cmVXZWJHTC51cGxvYWRGcm9tRGF0YSIsIlRleHR1cmVXZWJHTC51cGxvYWRDb21wcmVzc2VkVGV4dHVyZUZyb21CeXRlQXJyYXkiLCJUZXh0dXJlV2ViR0wuZ2xUZXh0dXJlIiwiVGV4dHVyZVdlYkdMLmdlbmVyYXRlTWlwbWFwcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxVQUFVLFdBQWUsaUNBQWlDLENBQUMsQ0FBQztBQUluRSxJQUFPLGdCQUFnQixXQUFjLGtEQUFrRCxDQUFDLENBQUM7QUFFekYsSUFBTSxZQUFZO0lBQVNBLFVBQXJCQSxZQUFZQSxVQUF5QkE7SUFZMUNBLFNBWktBLFlBQVlBLENBWUxBLEVBQXdCQSxFQUFFQSxLQUFZQSxFQUFFQSxNQUFhQTtRQUVoRUMsa0JBQU1BLEVBQUVBLENBQUNBLENBQUNBO1FBWEpBLGdCQUFXQSxHQUFVQSxXQUFXQSxDQUFDQTtRQVl2Q0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDcEJBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE1BQU1BLENBQUNBO1FBRXRCQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFFTUQsOEJBQU9BLEdBQWRBO1FBRUNFLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO0lBQ3pDQSxDQUFDQTtJQUVERixzQkFBV0EsK0JBQUtBO2FBQWhCQTtZQUVDRyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNwQkEsQ0FBQ0E7OztPQUFBSDtJQUVEQSxzQkFBV0EsZ0NBQU1BO2FBQWpCQTtZQUVDSSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUNyQkEsQ0FBQ0E7OztPQUFBSjtJQUVEQSxzQkFBV0EscUNBQVdBO2FBQXRCQTtZQUVDSyxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDeEJBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7Z0JBQ2pEQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtnQkFDbEVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO2dCQUMzREEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsYUFBYUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBRXRJQSxJQUFJQSxZQUFZQSxHQUFxQkEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxDQUFDQTtnQkFDbkVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7Z0JBQy9EQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxtQkFBbUJBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7Z0JBRTNHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxvQkFBb0JBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3pIQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSx1QkFBdUJBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7Z0JBRXZIQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDaERBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZEQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUN0REEsQ0FBQ0E7WUFFREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDMUJBLENBQUNBOzs7T0FBQUw7SUFJTUEscUNBQWNBLEdBQXJCQSxVQUFzQkEsSUFBUUEsRUFBRUEsUUFBbUJBO1FBQW5CTSx3QkFBbUJBLEdBQW5CQSxZQUFtQkE7UUFFbERBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLFlBQVlBLFVBQVVBLENBQUNBO1lBQzlCQSxJQUFJQSxHQUFpQkEsSUFBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0E7UUFFdENBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBQzNEQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxFQUFFQSxRQUFRQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUMvR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDakRBLENBQUNBO0lBRU1OLDJEQUFvQ0EsR0FBM0NBLFVBQTRDQSxJQUFjQSxFQUFFQSxlQUFlQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxLQUFxQkE7UUFBckJPLHFCQUFxQkEsR0FBckJBLGFBQXFCQTtRQUVqSEEsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsQ0FBQ0Esc0NBQXNDQSxDQUFDQSxDQUFDQTtRQUMvRUEsNkRBQTZEQTtJQUM5REEsQ0FBQ0E7SUFFRFAsc0JBQVdBLG1DQUFTQTthQUFwQkE7WUFFQ1EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDeEJBLENBQUNBOzs7T0FBQVI7SUFFTUEsc0NBQWVBLEdBQXRCQTtRQUVDUyxvQ0FBb0NBO1FBQ3BDQSwrREFBK0RBO1FBQy9EQSwrQ0FBK0NBO1FBQy9DQSxvREFBb0RBO0lBQ3JEQSxDQUFDQTtJQUNGVCxtQkFBQ0E7QUFBREEsQ0F6RkEsQUF5RkNBLEVBekYwQixnQkFBZ0IsRUF5RjFDO0FBRUQsQUFBc0IsaUJBQWIsWUFBWSxDQUFDIiwiZmlsZSI6ImNvcmUvc3RhZ2VnbC9UZXh0dXJlV2ViR0wuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJpdG1hcERhdGFcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Jhc2UvQml0bWFwRGF0YVwiKTtcbmltcG9ydCBCeXRlQXJyYXlcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0J5dGVBcnJheVwiKTtcblxuaW1wb3J0IElUZXh0dXJlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9JVGV4dHVyZVwiKTtcbmltcG9ydCBUZXh0dXJlQmFzZVdlYkdMXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL1RleHR1cmVCYXNlV2ViR0xcIik7XG5cbmNsYXNzIFRleHR1cmVXZWJHTCBleHRlbmRzIFRleHR1cmVCYXNlV2ViR0wgaW1wbGVtZW50cyBJVGV4dHVyZVxue1xuXG5cdHB1YmxpYyB0ZXh0dXJlVHlwZTpzdHJpbmcgPSBcInRleHR1cmUyZFwiO1xuXG5cdHByaXZhdGUgX3dpZHRoOm51bWJlcjtcblx0cHJpdmF0ZSBfaGVpZ2h0Om51bWJlcjtcblxuXHRwcml2YXRlIF9mcmFtZUJ1ZmZlcjpXZWJHTEZyYW1lYnVmZmVyO1xuXG5cdHByaXZhdGUgX2dsVGV4dHVyZTpXZWJHTFRleHR1cmU7XG5cblx0Y29uc3RydWN0b3IoZ2w6V2ViR0xSZW5kZXJpbmdDb250ZXh0LCB3aWR0aDpudW1iZXIsIGhlaWdodDpudW1iZXIpXG5cdHtcblx0XHRzdXBlcihnbCk7XG5cdFx0dGhpcy5fd2lkdGggPSB3aWR0aDtcblx0XHR0aGlzLl9oZWlnaHQgPSBoZWlnaHQ7XG5cblx0XHR0aGlzLl9nbFRleHR1cmUgPSB0aGlzLl9nbC5jcmVhdGVUZXh0dXJlKCk7XG5cdH1cblxuXHRwdWJsaWMgZGlzcG9zZSgpXG5cdHtcblx0XHR0aGlzLl9nbC5kZWxldGVUZXh0dXJlKHRoaXMuX2dsVGV4dHVyZSk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHdpZHRoKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fd2lkdGg7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IGhlaWdodCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2hlaWdodDtcblx0fVxuXG5cdHB1YmxpYyBnZXQgZnJhbWVCdWZmZXIoKTpXZWJHTEZyYW1lYnVmZmVyXG5cdHtcblx0XHRpZiAoIXRoaXMuX2ZyYW1lQnVmZmVyKSB7XG5cdFx0XHR0aGlzLl9mcmFtZUJ1ZmZlciA9IHRoaXMuX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7XG5cdFx0XHR0aGlzLl9nbC5iaW5kRnJhbWVidWZmZXIodGhpcy5fZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyKTtcblx0XHRcdHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIHRoaXMuX2dsVGV4dHVyZSk7XG5cdFx0XHR0aGlzLl9nbC50ZXhJbWFnZTJEKHRoaXMuX2dsLlRFWFRVUkVfMkQsIDAsIHRoaXMuX2dsLlJHQkEsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIDAsIHRoaXMuX2dsLlJHQkEsIHRoaXMuX2dsLlVOU0lHTkVEX0JZVEUsIG51bGwpO1xuXG5cdFx0XHR2YXIgcmVuZGVyQnVmZmVyOldlYkdMUmVuZGVyYnVmZmVyID0gdGhpcy5fZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7XG5cdFx0XHR0aGlzLl9nbC5iaW5kUmVuZGVyYnVmZmVyKHRoaXMuX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyQnVmZmVyKTtcblx0XHRcdHRoaXMuX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UodGhpcy5fZ2wuUkVOREVSQlVGRkVSLCB0aGlzLl9nbC5ERVBUSF9DT01QT05FTlQxNiwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7XG5cblx0XHRcdHRoaXMuX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKHRoaXMuX2dsLkZSQU1FQlVGRkVSLCB0aGlzLl9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgdGhpcy5fZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xUZXh0dXJlLCAwKTtcblx0XHRcdHRoaXMuX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKHRoaXMuX2dsLkZSQU1FQlVGRkVSLCB0aGlzLl9nbC5ERVBUSF9BVFRBQ0hNRU5ULCB0aGlzLl9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlckJ1ZmZlcik7XG5cblx0XHRcdHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwpO1xuXHRcdFx0dGhpcy5fZ2wuYmluZFJlbmRlcmJ1ZmZlcih0aGlzLl9nbC5SRU5ERVJCVUZGRVIsIG51bGwpO1xuXHRcdFx0dGhpcy5fZ2wuYmluZEZyYW1lYnVmZmVyKHRoaXMuX2dsLkZSQU1FQlVGRkVSLCBudWxsKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fZnJhbWVCdWZmZXI7XG5cdH1cblxuXHRwdWJsaWMgdXBsb2FkRnJvbURhdGEoYml0bWFwRGF0YTpCaXRtYXBEYXRhLCBtaXBsZXZlbD86bnVtYmVyKTtcblx0cHVibGljIHVwbG9hZEZyb21EYXRhKGltYWdlOkhUTUxJbWFnZUVsZW1lbnQsIG1pcGxldmVsPzpudW1iZXIpO1xuXHRwdWJsaWMgdXBsb2FkRnJvbURhdGEoZGF0YTphbnksIG1pcGxldmVsOm51bWJlciA9IDApXG5cdHtcblx0XHRpZiAoZGF0YSBpbnN0YW5jZW9mIEJpdG1hcERhdGEpXG5cdFx0XHRkYXRhID0gKDxCaXRtYXBEYXRhPiBkYXRhKS5pbWFnZURhdGE7XG5cblx0XHR0aGlzLl9nbC5iaW5kVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFXzJELCB0aGlzLl9nbFRleHR1cmUpO1xuXHRcdHRoaXMuX2dsLnRleEltYWdlMkQodGhpcy5fZ2wuVEVYVFVSRV8yRCwgbWlwbGV2ZWwsIHRoaXMuX2dsLlJHQkEsIHRoaXMuX2dsLlJHQkEsIHRoaXMuX2dsLlVOU0lHTkVEX0JZVEUsIGRhdGEpO1xuXHRcdHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwpO1xuXHR9XG5cblx0cHVibGljIHVwbG9hZENvbXByZXNzZWRUZXh0dXJlRnJvbUJ5dGVBcnJheShkYXRhOkJ5dGVBcnJheSwgYnl0ZUFycmF5T2Zmc2V0Om51bWJlciAvKnVpbnQqLywgYXN5bmM6Ym9vbGVhbiA9IGZhbHNlKVxuXHR7XG5cdFx0dmFyIGV4dDpPYmplY3QgPSB0aGlzLl9nbC5nZXRFeHRlbnNpb24oXCJXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGNcIik7XG5cdFx0Ly90aGlzLl9nbC5jb21wcmVzc2VkVGV4SW1hZ2UyRCh0aGlzLl9nbC5URVhUVVJFXzJELCAwLCB0aGlzKVxuXHR9XG5cblx0cHVibGljIGdldCBnbFRleHR1cmUoKTpXZWJHTFRleHR1cmVcblx0e1xuXHRcdHJldHVybiB0aGlzLl9nbFRleHR1cmU7XG5cdH1cblxuXHRwdWJsaWMgZ2VuZXJhdGVNaXBtYXBzKClcblx0e1xuXHRcdC8vVE9ETzogaW1wbGVtZW50IGdlbmVyYXRpbmcgbWlwbWFwc1xuXHRcdC8vdGhpcy5fZ2wuYmluZFRleHR1cmUoIHRoaXMuX2dsLlRFWFRVUkVfMkQsIHRoaXMuX2dsVGV4dHVyZSApO1xuXHRcdC8vdGhpcy5fZ2wuZ2VuZXJhdGVNaXBtYXAodGhpcy5fZ2wuVEVYVFVSRV8yRCk7XG5cdFx0Ly90aGlzLl9nbC5iaW5kVGV4dHVyZSggdGhpcy5fZ2wuVEVYVFVSRV8yRCwgbnVsbCApO1xuXHR9XG59XG5cbmV4cG9ydCA9IFRleHR1cmVXZWJHTDsiXX0=
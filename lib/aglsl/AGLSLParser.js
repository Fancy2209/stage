var Mapping = require("awayjs-stagegl/lib/aglsl/Mapping");
var ContextStage3D = require("awayjs-stagegl/lib/core/stagegl/ContextStage3D");
var AGLSLParser = (function () {
    function AGLSLParser() {
    }
    AGLSLParser.prototype.parse = function (desc) {
        var header = "";
        var body = "";
        header += "precision highp float;\n";
        var tag = desc.header.type[0]; //TODO
        // declare uniforms
        if (desc.header.type == "vertex") {
            header += "uniform float yflip;\n";
        }
        if (!desc.hasindirect) {
            for (var i = 0; i < desc.regread[0x1].length; i++) {
                if (desc.regread[0x1][i]) {
                    header += "uniform vec4 " + tag + "c" + i + ";\n";
                }
            }
        }
        else {
            header += "uniform vec4 " + tag + "carrr[" + ContextStage3D.maxvertexconstants + "];\n"; // use max const count instead
        }
        for (var i = 0; i < desc.regread[0x2].length || i < desc.regwrite[0x2].length; i++) {
            if (desc.regread[0x2][i] || desc.regwrite[0x2][i]) {
                header += "vec4 " + tag + "t" + i + ";\n";
            }
        }
        for (var i = 0; i < desc.regread[0x0].length; i++) {
            if (desc.regread[0x0][i]) {
                header += "attribute vec4 va" + i + ";\n";
            }
        }
        for (var i = 0; i < desc.regread[0x4].length || i < desc.regwrite[0x4].length; i++) {
            if (desc.regread[0x4][i] || desc.regwrite[0x4][i]) {
                header += "varying vec4 vi" + i + ";\n";
            }
        }
        // declare samplers
        var samptype = ["2D", "Cube", "3D", ""];
        for (var i = 0; i < desc.samplers.length; i++) {
            if (desc.samplers[i]) {
                header += "uniform sampler" + samptype[desc.samplers[i].dim & 3] + " fs" + i + ";\n";
            }
        }
        // extra gl fluff: setup position and depth adjust temps
        if (desc.header.type == "vertex") {
            header += "vec4 outpos;\n";
        }
        if (desc.writedepth) {
            header += "vec4 tmp_FragDepth;\n";
        }
        //if ( desc.hasmatrix ) 
        //    header += "vec4 tmp_matrix;\n";
        // start body of code
        body += "void main() {\n";
        for (var i = 0; i < desc.tokens.length; i++) {
            var lutentry = Mapping.agal2glsllut[desc.tokens[i].opcode];
            if (!lutentry) {
                throw "Opcode not valid or not implemented yet: ";
            }
            var sublines = lutentry.matrixheight || 1;
            for (var sl = 0; sl < sublines; sl++) {
                var line = "  " + lutentry.s;
                if (desc.tokens[i].dest) {
                    if (lutentry.matrixheight) {
                        if (((desc.tokens[i].dest.mask >> sl) & 1) != 1) {
                            continue;
                        }
                        var destregstring = this.regtostring(desc.tokens[i].dest.regtype, desc.tokens[i].dest.regnum, desc, tag);
                        var destcaststring = "float";
                        var destmaskstring = ["x", "y", "z", "w"][sl];
                        destregstring += "." + destmaskstring;
                    }
                    else {
                        var destregstring = this.regtostring(desc.tokens[i].dest.regtype, desc.tokens[i].dest.regnum, desc, tag);
                        var destcaststring;
                        var destmaskstring;
                        if (desc.tokens[i].dest.mask != 0xf) {
                            var ndest = 0;
                            destmaskstring = "";
                            if (desc.tokens[i].dest.mask & 1) {
                                ndest++;
                                destmaskstring += "x";
                            }
                            if (desc.tokens[i].dest.mask & 2) {
                                ndest++;
                                destmaskstring += "y";
                            }
                            if (desc.tokens[i].dest.mask & 4) {
                                ndest++;
                                destmaskstring += "z";
                            }
                            if (desc.tokens[i].dest.mask & 8) {
                                ndest++;
                                destmaskstring += "w";
                            }
                            destregstring += "." + destmaskstring;
                            switch (ndest) {
                                case 1:
                                    destcaststring = "float";
                                    break;
                                case 2:
                                    destcaststring = "vec2";
                                    break;
                                case 3:
                                    destcaststring = "vec3";
                                    break;
                                default:
                                    throw "Unexpected destination mask";
                            }
                        }
                        else {
                            destcaststring = "vec4";
                            destmaskstring = "xyzw";
                        }
                    }
                    line = line.replace("%dest", destregstring);
                    line = line.replace("%cast", destcaststring);
                    line = line.replace("%dm", destmaskstring);
                }
                var dwm = 0xf;
                if (!lutentry.ndwm && lutentry.dest && desc.tokens[i].dest) {
                    dwm = desc.tokens[i].dest.mask;
                }
                if (desc.tokens[i].a) {
                    line = line.replace("%a", this.sourcetostring(desc.tokens[i].a, 0, dwm, lutentry.scalar, desc, tag));
                }
                if (desc.tokens[i].b) {
                    line = line.replace("%b", this.sourcetostring(desc.tokens[i].b, sl, dwm, lutentry.scalar, desc, tag));
                    if (desc.tokens[i].b.regtype == 0x5) {
                        // sampler dim
                        var texdim = ["2D", "Cube", "3D"][desc.tokens[i].b.dim];
                        var texsize = ["vec2", "vec3", "vec3"][desc.tokens[i].b.dim];
                        line = line.replace("%texdim", texdim);
                        line = line.replace("%texsize", texsize);
                        var texlod = "";
                        line = line.replace("%lod", texlod);
                    }
                }
                body += line;
            }
        }
        // adjust z from opengl range of -1..1 to 0..1 as in d3d, this also enforces a left handed coordinate system
        if (desc.header.type == "vertex") {
            body += "  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n";
        }
        // clamp fragment depth
        if (desc.writedepth) {
            body += "  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n";
        }
        // close main
        body += "}\n";
        return header + body;
    };
    AGLSLParser.prototype.regtostring = function (regtype, regnum, desc, tag) {
        switch (regtype) {
            case 0x0:
                return "va" + regnum;
            case 0x1:
                if (desc.hasindirect && desc.header.type == "vertex") {
                    return "vcarrr[" + regnum + "]";
                }
                else {
                    return tag + "c" + regnum;
                }
            case 0x2:
                return tag + "t" + regnum;
            case 0x3:
                return desc.header.type == "vertex" ? "outpos" : "gl_FragColor";
            case 0x4:
                return "vi" + regnum;
            case 0x5:
                return "fs" + regnum;
            case 0x6:
                return "tmp_FragDepth";
            default:
                throw "Unknown register type";
        }
    };
    AGLSLParser.prototype.sourcetostring = function (s, subline, dwm, isscalar, desc, tag) {
        var swiz = ["x", "y", "z", "w"];
        var r;
        if (s.indirectflag) {
            r = "vcarrr[int(" + this.regtostring(s.indexregtype, s.regnum, desc, tag) + "." + swiz[s.indexselect] + ")";
            var realofs = subline + s.indexoffset;
            if (realofs < 0)
                r += realofs.toString();
            if (realofs > 0)
                r += "+" + realofs.toString();
            r += "]";
        }
        else {
            r = this.regtostring(s.regtype, s.regnum + subline, desc, tag);
        }
        // samplers never add swizzle        
        if (s.regtype == 0x5) {
            return r;
        }
        // scalar, first component only
        if (isscalar) {
            return r + "." + swiz[(s.swizzle >> 0) & 3];
        }
        // identity
        if (s.swizzle == 0xe4 && dwm == 0xf) {
            return r;
        }
        // with destination write mask folded in
        r += ".";
        if (dwm & 1)
            r += swiz[(s.swizzle >> 0) & 3];
        if (dwm & 2)
            r += swiz[(s.swizzle >> 2) & 3];
        if (dwm & 4)
            r += swiz[(s.swizzle >> 4) & 3];
        if (dwm & 8)
            r += swiz[(s.swizzle >> 6) & 3];
        return r;
    };
    return AGLSLParser;
})();
module.exports = AGLSLParser;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFnbHNsL2FnbHNscGFyc2VyLnRzIl0sIm5hbWVzIjpbIkFHTFNMUGFyc2VyIiwiQUdMU0xQYXJzZXIuY29uc3RydWN0b3IiLCJBR0xTTFBhcnNlci5wYXJzZSIsIkFHTFNMUGFyc2VyLnJlZ3Rvc3RyaW5nIiwiQUdMU0xQYXJzZXIuc291cmNldG9zdHJpbmciXSwibWFwcGluZ3MiOiJBQUNBLElBQU8sT0FBTyxXQUFlLGtDQUFrQyxDQUFDLENBQUM7QUFDakUsSUFBTyxjQUFjLFdBQWEsZ0RBQWdELENBQUMsQ0FBQztBQUVwRixJQUFNLFdBQVc7SUFBakJBLFNBQU1BLFdBQVdBO0lBMk9qQkMsQ0FBQ0E7SUF6T09ELDJCQUFLQSxHQUFaQSxVQUFhQSxJQUFnQkE7UUFFNUJFLElBQUlBLE1BQU1BLEdBQVVBLEVBQUVBLENBQUNBO1FBQ3ZCQSxJQUFJQSxJQUFJQSxHQUFVQSxFQUFFQSxDQUFDQTtRQUVyQkEsTUFBTUEsSUFBSUEsMEJBQTBCQSxDQUFDQTtRQUNyQ0EsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUE7UUFFckNBLEFBQ0FBLG1CQURtQkE7UUFDbkJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xDQSxNQUFNQSxJQUFJQSx3QkFBd0JBLENBQUNBO1FBQ3BDQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN2QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7Z0JBQzFEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDMUJBLE1BQU1BLElBQUlBLGVBQWVBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO2dCQUNuREEsQ0FBQ0E7WUFDRkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsTUFBTUEsSUFBSUEsZUFBZUEsR0FBR0EsR0FBR0EsR0FBR0EsUUFBUUEsR0FBR0EsY0FBY0EsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxFQUFpQkEsOEJBQThCQTtRQUN2SUEsQ0FBQ0EsR0FEd0ZBO1FBSXpGQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNwRkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FDbERBLENBQUNBO2dCQUNBQSxNQUFNQSxJQUFJQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUMzQ0EsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFHREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDMURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUMxQkEsTUFBTUEsSUFBSUEsbUJBQW1CQSxHQUFHQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUMzQ0EsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFHREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDM0ZBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNuREEsTUFBTUEsSUFBSUEsaUJBQWlCQSxHQUFHQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUN6Q0EsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFFREEsQUFDQUEsbUJBRG1CQTtZQUNmQSxRQUFRQSxHQUFpQkEsQ0FBQ0EsSUFBSUEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDdERBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3REQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdEJBLE1BQU1BLElBQUlBLGlCQUFpQkEsR0FBR0EsUUFBUUEsQ0FBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBRUEsR0FBR0EsS0FBS0EsR0FBR0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFDeEZBLENBQUNBO1FBQ0ZBLENBQUNBO1FBRURBLEFBQ0FBLHdEQUR3REE7UUFDeERBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xDQSxNQUFNQSxJQUFJQSxnQkFBZ0JBLENBQUNBO1FBQzVCQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsTUFBTUEsSUFBSUEsdUJBQXVCQSxDQUFDQTtRQUNuQ0EsQ0FBQ0E7UUFDREEsQUFJQUEsd0JBSndCQTtRQUN4QkEscUNBQXFDQTtRQUVyQ0EscUJBQXFCQTtRQUNyQkEsSUFBSUEsSUFBSUEsaUJBQWlCQSxDQUFDQTtRQUUxQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDcERBLElBQUlBLFFBQVFBLEdBQUdBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQzNEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDZkEsTUFBTUEsMkNBQTJDQSxDQUFBQTtZQUVsREEsQ0FBQ0E7WUFDREEsSUFBSUEsUUFBUUEsR0FBR0EsUUFBUUEsQ0FBQ0EsWUFBWUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFFMUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEdBQVVBLENBQUNBLEVBQUVBLEVBQUVBLEdBQUdBLFFBQVFBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBO2dCQUM3Q0EsSUFBSUEsSUFBSUEsR0FBVUEsSUFBSUEsR0FBR0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3BDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDekJBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO3dCQUMzQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBQ2pEQSxRQUFRQSxDQUFDQTt3QkFDVkEsQ0FBQ0E7d0JBQ0RBLElBQUlBLGFBQWFBLEdBQVVBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO3dCQUNoSEEsSUFBSUEsY0FBY0EsR0FBVUEsT0FBT0EsQ0FBQ0E7d0JBQ3BDQSxJQUFJQSxjQUFjQSxHQUFHQSxDQUFDQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTt3QkFDOUNBLGFBQWFBLElBQUlBLEdBQUdBLEdBQUdBLGNBQWNBLENBQUNBO29CQUN2Q0EsQ0FBQ0E7b0JBQUNBLElBQUlBLENBQUNBLENBQUNBO3dCQUNQQSxJQUFJQSxhQUFhQSxHQUFVQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDaEhBLElBQUlBLGNBQXFCQSxDQUFDQTt3QkFDMUJBLElBQUlBLGNBQXFCQSxDQUFDQTt3QkFDMUJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBOzRCQUNyQ0EsSUFBSUEsS0FBS0EsR0FBVUEsQ0FBQ0EsQ0FBQ0E7NEJBQ3JCQSxjQUFjQSxHQUFHQSxFQUFFQSxDQUFDQTs0QkFDcEJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dDQUNsQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7Z0NBQ1JBLGNBQWNBLElBQUlBLEdBQUdBLENBQUNBOzRCQUN2QkEsQ0FBQ0E7NEJBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dDQUNsQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7Z0NBQ1JBLGNBQWNBLElBQUlBLEdBQUdBLENBQUNBOzRCQUN2QkEsQ0FBQ0E7NEJBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dDQUNsQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7Z0NBQ1JBLGNBQWNBLElBQUlBLEdBQUdBLENBQUNBOzRCQUN2QkEsQ0FBQ0E7NEJBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dDQUNsQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7Z0NBQ1JBLGNBQWNBLElBQUlBLEdBQUdBLENBQUNBOzRCQUN2QkEsQ0FBQ0E7NEJBQ0RBLGFBQWFBLElBQUlBLEdBQUdBLEdBQUdBLGNBQWNBLENBQUNBOzRCQUN0Q0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0NBQ2ZBLEtBQUtBLENBQUNBO29DQUNMQSxjQUFjQSxHQUFHQSxPQUFPQSxDQUFDQTtvQ0FDekJBLEtBQUtBLENBQUNBO2dDQUNQQSxLQUFLQSxDQUFDQTtvQ0FDTEEsY0FBY0EsR0FBR0EsTUFBTUEsQ0FBQ0E7b0NBQ3hCQSxLQUFLQSxDQUFDQTtnQ0FDUEEsS0FBS0EsQ0FBQ0E7b0NBQ0xBLGNBQWNBLEdBQUdBLE1BQU1BLENBQUNBO29DQUN4QkEsS0FBS0EsQ0FBQ0E7Z0NBQ1BBO29DQUNDQSxNQUFNQSw2QkFBNkJBLENBQUNBOzRCQUN0Q0EsQ0FBQ0E7d0JBQ0ZBLENBQUNBO3dCQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTs0QkFDUEEsY0FBY0EsR0FBR0EsTUFBTUEsQ0FBQ0E7NEJBQ3hCQSxjQUFjQSxHQUFHQSxNQUFNQSxDQUFDQTt3QkFDekJBLENBQUNBO29CQUNGQSxDQUFDQTtvQkFDREEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsRUFBRUEsYUFBYUEsQ0FBQ0EsQ0FBQ0E7b0JBQzVDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxFQUFFQSxjQUFjQSxDQUFDQSxDQUFDQTtvQkFDN0NBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLEVBQUVBLGNBQWNBLENBQUNBLENBQUNBO2dCQUM1Q0EsQ0FBQ0E7Z0JBQ0RBLElBQUlBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBO2dCQUNyQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsSUFBSUEsUUFBUUEsQ0FBQ0EsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzVEQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtnQkFDaENBLENBQUNBO2dCQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDdEJBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLFFBQVFBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0R0EsQ0FBQ0E7Z0JBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUN0QkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsRUFBRUEsUUFBUUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3RHQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDckNBLEFBQ0FBLGNBRGNBOzRCQUNWQSxNQUFNQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxNQUFNQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDeERBLElBQUlBLE9BQU9BLEdBQUdBLENBQUNBLE1BQU1BLEVBQUVBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO3dCQUM3REEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsU0FBU0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7d0JBQ3ZDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFVQSxFQUFFQSxPQUFPQSxDQUFD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QSxZQUFZQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxXQUFXQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtZQUM1R0EsSUFBSUEsT0FBT0EsR0FBR0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0E7WUFDdENBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO2dCQUFDQSxDQUFDQSxJQUFJQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtZQUN6Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQUNBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1lBQy9DQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQTtRQUNWQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxPQUFPQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNoRUEsQ0FBQ0E7UUFFREEsQUFDQUEscUNBRHFDQTtRQUNyQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBQ1ZBLENBQUNBO1FBRURBLEFBQ0FBLCtCQUQrQkE7UUFDL0JBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1lBQ2RBLE1BQU1BLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQzdDQSxDQUFDQTtRQUVEQSxBQUNBQSxXQURXQTtRQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxJQUFJQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDVkEsQ0FBQ0E7UUFFREEsQUFDQUEsd0NBRHdDQTtRQUN4Q0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0E7UUFDVEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO1lBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQzdDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM3Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO0lBQ1ZBLENBQUNBO0lBQ0ZKLGtCQUFDQTtBQUFEQSxDQTNPQSxBQTJPQ0EsSUFBQTtBQUVELEFBQXFCLGlCQUFaLFdBQVcsQ0FBQyIsImZpbGUiOiJhZ2xzbC9BR0xTTFBhcnNlci5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1zdGFnZWdsLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBEZXNjcmlwdGlvblx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL0Rlc2NyaXB0aW9uXCIpO1xuaW1wb3J0IE1hcHBpbmdcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL01hcHBpbmdcIik7XG5pbXBvcnQgQ29udGV4dFN0YWdlM0RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0NvbnRleHRTdGFnZTNEXCIpO1xuXG5jbGFzcyBBR0xTTFBhcnNlclxue1xuXHRwdWJsaWMgcGFyc2UoZGVzYzpEZXNjcmlwdGlvbilcblx0e1xuXHRcdHZhciBoZWFkZXI6c3RyaW5nID0gXCJcIjtcblx0XHR2YXIgYm9keTpzdHJpbmcgPSBcIlwiO1xuXG5cdFx0aGVhZGVyICs9IFwicHJlY2lzaW9uIGhpZ2hwIGZsb2F0O1xcblwiO1xuXHRcdHZhciB0YWcgPSBkZXNjLmhlYWRlci50eXBlWzBdOyAvL1RPRE9cblxuXHRcdC8vIGRlY2xhcmUgdW5pZm9ybXNcblx0XHRpZiAoZGVzYy5oZWFkZXIudHlwZSA9PSBcInZlcnRleFwiKSB7XG5cdFx0XHRoZWFkZXIgKz0gXCJ1bmlmb3JtIGZsb2F0IHlmbGlwO1xcblwiO1xuXHRcdH1cblx0XHRpZiAoIWRlc2MuaGFzaW5kaXJlY3QpIHtcblx0XHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGRlc2MucmVncmVhZFsweDFdLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmIChkZXNjLnJlZ3JlYWRbMHgxXVtpXSkge1xuXHRcdFx0XHRcdGhlYWRlciArPSBcInVuaWZvcm0gdmVjNCBcIiArIHRhZyArIFwiY1wiICsgaSArIFwiO1xcblwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGhlYWRlciArPSBcInVuaWZvcm0gdmVjNCBcIiArIHRhZyArIFwiY2FycnJbXCIgKyBDb250ZXh0U3RhZ2UzRC5tYXh2ZXJ0ZXhjb25zdGFudHMgKyBcIl07XFxuXCI7ICAgICAgICAgICAgICAgIC8vIHVzZSBtYXggY29uc3QgY291bnQgaW5zdGVhZFxuXHRcdH1cblxuXHRcdC8vIGRlY2xhcmUgdGVtcHNcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGRlc2MucmVncmVhZFsweDJdLmxlbmd0aCB8fCBpIDwgZGVzYy5yZWd3cml0ZVsweDJdLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZiAoZGVzYy5yZWdyZWFkWzB4Ml1baV0gfHwgZGVzYy5yZWd3cml0ZVsweDJdW2ldKSAvLyBkdWgsIGhhdmUgdG8gY2hlY2sgd3JpdGUgb25seSBhbHNvLi4uXG5cdFx0XHR7XG5cdFx0XHRcdGhlYWRlciArPSBcInZlYzQgXCIgKyB0YWcgKyBcInRcIiArIGkgKyBcIjtcXG5cIjtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBkZWNsYXJlIHN0cmVhbXNcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBkZXNjLnJlZ3JlYWRbMHgwXS5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYgKGRlc2MucmVncmVhZFsweDBdW2ldKSB7XG5cdFx0XHRcdGhlYWRlciArPSBcImF0dHJpYnV0ZSB2ZWM0IHZhXCIgKyBpICsgXCI7XFxuXCI7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gZGVjbGFyZSBpbnRlcnBvbGF0ZWRcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBkZXNjLnJlZ3JlYWRbMHg0XS5sZW5ndGggfHwgaSA8IGRlc2MucmVnd3JpdGVbMHg0XS5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYgKGRlc2MucmVncmVhZFsweDRdW2ldIHx8IGRlc2MucmVnd3JpdGVbMHg0XVtpXSkge1xuXHRcdFx0XHRoZWFkZXIgKz0gXCJ2YXJ5aW5nIHZlYzQgdmlcIiArIGkgKyBcIjtcXG5cIjtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBkZWNsYXJlIHNhbXBsZXJzXG5cdFx0dmFyIHNhbXB0eXBlOkFycmF5PHN0cmluZz4gPSBbXCIyRFwiLCBcIkN1YmVcIiwgXCIzRFwiLCBcIlwiXTtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBkZXNjLnNhbXBsZXJzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZiAoZGVzYy5zYW1wbGVyc1tpXSkge1xuXHRcdFx0XHRoZWFkZXIgKz0gXCJ1bmlmb3JtIHNhbXBsZXJcIiArIHNhbXB0eXBlWyBkZXNjLnNhbXBsZXJzW2ldLmRpbSAmIDMgXSArIFwiIGZzXCIgKyBpICsgXCI7XFxuXCI7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gZXh0cmEgZ2wgZmx1ZmY6IHNldHVwIHBvc2l0aW9uIGFuZCBkZXB0aCBhZGp1c3QgdGVtcHNcblx0XHRpZiAoZGVzYy5oZWFkZXIudHlwZSA9PSBcInZlcnRleFwiKSB7XG5cdFx0XHRoZWFkZXIgKz0gXCJ2ZWM0IG91dHBvcztcXG5cIjtcblx0XHR9XG5cdFx0aWYgKGRlc2Mud3JpdGVkZXB0aCkge1xuXHRcdFx0aGVhZGVyICs9IFwidmVjNCB0bXBfRnJhZ0RlcHRoO1xcblwiO1xuXHRcdH1cblx0XHQvL2lmICggZGVzYy5oYXNtYXRyaXggKSBcblx0XHQvLyAgICBoZWFkZXIgKz0gXCJ2ZWM0IHRtcF9tYXRyaXg7XFxuXCI7XG5cblx0XHQvLyBzdGFydCBib2R5IG9mIGNvZGVcblx0XHRib2R5ICs9IFwidm9pZCBtYWluKCkge1xcblwiO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgZGVzYy50b2tlbnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBsdXRlbnRyeSA9IE1hcHBpbmcuYWdhbDJnbHNsbHV0W2Rlc2MudG9rZW5zW2ldLm9wY29kZV07XG5cdFx0XHRpZiAoIWx1dGVudHJ5KSB7XG5cdFx0XHRcdHRocm93IFwiT3Bjb2RlIG5vdCB2YWxpZCBvciBub3QgaW1wbGVtZW50ZWQgeWV0OiBcIlxuXHRcdFx0XHQvKit0b2tlbi5vcGNvZGU7Ki9cblx0XHRcdH1cblx0XHRcdHZhciBzdWJsaW5lcyA9IGx1dGVudHJ5Lm1hdHJpeGhlaWdodCB8fCAxO1xuXG5cdFx0XHRmb3IgKHZhciBzbDpudW1iZXIgPSAwOyBzbCA8IHN1YmxpbmVzOyBzbCsrKSB7XG5cdFx0XHRcdHZhciBsaW5lOnN0cmluZyA9IFwiICBcIiArIGx1dGVudHJ5LnM7XG5cdFx0XHRcdGlmIChkZXNjLnRva2Vuc1tpXS5kZXN0KSB7XG5cdFx0XHRcdFx0aWYgKGx1dGVudHJ5Lm1hdHJpeGhlaWdodCkge1xuXHRcdFx0XHRcdFx0aWYgKCgoZGVzYy50b2tlbnNbaV0uZGVzdC5tYXNrID4+IHNsKSAmIDEpICE9IDEpIHtcblx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR2YXIgZGVzdHJlZ3N0cmluZzpzdHJpbmcgPSB0aGlzLnJlZ3Rvc3RyaW5nKGRlc2MudG9rZW5zW2ldLmRlc3QucmVndHlwZSwgZGVzYy50b2tlbnNbaV0uZGVzdC5yZWdudW0sIGRlc2MsIHRhZyk7XG5cdFx0XHRcdFx0XHR2YXIgZGVzdGNhc3RzdHJpbmc6c3RyaW5nID0gXCJmbG9hdFwiO1xuXHRcdFx0XHRcdFx0dmFyIGRlc3RtYXNrc3RyaW5nID0gW1wieFwiLCBcInlcIiwgXCJ6XCIsIFwid1wiXVtzbF07XG5cdFx0XHRcdFx0XHRkZXN0cmVnc3RyaW5nICs9IFwiLlwiICsgZGVzdG1hc2tzdHJpbmc7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHZhciBkZXN0cmVnc3RyaW5nOnN0cmluZyA9IHRoaXMucmVndG9zdHJpbmcoZGVzYy50b2tlbnNbaV0uZGVzdC5yZWd0eXBlLCBkZXNjLnRva2Vuc1tpXS5kZXN0LnJlZ251bSwgZGVzYywgdGFnKTtcblx0XHRcdFx0XHRcdHZhciBkZXN0Y2FzdHN0cmluZzpzdHJpbmc7XG5cdFx0XHRcdFx0XHR2YXIgZGVzdG1hc2tzdHJpbmc6c3RyaW5nO1xuXHRcdFx0XHRcdFx0aWYgKGRlc2MudG9rZW5zW2ldLmRlc3QubWFzayAhPSAweGYpIHtcblx0XHRcdFx0XHRcdFx0dmFyIG5kZXN0Om51bWJlciA9IDA7XG5cdFx0XHRcdFx0XHRcdGRlc3RtYXNrc3RyaW5nID0gXCJcIjtcblx0XHRcdFx0XHRcdFx0aWYgKGRlc2MudG9rZW5zW2ldLmRlc3QubWFzayAmIDEpIHtcblx0XHRcdFx0XHRcdFx0XHRuZGVzdCsrO1xuXHRcdFx0XHRcdFx0XHRcdGRlc3RtYXNrc3RyaW5nICs9IFwieFwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGlmIChkZXNjLnRva2Vuc1tpXS5kZXN0Lm1hc2sgJiAyKSB7XG5cdFx0XHRcdFx0XHRcdFx0bmRlc3QrKztcblx0XHRcdFx0XHRcdFx0XHRkZXN0bWFza3N0cmluZyArPSBcInlcIjtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRpZiAoZGVzYy50b2tlbnNbaV0uZGVzdC5tYXNrICYgNCkge1xuXHRcdFx0XHRcdFx0XHRcdG5kZXN0Kys7XG5cdFx0XHRcdFx0XHRcdFx0ZGVzdG1hc2tzdHJpbmcgKz0gXCJ6XCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYgKGRlc2MudG9rZW5zW2ldLmRlc3QubWFzayAmIDgpIHtcblx0XHRcdFx0XHRcdFx0XHRuZGVzdCsrO1xuXHRcdFx0XHRcdFx0XHRcdGRlc3RtYXNrc3RyaW5nICs9IFwid1wiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGRlc3RyZWdzdHJpbmcgKz0gXCIuXCIgKyBkZXN0bWFza3N0cmluZztcblx0XHRcdFx0XHRcdFx0c3dpdGNoIChuZGVzdCkge1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgMTpcblx0XHRcdFx0XHRcdFx0XHRcdGRlc3RjYXN0c3RyaW5nID0gXCJmbG9hdFwiO1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0Y2FzZSAyOlxuXHRcdFx0XHRcdFx0XHRcdFx0ZGVzdGNhc3RzdHJpbmcgPSBcInZlYzJcIjtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgMzpcblx0XHRcdFx0XHRcdFx0XHRcdGRlc3RjYXN0c3RyaW5nID0gXCJ2ZWMzXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgXCJVbmV4cGVjdGVkIGRlc3RpbmF0aW9uIG1hc2tcIjtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZGVzdGNhc3RzdHJpbmcgPSBcInZlYzRcIjtcblx0XHRcdFx0XHRcdFx0ZGVzdG1hc2tzdHJpbmcgPSBcInh5endcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bGluZSA9IGxpbmUucmVwbGFjZShcIiVkZXN0XCIsIGRlc3RyZWdzdHJpbmcpO1xuXHRcdFx0XHRcdGxpbmUgPSBsaW5lLnJlcGxhY2UoXCIlY2FzdFwiLCBkZXN0Y2FzdHN0cmluZyk7XG5cdFx0XHRcdFx0bGluZSA9IGxpbmUucmVwbGFjZShcIiVkbVwiLCBkZXN0bWFza3N0cmluZyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyIGR3bTpudW1iZXIgPSAweGY7XG5cdFx0XHRcdGlmICghbHV0ZW50cnkubmR3bSAmJiBsdXRlbnRyeS5kZXN0ICYmIGRlc2MudG9rZW5zW2ldLmRlc3QpIHtcblx0XHRcdFx0XHRkd20gPSBkZXNjLnRva2Vuc1tpXS5kZXN0Lm1hc2s7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKGRlc2MudG9rZW5zW2ldLmEpIHtcblx0XHRcdFx0XHRsaW5lID0gbGluZS5yZXBsYWNlKFwiJWFcIiwgdGhpcy5zb3VyY2V0b3N0cmluZyhkZXNjLnRva2Vuc1tpXS5hLCAwLCBkd20sIGx1dGVudHJ5LnNjYWxhciwgZGVzYywgdGFnKSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKGRlc2MudG9rZW5zW2ldLmIpIHtcblx0XHRcdFx0XHRsaW5lID0gbGluZS5yZXBsYWNlKFwiJWJcIiwgdGhpcy5zb3VyY2V0b3N0cmluZyhkZXNjLnRva2Vuc1tpXS5iLCBzbCwgZHdtLCBsdXRlbnRyeS5zY2FsYXIsIGRlc2MsIHRhZykpO1xuXHRcdFx0XHRcdGlmIChkZXNjLnRva2Vuc1tpXS5iLnJlZ3R5cGUgPT0gMHg1KSB7XG5cdFx0XHRcdFx0XHQvLyBzYW1wbGVyIGRpbVxuXHRcdFx0XHRcdFx0dmFyIHRleGRpbSA9IFtcIjJEXCIsIFwiQ3ViZVwiLCBcIjNEXCJdW2Rlc2MudG9rZW5zW2ldLmIuZGltXTtcblx0XHRcdFx0XHRcdHZhciB0ZXhzaXplID0gW1widmVjMlwiLCBcInZlYzNcIiwgXCJ2ZWMzXCJdW2Rlc2MudG9rZW5zW2ldLmIuZGltXTtcblx0XHRcdFx0XHRcdGxpbmUgPSBsaW5lLnJlcGxhY2UoXCIldGV4ZGltXCIsIHRleGRpbSk7XG5cdFx0XHRcdFx0XHRsaW5lID0gbGluZS5yZXBsYWNlKFwiJXRleHNpemVcIiwgdGV4c2l6ZSk7XG5cdFx0XHRcdFx0XHR2YXIgdGV4bG9kOnN0cmluZyA9IFwiXCI7XG5cdFx0XHRcdFx0XHRsaW5lID0gbGluZS5yZXBsYWNlKFwiJWxvZFwiLCB0ZXhsb2QpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRib2R5ICs9IGxpbmU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gYWRqdXN0IHogZnJvbSBvcGVuZ2wgcmFuZ2Ugb2YgLTEuLjEgdG8gMC4uMSBhcyBpbiBkM2QsIHRoaXMgYWxzbyBlbmZvcmNlcyBhIGxlZnQgaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtXG5cdFx0aWYgKGRlc2MuaGVhZGVyLnR5cGUgPT0gXCJ2ZXJ0ZXhcIikge1xuXHRcdFx0Ym9keSArPSBcIiAgZ2xfUG9zaXRpb24gPSB2ZWM0KG91dHBvcy54LCBvdXRwb3MueSwgb3V0cG9zLnoqMi4wIC0gb3V0cG9zLncsIG91dHBvcy53KTtcXG5cIjtcblx0XHR9XG5cblx0XHQvLyBjbGFtcCBmcmFnbWVudCBkZXB0aFxuXHRcdGlmIChkZXNjLndyaXRlZGVwdGgpIHtcblx0XHRcdGJvZHkgKz0gXCIgIGdsX0ZyYWdEZXB0aCA9IGNsYW1wKHRtcF9GcmFnRGVwdGgsMC4wLDEuMCk7XFxuXCI7XG5cdFx0fVxuXG5cdFx0Ly8gY2xvc2UgbWFpblxuXHRcdGJvZHkgKz0gXCJ9XFxuXCI7XG5cblx0XHRyZXR1cm4gaGVhZGVyICsgYm9keTtcblx0fVxuXG5cdHB1YmxpYyByZWd0b3N0cmluZyhyZWd0eXBlOm51bWJlciwgcmVnbnVtOm51bWJlciwgZGVzYzpEZXNjcmlwdGlvbiwgdGFnKVxuXHR7XG5cdFx0c3dpdGNoIChyZWd0eXBlKSB7XG5cdFx0XHRjYXNlIDB4MDpcblx0XHRcdFx0cmV0dXJuIFwidmFcIiArIHJlZ251bTtcblx0XHRcdGNhc2UgMHgxOlxuXHRcdFx0XHRpZiAoZGVzYy5oYXNpbmRpcmVjdCAmJiBkZXNjLmhlYWRlci50eXBlID09IFwidmVydGV4XCIpIHtcblx0XHRcdFx0XHRyZXR1cm4gXCJ2Y2FycnJbXCIgKyByZWdudW0gKyBcIl1cIjtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gdGFnICsgXCJjXCIgKyByZWdudW07XG5cdFx0XHRcdH1cblx0XHRcdGNhc2UgMHgyOlxuXHRcdFx0XHRyZXR1cm4gdGFnICsgXCJ0XCIgKyByZWdudW07XG5cdFx0XHRjYXNlIDB4Mzpcblx0XHRcdFx0cmV0dXJuIGRlc2MuaGVhZGVyLnR5cGUgPT0gXCJ2ZXJ0ZXhcIj8gXCJvdXRwb3NcIiA6IFwiZ2xfRnJhZ0NvbG9yXCI7XG5cdFx0XHRjYXNlIDB4NDpcblx0XHRcdFx0cmV0dXJuIFwidmlcIiArIHJlZ251bTtcblx0XHRcdGNhc2UgMHg1OlxuXHRcdFx0XHRyZXR1cm4gXCJmc1wiICsgcmVnbnVtO1xuXHRcdFx0Y2FzZSAweDY6XG5cdFx0XHRcdHJldHVybiBcInRtcF9GcmFnRGVwdGhcIjtcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHRocm93IFwiVW5rbm93biByZWdpc3RlciB0eXBlXCI7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHNvdXJjZXRvc3RyaW5nKHMsIHN1YmxpbmUsIGR3bSwgaXNzY2FsYXIsIGRlc2MsIHRhZyk6c3RyaW5nXG5cdHtcblx0XHR2YXIgc3dpeiA9IFsgXCJ4XCIsIFwieVwiLCBcInpcIiwgXCJ3XCIgXTtcblx0XHR2YXIgcjtcblxuXHRcdGlmIChzLmluZGlyZWN0ZmxhZykge1xuXHRcdFx0ciA9IFwidmNhcnJyW2ludChcIiArIHRoaXMucmVndG9zdHJpbmcocy5pbmRleHJlZ3R5cGUsIHMucmVnbnVtLCBkZXNjLCB0YWcpICsgXCIuXCIgKyBzd2l6W3MuaW5kZXhzZWxlY3RdICsgXCIpXCI7XG5cdFx0XHR2YXIgcmVhbG9mcyA9IHN1YmxpbmUgKyBzLmluZGV4b2Zmc2V0O1xuXHRcdFx0aWYgKHJlYWxvZnMgPCAwKSByICs9IHJlYWxvZnMudG9TdHJpbmcoKTtcblx0XHRcdGlmIChyZWFsb2ZzID4gMCkgciArPSBcIitcIiArIHJlYWxvZnMudG9TdHJpbmcoKTtcblx0XHRcdHIgKz0gXCJdXCI7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHIgPSB0aGlzLnJlZ3Rvc3RyaW5nKHMucmVndHlwZSwgcy5yZWdudW0gKyBzdWJsaW5lLCBkZXNjLCB0YWcpO1xuXHRcdH1cblxuXHRcdC8vIHNhbXBsZXJzIG5ldmVyIGFkZCBzd2l6emxlICAgICAgICBcblx0XHRpZiAocy5yZWd0eXBlID09IDB4NSkge1xuXHRcdFx0cmV0dXJuIHI7XG5cdFx0fVxuXG5cdFx0Ly8gc2NhbGFyLCBmaXJzdCBjb21wb25lbnQgb25seVxuXHRcdGlmIChpc3NjYWxhcikge1xuXHRcdFx0cmV0dXJuIHIgKyBcIi5cIiArIHN3aXpbKHMuc3dpenpsZSA+PiAwKSAmIDNdO1xuXHRcdH1cblxuXHRcdC8vIGlkZW50aXR5XG5cdFx0aWYgKHMuc3dpenpsZSA9PSAweGU0ICYmIGR3bSA9PSAweGYpIHtcblx0XHRcdHJldHVybiByO1xuXHRcdH1cblxuXHRcdC8vIHdpdGggZGVzdGluYXRpb24gd3JpdGUgbWFzayBmb2xkZWQgaW5cblx0XHRyICs9IFwiLlwiO1xuXHRcdGlmIChkd20gJiAxKSByICs9IHN3aXpbKHMuc3dpenpsZSA+PiAwKSAmIDNdO1xuXHRcdGlmIChkd20gJiAyKSByICs9IHN3aXpbKHMuc3dpenpsZSA+PiAyKSAmIDNdO1xuXHRcdGlmIChkd20gJiA0KSByICs9IHN3aXpbKHMuc3dpenpsZSA+PiA0KSAmIDNdO1xuXHRcdGlmIChkd20gJiA4KSByICs9IHN3aXpbKHMuc3dpenpsZSA+PiA2KSAmIDNdO1xuXHRcdHJldHVybiByO1xuXHR9XG59XG5cbmV4cG9ydCA9IEFHTFNMUGFyc2VyOyJdfQ==
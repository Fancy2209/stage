var OpcodeMap = require("awayjs-stagegl/lib/aglsl/assembler/OpcodeMap");
var Part = require("awayjs-stagegl/lib/aglsl/assembler/Part");
var RegMap = require("awayjs-stagegl/lib/aglsl/assembler/RegMap");
var SamplerMap = require("awayjs-stagegl/lib/aglsl/assembler/SamplerMap");
var AGALMiniAssembler = (function () {
    function AGALMiniAssembler() {
        this.r = {};
        this.cur = new Part();
    }
    AGALMiniAssembler.prototype.assemble = function (source, ext_part, ext_version) {
        if (ext_part === void 0) { ext_part = null; }
        if (ext_version === void 0) { ext_version = null; }
        if (!ext_version) {
            ext_version = 1;
        }
        if (ext_part) {
            this.addHeader(ext_part, ext_version);
        }
        var lines = source.replace(/[\f\n\r\v]+/g, "\n").split("\n"); // handle breaks, then split into lines
        for (var i in lines) {
            this.processLine(lines[i], i);
        }
        return this.r;
    };
    AGALMiniAssembler.prototype.processLine = function (line, linenr) {
        var startcomment = line.search("//"); // remove comments
        if (startcomment != -1) {
            line = line.slice(0, startcomment);
        }
        line = line.replace(/^\s+|\s+$/g, ""); // remove outer space
        if (!(line.length > 0)) {
            return;
        }
        var optsi = line.search(/<.*>/g); // split of options part <*> if there
        var opts = null;
        if (optsi != -1) {
            opts = line.slice(optsi).match(/([\w\.\-\+]+)/gi);
            line = line.slice(0, optsi);
        }
        // get opcode/command				            
        var tokens = line.match(/([\w\.\+\[\]]+)/gi); // get tokens in line
        if (!tokens || tokens.length < 1) {
            if (line.length >= 3) {
                console.log("Warning: bad line " + linenr + ": " + line);
            }
            return;
        }
        switch (tokens[0]) {
            case "part":
                this.addHeader(tokens[1], Number(tokens[2]));
                break;
            case "endpart":
                if (!this.cur) {
                    throw "Unexpected endpart";
                }
                this.cur.data.position = 0;
                this.cur = null;
                return;
            default:
                if (!this.cur) {
                    console.log("Warning: bad line " + linenr + ": " + line + " (Outside of any part definition)");
                    return;
                }
                if (this.cur.name == "comment") {
                    return;
                }
                var op = OpcodeMap.map[tokens[0]];
                if (!op) {
                    throw "Bad opcode " + tokens[0] + " " + linenr + ": " + line;
                }
                // console.log( 'AGALMiniAssembler' , 'op' , op );
                this.emitOpcode(this.cur, op.opcode);
                var ti = 1;
                if (op.dest && op.dest != "none") {
                    if (!this.emitDest(this.cur, tokens[ti++], op.dest)) {
                        throw "Bad destination register " + tokens[ti - 1] + " " + linenr + ": " + line;
                    }
                }
                else {
                    this.emitZeroDword(this.cur);
                }
                if (op.a && op.a.format != "none") {
                    if (!this.emitSource(this.cur, tokens[ti++], op.a))
                        throw "Bad source register " + tokens[ti - 1] + " " + linenr + ": " + line;
                }
                else {
                    this.emitZeroQword(this.cur);
                }
                if (op.b && op.b.format != "none") {
                    if (op.b.format == "sampler") {
                        if (!this.emitSampler(this.cur, tokens[ti++], op.b, opts)) {
                            throw "Bad sampler register " + tokens[ti - 1] + " " + linenr + ": " + line;
                        }
                    }
                    else {
                        if (!this.emitSource(this.cur, tokens[ti++], op.b)) {
                            throw "Bad source register " + tokens[ti - 1] + " " + linenr + ": " + line;
                        }
                    }
                }
                else {
                    this.emitZeroQword(this.cur);
                }
                break;
        }
    };
    AGALMiniAssembler.prototype.emitHeader = function (pr) {
        pr.data.writeUnsignedByte(0xa0); // tag version
        pr.data.writeUnsignedInt(pr.version);
        if (pr.version >= 0x10) {
            pr.data.writeUnsignedByte(0); // align, for higher versions
        }
        pr.data.writeUnsignedByte(0xa1); // tag program id
        switch (pr.name) {
            case "fragment":
                pr.data.writeUnsignedByte(1);
                break;
            case "vertex":
                pr.data.writeUnsignedByte(0);
                break;
            case "cpu":
                pr.data.writeUnsignedByte(2);
                break;
            default:
                pr.data.writeUnsignedByte(0xff);
                break;
        }
    };
    AGALMiniAssembler.prototype.emitOpcode = function (pr, opcode) {
        pr.data.writeUnsignedInt(opcode);
        //console.log ( "Emit opcode: ", opcode ); 
    };
    AGALMiniAssembler.prototype.emitZeroDword = function (pr) {
        pr.data.writeUnsignedInt(0);
    };
    AGALMiniAssembler.prototype.emitZeroQword = function (pr) {
        pr.data.writeUnsignedInt(0);
        pr.data.writeUnsignedInt(0);
    };
    AGALMiniAssembler.prototype.emitDest = function (pr, token, opdest) {
        //console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map' , RegMap.map);
        var reg = token.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:mask
        // console.log( 'AGALMiniAssembler' , 'emitDest' , 'reg' , reg , reg[1] , RegMap.map[reg[1]] );
        // console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map[reg[1]]' , RegMap.map[reg[1]] , 'bool' , !RegMap.map[reg[1]] ) ;
        if (!RegMap.map[reg[1]])
            return false;
        var em = { num: reg[2] ? reg[2] : 0, code: RegMap.map[reg[1]].code, mask: this.stringToMask(reg[3]) };
        pr.data.writeUnsignedShort(em.num);
        pr.data.writeUnsignedByte(em.mask);
        pr.data.writeUnsignedByte(em.code);
        //console.log ( "  Emit dest: ", em );
        return true;
    };
    AGALMiniAssembler.prototype.stringToMask = function (s) {
        if (!s)
            return 0xf;
        var r = 0;
        if (s.indexOf("x") != -1)
            r |= 1;
        if (s.indexOf("y") != -1)
            r |= 2;
        if (s.indexOf("z") != -1)
            r |= 4;
        if (s.indexOf("w") != -1)
            r |= 8;
        return r;
    };
    AGALMiniAssembler.prototype.stringToSwizzle = function (s) {
        if (!s) {
            return 0xe4;
        }
        var chartoindex = { x: 0, y: 1, z: 2, w: 3 };
        var sw = 0;
        if (s.charAt(0) != ".") {
            throw "Missing . for swizzle";
        }
        if (s.length > 1) {
            sw |= chartoindex[s.charAt(1)];
        }
        if (s.length > 2) {
            sw |= chartoindex[s.charAt(2)] << 2;
        }
        else {
            sw |= (sw & 3) << 2;
        }
        if (s.length > 3) {
            sw |= chartoindex[s.charAt(3)] << 4;
        }
        else {
            sw |= (sw & (3 << 2)) << 2;
        }
        if (s.length > 4) {
            sw |= chartoindex[s.charAt(4)] << 6;
        }
        else {
            sw |= (sw & (3 << 4)) << 2;
        }
        return sw;
    };
    AGALMiniAssembler.prototype.emitSampler = function (pr, token, opsrc, opts) {
        var reg = token.match(/fs(\d*)/i); // g1:regnum
        if (!reg || !reg[1]) {
            return false;
        }
        pr.data.writeUnsignedShort(parseInt(reg[1]));
        pr.data.writeUnsignedByte(0); // bias
        pr.data.writeUnsignedByte(0);
        /*
         pr.data.writeUnsignedByte ( 0x5 );
         pr.data.writeUnsignedByte ( 0 );   // readmode, dim
         pr.data.writeUnsignedByte ( 0 );   // special, wrap
         pr.data.writeUnsignedByte ( 0 );   // mip, filter
         */
        var samplerbits = 0x5;
        var sampleroptset = 0;
        for (var i = 0; i < opts.length; i++) {
            var o = SamplerMap.map[opts[i].toLowerCase()];
            //console.log( 'AGALMiniAssembler' , 'emitSampler' , 'SampleMap opt:' , o , '<-------- WATCH FOR THIS');
            if (o) {
                if (((sampleroptset >> o.shift) & o.mask) != 0) {
                    console.log("Warning, duplicate sampler option");
                }
                sampleroptset |= o.mask << o.shift;
                samplerbits &= ~(o.mask << o.shift);
                samplerbits |= o.value << o.shift;
            }
            else {
                console.log("Warning, unknown sampler option: ", opts[i]);
            }
        }
        pr.data.writeUnsignedInt(samplerbits);
        return true;
    };
    AGALMiniAssembler.prototype.emitSource = function (pr, token, opsrc) {
        var indexed = token.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i); // g1: indexregname, g2:indexregnum, g3:select, [g4:offset], [g5:swizzle]
        var reg;
        if (indexed) {
            if (!RegMap.map[indexed[1]]) {
                return false;
            }
            var selindex = { x: 0, y: 1, z: 2, w: 3 };
            var em = { num: indexed[2] | 0, code: RegMap.map[indexed[1]].code, swizzle: this.stringToSwizzle(indexed[5]), select: selindex[indexed[3]], offset: indexed[4] | 0 };
            pr.data.writeUnsignedShort(em.num);
            pr.data.writeByte(em.offset);
            pr.data.writeUnsignedByte(em.swizzle);
            pr.data.writeUnsignedByte(0x1); // constant reg
            pr.data.writeUnsignedByte(em.code);
            pr.data.writeUnsignedByte(em.select);
            pr.data.writeUnsignedByte(1 << 7);
        }
        else {
            reg = token.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:swizzle
            if (!RegMap.map[reg[1]]) {
                return false;
            }
            var em = { num: reg[2] | 0, code: RegMap.map[reg[1]].code, swizzle: this.stringToSwizzle(reg[3]) };
            pr.data.writeUnsignedShort(em.num);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(em.swizzle);
            pr.data.writeUnsignedByte(em.code);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(0);
        }
        return true;
    };
    AGALMiniAssembler.prototype.addHeader = function (partname, version) {
        if (!version) {
            version = 1;
        }
        if (this.r[partname] == undefined) {
            this.r[partname] = new Part(partname, version);
            this.emitHeader(this.r[partname]);
        }
        else if (this.r[partname].version != version) {
            throw "Multiple versions for part " + partname;
        }
        this.cur = this.r[partname];
    };
    return AGALMiniAssembler;
})();
module.exports = AGALMiniAssembler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFnbHNsL2Fzc2VtYmxlci9hZ2FsbWluaWFzc2VtYmxlci50cyJdLCJuYW1lcyI6WyJBR0FMTWluaUFzc2VtYmxlciIsIkFHQUxNaW5pQXNzZW1ibGVyLmNvbnN0cnVjdG9yIiwiQUdBTE1pbmlBc3NlbWJsZXIuYXNzZW1ibGUiLCJBR0FMTWluaUFzc2VtYmxlci5wcm9jZXNzTGluZSIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRIZWFkZXIiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0T3Bjb2RlIiwiQUdBTE1pbmlBc3NlbWJsZXIuZW1pdFplcm9Ed29yZCIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRaZXJvUXdvcmQiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0RGVzdCIsIkFHQUxNaW5pQXNzZW1ibGVyLnN0cmluZ1RvTWFzayIsIkFHQUxNaW5pQXNzZW1ibGVyLnN0cmluZ1RvU3dpenpsZSIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRTYW1wbGVyIiwiQUdBTE1pbmlBc3NlbWJsZXIuZW1pdFNvdXJjZSIsIkFHQUxNaW5pQXNzZW1ibGVyLmFkZEhlYWRlciJdLCJtYXBwaW5ncyI6IkFBRUEsSUFBTyxTQUFTLFdBQWMsOENBQThDLENBQUMsQ0FBQztBQUM5RSxJQUFPLElBQUksV0FBZ0IseUNBQXlDLENBQUMsQ0FBQztBQUN0RSxJQUFPLE1BQU0sV0FBZSwyQ0FBMkMsQ0FBQyxDQUFDO0FBQ3pFLElBQU8sVUFBVSxXQUFjLCtDQUErQyxDQUFDLENBQUM7QUFHaEYsSUFBTSxpQkFBaUI7SUFLdEJBLFNBTEtBLGlCQUFpQkE7UUFPckJDLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ1pBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUVNRCxvQ0FBUUEsR0FBZkEsVUFBZ0JBLE1BQWFBLEVBQUVBLFFBQWVBLEVBQUVBLFdBQWtCQTtRQUFuQ0Usd0JBQWVBLEdBQWZBLGVB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Q0FBQ0E7UUFHREEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbkJBLEtBQUtBLE1BQU1BO2dCQUNWQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDN0NBLEtBQUtBLENBQUNBO1lBQ1BBLEtBQUtBLFNBQVNBO2dCQUNiQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDZkEsTUFBTUEsb0JBQW9CQSxDQUFDQTtnQkFDNUJBLENBQUNBO2dCQUNEQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDM0JBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNoQkEsTUFBTUEsQ0FBQ0E7WUFDUkE7Z0JBQ0NBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO29CQUNmQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxvQkFBb0JBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLG1DQUFtQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQy9GQSxNQUFNQSxDQUFDQTtnQkFDUkEsQ0FBQ0E7Z0JBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO29CQUNoQ0EsTUFBTUEsQ0FBQ0E7Z0JBQ1JBLENBQUNBO2dCQUNEQSxJQUFJQSxFQUFFQSxHQUFtQkEsU0FBU0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDVEEsTUFBTUEsYUFBYUEsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQzlEQSxDQUFDQTtnQkFDREEsQUFFQUEsa0RBRmtEQTtnQkFFbERBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO2dCQUNyQ0EsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xCQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxJQUFJQSxFQUFFQSxDQUFDQSxJQUFJQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbENBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO3dCQUNyREEsTUFBTUEsMkJBQTJCQSxHQUFHQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtvQkFDakZBLENBQUNBO2dCQUNGQSxDQUFDQTtnQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7b0JBQ1BBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO2dCQUM5QkEsQ0FBQ0E7Z0JBRURBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQUNBLE1BQU1BLHNCQUFzQkEsR0FBR0EsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2hJQSxDQUFDQTtnQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7b0JBQ1BBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO2dCQUM5QkEsQ0FBQ0E7Z0JBRURBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsSUFBSUEsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQzlCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTs0QkFDM0RBLE1BQU1BLHVCQUF1QkEsR0FBR0EsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7d0JBQzdFQSxDQUFDQTtvQkFD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UUE7UUFFM0JTLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNWQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNqQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDakNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ2pDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNqQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDVkEsQ0FBQ0E7SUFFTVQsMkNBQWVBLEdBQXRCQSxVQUF1QkEsQ0FBQ0E7UUFFdkJVLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ1JBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBQ2JBLENBQUNBO1FBQ0RBLElBQUlBLFdBQVdBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBO1FBQ3pDQSxJQUFJQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVYQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsTUFBTUEsdUJBQXVCQSxDQUFDQTtRQUMvQkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2hDQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsQkEsRUFBRUEsSUFBSUEsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLEVBQUVBLElBQUlBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsQkEsRUFBRUEsSUFBSUEsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLEVBQUVBLElBQUlBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzVCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsQkEsRUFBRUEsSUFBSUEsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLEVBQUVBLElBQUlBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzVCQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQTtJQUNYQSxDQUFDQTtJQUVNVix1Q0FBV0EsR0FBbEJBLFVBQW1CQSxFQUFPQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxJQUFJQTtRQUU3Q1csSUFBSUEsR0FBR0EsR0FBWUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsRUFBRUEsWUFBWUE7UUFDeERBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUNkQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzdDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLENBQUNBLEVBQUlBLE9BQU9BO1FBQ3ZDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzdCQSxBQU1BQTs7Ozs7V0FER0E7WUFDQ0EsV0FBV0EsR0FBVUEsR0FBR0EsQ0FBQ0E7UUFDN0JB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U0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO1lBQy9DQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFFQSxRQUFRQSxDQUFFQSxDQUFDQSxDQUFDQTtRQUNyQ0EsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaERBLE1BQU1BLDZCQUE2QkEsR0FBR0EsUUFBUUEsQ0FBQ0E7UUFDaERBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBQzdCQSxDQUFDQTtJQUNGYix3QkFBQ0E7QUFBREEsQ0FwVEEsQUFvVENBLElBQUE7QUFFRCxBQUEyQixpQkFBbEIsaUJBQWlCLENBQUMiLCJmaWxlIjoiYWdsc2wvYXNzZW1ibGVyL0FHQUxNaW5pQXNzZW1ibGVyLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9yb2JiYXRlbWFuL1dlYnN0b3JtUHJvamVjdHMvYXdheWpzLXN0YWdlZ2wvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFNhbXBsZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL2Fzc2VtYmxlci9TYW1wbGVyXCIpO1xuaW1wb3J0IE9wY29kZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL09wY29kZVwiKTtcbmltcG9ydCBPcGNvZGVNYXBcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvT3Bjb2RlTWFwXCIpO1xuaW1wb3J0IFBhcnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL1BhcnRcIik7XG5pbXBvcnQgUmVnTWFwXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvUmVnTWFwXCIpO1xuaW1wb3J0IFNhbXBsZXJNYXBcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvU2FtcGxlck1hcFwiKTtcblxuXG5jbGFzcyBBR0FMTWluaUFzc2VtYmxlclxue1xuXHRwdWJsaWMgcjpPYmplY3Q7XG5cdHB1YmxpYyBjdXI6UGFydDtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHR0aGlzLnIgPSB7fTtcblx0XHR0aGlzLmN1ciA9IG5ldyBQYXJ0KCk7XG5cdH1cblxuXHRwdWJsaWMgYXNzZW1ibGUoc291cmNlOnN0cmluZywgZXh0X3BhcnQgPSBudWxsLCBleHRfdmVyc2lvbiA9IG51bGwpXG5cdHtcblx0XHRpZiAoIWV4dF92ZXJzaW9uKSB7XG5cdFx0XHRleHRfdmVyc2lvbiA9IDE7XG5cdFx0fVxuXG5cdFx0aWYgKGV4dF9wYXJ0KSB7XG5cdFx0XHR0aGlzLmFkZEhlYWRlcihleHRfcGFydCwgZXh0X3ZlcnNpb24pO1xuXHRcdH1cblxuXHRcdHZhciBsaW5lcyA9IHNvdXJjZS5yZXBsYWNlKC9bXFxmXFxuXFxyXFx2XSsvZywgXCJcXG5cIikuc3BsaXQoXCJcXG5cIik7IC8vIGhhbmRsZSBicmVha3MsIHRoZW4gc3BsaXQgaW50byBsaW5lc1xuXG5cdFx0Zm9yICh2YXIgaSBpbiBsaW5lcykge1xuXHRcdFx0dGhpcy5wcm9jZXNzTGluZShsaW5lc1tpXSwgaSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMucjtcblx0fVxuXG5cdHByaXZhdGUgcHJvY2Vzc0xpbmUobGluZSwgbGluZW5yKVxuXHR7XG5cdFx0dmFyIHN0YXJ0Y29tbWVudDpudW1iZXIgPSBsaW5lLnNlYXJjaChcIi8vXCIpOyAgLy8gcmVtb3ZlIGNvbW1lbnRzXG5cdFx0aWYgKHN0YXJ0Y29tbWVudCAhPSAtMSkge1xuXHRcdFx0bGluZSA9IGxpbmUuc2xpY2UoMCwgc3RhcnRjb21tZW50KTtcblx0XHR9XG5cdFx0bGluZSA9IGxpbmUucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7IC8vIHJlbW92ZSBvdXRlciBzcGFjZVxuXHRcdGlmICghKGxpbmUubGVuZ3RoID4gMCApKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBvcHRzaTpudW1iZXIgPSBsaW5lLnNlYXJjaCgvPC4qPi9nKTsgLy8gc3BsaXQgb2Ygb3B0aW9ucyBwYXJ0IDwqPiBpZiB0aGVyZVxuXHRcdHZhciBvcHRzOnN0cmluZ1tdID0gbnVsbDtcblx0XHRpZiAob3B0c2kgIT0gLTEpIHtcblx0XHRcdG9wdHMgPSBsaW5lLnNsaWNlKG9wdHNpKS5tYXRjaCgvKFtcXHdcXC5cXC1cXCtdKykvZ2kpO1xuXHRcdFx0bGluZSA9IGxpbmUuc2xpY2UoMCwgb3B0c2kpO1xuXHRcdH1cblxuXHRcdC8vIGdldCBvcGNvZGUvY29tbWFuZFx0XHRcdFx0ICAgICAgICAgICAgXG5cdFx0dmFyIHRva2VucyA9IGxpbmUubWF0Y2goLyhbXFx3XFwuXFwrXFxbXFxdXSspL2dpKTsgLy8gZ2V0IHRva2VucyBpbiBsaW5lXG5cdFx0aWYgKCF0b2tlbnMgfHwgdG9rZW5zLmxlbmd0aCA8IDEpIHtcblx0XHRcdGlmIChsaW5lLmxlbmd0aCA+PSAzKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiV2FybmluZzogYmFkIGxpbmUgXCIgKyBsaW5lbnIgKyBcIjogXCIgKyBsaW5lKTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvL2NvbnNvbGUubG9nICggbGluZW5yLCBsaW5lLCBjdXIsIHRva2VucyApOyBcblx0XHRzd2l0Y2ggKHRva2Vuc1swXSkge1xuXHRcdFx0Y2FzZSBcInBhcnRcIjpcblx0XHRcdFx0dGhpcy5hZGRIZWFkZXIodG9rZW5zWzFdLCBOdW1iZXIodG9rZW5zWzJdKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcImVuZHBhcnRcIjpcblx0XHRcdFx0aWYgKCF0aGlzLmN1cikge1xuXHRcdFx0XHRcdHRocm93IFwiVW5leHBlY3RlZCBlbmRwYXJ0XCI7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5jdXIuZGF0YS5wb3NpdGlvbiA9IDA7XG5cdFx0XHRcdHRoaXMuY3VyID0gbnVsbDtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0aWYgKCF0aGlzLmN1cikge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiV2FybmluZzogYmFkIGxpbmUgXCIgKyBsaW5lbnIgKyBcIjogXCIgKyBsaW5lICsgXCIgKE91dHNpZGUgb2YgYW55IHBhcnQgZGVmaW5pdGlvbilcIik7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICh0aGlzLmN1ci5uYW1lID09IFwiY29tbWVudFwiKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHZhciBvcDpPcGNvZGUgPSA8T3Bjb2RlPiBPcGNvZGVNYXAubWFwW3Rva2Vuc1swXV07XG5cdFx0XHRcdGlmICghb3ApIHtcblx0XHRcdFx0XHR0aHJvdyBcIkJhZCBvcGNvZGUgXCIgKyB0b2tlbnNbMF0gKyBcIiBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmU7XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gY29uc29sZS5sb2coICdBR0FMTWluaUFzc2VtYmxlcicgLCAnb3AnICwgb3AgKTtcblxuXHRcdFx0XHR0aGlzLmVtaXRPcGNvZGUodGhpcy5jdXIsIG9wLm9wY29kZSk7XG5cdFx0XHRcdHZhciB0aTpudW1iZXIgPSAxO1xuXHRcdFx0XHRpZiAob3AuZGVzdCAmJiBvcC5kZXN0ICE9IFwibm9uZVwiKSB7XG5cdFx0XHRcdFx0aWYgKCF0aGlzLmVtaXREZXN0KHRoaXMuY3VyLCB0b2tlbnNbdGkrK10sIG9wLmRlc3QpKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBcIkJhZCBkZXN0aW5hdGlvbiByZWdpc3RlciBcIiArIHRva2Vuc1t0aSAtIDFdICsgXCIgXCIgKyBsaW5lbnIgKyBcIjogXCIgKyBsaW5lO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmVtaXRaZXJvRHdvcmQodGhpcy5jdXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG9wLmEgJiYgb3AuYS5mb3JtYXQgIT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRpZiAoIXRoaXMuZW1pdFNvdXJjZSh0aGlzLmN1ciwgdG9rZW5zW3RpKytdLCBvcC5hKSkgdGhyb3cgXCJCYWQgc291cmNlIHJlZ2lzdGVyIFwiICsgdG9rZW5zW3RpIC0gMV0gKyBcIiBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5lbWl0WmVyb1F3b3JkKHRoaXMuY3VyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvcC5iICYmIG9wLmIuZm9ybWF0ICE9IFwibm9uZVwiKSB7XG5cdFx0XHRcdFx0aWYgKG9wLmIuZm9ybWF0ID09IFwic2FtcGxlclwiKSB7XG5cdFx0XHRcdFx0XHRpZiAoIXRoaXMuZW1pdFNhbXBsZXIodGhpcy5jdXIsIHRva2Vuc1t0aSsrXSwgb3AuYiwgb3B0cykpIHtcblx0XHRcdFx0XHRcdFx0dGhyb3cgXCJCYWQgc2FtcGxlciByZWdpc3RlciBcIiArIHRva2Vuc1t0aSAtIDFdICsgXCIgXCIgKyBsaW5lbnIgKyBcIjogXCIgKyBsaW5lO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoIXRoaXMuZW1pdFNvdXJjZSh0aGlzLmN1ciwgdG9rZW5zW3RpKytdLCBvcC5iKSkge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBcIkJhZCBzb3VyY2UgcmVnaXN0ZXIgXCIgKyB0b2tlbnNbdGkgLSAxXSArIFwiIFwiICsgbGluZW5yICsgXCI6IFwiICsgbGluZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5lbWl0WmVyb1F3b3JkKHRoaXMuY3VyKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZW1pdEhlYWRlcihwcjpQYXJ0KVxuXHR7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgweGEwKTsgXHQvLyB0YWcgdmVyc2lvblxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludChwci52ZXJzaW9uKTtcblx0XHRpZiAocHIudmVyc2lvbiA+PSAweDEwKSB7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApOyAvLyBhbGlnbiwgZm9yIGhpZ2hlciB2ZXJzaW9uc1xuXHRcdH1cblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDB4YTEpO1x0XHQvLyB0YWcgcHJvZ3JhbSBpZFxuXHRcdHN3aXRjaCAocHIubmFtZSkge1xuXHRcdFx0Y2FzZSBcImZyYWdtZW50XCIgOlxuXHRcdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDEpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgXCJ2ZXJ0ZXhcIiA6XG5cdFx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcImNwdVwiIDpcblx0XHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgyKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0IDpcblx0XHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgweGZmKTtcblx0XHRcdFx0YnJlYWs7IC8vIHVua25vd24vY29tbWVudFxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBlbWl0T3Bjb2RlKHByOlBhcnQsIG9wY29kZSlcblx0e1xuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludChvcGNvZGUpO1xuXHRcdC8vY29uc29sZS5sb2cgKCBcIkVtaXQgb3Bjb2RlOiBcIiwgb3Bjb2RlICk7IFxuXHR9XG5cblx0cHVibGljIGVtaXRaZXJvRHdvcmQocHI6UGFydClcblx0e1xuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludCgwKTtcblx0fVxuXG5cdHB1YmxpYyBlbWl0WmVyb1F3b3JkKHByKVxuXHR7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KDApO1xuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludCgwKTtcblx0fVxuXG5cdHB1YmxpYyBlbWl0RGVzdChwciwgdG9rZW4sIG9wZGVzdClcblx0e1xuXG5cdFx0Ly9jb25zb2xlLmxvZyggJ0FHQUxNaW5pQXNzZW1ibGVyJyAsICdlbWl0RGVzdCcgLCAnUmVnTWFwLm1hcCcgLCBSZWdNYXAubWFwKTtcblx0XHR2YXIgcmVnID0gdG9rZW4ubWF0Y2goLyhbZm92XT9bdHBvY2lkYXZzXSkoXFxkKikoXFwuW3h5enddezEsNH0pPy9pKTsgLy8gZzE6IHJlZ25hbWUsIGcyOnJlZ251bSwgZzM6bWFza1xuXG5cdFx0Ly8gY29uc29sZS5sb2coICdBR0FMTWluaUFzc2VtYmxlcicgLCAnZW1pdERlc3QnICwgJ3JlZycgLCByZWcgLCByZWdbMV0gLCBSZWdNYXAubWFwW3JlZ1sxXV0gKTtcblx0XHQvLyBjb25zb2xlLmxvZyggJ0FHQUxNaW5pQXNzZW1ibGVyJyAsICdlbWl0RGVzdCcgLCAnUmVnTWFwLm1hcFtyZWdbMV1dJyAsIFJlZ01hcC5tYXBbcmVnWzFdXSAsICdib29sJyAsICFSZWdNYXAubWFwW3JlZ1sxXV0gKSA7XG5cblx0XHRpZiAoIVJlZ01hcC5tYXBbcmVnWzFdXSkgcmV0dXJuIGZhbHNlO1xuXHRcdHZhciBlbSA9IHsgbnVtOnJlZ1syXT8gcmVnWzJdIDogMCwgY29kZTpSZWdNYXAubWFwW3JlZ1sxXV0uY29kZSwgbWFzazp0aGlzLnN0cmluZ1RvTWFzayhyZWdbM10pIH07XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQoZW0ubnVtKTtcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKGVtLm1hc2spO1xuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoZW0uY29kZSk7XG5cdFx0Ly9jb25zb2xlLmxvZyAoIFwiICBFbWl0IGRlc3Q6IFwiLCBlbSApO1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0cHVibGljIHN0cmluZ1RvTWFzayhzOnN0cmluZyk6bnVtYmVyXG5cdHtcblx0XHRpZiAoIXMpIHJldHVybiAweGY7XG5cdFx0dmFyIHIgPSAwO1xuXHRcdGlmIChzLmluZGV4T2YoXCJ4XCIpICE9IC0xKSByIHw9IDE7XG5cdFx0aWYgKHMuaW5kZXhPZihcInlcIikgIT0gLTEpIHIgfD0gMjtcblx0XHRpZiAocy5pbmRleE9mKFwielwiKSAhPSAtMSkgciB8PSA0O1xuXHRcdGlmIChzLmluZGV4T2YoXCJ3XCIpICE9IC0xKSByIHw9IDg7XG5cdFx0cmV0dXJuIHI7XG5cdH1cblxuXHRwdWJsaWMgc3RyaW5nVG9Td2l6emxlKHMpXG5cdHtcblx0XHRpZiAoIXMpIHtcblx0XHRcdHJldHVybiAweGU0O1xuXHRcdH1cblx0XHR2YXIgY2hhcnRvaW5kZXggPSB7IHg6MCwgeToxLCB6OjIsIHc6MyB9O1xuXHRcdHZhciBzdyA9IDA7XG5cblx0XHRpZiAocy5jaGFyQXQoMCkgIT0gXCIuXCIpIHtcblx0XHRcdHRocm93IFwiTWlzc2luZyAuIGZvciBzd2l6emxlXCI7XG5cdFx0fVxuXG5cdFx0aWYgKHMubGVuZ3RoID4gMSkge1xuXHRcdFx0c3cgfD0gY2hhcnRvaW5kZXhbcy5jaGFyQXQoMSldO1xuXHRcdH1cblxuXHRcdGlmIChzLmxlbmd0aCA+IDIpIHtcblx0XHRcdHN3IHw9IGNoYXJ0b2luZGV4W3MuY2hhckF0KDIpXSA8PCAyO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzdyB8PSAoc3cgJiAzKSA8PCAyO1xuXHRcdH1cblxuXHRcdGlmIChzLmxlbmd0aCA+IDMpIHtcblx0XHRcdHN3IHw9IGNoYXJ0b2luZGV4W3MuY2hhckF0KDMpXSA8PCA0O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzdyB8PSAoc3cgJiAoMyA8PCAyKSkgPDwgMjtcblx0XHR9XG5cblx0XHRpZiAocy5sZW5ndGggPiA0KSB7XG5cdFx0XHRzdyB8PSBjaGFydG9pbmRleFtzLmNoYXJBdCg0KV0gPDwgNjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c3cgfD0gKHN3ICYgKDMgPDwgNCkpIDw8IDI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHN3O1xuXHR9XG5cblx0cHVibGljIGVtaXRTYW1wbGVyKHByOlBhcnQsIHRva2VuLCBvcHNyYywgb3B0cylcblx0e1xuXHRcdHZhciByZWc6c3RyaW5nW10gPSB0b2tlbi5tYXRjaCgvZnMoXFxkKikvaSk7IC8vIGcxOnJlZ251bVxuXHRcdGlmICghcmVnIHx8ICFyZWdbMV0pIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQocGFyc2VJbnQocmVnWzFdKSk7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTsgICAvLyBiaWFzXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcblx0XHQvKlxuXHRcdCBwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlICggMHg1ICk7XG5cdFx0IHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUgKCAwICk7ICAgLy8gcmVhZG1vZGUsIGRpbVxuXHRcdCBwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlICggMCApOyAgIC8vIHNwZWNpYWwsIHdyYXBcblx0XHQgcHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSAoIDAgKTsgICAvLyBtaXAsIGZpbHRlclxuXHRcdCAqL1xuXHRcdHZhciBzYW1wbGVyYml0czpudW1iZXIgPSAweDU7XG5cdFx0dmFyIHNhbXBsZXJvcHRzZXQ6bnVtYmVyID0gMDtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBvcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgbzpTYW1wbGVyID0gPFNhbXBsZXI+IFNhbXBsZXJNYXAubWFwWyBvcHRzW2ldLnRvTG93ZXJDYXNlKCkgXTtcblxuXHRcdFx0Ly9jb25zb2xlLmxvZyggJ0FHQUxNaW5pQXNzZW1ibGVyJyAsICdlbWl0U2FtcGxlcicgLCAnU2FtcGxlTWFwIG9wdDonICwgbyAsICc8LS0tLS0tLS0gV0FUQ0ggRk9SIFRISVMnKTtcblxuXHRcdFx0aWYgKG8pIHtcblx0XHRcdFx0aWYgKCgoc2FtcGxlcm9wdHNldCA+PiBvLnNoaWZ0KSAmIG8ubWFzaykgIT0gMCkge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiV2FybmluZywgZHVwbGljYXRlIHNhbXBsZXIgb3B0aW9uXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNhbXBsZXJvcHRzZXQgfD0gby5tYXNrIDw8IG8uc2hpZnQ7XG5cdFx0XHRcdHNhbXBsZXJiaXRzICY9IH4oby5tYXNrIDw8IG8uc2hpZnQpO1xuXHRcdFx0XHRzYW1wbGVyYml0cyB8PSBvLnZhbHVlIDw8IG8uc2hpZnQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcIldhcm5pbmcsIHVua25vd24gc2FtcGxlciBvcHRpb246IFwiLCBvcHRzW2ldKTtcblx0XHRcdFx0Ly8gdG9kbyBiaWFzXG5cdFx0XHR9XG5cdFx0fVxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludChzYW1wbGVyYml0cyk7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwdWJsaWMgZW1pdFNvdXJjZShwciwgdG9rZW4sIG9wc3JjKVxuXHR7XG5cdFx0dmFyIGluZGV4ZWQgPSB0b2tlbi5tYXRjaCgvdmNcXFsodlt0Y2FpXSkoXFxkKylcXC4oW3h5enddKShbXFwrXFwtXVxcZCspP1xcXShcXC5beHl6d117MSw0fSk/L2kpOyAvLyBnMTogaW5kZXhyZWduYW1lLCBnMjppbmRleHJlZ251bSwgZzM6c2VsZWN0LCBbZzQ6b2Zmc2V0XSwgW2c1OnN3aXp6bGVdXG5cdFx0dmFyIHJlZztcblx0XHRpZiAoaW5kZXhlZCkge1xuXHRcdFx0aWYgKCFSZWdNYXAubWFwW2luZGV4ZWRbMV1dKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHZhciBzZWxpbmRleCA9IHsgeDowLCB5OjEsIHo6MiwgdzozIH07XG5cdFx0XHR2YXIgZW06YW55ID0geyBudW06aW5kZXhlZFsyXSB8IDAsIGNvZGU6UmVnTWFwLm1hcFtpbmRleGVkWzFdXS5jb2RlLCBzd2l6emxlOnRoaXMuc3RyaW5nVG9Td2l6emxlKGluZGV4ZWRbNV0pLCBzZWxlY3Q6c2VsaW5kZXhbaW5kZXhlZFszXV0sIG9mZnNldDppbmRleGVkWzRdIHwgMCB9O1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQoZW0ubnVtKTtcblx0XHRcdHByLmRhdGEud3JpdGVCeXRlKGVtLm9mZnNldCk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKGVtLnN3aXp6bGUpO1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgweDEpOyAvLyBjb25zdGFudCByZWdcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoZW0uY29kZSk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKGVtLnNlbGVjdCk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDEgPDwgNyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlZyA9IHRva2VuLm1hdGNoKC8oW2Zvdl0/W3Rwb2NpZGF2c10pKFxcZCopKFxcLlt4eXp3XXsxLDR9KT8vaSk7IC8vIGcxOiByZWduYW1lLCBnMjpyZWdudW0sIGczOnN3aXp6bGVcblx0XHRcdGlmICghUmVnTWFwLm1hcFtyZWdbMV1dKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHZhciBlbTphbnkgPSB7IG51bTpyZWdbMl0gfCAwLCBjb2RlOlJlZ01hcC5tYXBbcmVnWzFdXS5jb2RlLCBzd2l6emxlOnRoaXMuc3RyaW5nVG9Td2l6emxlKHJlZ1szXSkgfTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZFNob3J0KGVtLm51bSk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApO1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5zd2l6emxlKTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoZW0uY29kZSk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApO1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMCk7XG5cdFx0XHQvL2NvbnNvbGUubG9nICggXCIgIEVtaXQgc291cmNlOiBcIiwgZW0sIHByLmRhdGEubGVuZ3RoICk7XG5cdFx0fVxuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0cHVibGljIGFkZEhlYWRlcihwYXJ0bmFtZSwgdmVyc2lvbilcblx0e1xuXHRcdGlmICghdmVyc2lvbikge1xuXHRcdFx0dmVyc2lvbiA9IDE7XG5cdFx0fVxuXHRcdGlmICh0aGlzLnJbcGFydG5hbWVdID09IHVuZGVmaW5lZCkge1xuXHRcdFx0dGhpcy5yW3BhcnRuYW1lXSA9IG5ldyBQYXJ0KHBhcnRuYW1lLCB2ZXJzaW9uKTtcblx0XHRcdHRoaXMuZW1pdEhlYWRlcih0aGlzLnJbIHBhcnRuYW1lIF0pO1xuXHRcdH0gZWxzZSBpZiAodGhpcy5yW3BhcnRuYW1lXS52ZXJzaW9uICE9IHZlcnNpb24pIHtcblx0XHRcdHRocm93IFwiTXVsdGlwbGUgdmVyc2lvbnMgZm9yIHBhcnQgXCIgKyBwYXJ0bmFtZTtcblx0XHR9XG5cdFx0dGhpcy5jdXIgPSB0aGlzLnJbcGFydG5hbWVdO1xuXHR9XG59XG5cbmV4cG9ydCA9IEFHQUxNaW5pQXNzZW1ibGVyOyJdfQ==
var OpcodeMap = require("awayjs-stagegl/lib/aglsl/assembler/OpcodeMap");
var Part = require("awayjs-stagegl/lib/aglsl/assembler/Part");
var RegMap = require("awayjs-stagegl/lib/aglsl/assembler/RegMap");
var SamplerMap = require("awayjs-stagegl/lib/aglsl/assembler/SamplerMap");
var AGALMiniAssembler = (function () {
    function AGALMiniAssembler() {
        this.r = {};
        this.cur = new Part();
    }
    AGALMiniAssembler.prototype.assemble = function (source, ext_part, ext_version) {
        if (ext_part === void 0) { ext_part = null; }
        if (ext_version === void 0) { ext_version = null; }
        if (!ext_version) {
            ext_version = 1;
        }
        if (ext_part) {
            this.addHeader(ext_part, ext_version);
        }
        var lines = source.replace(/[\f\n\r\v]+/g, "\n").split("\n"); // handle breaks, then split into lines
        for (var i in lines) {
            this.processLine(lines[i], i);
        }
        return this.r;
    };
    AGALMiniAssembler.prototype.processLine = function (line, linenr) {
        var startcomment = line.search("//"); // remove comments
        if (startcomment != -1) {
            line = line.slice(0, startcomment);
        }
        line = line.replace(/^\s+|\s+$/g, ""); // remove outer space
        if (!(line.length > 0)) {
            return;
        }
        var optsi = line.search(/<.*>/g); // split of options part <*> if there
        var opts = null;
        if (optsi != -1) {
            opts = line.slice(optsi).match(/([\w\.\-\+]+)/gi);
            line = line.slice(0, optsi);
        }
        // get opcode/command				            
        var tokens = line.match(/([\w\.\+\[\]]+)/gi); // get tokens in line
        if (!tokens || tokens.length < 1) {
            if (line.length >= 3) {
                console.log("Warning: bad line " + linenr + ": " + line);
            }
            return;
        }
        switch (tokens[0]) {
            case "part":
                this.addHeader(tokens[1], Number(tokens[2]));
                break;
            case "endpart":
                if (!this.cur) {
                    throw "Unexpected endpart";
                }
                this.cur.data.position = 0;
                this.cur = null;
                return;
            default:
                if (!this.cur) {
                    console.log("Warning: bad line " + linenr + ": " + line + " (Outside of any part definition)");
                    return;
                }
                if (this.cur.name == "comment") {
                    return;
                }
                var op = OpcodeMap.map[tokens[0]];
                if (!op) {
                    throw "Bad opcode " + tokens[0] + " " + linenr + ": " + line;
                }
                // console.log( 'AGALMiniAssembler' , 'op' , op );
                this.emitOpcode(this.cur, op.opcode);
                var ti = 1;
                if (op.dest && op.dest != "none") {
                    if (!this.emitDest(this.cur, tokens[ti++], op.dest)) {
                        throw "Bad destination register " + tokens[ti - 1] + " " + linenr + ": " + line;
                    }
                }
                else {
                    this.emitZeroDword(this.cur);
                }
                if (op.a && op.a.format != "none") {
                    if (!this.emitSource(this.cur, tokens[ti++], op.a))
                        throw "Bad source register " + tokens[ti - 1] + " " + linenr + ": " + line;
                }
                else {
                    this.emitZeroQword(this.cur);
                }
                if (op.b && op.b.format != "none") {
                    if (op.b.format == "sampler") {
                        if (!this.emitSampler(this.cur, tokens[ti++], op.b, opts)) {
                            throw "Bad sampler register " + tokens[ti - 1] + " " + linenr + ": " + line;
                        }
                    }
                    else {
                        if (!this.emitSource(this.cur, tokens[ti++], op.b)) {
                            throw "Bad source register " + tokens[ti - 1] + " " + linenr + ": " + line;
                        }
                    }
                }
                else {
                    this.emitZeroQword(this.cur);
                }
                break;
        }
    };
    AGALMiniAssembler.prototype.emitHeader = function (pr) {
        pr.data.writeUnsignedByte(0xa0); // tag version
        pr.data.writeUnsignedInt(pr.version);
        if (pr.version >= 0x10) {
            pr.data.writeUnsignedByte(0); // align, for higher versions
        }
        pr.data.writeUnsignedByte(0xa1); // tag program id
        switch (pr.name) {
            case "fragment":
                pr.data.writeUnsignedByte(1);
                break;
            case "vertex":
                pr.data.writeUnsignedByte(0);
                break;
            case "cpu":
                pr.data.writeUnsignedByte(2);
                break;
            default:
                pr.data.writeUnsignedByte(0xff);
                break;
        }
    };
    AGALMiniAssembler.prototype.emitOpcode = function (pr, opcode) {
        pr.data.writeUnsignedInt(opcode);
        //console.log ( "Emit opcode: ", opcode ); 
    };
    AGALMiniAssembler.prototype.emitZeroDword = function (pr) {
        pr.data.writeUnsignedInt(0);
    };
    AGALMiniAssembler.prototype.emitZeroQword = function (pr) {
        pr.data.writeUnsignedInt(0);
        pr.data.writeUnsignedInt(0);
    };
    AGALMiniAssembler.prototype.emitDest = function (pr, token, opdest) {
        //console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map' , RegMap.map);
        var reg = token.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:mask
        // console.log( 'AGALMiniAssembler' , 'emitDest' , 'reg' , reg , reg[1] , RegMap.map[reg[1]] );
        // console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map[reg[1]]' , RegMap.map[reg[1]] , 'bool' , !RegMap.map[reg[1]] ) ;
        if (!RegMap.map[reg[1]])
            return false;
        var em = { num: reg[2] ? reg[2] : 0, code: RegMap.map[reg[1]].code, mask: this.stringToMask(reg[3]) };
        pr.data.writeUnsignedShort(em.num);
        pr.data.writeUnsignedByte(em.mask);
        pr.data.writeUnsignedByte(em.code);
        //console.log ( "  Emit dest: ", em );
        return true;
    };
    AGALMiniAssembler.prototype.stringToMask = function (s) {
        if (!s)
            return 0xf;
        var r = 0;
        if (s.indexOf("x") != -1)
            r |= 1;
        if (s.indexOf("y") != -1)
            r |= 2;
        if (s.indexOf("z") != -1)
            r |= 4;
        if (s.indexOf("w") != -1)
            r |= 8;
        return r;
    };
    AGALMiniAssembler.prototype.stringToSwizzle = function (s) {
        if (!s) {
            return 0xe4;
        }
        var chartoindex = { x: 0, y: 1, z: 2, w: 3 };
        var sw = 0;
        if (s.charAt(0) != ".") {
            throw "Missing . for swizzle";
        }
        if (s.length > 1) {
            sw |= chartoindex[s.charAt(1)];
        }
        if (s.length > 2) {
            sw |= chartoindex[s.charAt(2)] << 2;
        }
        else {
            sw |= (sw & 3) << 2;
        }
        if (s.length > 3) {
            sw |= chartoindex[s.charAt(3)] << 4;
        }
        else {
            sw |= (sw & (3 << 2)) << 2;
        }
        if (s.length > 4) {
            sw |= chartoindex[s.charAt(4)] << 6;
        }
        else {
            sw |= (sw & (3 << 4)) << 2;
        }
        return sw;
    };
    AGALMiniAssembler.prototype.emitSampler = function (pr, token, opsrc, opts) {
        var reg = token.match(/fs(\d*)/i); // g1:regnum
        if (!reg || !reg[1]) {
            return false;
        }
        pr.data.writeUnsignedShort(parseInt(reg[1]));
        pr.data.writeUnsignedByte(0); // bias
        pr.data.writeUnsignedByte(0);
        /*
         pr.data.writeUnsignedByte ( 0x5 );
         pr.data.writeUnsignedByte ( 0 );   // readmode, dim
         pr.data.writeUnsignedByte ( 0 );   // special, wrap
         pr.data.writeUnsignedByte ( 0 );   // mip, filter
         */
        var samplerbits = 0x5;
        var sampleroptset = 0;
        for (var i = 0; i < opts.length; i++) {
            var o = SamplerMap.map[opts[i].toLowerCase()];
            //console.log( 'AGALMiniAssembler' , 'emitSampler' , 'SampleMap opt:' , o , '<-------- WATCH FOR THIS');
            if (o) {
                if (((sampleroptset >> o.shift) & o.mask) != 0) {
                    console.log("Warning, duplicate sampler option");
                }
                sampleroptset |= o.mask << o.shift;
                samplerbits &= ~(o.mask << o.shift);
                samplerbits |= o.value << o.shift;
            }
            else {
                console.log("Warning, unknown sampler option: ", opts[i]);
            }
        }
        pr.data.writeUnsignedInt(samplerbits);
        return true;
    };
    AGALMiniAssembler.prototype.emitSource = function (pr, token, opsrc) {
        var indexed = token.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i); // g1: indexregname, g2:indexregnum, g3:select, [g4:offset], [g5:swizzle]
        var reg;
        if (indexed) {
            if (!RegMap.map[indexed[1]]) {
                return false;
            }
            var selindex = { x: 0, y: 1, z: 2, w: 3 };
            var em = { num: indexed[2] | 0, code: RegMap.map[indexed[1]].code, swizzle: this.stringToSwizzle(indexed[5]), select: selindex[indexed[3]], offset: indexed[4] | 0 };
            pr.data.writeUnsignedShort(em.num);
            pr.data.writeByte(em.offset);
            pr.data.writeUnsignedByte(em.swizzle);
            pr.data.writeUnsignedByte(0x1); // constant reg
            pr.data.writeUnsignedByte(em.code);
            pr.data.writeUnsignedByte(em.select);
            pr.data.writeUnsignedByte(1 << 7);
        }
        else {
            reg = token.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:swizzle
            if (!RegMap.map[reg[1]]) {
                return false;
            }
            var em = { num: reg[2] | 0, code: RegMap.map[reg[1]].code, swizzle: this.stringToSwizzle(reg[3]) };
            pr.data.writeUnsignedShort(em.num);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(em.swizzle);
            pr.data.writeUnsignedByte(em.code);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(0);
        }
        return true;
    };
    AGALMiniAssembler.prototype.addHeader = function (partname, version) {
        if (!version) {
            version = 1;
        }
        if (this.r[partname] == undefined) {
            this.r[partname] = new Part(partname, version);
            this.emitHeader(this.r[partname]);
        }
        else if (this.r[partname].version != version) {
            throw "Multiple versions for part " + partname;
        }
        this.cur = this.r[partname];
    };
    return AGALMiniAssembler;
})();
module.exports = AGALMiniAssembler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvQUdBTE1pbmlBc3NlbWJsZXIudHMiXSwibmFtZXMiOlsiQUdBTE1pbmlBc3NlbWJsZXIiLCJBR0FMTWluaUFzc2VtYmxlci5jb25zdHJ1Y3RvciIsIkFHQUxNaW5pQXNzZW1ibGVyLmFzc2VtYmxlIiwiQUdBTE1pbmlBc3NlbWJsZXIucHJvY2Vzc0xpbmUiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0SGVhZGVyIiwiQUdBTE1pbmlBc3NlbWJsZXIuZW1pdE9wY29kZSIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRaZXJvRHdvcmQiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0WmVyb1F3b3JkIiwiQUdBTE1pbmlBc3NlbWJsZXIuZW1pdERlc3QiLCJBR0FMTWluaUFzc2VtYmxlci5zdHJpbmdUb01hc2siLCJBR0FMTWluaUFzc2VtYmxlci5zdHJpbmdUb1N3aXp6bGUiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0U2FtcGxlciIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRTb3VyY2UiLCJBR0FMTWluaUFzc2VtYmxlci5hZGRIZWFkZXIiXSwibWFwcGluZ3MiOiJBQUVBLElBQU8sU0FBUyxXQUFjLDhDQUE4QyxDQUFDLENBQUM7QUFDOUUsSUFBTyxJQUFJLFdBQWdCLHlDQUF5QyxDQUFDLENBQUM7QUFDdEUsSUFBTyxNQUFNLFdBQWUsMkNBQTJDLENBQUMsQ0FBQztBQUN6RSxJQUFPLFVBQVUsV0FBYywrQ0FBK0MsQ0FBQyxDQUFDO0FBR2hGLElBQU0saUJBQWlCO0lBS3RCQSxTQUxLQSxpQkFBaUJBO1FBT3JCQyxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNaQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxJQUFJQSxFQUFFQSxDQUFDQTtJQUN2QkEsQ0FBQ0E7SUFFTUQsb0NBQVFBLEdBQWZBLFVBQWdCQSxNQUFhQSxFQUFFQSxRQUFlQSxFQUFFQSxXQUFrQkE7UUFB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LE1BQU1BLENBQUNBO1FBQ1JBLENBQUNBO1FBR0RBLE1BQU1BLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ25CQSxLQUFLQSxNQUFNQTtnQkFDVkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzdDQSxLQUFLQSxDQUFDQTtZQUNQQSxLQUFLQSxTQUFTQTtnQkFDYkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2ZBLE1BQU1BLG9CQUFvQkEsQ0FBQ0E7Z0JBQzVCQSxDQUFDQTtnQkFDREEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzNCQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDaEJBLE1BQU1BLENBQUNBO1lBQ1JBO2dCQUNDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDZkEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxtQ0FBbUNBLENBQUNBLENBQUNBO29CQUMvRkEsTUFBTUEsQ0FBQ0E7Z0JBQ1JBLENBQUNBO2dCQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxJQUFJQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDaENBLE1BQU1BLENBQUNBO2dCQUNSQSxDQUFDQTtnQkFDREEsSUFBSUEsRUFBRUEsR0FBbUJBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNsREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ1RBLE1BQU1BLGFBQWFBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO2dCQUM5REEsQ0FBQ0E7Z0JBQ0RBLEFBRUFBLGtEQUZrREE7Z0JBRWxEQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtnQkFDckNBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBO2dCQUNsQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0EsSUFBSUEsSUFBSUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2xDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDckRBLE1BQU1BLDJCQUEyQkEsR0FBR0EsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7b0JBQ2pGQSxDQUFDQTtnQkFDRkEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNQQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDOUJBLENBQUNBO2dCQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbkNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO3dCQUFDQSxNQUFNQSxzQkFBc0JBLEdBQUdBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNoSUEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNQQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDOUJBLENBQUNBO2dCQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbkNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO3dCQUM5QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBQzNEQSxNQUFNQSx1QkFBdUJBLEdBQUdBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNB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QSxHQUFuQkEsVUFBb0JBLENBQVFBO1FBRTNCUyxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtRQUNuQkEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDakNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ2pDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNqQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDakNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO0lBQ1ZBLENBQUNBO0lBRU1ULDJDQUFlQSxHQUF0QkEsVUFBdUJBLENBQUNBO1FBRXZCVSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNSQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtRQUNiQSxDQUFDQTtRQUNEQSxJQUFJQSxXQUFXQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUN6Q0EsSUFBSUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDeEJBLE1BQU1BLHVCQUF1QkEsQ0FBQ0E7UUFDL0JBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xCQSxFQUFFQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNyQkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7SUFDWEEsQ0FBQ0E7SUFFTVYsdUNBQVdBLEdBQWxCQSxVQUFtQkEsRUFBT0EsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsSUFBSUE7UUFFN0NXLElBQUlBLEdBQUdBLEdBQVlBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLFlBQVlBO1FBQ3hEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDZEEsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM3Q0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFJQSxPQUFPQTtRQUN2Q0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM3QkEsQUFNQUE7Ozs7O1dBREdBO1lBQ0NBLFdBQVdBLEdBQVVBLEdBQUdBLENBQUNBO1FBQzdCQSxJQUFJQSxhQUFhQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUM3QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDN0NBLElBQUlBLENBQUNBLEdBQXFCQSxVQUFVQSxDQUFDQSxHQUFHQSxDQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFFQSxDQUFDQTtZQUVsRUEsQUFFQUEsd0dBRndHQTtZQUV4R0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLGFBQWFBLElBQUlBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUNoREEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsbUNBQW1DQSxDQUFDQSxDQUFDQTtnQkFDbERBLENBQUNBO2dCQUNEQSxhQUFhQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQTtnQkFDbkNBLFdBQVdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO2dCQUNwQ0EsV0FBV0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDbkNBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNQQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxtQ0FBbUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRTNEQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO1FBQ3RDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNiQSxDQUFDQTtJQUVNWCxzQ0FBVUEsR0FBakJBLFVBQWtCQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQTtRQUVqQ1ksSUFBSUEsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsNkRBQTZEQSxDQUFDQSxFQUFFQSx5RUFBeUVBO1FBQ25LQSxJQUFJQSxHQUFHQSxDQUFDQTtRQUNSQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNiQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDN0JBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1lBQ2RBLENBQUNBO1lBQ0RBLElBQUlBLFFBQVFBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBO1lBQ3RDQSxJQUFJQSxFQUFFQSxHQUFPQSxFQUFFQSxHQUFHQSxFQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFDQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNwS0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDN0JBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFDdENBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsZUFBZUE7WUFDL0NBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDckNBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLDJDQUEyQ0EsQ0FBQ0EsRUFBRUEscUNBQXFDQTtZQUNyR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3pCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUNkQSxDQUFDQTtZQUNEQSxJQUFJQSxFQUFFQSxHQUFPQSxFQUFFQSxHQUFHQSxFQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFDQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNwR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxFQUFFQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtZQUN0Q0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU5QkEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFFTVoscUNBQVNBLEdBQWhCQSxVQUFpQkEsUUFBUUEsRUFBRUEsT0FBT0E7UUFFakNhLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQ2RBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO1FBQ2JBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtZQUMvQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBRUEsUUFBUUEsQ0FBRUEsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQ2hEQSxNQUFNQSw2QkFBNkJBLEdBQUdBLFFBQVFBLENBQUNBO1FBQ2hEQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUM3QkEsQ0FBQ0E7SUFDRmIsd0JBQUNBO0FBQURBLENBcFRBLEFBb1RDQSxJQUFBO0FBRUQsQUFBMkIsaUJBQWxCLGlCQUFpQixDQUFDIiwiZmlsZSI6ImFnbHNsL2Fzc2VtYmxlci9BR0FMTWluaUFzc2VtYmxlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2FtcGxlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL1NhbXBsZXJcIik7XG5pbXBvcnQgT3Bjb2RlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvT3Bjb2RlXCIpO1xuaW1wb3J0IE9wY29kZU1hcFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL2Fzc2VtYmxlci9PcGNvZGVNYXBcIik7XG5pbXBvcnQgUGFydFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvUGFydFwiKTtcbmltcG9ydCBSZWdNYXBcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL2Fzc2VtYmxlci9SZWdNYXBcIik7XG5pbXBvcnQgU2FtcGxlck1hcFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL2Fzc2VtYmxlci9TYW1wbGVyTWFwXCIpO1xuXG5cbmNsYXNzIEFHQUxNaW5pQXNzZW1ibGVyXG57XG5cdHB1YmxpYyByOk9iamVjdDtcblx0cHVibGljIGN1cjpQYXJ0O1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHRoaXMuciA9IHt9O1xuXHRcdHRoaXMuY3VyID0gbmV3IFBhcnQoKTtcblx0fVxuXG5cdHB1YmxpYyBhc3NlbWJsZShzb3VyY2U6c3RyaW5nLCBleHRfcGFydCA9IG51bGwsIGV4dF92ZXJzaW9uID0gbnVsbClcblx0e1xuXHRcdGlmICghZXh0X3ZlcnNpb24pIHtcblx0XHRcdGV4dF92ZXJzaW9uID0gMTtcblx0XHR9XG5cblx0XHRpZiAoZXh0X3BhcnQpIHtcblx0XHRcdHRoaXMuYWRkSGVhZGVyKGV4dF9wYXJ0LCBleHRfdmVyc2lvbik7XG5cdFx0fVxuXG5cdFx0dmFyIGxpbmVzID0gc291cmNlLnJlcGxhY2UoL1tcXGZcXG5cXHJcXHZdKy9nLCBcIlxcblwiKS5zcGxpdChcIlxcblwiKTsgLy8gaGFuZGxlIGJyZWFrcywgdGhlbiBzcGxpdCBpbnRvIGxpbmVzXG5cblx0XHRmb3IgKHZhciBpIGluIGxpbmVzKSB7XG5cdFx0XHR0aGlzLnByb2Nlc3NMaW5lKGxpbmVzW2ldLCBpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5yO1xuXHR9XG5cblx0cHJpdmF0ZSBwcm9jZXNzTGluZShsaW5lLCBsaW5lbnIpXG5cdHtcblx0XHR2YXIgc3RhcnRjb21tZW50Om51bWJlciA9IGxpbmUuc2VhcmNoKFwiLy9cIik7ICAvLyByZW1vdmUgY29tbWVudHNcblx0XHRpZiAoc3RhcnRjb21tZW50ICE9IC0xKSB7XG5cdFx0XHRsaW5lID0gbGluZS5zbGljZSgwLCBzdGFydGNvbW1lbnQpO1xuXHRcdH1cblx0XHRsaW5lID0gbGluZS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCBcIlwiKTsgLy8gcmVtb3ZlIG91dGVyIHNwYWNlXG5cdFx0aWYgKCEobGluZS5sZW5ndGggPiAwICkpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIG9wdHNpOm51bWJlciA9IGxpbmUuc2VhcmNoKC88Lio+L2cpOyAvLyBzcGxpdCBvZiBvcHRpb25zIHBhcnQgPCo+IGlmIHRoZXJlXG5cdFx0dmFyIG9wdHM6c3RyaW5nW10gPSBudWxsO1xuXHRcdGlmIChvcHRzaSAhPSAtMSkge1xuXHRcdFx0b3B0cyA9IGxpbmUuc2xpY2Uob3B0c2kpLm1hdGNoKC8oW1xcd1xcLlxcLVxcK10rKS9naSk7XG5cdFx0XHRsaW5lID0gbGluZS5zbGljZSgwLCBvcHRzaSk7XG5cdFx0fVxuXG5cdFx0Ly8gZ2V0IG9wY29kZS9jb21tYW5kXHRcdFx0XHQgICAgICAgICAgICBcblx0XHR2YXIgdG9rZW5zID0gbGluZS5tYXRjaCgvKFtcXHdcXC5cXCtcXFtcXF1dKykvZ2kpOyAvLyBnZXQgdG9rZW5zIGluIGxpbmVcblx0XHRpZiAoIXRva2VucyB8fCB0b2tlbnMubGVuZ3RoIDwgMSkge1xuXHRcdFx0aWYgKGxpbmUubGVuZ3RoID49IDMpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coXCJXYXJuaW5nOiBiYWQgbGluZSBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmUpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vY29uc29sZS5sb2cgKCBsaW5lbnIsIGxpbmUsIGN1ciwgdG9rZW5zICk7IFxuXHRcdHN3aXRjaCAodG9rZW5zWzBdKSB7XG5cdFx0XHRjYXNlIFwicGFydFwiOlxuXHRcdFx0XHR0aGlzLmFkZEhlYWRlcih0b2tlbnNbMV0sIE51bWJlcih0b2tlbnNbMl0pKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIFwiZW5kcGFydFwiOlxuXHRcdFx0XHRpZiAoIXRoaXMuY3VyKSB7XG5cdFx0XHRcdFx0dGhyb3cgXCJVbmV4cGVjdGVkIGVuZHBhcnRcIjtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLmN1ci5kYXRhLnBvc2l0aW9uID0gMDtcblx0XHRcdFx0dGhpcy5jdXIgPSBudWxsO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRpZiAoIXRoaXMuY3VyKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJXYXJuaW5nOiBiYWQgbGluZSBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmUgKyBcIiAoT3V0c2lkZSBvZiBhbnkgcGFydCBkZWZpbml0aW9uKVwiKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKHRoaXMuY3VyLm5hbWUgPT0gXCJjb21tZW50XCIpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyIG9wOk9wY29kZSA9IDxPcGNvZGU+IE9wY29kZU1hcC5tYXBbdG9rZW5zWzBdXTtcblx0XHRcdFx0aWYgKCFvcCkge1xuXHRcdFx0XHRcdHRocm93IFwiQmFkIG9wY29kZSBcIiArIHRva2Vuc1swXSArIFwiIFwiICsgbGluZW5yICsgXCI6IFwiICsgbGluZTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBjb25zb2xlLmxvZyggJ0FHQUxNaW5pQXNzZW1ibGVyJyAsICdvcCcgLCBvcCApO1xuXG5cdFx0XHRcdHRoaXMuZW1pdE9wY29kZSh0aGlzLmN1ciwgb3Aub3Bjb2RlKTtcblx0XHRcdFx0dmFyIHRpOm51bWJlciA9IDE7XG5cdFx0XHRcdGlmIChvcC5kZXN0ICYmIG9wLmRlc3QgIT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRpZiAoIXRoaXMuZW1pdERlc3QodGhpcy5jdXIsIHRva2Vuc1t0aSsrXSwgb3AuZGVzdCkpIHtcblx0XHRcdFx0XHRcdHRocm93IFwiQmFkIGRlc3RpbmF0aW9uIHJlZ2lzdGVyIFwiICsgdG9rZW5zW3RpIC0gMV0gKyBcIiBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuZW1pdFplcm9Ed29yZCh0aGlzLmN1cik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAob3AuYSAmJiBvcC5hLmZvcm1hdCAhPSBcIm5vbmVcIikge1xuXHRcdFx0XHRcdGlmICghdGhpcy5lbWl0U291cmNlKHRoaXMuY3VyLCB0b2tlbnNbdGkrK10sIG9wLmEpKSB0aHJvdyBcIkJhZCBzb3VyY2UgcmVnaXN0ZXIgXCIgKyB0b2tlbnNbdGkgLSAxXSArIFwiIFwiICsgbGluZW5yICsgXCI6IFwiICsgbGluZTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmVtaXRaZXJvUXdvcmQodGhpcy5jdXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG9wLmIgJiYgb3AuYi5mb3JtYXQgIT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRpZiAob3AuYi5mb3JtYXQgPT0gXCJzYW1wbGVyXCIpIHtcblx0XHRcdFx0XHRcdGlmICghdGhpcy5lbWl0U2FtcGxlcih0aGlzLmN1ciwgdG9rZW5zW3RpKytdLCBvcC5iLCBvcHRzKSkge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBcIkJhZCBzYW1wbGVyIHJlZ2lzdGVyIFwiICsgdG9rZW5zW3RpIC0gMV0gKyBcIiBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmICghdGhpcy5lbWl0U291cmNlKHRoaXMuY3VyLCB0b2tlbnNbdGkrK10sIG9wLmIpKSB7XG5cdFx0XHRcdFx0XHRcdHRocm93IFwiQmFkIHNvdXJjZSByZWdpc3RlciBcIiArIHRva2Vuc1t0aSAtIDFdICsgXCIgXCIgKyBsaW5lbnIgKyBcIjogXCIgKyBsaW5lO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmVtaXRaZXJvUXdvcmQodGhpcy5jdXIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBlbWl0SGVhZGVyKHByOlBhcnQpXG5cdHtcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDB4YTApOyBcdC8vIHRhZyB2ZXJzaW9uXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KHByLnZlcnNpb24pO1xuXHRcdGlmIChwci52ZXJzaW9uID49IDB4MTApIHtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMCk7IC8vIGFsaWduLCBmb3IgaGlnaGVyIHZlcnNpb25zXG5cdFx0fVxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMHhhMSk7XHRcdC8vIHRhZyBwcm9ncmFtIGlkXG5cdFx0c3dpdGNoIChwci5uYW1lKSB7XG5cdFx0XHRjYXNlIFwiZnJhZ21lbnRcIiA6XG5cdFx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcInZlcnRleFwiIDpcblx0XHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIFwiY3B1XCIgOlxuXHRcdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQgOlxuXHRcdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDB4ZmYpO1xuXHRcdFx0XHRicmVhazsgLy8gdW5rbm93bi9jb21tZW50XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGVtaXRPcGNvZGUocHI6UGFydCwgb3Bjb2RlKVxuXHR7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KG9wY29kZSk7XG5cdFx0Ly9jb25zb2xlLmxvZyAoIFwiRW1pdCBvcGNvZGU6IFwiLCBvcGNvZGUgKTsgXG5cdH1cblxuXHRwdWJsaWMgZW1pdFplcm9Ed29yZChwcjpQYXJ0KVxuXHR7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KDApO1xuXHR9XG5cblx0cHVibGljIGVtaXRaZXJvUXdvcmQocHIpXG5cdHtcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRJbnQoMCk7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KDApO1xuXHR9XG5cblx0cHVibGljIGVtaXREZXN0KHByLCB0b2tlbiwgb3BkZXN0KVxuXHR7XG5cblx0XHQvL2NvbnNvbGUubG9nKCAnQUdBTE1pbmlBc3NlbWJsZXInICwgJ2VtaXREZXN0JyAsICdSZWdNYXAubWFwJyAsIFJlZ01hcC5tYXApO1xuXHRcdHZhciByZWcgPSB0b2tlbi5tYXRjaCgvKFtmb3ZdP1t0cG9jaWRhdnNdKShcXGQqKShcXC5beHl6d117MSw0fSk/L2kpOyAvLyBnMTogcmVnbmFtZSwgZzI6cmVnbnVtLCBnMzptYXNrXG5cblx0XHQvLyBjb25zb2xlLmxvZyggJ0FHQUxNaW5pQXNzZW1ibGVyJyAsICdlbWl0RGVzdCcgLCAncmVnJyAsIHJlZyAsIHJlZ1sxXSAsIFJlZ01hcC5tYXBbcmVnWzFdXSApO1xuXHRcdC8vIGNvbnNvbGUubG9nKCAnQUdBTE1pbmlBc3NlbWJsZXInICwgJ2VtaXREZXN0JyAsICdSZWdNYXAubWFwW3JlZ1sxXV0nICwgUmVnTWFwLm1hcFtyZWdbMV1dICwgJ2Jvb2wnICwgIVJlZ01hcC5tYXBbcmVnWzFdXSApIDtcblxuXHRcdGlmICghUmVnTWFwLm1hcFtyZWdbMV1dKSByZXR1cm4gZmFsc2U7XG5cdFx0dmFyIGVtID0geyBudW06cmVnWzJdPyByZWdbMl0gOiAwLCBjb2RlOlJlZ01hcC5tYXBbcmVnWzFdXS5jb2RlLCBtYXNrOnRoaXMuc3RyaW5nVG9NYXNrKHJlZ1szXSkgfTtcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRTaG9ydChlbS5udW0pO1xuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoZW0ubWFzayk7XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5jb2RlKTtcblx0XHQvL2NvbnNvbGUubG9nICggXCIgIEVtaXQgZGVzdDogXCIsIGVtICk7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwdWJsaWMgc3RyaW5nVG9NYXNrKHM6c3RyaW5nKTpudW1iZXJcblx0e1xuXHRcdGlmICghcykgcmV0dXJuIDB4Zjtcblx0XHR2YXIgciA9IDA7XG5cdFx0aWYgKHMuaW5kZXhPZihcInhcIikgIT0gLTEpIHIgfD0gMTtcblx0XHRpZiAocy5pbmRleE9mKFwieVwiKSAhPSAtMSkgciB8PSAyO1xuXHRcdGlmIChzLmluZGV4T2YoXCJ6XCIpICE9IC0xKSByIHw9IDQ7XG5cdFx0aWYgKHMuaW5kZXhPZihcIndcIikgIT0gLTEpIHIgfD0gODtcblx0XHRyZXR1cm4gcjtcblx0fVxuXG5cdHB1YmxpYyBzdHJpbmdUb1N3aXp6bGUocylcblx0e1xuXHRcdGlmICghcykge1xuXHRcdFx0cmV0dXJuIDB4ZTQ7XG5cdFx0fVxuXHRcdHZhciBjaGFydG9pbmRleCA9IHsgeDowLCB5OjEsIHo6MiwgdzozIH07XG5cdFx0dmFyIHN3ID0gMDtcblxuXHRcdGlmIChzLmNoYXJBdCgwKSAhPSBcIi5cIikge1xuXHRcdFx0dGhyb3cgXCJNaXNzaW5nIC4gZm9yIHN3aXp6bGVcIjtcblx0XHR9XG5cblx0XHRpZiAocy5sZW5ndGggPiAxKSB7XG5cdFx0XHRzdyB8PSBjaGFydG9pbmRleFtzLmNoYXJBdCgxKV07XG5cdFx0fVxuXG5cdFx0aWYgKHMubGVuZ3RoID4gMikge1xuXHRcdFx0c3cgfD0gY2hhcnRvaW5kZXhbcy5jaGFyQXQoMildIDw8IDI7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN3IHw9IChzdyAmIDMpIDw8IDI7XG5cdFx0fVxuXG5cdFx0aWYgKHMubGVuZ3RoID4gMykge1xuXHRcdFx0c3cgfD0gY2hhcnRvaW5kZXhbcy5jaGFyQXQoMyldIDw8IDQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN3IHw9IChzdyAmICgzIDw8IDIpKSA8PCAyO1xuXHRcdH1cblxuXHRcdGlmIChzLmxlbmd0aCA+IDQpIHtcblx0XHRcdHN3IHw9IGNoYXJ0b2luZGV4W3MuY2hhckF0KDQpXSA8PCA2O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzdyB8PSAoc3cgJiAoMyA8PCA0KSkgPDwgMjtcblx0XHR9XG5cblx0XHRyZXR1cm4gc3c7XG5cdH1cblxuXHRwdWJsaWMgZW1pdFNhbXBsZXIocHI6UGFydCwgdG9rZW4sIG9wc3JjLCBvcHRzKVxuXHR7XG5cdFx0dmFyIHJlZzpzdHJpbmdbXSA9IHRva2VuLm1hdGNoKC9mcyhcXGQqKS9pKTsgLy8gZzE6cmVnbnVtXG5cdFx0aWYgKCFyZWcgfHwgIXJlZ1sxXSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRTaG9ydChwYXJzZUludChyZWdbMV0pKTtcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApOyAgIC8vIGJpYXNcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApO1xuXHRcdC8qXG5cdFx0IHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUgKCAweDUgKTtcblx0XHQgcHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSAoIDAgKTsgICAvLyByZWFkbW9kZSwgZGltXG5cdFx0IHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUgKCAwICk7ICAgLy8gc3BlY2lhbCwgd3JhcFxuXHRcdCBwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlICggMCApOyAgIC8vIG1pcCwgZmlsdGVyXG5cdFx0ICovXG5cdFx0dmFyIHNhbXBsZXJiaXRzOm51bWJlciA9IDB4NTtcblx0XHR2YXIgc2FtcGxlcm9wdHNldDpudW1iZXIgPSAwO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IG9wdHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBvOlNhbXBsZXIgPSA8U2FtcGxlcj4gU2FtcGxlck1hcC5tYXBbIG9wdHNbaV0udG9Mb3dlckNhc2UoKSBdO1xuXG5cdFx0XHQvL2NvbnNvbGUubG9nKCAnQUdBTE1pbmlBc3NlbWJsZXInICwgJ2VtaXRTYW1wbGVyJyAsICdTYW1wbGVNYXAgb3B0OicgLCBvICwgJzwtLS0tLS0tLSBXQVRDSCBGT1IgVEhJUycpO1xuXG5cdFx0XHRpZiAobykge1xuXHRcdFx0XHRpZiAoKChzYW1wbGVyb3B0c2V0ID4+IG8uc2hpZnQpICYgby5tYXNrKSAhPSAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJXYXJuaW5nLCBkdXBsaWNhdGUgc2FtcGxlciBvcHRpb25cIik7XG5cdFx0XHRcdH1cblx0XHRcdFx0c2FtcGxlcm9wdHNldCB8PSBvLm1hc2sgPDwgby5zaGlmdDtcblx0XHRcdFx0c2FtcGxlcmJpdHMgJj0gfihvLm1hc2sgPDwgby5zaGlmdCk7XG5cdFx0XHRcdHNhbXBsZXJiaXRzIHw9IG8udmFsdWUgPDwgby5zaGlmdDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiV2FybmluZywgdW5rbm93biBzYW1wbGVyIG9wdGlvbjogXCIsIG9wdHNbaV0pO1xuXHRcdFx0XHQvLyB0b2RvIGJpYXNcblx0XHRcdH1cblx0XHR9XG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KHNhbXBsZXJiaXRzKTtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBlbWl0U291cmNlKHByLCB0b2tlbiwgb3BzcmMpXG5cdHtcblx0XHR2YXIgaW5kZXhlZCA9IHRva2VuLm1hdGNoKC92Y1xcWyh2W3RjYWldKShcXGQrKVxcLihbeHl6d10pKFtcXCtcXC1dXFxkKyk/XFxdKFxcLlt4eXp3XXsxLDR9KT8vaSk7IC8vIGcxOiBpbmRleHJlZ25hbWUsIGcyOmluZGV4cmVnbnVtLCBnMzpzZWxlY3QsIFtnNDpvZmZzZXRdLCBbZzU6c3dpenpsZV1cblx0XHR2YXIgcmVnO1xuXHRcdGlmIChpbmRleGVkKSB7XG5cdFx0XHRpZiAoIVJlZ01hcC5tYXBbaW5kZXhlZFsxXV0pIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHNlbGluZGV4ID0geyB4OjAsIHk6MSwgejoyLCB3OjMgfTtcblx0XHRcdHZhciBlbTphbnkgPSB7IG51bTppbmRleGVkWzJdIHwgMCwgY29kZTpSZWdNYXAubWFwW2luZGV4ZWRbMV1dLmNvZGUsIHN3aXp6bGU6dGhpcy5zdHJpbmdUb1N3aXp6bGUoaW5kZXhlZFs1XSksIHNlbGVjdDpzZWxpbmRleFtpbmRleGVkWzNdXSwgb2Zmc2V0OmluZGV4ZWRbNF0gfCAwIH07XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRTaG9ydChlbS5udW0pO1xuXHRcdFx0cHIuZGF0YS53cml0ZUJ5dGUoZW0ub2Zmc2V0KTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoZW0uc3dpenpsZSk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDB4MSk7IC8vIGNvbnN0YW50IHJlZ1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5jb2RlKTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoZW0uc2VsZWN0KTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMSA8PCA3KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVnID0gdG9rZW4ubWF0Y2goLyhbZm92XT9bdHBvY2lkYXZzXSkoXFxkKikoXFwuW3h5enddezEsNH0pPy9pKTsgLy8gZzE6IHJlZ25hbWUsIGcyOnJlZ251bSwgZzM6c3dpenpsZVxuXHRcdFx0aWYgKCFSZWdNYXAubWFwW3JlZ1sxXV0pIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGVtOmFueSA9IHsgbnVtOnJlZ1syXSB8IDAsIGNvZGU6UmVnTWFwLm1hcFtyZWdbMV1dLmNvZGUsIHN3aXp6bGU6dGhpcy5zdHJpbmdUb1N3aXp6bGUocmVnWzNdKSB9O1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQoZW0ubnVtKTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMCk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKGVtLnN3aXp6bGUpO1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5jb2RlKTtcblx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMCk7XG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApO1xuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcblx0XHRcdC8vY29uc29sZS5sb2cgKCBcIiAgRW1pdCBzb3VyY2U6IFwiLCBlbSwgcHIuZGF0YS5sZW5ndGggKTtcblx0XHR9XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwdWJsaWMgYWRkSGVhZGVyKHBhcnRuYW1lLCB2ZXJzaW9uKVxuXHR7XG5cdFx0aWYgKCF2ZXJzaW9uKSB7XG5cdFx0XHR2ZXJzaW9uID0gMTtcblx0XHR9XG5cdFx0aWYgKHRoaXMucltwYXJ0bmFtZV0gPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR0aGlzLnJbcGFydG5hbWVdID0gbmV3IFBhcnQocGFydG5hbWUsIHZlcnNpb24pO1xuXHRcdFx0dGhpcy5lbWl0SGVhZGVyKHRoaXMuclsgcGFydG5hbWUgXSk7XG5cdFx0fSBlbHNlIGlmICh0aGlzLnJbcGFydG5hbWVdLnZlcnNpb24gIT0gdmVyc2lvbikge1xuXHRcdFx0dGhyb3cgXCJNdWx0aXBsZSB2ZXJzaW9ucyBmb3IgcGFydCBcIiArIHBhcnRuYW1lO1xuXHRcdH1cblx0XHR0aGlzLmN1ciA9IHRoaXMucltwYXJ0bmFtZV07XG5cdH1cbn1cblxuZXhwb3J0ID0gQUdBTE1pbmlBc3NlbWJsZXI7Il19
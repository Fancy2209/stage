var OpcodeMap = require("awayjs-stagegl/lib/aglsl/assembler/OpcodeMap");
var Part = require("awayjs-stagegl/lib/aglsl/assembler/Part");
var RegMap = require("awayjs-stagegl/lib/aglsl/assembler/RegMap");
var SamplerMap = require("awayjs-stagegl/lib/aglsl/assembler/SamplerMap");
var AGALMiniAssembler = (function () {
    function AGALMiniAssembler() {
        this.r = {};
        this.cur = new Part();
    }
    AGALMiniAssembler.prototype.assemble = function (source, ext_part, ext_version) {
        if (ext_part === void 0) { ext_part = null; }
        if (ext_version === void 0) { ext_version = null; }
        if (!ext_version) {
            ext_version = 1;
        }
        if (ext_part) {
            this.addHeader(ext_part, ext_version);
        }
        var lines = source.replace(/[\f\n\r\v]+/g, "\n").split("\n"); // handle breaks, then split into lines
        for (var i in lines) {
            this.processLine(lines[i], i);
        }
        return this.r;
    };
    AGALMiniAssembler.prototype.processLine = function (line, linenr) {
        var startcomment = line.search("//"); // remove comments
        if (startcomment != -1) {
            line = line.slice(0, startcomment);
        }
        line = line.replace(/^\s+|\s+$/g, ""); // remove outer space
        if (!(line.length > 0)) {
            return;
        }
        var optsi = line.search(/<.*>/g); // split of options part <*> if there
        var opts = null;
        if (optsi != -1) {
            opts = line.slice(optsi).match(/([\w\.\-\+]+)/gi);
            line = line.slice(0, optsi);
        }
        // get opcode/command				            
        var tokens = line.match(/([\w\.\+\[\]]+)/gi); // get tokens in line
        if (!tokens || tokens.length < 1) {
            if (line.length >= 3) {
                console.log("Warning: bad line " + linenr + ": " + line);
            }
            return;
        }
        switch (tokens[0]) {
            case "part":
                this.addHeader(tokens[1], Number(tokens[2]));
                break;
            case "endpart":
                if (!this.cur) {
                    throw "Unexpected endpart";
                }
                this.cur.data.position = 0;
                this.cur = null;
                return;
            default:
                if (!this.cur) {
                    console.log("Warning: bad line " + linenr + ": " + line + " (Outside of any part definition)");
                    return;
                }
                if (this.cur.name == "comment") {
                    return;
                }
                var op = OpcodeMap.map[tokens[0]];
                if (!op) {
                    throw "Bad opcode " + tokens[0] + " " + linenr + ": " + line;
                }
                // console.log( 'AGALMiniAssembler' , 'op' , op );
                this.emitOpcode(this.cur, op.opcode);
                var ti = 1;
                if (op.dest && op.dest != "none") {
                    if (!this.emitDest(this.cur, tokens[ti++], op.dest)) {
                        throw "Bad destination register " + tokens[ti - 1] + " " + linenr + ": " + line;
                    }
                }
                else {
                    this.emitZeroDword(this.cur);
                }
                if (op.a && op.a.format != "none") {
                    if (!this.emitSource(this.cur, tokens[ti++], op.a))
                        throw "Bad source register " + tokens[ti - 1] + " " + linenr + ": " + line;
                }
                else {
                    this.emitZeroQword(this.cur);
                }
                if (op.b && op.b.format != "none") {
                    if (op.b.format == "sampler") {
                        if (!this.emitSampler(this.cur, tokens[ti++], op.b, opts)) {
                            throw "Bad sampler register " + tokens[ti - 1] + " " + linenr + ": " + line;
                        }
                    }
                    else {
                        if (!this.emitSource(this.cur, tokens[ti++], op.b)) {
                            throw "Bad source register " + tokens[ti - 1] + " " + linenr + ": " + line;
                        }
                    }
                }
                else {
                    this.emitZeroQword(this.cur);
                }
                break;
        }
    };
    AGALMiniAssembler.prototype.emitHeader = function (pr) {
        pr.data.writeUnsignedByte(0xa0); // tag version
        pr.data.writeUnsignedInt(pr.version);
        if (pr.version >= 0x10) {
            pr.data.writeUnsignedByte(0); // align, for higher versions
        }
        pr.data.writeUnsignedByte(0xa1); // tag program id
        switch (pr.name) {
            case "fragment":
                pr.data.writeUnsignedByte(1);
                break;
            case "vertex":
                pr.data.writeUnsignedByte(0);
                break;
            case "cpu":
                pr.data.writeUnsignedByte(2);
                break;
            default:
                pr.data.writeUnsignedByte(0xff);
                break;
        }
    };
    AGALMiniAssembler.prototype.emitOpcode = function (pr, opcode) {
        pr.data.writeUnsignedInt(opcode);
        //console.log ( "Emit opcode: ", opcode ); 
    };
    AGALMiniAssembler.prototype.emitZeroDword = function (pr) {
        pr.data.writeUnsignedInt(0);
    };
    AGALMiniAssembler.prototype.emitZeroQword = function (pr) {
        pr.data.writeUnsignedInt(0);
        pr.data.writeUnsignedInt(0);
    };
    AGALMiniAssembler.prototype.emitDest = function (pr, token, opdest) {
        //console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map' , RegMap.map);
        var reg = token.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:mask
        // console.log( 'AGALMiniAssembler' , 'emitDest' , 'reg' , reg , reg[1] , RegMap.map[reg[1]] );
        // console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map[reg[1]]' , RegMap.map[reg[1]] , 'bool' , !RegMap.map[reg[1]] ) ;
        if (!RegMap.map[reg[1]])
            return false;
        var em = { num: reg[2] ? reg[2] : 0, code: RegMap.map[reg[1]].code, mask: this.stringToMask(reg[3]) };
        pr.data.writeUnsignedShort(em.num);
        pr.data.writeUnsignedByte(em.mask);
        pr.data.writeUnsignedByte(em.code);
        //console.log ( "  Emit dest: ", em );
        return true;
    };
    AGALMiniAssembler.prototype.stringToMask = function (s) {
        if (!s)
            return 0xf;
        var r = 0;
        if (s.indexOf("x") != -1)
            r |= 1;
        if (s.indexOf("y") != -1)
            r |= 2;
        if (s.indexOf("z") != -1)
            r |= 4;
        if (s.indexOf("w") != -1)
            r |= 8;
        return r;
    };
    AGALMiniAssembler.prototype.stringToSwizzle = function (s) {
        if (!s) {
            return 0xe4;
        }
        var chartoindex = { x: 0, y: 1, z: 2, w: 3 };
        var sw = 0;
        if (s.charAt(0) != ".") {
            throw "Missing . for swizzle";
        }
        if (s.length > 1) {
            sw |= chartoindex[s.charAt(1)];
        }
        if (s.length > 2) {
            sw |= chartoindex[s.charAt(2)] << 2;
        }
        else {
            sw |= (sw & 3) << 2;
        }
        if (s.length > 3) {
            sw |= chartoindex[s.charAt(3)] << 4;
        }
        else {
            sw |= (sw & (3 << 2)) << 2;
        }
        if (s.length > 4) {
            sw |= chartoindex[s.charAt(4)] << 6;
        }
        else {
            sw |= (sw & (3 << 4)) << 2;
        }
        return sw;
    };
    AGALMiniAssembler.prototype.emitSampler = function (pr, token, opsrc, opts) {
        var reg = token.match(/fs(\d*)/i); // g1:regnum
        if (!reg || !reg[1]) {
            return false;
        }
        pr.data.writeUnsignedShort(parseInt(reg[1]));
        pr.data.writeUnsignedByte(0); // bias
        pr.data.writeUnsignedByte(0);
        /*
         pr.data.writeUnsignedByte ( 0x5 );
         pr.data.writeUnsignedByte ( 0 );   // readmode, dim
         pr.data.writeUnsignedByte ( 0 );   // special, wrap
         pr.data.writeUnsignedByte ( 0 );   // mip, filter
         */
        var samplerbits = 0x5;
        var sampleroptset = 0;
        for (var i = 0; i < opts.length; i++) {
            var o = SamplerMap.map[opts[i].toLowerCase()];
            //console.log( 'AGALMiniAssembler' , 'emitSampler' , 'SampleMap opt:' , o , '<-------- WATCH FOR THIS');
            if (o) {
                if (((sampleroptset >> o.shift) & o.mask) != 0) {
                    console.log("Warning, duplicate sampler option");
                }
                sampleroptset |= o.mask << o.shift;
                samplerbits &= ~(o.mask << o.shift);
                samplerbits |= o.value << o.shift;
            }
            else {
                console.log("Warning, unknown sampler option: ", opts[i]);
            }
        }
        pr.data.writeUnsignedInt(samplerbits);
        return true;
    };
    AGALMiniAssembler.prototype.emitSource = function (pr, token, opsrc) {
        var indexed = token.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i); // g1: indexregname, g2:indexregnum, g3:select, [g4:offset], [g5:swizzle]
        var reg;
        if (indexed) {
            if (!RegMap.map[indexed[1]]) {
                return false;
            }
            var selindex = { x: 0, y: 1, z: 2, w: 3 };
            var em = { num: indexed[2] | 0, code: RegMap.map[indexed[1]].code, swizzle: this.stringToSwizzle(indexed[5]), select: selindex[indexed[3]], offset: indexed[4] | 0 };
            pr.data.writeUnsignedShort(em.num);
            pr.data.writeByte(em.offset);
            pr.data.writeUnsignedByte(em.swizzle);
            pr.data.writeUnsignedByte(0x1); // constant reg
            pr.data.writeUnsignedByte(em.code);
            pr.data.writeUnsignedByte(em.select);
            pr.data.writeUnsignedByte(1 << 7);
        }
        else {
            reg = token.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:swizzle
            if (!RegMap.map[reg[1]]) {
                return false;
            }
            var em = { num: reg[2] | 0, code: RegMap.map[reg[1]].code, swizzle: this.stringToSwizzle(reg[3]) };
            pr.data.writeUnsignedShort(em.num);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(em.swizzle);
            pr.data.writeUnsignedByte(em.code);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(0);
            pr.data.writeUnsignedByte(0);
        }
        return true;
    };
    AGALMiniAssembler.prototype.addHeader = function (partname, version) {
        if (!version) {
            version = 1;
        }
        if (this.r[partname] == undefined) {
            this.r[partname] = new Part(partname, version);
            this.emitHeader(this.r[partname]);
        }
        else if (this.r[partname].version != version) {
            throw "Multiple versions for part " + partname;
        }
        this.cur = this.r[partname];
    };
    return AGALMiniAssembler;
})();
module.exports = AGALMiniAssembler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvQUdBTE1pbmlBc3NlbWJsZXIudHMiXSwibmFtZXMiOlsiQUdBTE1pbmlBc3NlbWJsZXIiLCJBR0FMTWluaUFzc2VtYmxlci5jb25zdHJ1Y3RvciIsIkFHQUxNaW5pQXNzZW1ibGVyLmFzc2VtYmxlIiwiQUdBTE1pbmlBc3NlbWJsZXIucHJvY2Vzc0xpbmUiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0SGVhZGVyIiwiQUdBTE1pbmlBc3NlbWJsZXIuZW1pdE9wY29kZSIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRaZXJvRHdvcmQiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0WmVyb1F3b3JkIiwiQUdBTE1pbmlBc3NlbWJsZXIuZW1pdERlc3QiLCJBR0FMTWluaUFzc2VtYmxlci5zdHJpbmdUb01hc2siLCJBR0FMTWluaUFzc2VtYmxlci5zdHJpbmdUb1N3aXp6bGUiLCJBR0FMTWluaUFzc2VtYmxlci5lbWl0U2FtcGxlciIsIkFHQUxNaW5pQXNzZW1ibGVyLmVtaXRTb3VyY2UiLCJBR0FMTWluaUFzc2VtYmxlci5hZGRIZWFkZXIiXSwibWFwcGluZ3MiOiJBQUVBLElBQU8sU0FBUyxXQUFjLDhDQUE4QyxDQUFDLENBQUM7QUFDOUUsSUFBTyxJQUFJLFdBQWdCLHlDQUF5QyxDQUFDLENBQUM7QUFDdEUsSUFBTyxNQUFNLFdBQWUsMkNBQTJDLENBQUMsQ0FBQztBQUN6RSxJQUFPLFVBQVUsV0FBYywrQ0FBK0MsQ0FBQyxDQUFDO0FBR2hGLElBQU0saUJBQWlCO0lBS3RCQSxTQUxLQSxpQkFBaUJBO1FBT3JCQyxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNaQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxJQUFJQSxFQUFFQSxDQUFDQTtJQUN2QkEsQ0FBQ0E7SUFFTUQsb0NBQVFBLEdBQWZBLFVBQWdCQSxNQUFhQSxFQUFFQSxRQUFlQSxFQUFFQSxXQUFrQkE7UUFB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LE1BQU1BLENBQUNBO1FBQ1JBLENBQUNBO1FBR0RBLE1BQU1BLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ25CQSxLQUFLQSxNQUFNQTtnQkFDVkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzdDQSxLQUFLQSxDQUFDQTtZQUNQQSxLQUFLQSxTQUFTQTtnQkFDYkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2ZBLE1BQU1BLG9CQUFvQkEsQ0FBQ0E7Z0JBQzVCQSxDQUFDQTtnQkFDREEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzNCQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDaEJBLE1BQU1BLENBQUNBO1lBQ1JBO2dCQUNDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDZkEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxtQ0FBbUNBLENBQUNBLENBQUNBO29CQUMvRkEsTUFBTUEsQ0FBQ0E7Z0JBQ1JBLENBQUNBO2dCQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxJQUFJQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDaENBLE1BQU1BLENBQUNBO2dCQUNSQSxDQUFDQTtnQkFDREEsSUFBSUEsRUFBRUEsR0FBbUJBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNsREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ1RBLE1BQU1BLGFBQWFBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO2dCQUM5REEsQ0FBQ0E7Z0JBQ0RBLEFBRUFBLGtEQUZrREE7Z0JBRWxEQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtnQkFDckNBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBO2dCQUNsQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0EsSUFBSUEsSUFBSUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2xDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDckRBLE1BQU1BLDJCQUEyQkEsR0FBR0EsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7b0JBQ2pGQSxDQUFDQTtnQkFDRkEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNQQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDOUJBLENBQUNBO2dCQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbkNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO3dCQUFDQSxNQUFNQSxzQkFBc0JBLEdBQUdBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNoSUEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNQQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDOUJBLENBQUNBO2dCQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbkNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO3dCQUM5QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBQzNEQSxNQUFNQSx1QkFBdUJBLEdBQUdBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNB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QSxHQUFuQkEsVUFBb0JBLENBQVFBO1FBRTNCUyxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtRQUNuQkEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDakNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ2pDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNqQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDakNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO0lBQ1ZBLENBQUNBO0lBRU1ULDJDQUFlQSxHQUF0QkEsVUFBdUJBLENBQUNBO1FBRXZCVSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNSQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtRQUNiQSxDQUFDQTtRQUNEQSxJQUFJQSxXQUFXQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUN6Q0EsSUFBSUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDeEJBLE1BQU1BLHVCQUF1QkEsQ0FBQ0E7UUFDL0JBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xCQSxFQUFFQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNyQkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLEVBQUVBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7SUFDWEEsQ0FBQ0E7SUFFTVYsdUNBQVdBLEdBQWxCQSxVQUFtQkEsRUFBT0EsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsSUFBSUE7UUFFN0NXLElBQUlBLEdBQUdBLEdBQVlBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLFlBQVlBO1FBQ3hEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDZEEsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM3Q0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFJQSxPQUFPQTtRQUN2Q0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM3QkEsQUFNQUE7Ozs7O1dBREdBO1lBQ0NBLFdBQVdBLEdBQVVBLEdBQUdBLENBQUNBO1FBQzdCQSxJQUFJQSxhQUFhQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUM3QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDN0NBLElBQUlBLENBQUNBLEdBQXFCQSxVQUFVQSxDQUFDQSxHQUFHQSxDQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFFQSxDQUFDQTtZQUVsRUEsQUFFQUEsd0dBRndHQTtZQUV4R0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLGFBQWFBLElBQUlBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUNoREEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsbUNBQW1DQSxDQUFDQSxDQUFDQTtnQkFDbERBLENBQUNBO2dCQUNEQSxhQUFhQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQTtnQkFDbkNBLFdBQVdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO2dCQUNwQ0EsV0FBV0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDbkNBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNQQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxtQ0FBbUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRTNEQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO1FBQ3RDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNiQSxDQUFDQTtJQUVNWCxzQ0FBVUEsR0FBakJBLFVBQWtCQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQTtRQUVqQ1ksSUFBSUEsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsNkRBQTZEQSxDQUFDQSxFQUFFQSx5RUFBeUVBO1FBQ25LQSxJQUFJQSxHQUFHQSxDQUFDQTtRQUNSQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNiQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDN0JBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1lBQ2RBLENBQUNBO1lBQ0RBLElBQUlBLFFBQVFBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBO1lBQ3RDQSxJQUFJQSxFQUFFQSxHQUFPQSxFQUFFQSxHQUFHQSxFQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFDQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNwS0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDN0JBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFDdENBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsZUFBZUE7WUFDL0NBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDckNBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLDJDQUEyQ0EsQ0FBQ0EsRUFBRUEscUNBQXFDQTtZQUNyR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3pCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUNkQSxDQUFDQTtZQUNEQSxJQUFJQSxFQUFFQSxHQUFPQSxFQUFFQSxHQUFHQSxFQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFDQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNwR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxFQUFFQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtZQUN0Q0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU5QkEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFFTVoscUNBQVNBLEdBQWhCQSxVQUFpQkEsUUFBUUEsRUFBRUEsT0FBT0E7UUFFakNhLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQ2RBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO1FBQ2JBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtZQUMvQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBRUEsUUFBUUEsQ0FBRUEsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQ2hEQSxNQUFNQSw2QkFBNkJBLEdBQUdBLFFBQVFBLENBQUNBO1FBQ2hEQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUM3QkEsQ0FBQ0E7SUFDRmIsd0JBQUNBO0FBQURBLENBcFRBLEFBb1RDQSxJQUFBO0FBRUQsQUFBMkIsaUJBQWxCLGlCQUFpQixDQUFDIiwiZmlsZSI6ImFnbHNsL2Fzc2VtYmxlci9BR0FMTWluaUFzc2VtYmxlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2FtcGxlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL1NhbXBsZXJcIik7XHJcbmltcG9ydCBPcGNvZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL2Fzc2VtYmxlci9PcGNvZGVcIik7XHJcbmltcG9ydCBPcGNvZGVNYXBcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvT3Bjb2RlTWFwXCIpO1xyXG5pbXBvcnQgUGFydFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvUGFydFwiKTtcclxuaW1wb3J0IFJlZ01hcFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL1JlZ01hcFwiKTtcclxuaW1wb3J0IFNhbXBsZXJNYXBcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvU2FtcGxlck1hcFwiKTtcclxuXHJcblxyXG5jbGFzcyBBR0FMTWluaUFzc2VtYmxlclxyXG57XHJcblx0cHVibGljIHI6T2JqZWN0O1xyXG5cdHB1YmxpYyBjdXI6UGFydDtcclxuXHJcblx0Y29uc3RydWN0b3IoKVxyXG5cdHtcclxuXHRcdHRoaXMuciA9IHt9O1xyXG5cdFx0dGhpcy5jdXIgPSBuZXcgUGFydCgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGFzc2VtYmxlKHNvdXJjZTpzdHJpbmcsIGV4dF9wYXJ0ID0gbnVsbCwgZXh0X3ZlcnNpb24gPSBudWxsKVxyXG5cdHtcclxuXHRcdGlmICghZXh0X3ZlcnNpb24pIHtcclxuXHRcdFx0ZXh0X3ZlcnNpb24gPSAxO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChleHRfcGFydCkge1xyXG5cdFx0XHR0aGlzLmFkZEhlYWRlcihleHRfcGFydCwgZXh0X3ZlcnNpb24pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBsaW5lcyA9IHNvdXJjZS5yZXBsYWNlKC9bXFxmXFxuXFxyXFx2XSsvZywgXCJcXG5cIikuc3BsaXQoXCJcXG5cIik7IC8vIGhhbmRsZSBicmVha3MsIHRoZW4gc3BsaXQgaW50byBsaW5lc1xyXG5cclxuXHRcdGZvciAodmFyIGkgaW4gbGluZXMpIHtcclxuXHRcdFx0dGhpcy5wcm9jZXNzTGluZShsaW5lc1tpXSwgaSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMucjtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcHJvY2Vzc0xpbmUobGluZSwgbGluZW5yKVxyXG5cdHtcclxuXHRcdHZhciBzdGFydGNvbW1lbnQ6bnVtYmVyID0gbGluZS5zZWFyY2goXCIvL1wiKTsgIC8vIHJlbW92ZSBjb21tZW50c1xyXG5cdFx0aWYgKHN0YXJ0Y29tbWVudCAhPSAtMSkge1xyXG5cdFx0XHRsaW5lID0gbGluZS5zbGljZSgwLCBzdGFydGNvbW1lbnQpO1xyXG5cdFx0fVxyXG5cdFx0bGluZSA9IGxpbmUucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7IC8vIHJlbW92ZSBvdXRlciBzcGFjZVxyXG5cdFx0aWYgKCEobGluZS5sZW5ndGggPiAwICkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0dmFyIG9wdHNpOm51bWJlciA9IGxpbmUuc2VhcmNoKC88Lio+L2cpOyAvLyBzcGxpdCBvZiBvcHRpb25zIHBhcnQgPCo+IGlmIHRoZXJlXHJcblx0XHR2YXIgb3B0czpzdHJpbmdbXSA9IG51bGw7XHJcblx0XHRpZiAob3B0c2kgIT0gLTEpIHtcclxuXHRcdFx0b3B0cyA9IGxpbmUuc2xpY2Uob3B0c2kpLm1hdGNoKC8oW1xcd1xcLlxcLVxcK10rKS9naSk7XHJcblx0XHRcdGxpbmUgPSBsaW5lLnNsaWNlKDAsIG9wdHNpKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBnZXQgb3Bjb2RlL2NvbW1hbmRcdFx0XHRcdCAgICAgICAgICAgIFxyXG5cdFx0dmFyIHRva2VucyA9IGxpbmUubWF0Y2goLyhbXFx3XFwuXFwrXFxbXFxdXSspL2dpKTsgLy8gZ2V0IHRva2VucyBpbiBsaW5lXHJcblx0XHRpZiAoIXRva2VucyB8fCB0b2tlbnMubGVuZ3RoIDwgMSkge1xyXG5cdFx0XHRpZiAobGluZS5sZW5ndGggPj0gMykge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiV2FybmluZzogYmFkIGxpbmUgXCIgKyBsaW5lbnIgKyBcIjogXCIgKyBsaW5lKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyAoIGxpbmVuciwgbGluZSwgY3VyLCB0b2tlbnMgKTsgXHJcblx0XHRzd2l0Y2ggKHRva2Vuc1swXSkge1xyXG5cdFx0XHRjYXNlIFwicGFydFwiOlxyXG5cdFx0XHRcdHRoaXMuYWRkSGVhZGVyKHRva2Vuc1sxXSwgTnVtYmVyKHRva2Vuc1syXSkpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIFwiZW5kcGFydFwiOlxyXG5cdFx0XHRcdGlmICghdGhpcy5jdXIpIHtcclxuXHRcdFx0XHRcdHRocm93IFwiVW5leHBlY3RlZCBlbmRwYXJ0XCI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuY3VyLmRhdGEucG9zaXRpb24gPSAwO1xyXG5cdFx0XHRcdHRoaXMuY3VyID0gbnVsbDtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0aWYgKCF0aGlzLmN1cikge1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJXYXJuaW5nOiBiYWQgbGluZSBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmUgKyBcIiAoT3V0c2lkZSBvZiBhbnkgcGFydCBkZWZpbml0aW9uKVwiKTtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHRoaXMuY3VyLm5hbWUgPT0gXCJjb21tZW50XCIpIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dmFyIG9wOk9wY29kZSA9IDxPcGNvZGU+IE9wY29kZU1hcC5tYXBbdG9rZW5zWzBdXTtcclxuXHRcdFx0XHRpZiAoIW9wKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBcIkJhZCBvcGNvZGUgXCIgKyB0b2tlbnNbMF0gKyBcIiBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKCAnQUdBTE1pbmlBc3NlbWJsZXInICwgJ29wJyAsIG9wICk7XHJcblxyXG5cdFx0XHRcdHRoaXMuZW1pdE9wY29kZSh0aGlzLmN1ciwgb3Aub3Bjb2RlKTtcclxuXHRcdFx0XHR2YXIgdGk6bnVtYmVyID0gMTtcclxuXHRcdFx0XHRpZiAob3AuZGVzdCAmJiBvcC5kZXN0ICE9IFwibm9uZVwiKSB7XHJcblx0XHRcdFx0XHRpZiAoIXRoaXMuZW1pdERlc3QodGhpcy5jdXIsIHRva2Vuc1t0aSsrXSwgb3AuZGVzdCkpIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgXCJCYWQgZGVzdGluYXRpb24gcmVnaXN0ZXIgXCIgKyB0b2tlbnNbdGkgLSAxXSArIFwiIFwiICsgbGluZW5yICsgXCI6IFwiICsgbGluZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5lbWl0WmVyb0R3b3JkKHRoaXMuY3VyKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChvcC5hICYmIG9wLmEuZm9ybWF0ICE9IFwibm9uZVwiKSB7XHJcblx0XHRcdFx0XHRpZiAoIXRoaXMuZW1pdFNvdXJjZSh0aGlzLmN1ciwgdG9rZW5zW3RpKytdLCBvcC5hKSkgdGhyb3cgXCJCYWQgc291cmNlIHJlZ2lzdGVyIFwiICsgdG9rZW5zW3RpIC0gMV0gKyBcIiBcIiArIGxpbmVuciArIFwiOiBcIiArIGxpbmU7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuZW1pdFplcm9Rd29yZCh0aGlzLmN1cik7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAob3AuYiAmJiBvcC5iLmZvcm1hdCAhPSBcIm5vbmVcIikge1xyXG5cdFx0XHRcdFx0aWYgKG9wLmIuZm9ybWF0ID09IFwic2FtcGxlclwiKSB7XHJcblx0XHRcdFx0XHRcdGlmICghdGhpcy5lbWl0U2FtcGxlcih0aGlzLmN1ciwgdG9rZW5zW3RpKytdLCBvcC5iLCBvcHRzKSkge1xyXG5cdFx0XHRcdFx0XHRcdHRocm93IFwiQmFkIHNhbXBsZXIgcmVnaXN0ZXIgXCIgKyB0b2tlbnNbdGkgLSAxXSArIFwiIFwiICsgbGluZW5yICsgXCI6IFwiICsgbGluZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0aWYgKCF0aGlzLmVtaXRTb3VyY2UodGhpcy5jdXIsIHRva2Vuc1t0aSsrXSwgb3AuYikpIHtcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBcIkJhZCBzb3VyY2UgcmVnaXN0ZXIgXCIgKyB0b2tlbnNbdGkgLSAxXSArIFwiIFwiICsgbGluZW5yICsgXCI6IFwiICsgbGluZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLmVtaXRaZXJvUXdvcmQodGhpcy5jdXIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBlbWl0SGVhZGVyKHByOlBhcnQpXHJcblx0e1xyXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgweGEwKTsgXHQvLyB0YWcgdmVyc2lvblxyXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KHByLnZlcnNpb24pO1xyXG5cdFx0aWYgKHByLnZlcnNpb24gPj0gMHgxMCkge1xyXG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApOyAvLyBhbGlnbiwgZm9yIGhpZ2hlciB2ZXJzaW9uc1xyXG5cdFx0fVxyXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgweGExKTtcdFx0Ly8gdGFnIHByb2dyYW0gaWRcclxuXHRcdHN3aXRjaCAocHIubmFtZSkge1xyXG5cdFx0XHRjYXNlIFwiZnJhZ21lbnRcIiA6XHJcblx0XHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgxKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSBcInZlcnRleFwiIDpcclxuXHRcdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIFwiY3B1XCIgOlxyXG5cdFx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMik7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGRlZmF1bHQgOlxyXG5cdFx0XHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMHhmZik7XHJcblx0XHRcdFx0YnJlYWs7IC8vIHVua25vd24vY29tbWVudFxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIGVtaXRPcGNvZGUocHI6UGFydCwgb3Bjb2RlKVxyXG5cdHtcclxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludChvcGNvZGUpO1xyXG5cdFx0Ly9jb25zb2xlLmxvZyAoIFwiRW1pdCBvcGNvZGU6IFwiLCBvcGNvZGUgKTsgXHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZW1pdFplcm9Ed29yZChwcjpQYXJ0KVxyXG5cdHtcclxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludCgwKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBlbWl0WmVyb1F3b3JkKHByKVxyXG5cdHtcclxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludCgwKTtcclxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEludCgwKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBlbWl0RGVzdChwciwgdG9rZW4sIG9wZGVzdClcclxuXHR7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ0FHQUxNaW5pQXNzZW1ibGVyJyAsICdlbWl0RGVzdCcgLCAnUmVnTWFwLm1hcCcgLCBSZWdNYXAubWFwKTtcclxuXHRcdHZhciByZWcgPSB0b2tlbi5tYXRjaCgvKFtmb3ZdP1t0cG9jaWRhdnNdKShcXGQqKShcXC5beHl6d117MSw0fSk/L2kpOyAvLyBnMTogcmVnbmFtZSwgZzI6cmVnbnVtLCBnMzptYXNrXHJcblxyXG5cdFx0Ly8gY29uc29sZS5sb2coICdBR0FMTWluaUFzc2VtYmxlcicgLCAnZW1pdERlc3QnICwgJ3JlZycgLCByZWcgLCByZWdbMV0gLCBSZWdNYXAubWFwW3JlZ1sxXV0gKTtcclxuXHRcdC8vIGNvbnNvbGUubG9nKCAnQUdBTE1pbmlBc3NlbWJsZXInICwgJ2VtaXREZXN0JyAsICdSZWdNYXAubWFwW3JlZ1sxXV0nICwgUmVnTWFwLm1hcFtyZWdbMV1dICwgJ2Jvb2wnICwgIVJlZ01hcC5tYXBbcmVnWzFdXSApIDtcclxuXHJcblx0XHRpZiAoIVJlZ01hcC5tYXBbcmVnWzFdXSkgcmV0dXJuIGZhbHNlO1xyXG5cdFx0dmFyIGVtID0geyBudW06cmVnWzJdPyByZWdbMl0gOiAwLCBjb2RlOlJlZ01hcC5tYXBbcmVnWzFdXS5jb2RlLCBtYXNrOnRoaXMuc3RyaW5nVG9NYXNrKHJlZ1szXSkgfTtcclxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZFNob3J0KGVtLm51bSk7XHJcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKGVtLm1hc2spO1xyXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5jb2RlKTtcclxuXHRcdC8vY29uc29sZS5sb2cgKCBcIiAgRW1pdCBkZXN0OiBcIiwgZW0gKTtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0cmluZ1RvTWFzayhzOnN0cmluZyk6bnVtYmVyXHJcblx0e1xyXG5cdFx0aWYgKCFzKSByZXR1cm4gMHhmO1xyXG5cdFx0dmFyIHIgPSAwO1xyXG5cdFx0aWYgKHMuaW5kZXhPZihcInhcIikgIT0gLTEpIHIgfD0gMTtcclxuXHRcdGlmIChzLmluZGV4T2YoXCJ5XCIpICE9IC0xKSByIHw9IDI7XHJcblx0XHRpZiAocy5pbmRleE9mKFwielwiKSAhPSAtMSkgciB8PSA0O1xyXG5cdFx0aWYgKHMuaW5kZXhPZihcIndcIikgIT0gLTEpIHIgfD0gODtcclxuXHRcdHJldHVybiByO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0cmluZ1RvU3dpenpsZShzKVxyXG5cdHtcclxuXHRcdGlmICghcykge1xyXG5cdFx0XHRyZXR1cm4gMHhlNDtcclxuXHRcdH1cclxuXHRcdHZhciBjaGFydG9pbmRleCA9IHsgeDowLCB5OjEsIHo6MiwgdzozIH07XHJcblx0XHR2YXIgc3cgPSAwO1xyXG5cclxuXHRcdGlmIChzLmNoYXJBdCgwKSAhPSBcIi5cIikge1xyXG5cdFx0XHR0aHJvdyBcIk1pc3NpbmcgLiBmb3Igc3dpenpsZVwiO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChzLmxlbmd0aCA+IDEpIHtcclxuXHRcdFx0c3cgfD0gY2hhcnRvaW5kZXhbcy5jaGFyQXQoMSldO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChzLmxlbmd0aCA+IDIpIHtcclxuXHRcdFx0c3cgfD0gY2hhcnRvaW5kZXhbcy5jaGFyQXQoMildIDw8IDI7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRzdyB8PSAoc3cgJiAzKSA8PCAyO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChzLmxlbmd0aCA+IDMpIHtcclxuXHRcdFx0c3cgfD0gY2hhcnRvaW5kZXhbcy5jaGFyQXQoMyldIDw8IDQ7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRzdyB8PSAoc3cgJiAoMyA8PCAyKSkgPDwgMjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocy5sZW5ndGggPiA0KSB7XHJcblx0XHRcdHN3IHw9IGNoYXJ0b2luZGV4W3MuY2hhckF0KDQpXSA8PCA2O1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0c3cgfD0gKHN3ICYgKDMgPDwgNCkpIDw8IDI7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHN3O1xyXG5cdH1cclxuXHJcblx0cHVibGljIGVtaXRTYW1wbGVyKHByOlBhcnQsIHRva2VuLCBvcHNyYywgb3B0cylcclxuXHR7XHJcblx0XHR2YXIgcmVnOnN0cmluZ1tdID0gdG9rZW4ubWF0Y2goL2ZzKFxcZCopL2kpOyAvLyBnMTpyZWdudW1cclxuXHRcdGlmICghcmVnIHx8ICFyZWdbMV0pIHtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQocGFyc2VJbnQocmVnWzFdKSk7XHJcblx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDApOyAgIC8vIGJpYXNcclxuXHRcdHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUoMCk7XHJcblx0XHQvKlxyXG5cdFx0IHByLmRhdGEud3JpdGVVbnNpZ25lZEJ5dGUgKCAweDUgKTtcclxuXHRcdCBwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlICggMCApOyAgIC8vIHJlYWRtb2RlLCBkaW1cclxuXHRcdCBwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlICggMCApOyAgIC8vIHNwZWNpYWwsIHdyYXBcclxuXHRcdCBwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlICggMCApOyAgIC8vIG1pcCwgZmlsdGVyXHJcblx0XHQgKi9cclxuXHRcdHZhciBzYW1wbGVyYml0czpudW1iZXIgPSAweDU7XHJcblx0XHR2YXIgc2FtcGxlcm9wdHNldDpudW1iZXIgPSAwO1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgb3B0cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgbzpTYW1wbGVyID0gPFNhbXBsZXI+IFNhbXBsZXJNYXAubWFwWyBvcHRzW2ldLnRvTG93ZXJDYXNlKCkgXTtcclxuXHJcblx0XHRcdC8vY29uc29sZS5sb2coICdBR0FMTWluaUFzc2VtYmxlcicgLCAnZW1pdFNhbXBsZXInICwgJ1NhbXBsZU1hcCBvcHQ6JyAsIG8gLCAnPC0tLS0tLS0tIFdBVENIIEZPUiBUSElTJyk7XHJcblxyXG5cdFx0XHRpZiAobykge1xyXG5cdFx0XHRcdGlmICgoKHNhbXBsZXJvcHRzZXQgPj4gby5zaGlmdCkgJiBvLm1hc2spICE9IDApIHtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiV2FybmluZywgZHVwbGljYXRlIHNhbXBsZXIgb3B0aW9uXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRzYW1wbGVyb3B0c2V0IHw9IG8ubWFzayA8PCBvLnNoaWZ0O1xyXG5cdFx0XHRcdHNhbXBsZXJiaXRzICY9IH4oby5tYXNrIDw8IG8uc2hpZnQpO1xyXG5cdFx0XHRcdHNhbXBsZXJiaXRzIHw9IG8udmFsdWUgPDwgby5zaGlmdDtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhcIldhcm5pbmcsIHVua25vd24gc2FtcGxlciBvcHRpb246IFwiLCBvcHRzW2ldKTtcclxuXHRcdFx0XHQvLyB0b2RvIGJpYXNcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkSW50KHNhbXBsZXJiaXRzKTtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGVtaXRTb3VyY2UocHIsIHRva2VuLCBvcHNyYylcclxuXHR7XHJcblx0XHR2YXIgaW5kZXhlZCA9IHRva2VuLm1hdGNoKC92Y1xcWyh2W3RjYWldKShcXGQrKVxcLihbeHl6d10pKFtcXCtcXC1dXFxkKyk/XFxdKFxcLlt4eXp3XXsxLDR9KT8vaSk7IC8vIGcxOiBpbmRleHJlZ25hbWUsIGcyOmluZGV4cmVnbnVtLCBnMzpzZWxlY3QsIFtnNDpvZmZzZXRdLCBbZzU6c3dpenpsZV1cclxuXHRcdHZhciByZWc7XHJcblx0XHRpZiAoaW5kZXhlZCkge1xyXG5cdFx0XHRpZiAoIVJlZ01hcC5tYXBbaW5kZXhlZFsxXV0pIHtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIHNlbGluZGV4ID0geyB4OjAsIHk6MSwgejoyLCB3OjMgfTtcclxuXHRcdFx0dmFyIGVtOmFueSA9IHsgbnVtOmluZGV4ZWRbMl0gfCAwLCBjb2RlOlJlZ01hcC5tYXBbaW5kZXhlZFsxXV0uY29kZSwgc3dpenpsZTp0aGlzLnN0cmluZ1RvU3dpenpsZShpbmRleGVkWzVdKSwgc2VsZWN0OnNlbGluZGV4W2luZGV4ZWRbM11dLCBvZmZzZXQ6aW5kZXhlZFs0XSB8IDAgfTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQoZW0ubnVtKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZUJ5dGUoZW0ub2Zmc2V0KTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5zd2l6emxlKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgweDEpOyAvLyBjb25zdGFudCByZWdcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5jb2RlKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5zZWxlY3QpO1xyXG5cdFx0XHRwci5kYXRhLndyaXRlVW5zaWduZWRCeXRlKDEgPDwgNyk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZWcgPSB0b2tlbi5tYXRjaCgvKFtmb3ZdP1t0cG9jaWRhdnNdKShcXGQqKShcXC5beHl6d117MSw0fSk/L2kpOyAvLyBnMTogcmVnbmFtZSwgZzI6cmVnbnVtLCBnMzpzd2l6emxlXHJcblx0XHRcdGlmICghUmVnTWFwLm1hcFtyZWdbMV1dKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBlbTphbnkgPSB7IG51bTpyZWdbMl0gfCAwLCBjb2RlOlJlZ01hcC5tYXBbcmVnWzFdXS5jb2RlLCBzd2l6emxlOnRoaXMuc3RyaW5nVG9Td2l6emxlKHJlZ1szXSkgfTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkU2hvcnQoZW0ubnVtKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5zd2l6emxlKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZShlbS5jb2RlKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcclxuXHRcdFx0cHIuZGF0YS53cml0ZVVuc2lnbmVkQnl0ZSgwKTtcclxuXHRcdFx0Ly9jb25zb2xlLmxvZyAoIFwiICBFbWl0IHNvdXJjZTogXCIsIGVtLCBwci5kYXRhLmxlbmd0aCApO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgYWRkSGVhZGVyKHBhcnRuYW1lLCB2ZXJzaW9uKVxyXG5cdHtcclxuXHRcdGlmICghdmVyc2lvbikge1xyXG5cdFx0XHR2ZXJzaW9uID0gMTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLnJbcGFydG5hbWVdID09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLnJbcGFydG5hbWVdID0gbmV3IFBhcnQocGFydG5hbWUsIHZlcnNpb24pO1xyXG5cdFx0XHR0aGlzLmVtaXRIZWFkZXIodGhpcy5yWyBwYXJ0bmFtZSBdKTtcclxuXHRcdH0gZWxzZSBpZiAodGhpcy5yW3BhcnRuYW1lXS52ZXJzaW9uICE9IHZlcnNpb24pIHtcclxuXHRcdFx0dGhyb3cgXCJNdWx0aXBsZSB2ZXJzaW9ucyBmb3IgcGFydCBcIiArIHBhcnRuYW1lO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5jdXIgPSB0aGlzLnJbcGFydG5hbWVdO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gQUdBTE1pbmlBc3NlbWJsZXI7Il19
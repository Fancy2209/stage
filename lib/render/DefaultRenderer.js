var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var RenderablePool = require("awayjs-display/lib/pool/RenderablePool");
var SkyboxRenderable = require("awayjs-stagegl/lib/pool/SkyboxRenderable");
var DepthRenderer = require("awayjs-stagegl/lib/render/DepthRenderer");
var Filter3DRenderer = require("awayjs-stagegl/lib/render/Filter3DRenderer");
var RendererBase = require("awayjs-stagegl/lib/render/RendererBase");
var ContextGLBlendFactor = require("awayjs-stagegl/lib/base/ContextGLBlendFactor");
var ContextGLCompareMode = require("awayjs-stagegl/lib/base/ContextGLCompareMode");
var ContextGLClearMask = require("awayjs-stagegl/lib/base/ContextGLClearMask");
var RTTBufferManager = require("awayjs-stagegl/lib/managers/RTTBufferManager");
var StageManager = require("awayjs-stagegl/lib/managers/StageManager");
var DepthMapPass = require("awayjs-stagegl/lib/materials/passes/DepthMapPass");
var DistanceMapPass = require("awayjs-stagegl/lib/materials/passes/DistanceMapPass");
/**
 * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the
 * materials assigned to them.
 *
 * @class away.render.DefaultRenderer
 */
var DefaultRenderer = (function (_super) {
    __extends(DefaultRenderer, _super);
    /**
     * Creates a new DefaultRenderer object.
     *
     * @param antiAlias The amount of anti-aliasing to use.
     * @param renderMode The render mode to use.
     */
    function DefaultRenderer(forceSoftware, profile, mode) {
        if (forceSoftware === void 0) { forceSoftware = false; }
        if (profile === void 0) { profile = "baseline"; }
        if (mode === void 0) { mode = "auto"; }
        _super.call(this);
        this._skyboxProjection = new Matrix3D();
        this._skyboxRenderablePool = RenderablePool.getPool(SkyboxRenderable);
        this._pDepthRenderer = new DepthRenderer(new DepthMapPass());
        this._pDistanceRenderer = new DepthRenderer(new DistanceMapPass());
        if (this._pStage == null)
            this.stage = StageManager.getInstance().getFreeStage(forceSoftware, profile, mode);
        this._pRttBufferManager = RTTBufferManager.getInstance(this._pStage);
        if (this._width == 0)
            this.width = window.innerWidth;
        else
            this._pRttBufferManager.viewWidth = this._width;
        if (this._height == 0)
            this.height = window.innerHeight;
        else
            this._pRttBufferManager.viewHeight = this._height;
    }
    Object.defineProperty(DefaultRenderer.prototype, "antiAlias", {
        get: function () {
            return this._antiAlias;
        },
        set: function (value) {
            if (this._antiAlias == value)
                return;
            this._antiAlias = value;
            this._pBackBufferInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DefaultRenderer.prototype, "depthPrepass", {
        /**
         *
         */
        get: function () {
            return this._depthPrepass;
        },
        set: function (value) {
            this._depthPrepass = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DefaultRenderer.prototype, "filters3d", {
        /**
         *
         * @returns {*}
         */
        get: function () {
            return this._pFilter3DRenderer ? this._pFilter3DRenderer.filters : null;
        },
        set: function (value) {
            if (value && value.length == 0)
                value = null;
            if (this._pFilter3DRenderer && !value) {
                this._pFilter3DRenderer.dispose();
                this._pFilter3DRenderer = null;
            }
            else if (!this._pFilter3DRenderer && value) {
                this._pFilter3DRenderer = new Filter3DRenderer(this._pStage);
                this._pFilter3DRenderer.filters = value;
            }
            if (this._pFilter3DRenderer) {
                this._pFilter3DRenderer.filters = value;
                this._pRequireDepthRender = this._pFilter3DRenderer.requireDepthRender;
            }
            else {
                this._pRequireDepthRender = false;
                if (this._pDepthRender) {
                    this._pDepthRender.dispose();
                    this._pDepthRender = null;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    DefaultRenderer.prototype.render = function (entityCollector) {
        _super.prototype.render.call(this, entityCollector);
        if (!this._pStage.recoverFromDisposal()) {
            this._pBackBufferInvalid = true;
            return;
        }
        if (this._pBackBufferInvalid)
            this.pUpdateBackBuffer();
        if (this._shareContext && this._pContext)
            this._pContext.clear(0, 0, 0, 1, 1, 0, ContextGLClearMask.DEPTH);
        if (this._pFilter3DRenderer) {
            this.textureRatioX = this._pRttBufferManager.textureRatioX;
            this.textureRatioY = this._pRttBufferManager.textureRatioY;
        }
        else {
            this.textureRatioX = 1;
            this.textureRatioY = 1;
        }
        if (this._pRequireDepthRender)
            this.pRenderSceneDepthToTexture(entityCollector);
        if (this._depthPrepass)
            this.pRenderDepthPrepass(entityCollector);
        if (this._pFilter3DRenderer && this._pContext) {
        }
        else {
            if (this._shareContext)
                this._iRender(entityCollector, null, this._pScissorRect);
            else
                this._iRender(entityCollector);
        }
        _super.prototype.render.call(this, entityCollector);
        if (!this._shareContext && this._pContext)
            this._pContext.present();
        // register that a view has been rendered
        this._pStage.bufferClear = false;
    };
    DefaultRenderer.prototype.pExecuteRender = function (entityCollector, target, scissorRect, surfaceSelector) {
        if (target === void 0) { target = null; }
        if (scissorRect === void 0) { scissorRect = null; }
        if (surfaceSelector === void 0) { surfaceSelector = 0; }
        this.updateLights(entityCollector);
        // otherwise RTT will interfere with other RTTs
        if (target) {
            this.pCollectRenderables(entityCollector);
            this.drawRenderables(this._pOpaqueRenderableHead, entityCollector);
            this.drawRenderables(this._pBlendedRenderableHead, entityCollector);
        }
        _super.prototype.pExecuteRender.call(this, entityCollector, target, scissorRect, surfaceSelector);
    };
    DefaultRenderer.prototype.updateLights = function (entityCollector) {
        var dirLights = entityCollector.directionalLights;
        var pointLights = entityCollector.pointLights;
        var len, i;
        var light;
        var shadowMapper;
        len = dirLights.length;
        for (i = 0; i < len; ++i) {
            light = dirLights[i];
            shadowMapper = light.shadowMapper;
            if (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))
                shadowMapper.iRenderDepthMap(entityCollector, this._pDepthRenderer);
        }
        len = pointLights.length;
        for (i = 0; i < len; ++i) {
            light = pointLights[i];
            shadowMapper = light.shadowMapper;
            if (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))
                shadowMapper.iRenderDepthMap(entityCollector, this._pDistanceRenderer);
        }
    };
    /**
     * @inheritDoc
     */
    DefaultRenderer.prototype.pDraw = function (entityCollector, target) {
        if (!target)
            this.pCollectRenderables(entityCollector);
        this._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);
        if (entityCollector.skyBox) {
            this._pContext.setDepthTest(false, ContextGLCompareMode.ALWAYS);
            this.drawSkybox(entityCollector);
        }
        this._pContext.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);
        this.drawRenderables(this._pOpaqueRenderableHead, entityCollector);
        this.drawRenderables(this._pBlendedRenderableHead, entityCollector);
    };
    /**
     * Draw the skybox if present.
     *
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    DefaultRenderer.prototype.drawSkybox = function (entityCollector) {
        var skyBox = this._skyboxRenderablePool.getItem(entityCollector.skyBox);
        var material = entityCollector.skyBox.material;
        var camera = entityCollector.camera;
        this.updateSkyboxProjection(camera);
        var activePass = this._pStage.context.getMaterial(material, this._pStage.profile).getMaterialPass(material._iScreenPasses[0], this._pStage.profile);
        material._iActivatePass(activePass, this._pStage, camera);
        material._iRenderPass(activePass, skyBox, this._pStage, camera, this._skyboxProjection);
        material._iDeactivatePass(activePass, this._pStage);
    };
    DefaultRenderer.prototype.updateSkyboxProjection = function (camera) {
        var near = new Vector3D();
        this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);
        this._skyboxProjection.copyRowTo(2, near);
        var camPos = camera.scenePosition;
        var cx = near.x;
        var cy = near.y;
        var cz = near.z;
        var cw = -(near.x * camPos.x + near.y * camPos.y + near.z * camPos.z + Math.sqrt(cx * cx + cy * cy + cz * cz));
        var signX = cx >= 0 ? 1 : -1;
        var signY = cy >= 0 ? 1 : -1;
        var p = new Vector3D(signX, signY, 1, 1);
        var inverse = this._skyboxProjection.clone();
        inverse.invert();
        var q = inverse.transformVector(p);
        this._skyboxProjection.copyRowTo(3, p);
        var a = (q.x * p.x + q.y * p.y + q.z * p.z + q.w * p.w) / (cx * q.x + cy * q.y + cz * q.z + cw * q.w);
        this._skyboxProjection.copyRowFrom(2, new Vector3D(cx * a, cy * a, cz * a, cw * a));
    };
    /**
     * Draw a list of renderables.
     *
     * @param renderables The renderables to draw.
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    DefaultRenderer.prototype.drawRenderables = function (renderable, entityCollector) {
        var i;
        var len;
        var passes;
        var activePass;
        var activeMaterial;
        var context = this._pStage.context;
        var camera = entityCollector.camera;
        var renderable2;
        while (renderable) {
            activeMaterial = context.getMaterial(renderable.material, this._pStage.profile);
            //iterate through each screen pass
            passes = renderable.material._iScreenPasses;
            len = renderable.material._iNumScreenPasses();
            for (i = 0; i < len; i++) {
                renderable2 = renderable;
                activePass = activeMaterial.getMaterialPass(passes[i], this._pStage.profile);
                renderable.material._iActivatePass(activePass, this._pStage, camera);
                do {
                    renderable.material._iRenderPass(activePass, renderable2, this._pStage, camera, this._pRttViewProjectionMatrix);
                    renderable2 = renderable2.next;
                } while (renderable2 && renderable2.material == renderable.material);
                activeMaterial.material._iDeactivatePass(activePass, this._pStage);
            }
            renderable = renderable2;
        }
    };
    DefaultRenderer.prototype.dispose = function () {
        if (!this._shareContext)
            this._pStage.dispose();
        this._pDepthRenderer.dispose();
        this._pDistanceRenderer.dispose();
        this._pDepthRenderer = null;
        this._pDistanceRenderer = null;
        this._pDepthRender = null;
        _super.prototype.dispose.call(this);
    };
    /**
     *
     */
    DefaultRenderer.prototype.pRenderDepthPrepass = function (entityCollector) {
        this._pDepthRenderer.disableColor = true;
        if (this._pFilter3DRenderer) {
        }
        else {
            this._pDepthRenderer.textureRatioX = 1;
            this._pDepthRenderer.textureRatioY = 1;
            this._pDepthRenderer._iRender(entityCollector);
        }
        this._pDepthRenderer.disableColor = false;
    };
    /**
     *
     */
    DefaultRenderer.prototype.pRenderSceneDepthToTexture = function (entityCollector) {
        if (this._pDepthTextureInvalid || !this._pDepthRender)
            this.initDepthTexture(this._pStage.context);
        this._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;
        this._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;
        this._pDepthRenderer._iRender(entityCollector, this._pDepthRender);
    };
    /**
     * Updates the backbuffer dimensions.
     */
    DefaultRenderer.prototype.pUpdateBackBuffer = function () {
        // No reason trying to configure back buffer if there is no context available.
        // Doing this anyway (and relying on _stage to cache width/height for
        // context does get available) means usesSoftwareRendering won't be reliable.
        if (this._pStage.context && !this._shareContext) {
            if (this._width && this._height) {
                this._pStage.configureBackBuffer(this._width, this._height, this._antiAlias, true);
                this._pBackBufferInvalid = false;
            }
        }
    };
    DefaultRenderer.prototype.iSetStage = function (value) {
        _super.prototype.iSetStage.call(this, value);
        this._pDistanceRenderer.iSetStage(value);
        this._pDepthRenderer.iSetStage(value);
    };
    /**
     *
     */
    DefaultRenderer.prototype.initDepthTexture = function (context) {
        this._pDepthTextureInvalid = false;
        if (this._pDepthRender)
            this._pDepthRender.dispose();
        this._pDepthRender = new RenderTexture(this._pRttBufferManager.textureWidth, this._pRttBufferManager.textureHeight);
    };
    return DefaultRenderer;
})(RendererBase);
module.exports = DefaultRenderer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9yZW5kZXIvZGVmYXVsdHJlbmRlcmVyLnRzIl0sIm5hbWVzIjpbIkRlZmF1bHRSZW5kZXJlciIsIkRlZmF1bHRSZW5kZXJlci5jb25zdHJ1Y3RvciIsIkRlZmF1bHRSZW5kZXJlci5hbnRpQWxpYXMiLCJEZWZhdWx0UmVuZGVyZXIuZGVwdGhQcmVwYXNzIiwiRGVmYXVsdFJlbmRlcmVyLmZpbHRlcnMzZCIsIkRlZmF1bHRSZW5kZXJlci5yZW5kZXIiLCJEZWZhdWx0UmVuZGVyZXIucEV4ZWN1dGVSZW5kZXIiLCJEZWZhdWx0UmVuZGVyZXIudXBkYXRlTGlnaHRzIiwiRGVmYXVsdFJlbmRlcmVyLnBEcmF3IiwiRGVmYXVsdFJlbmRlcmVyLmRyYXdTa3lib3giLCJEZWZhdWx0UmVuZGVyZXIudXBkYXRlU2t5Ym94UHJvamVjdGlvbiIsIkRlZmF1bHRSZW5kZXJlci5kcmF3UmVuZGVyYWJsZXMiLCJEZWZhdWx0UmVuZGVyZXIuZGlzcG9zZSIsIkRlZmF1bHRSZW5kZXJlci5wUmVuZGVyRGVwdGhQcmVwYXNzIiwiRGVmYXVsdFJlbmRlcmVyLnBSZW5kZXJTY2VuZURlcHRoVG9UZXh0dXJlIiwiRGVmYXVsdFJlbmRlcmVyLnBVcGRhdGVCYWNrQnVmZmVyIiwiRGVmYXVsdFJlbmRlcmVyLmlTZXRTdGFnZSIsIkRlZmF1bHRSZW5kZXJlci5pbml0RGVwdGhUZXh0dXJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUVoRSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUNoRSxJQUFPLGFBQWEsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBSTVFLElBQU8sY0FBYyxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFlN0UsSUFBTyxnQkFBZ0IsV0FBYywwQ0FBMEMsQ0FBQyxDQUFDO0FBQ2pGLElBQU8sYUFBYSxXQUFjLHlDQUF5QyxDQUFDLENBQUM7QUFDN0UsSUFB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QUFJQSxDQUFDQSxHQUFZQSxJQUFJQSxRQUFRQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVsREEsSUFBSUEsT0FBT0EsR0FBWUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUN0REEsT0FBT0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFFakJBLElBQUlBLENBQUNBLEdBQVlBLE9BQU9BLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRTVDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRXZDQSxJQUFJQSxDQUFDQSxHQUFVQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxFQUFFQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUUzRkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxRQUFRQSxDQUFDQSxFQUFFQSxHQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxHQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxHQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxD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QUFhQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtRQUU5QkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxZQUFZQSxFQUFFQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBO0lBQ3JIQSxDQUFDQTtJQUNGakIsc0JBQUNBO0FBQURBLENBeFpBLEFBd1pDQSxFQXhaNkIsWUFBWSxFQXdaekM7QUFFRCxBQUF5QixpQkFBaEIsZUFBZSxDQUFDIiwiZmlsZSI6InJlbmRlci9EZWZhdWx0UmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XG5pbXBvcnQgUmVjdGFuZ2xlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1JlY3RhbmdsZVwiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xuaW1wb3J0IFJlbmRlclRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9SZW5kZXJUZXh0dXJlXCIpO1xuaW1wb3J0IFRleHR1cmVQcm94eUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlUHJveHlCYXNlXCIpO1xuXG5pbXBvcnQgTGlnaHRCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0xpZ2h0QmFzZVwiKTtcbmltcG9ydCBSZW5kZXJhYmxlUG9vbFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvUmVuZGVyYWJsZVBvb2xcIik7XG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xuaW1wb3J0IEVudGl0eUNvbGxlY3Rvclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0VudGl0eUNvbGxlY3RvclwiKTtcbmltcG9ydCBJQ29sbGVjdG9yXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9JQ29sbGVjdG9yXCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XG5pbXBvcnQgUG9pbnRMaWdodFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvUG9pbnRMaWdodFwiKTtcbmltcG9ydCBNYXRlcmlhbEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9NYXRlcmlhbEJhc2VcIik7XG5pbXBvcnQgSU1hdGVyaWFsUGFzc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9wYXNzZXMvSU1hdGVyaWFsUGFzc1wiKTtcbmltcG9ydCBTaGFkb3dNYXBwZXJCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvU2hhZG93TWFwcGVyQmFzZVwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgTWF0ZXJpYWxEYXRhXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9wb29sL01hdGVyaWFsRGF0YVwiKTtcbmltcG9ydCBNYXRlcmlhbFBhc3NEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvcG9vbC9NYXRlcmlhbFBhc3NEYXRhXCIpO1xuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcbmltcG9ydCBTa3lib3hSZW5kZXJhYmxlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvcG9vbC9Ta3lib3hSZW5kZXJhYmxlXCIpO1xuaW1wb3J0IERlcHRoUmVuZGVyZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9yZW5kZXIvRGVwdGhSZW5kZXJlclwiKTtcbmltcG9ydCBGaWx0ZXIzRFJlbmRlcmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvcmVuZGVyL0ZpbHRlcjNEUmVuZGVyZXJcIik7XG5pbXBvcnQgUmVuZGVyZXJCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9yZW5kZXIvUmVuZGVyZXJCYXNlXCIpO1xuaW1wb3J0IENvbnRleHRHTEJsZW5kRmFjdG9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMQmxlbmRGYWN0b3JcIik7XG5pbXBvcnQgQ29udGV4dEdMQ29tcGFyZU1vZGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xDb21wYXJlTW9kZVwiKTtcbmltcG9ydCBDb250ZXh0R0xDbGVhck1hc2tcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xDbGVhck1hc2tcIik7XG5pbXBvcnQgSUNvbnRleHRTdGFnZUdMXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dFN0YWdlR0xcIik7XG5pbXBvcnQgRmlsdGVyM0RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9maWx0ZXJzL0ZpbHRlcjNEQmFzZVwiKTtcbmltcG9ydCBSVFRCdWZmZXJNYW5hZ2VyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWFuYWdlcnMvUlRUQnVmZmVyTWFuYWdlclwiKTtcbmltcG9ydCBTdGFnZU1hbmFnZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hbmFnZXJzL1N0YWdlTWFuYWdlclwiKTtcbmltcG9ydCBEZXB0aE1hcFBhc3NcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9wYXNzZXMvRGVwdGhNYXBQYXNzXCIpO1xuaW1wb3J0IERpc3RhbmNlTWFwUGFzc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9wYXNzZXMvRGlzdGFuY2VNYXBQYXNzXCIpO1xuaW1wb3J0IE1hdGVyaWFsUGFzc0Jhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9tYXRlcmlhbHMvcGFzc2VzL01hdGVyaWFsUGFzc0Jhc2VcIik7XG5cbi8qKlxuICogVGhlIERlZmF1bHRSZW5kZXJlciBjbGFzcyBwcm92aWRlcyB0aGUgZGVmYXVsdCByZW5kZXJpbmcgbWV0aG9kLiBJdCByZW5kZXJzIHRoZSBzY2VuZSBncmFwaCBvYmplY3RzIHVzaW5nIHRoZVxuICogbWF0ZXJpYWxzIGFzc2lnbmVkIHRvIHRoZW0uXG4gKlxuICogQGNsYXNzIGF3YXkucmVuZGVyLkRlZmF1bHRSZW5kZXJlclxuICovXG5jbGFzcyBEZWZhdWx0UmVuZGVyZXIgZXh0ZW5kcyBSZW5kZXJlckJhc2UgaW1wbGVtZW50cyBJUmVuZGVyZXJcbntcblx0cHVibGljIF9wUmVxdWlyZURlcHRoUmVuZGVyOmJvb2xlYW47XG5cdHByaXZhdGUgX3NreWJveFJlbmRlcmFibGVQb29sOlJlbmRlcmFibGVQb29sO1xuXG4vL1x0XHRwcml2YXRlIF9hY3RpdmVNYXRlcmlhbDpNYXRlcmlhbEJhc2U7XG5cdHByaXZhdGUgX3BEaXN0YW5jZVJlbmRlcmVyOkRlcHRoUmVuZGVyZXI7XG5cdHByaXZhdGUgX3BEZXB0aFJlbmRlcmVyOkRlcHRoUmVuZGVyZXI7XG5cdHByaXZhdGUgX3NreWJveFByb2plY3Rpb246TWF0cml4M0QgPSBuZXcgTWF0cml4M0QoKTtcblx0cHVibGljIF9wRmlsdGVyM0RSZW5kZXJlcjpGaWx0ZXIzRFJlbmRlcmVyO1xuXG5cdHB1YmxpYyBfcERlcHRoUmVuZGVyOlRleHR1cmVQcm94eUJhc2U7XG5cblx0cHJpdmF0ZSBfYW50aUFsaWFzOm51bWJlcjtcblxuXHRwdWJsaWMgZ2V0IGFudGlBbGlhcygpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2FudGlBbGlhcztcblx0fVxuXG5cdHB1YmxpYyBzZXQgYW50aUFsaWFzKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl9hbnRpQWxpYXMgPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9hbnRpQWxpYXMgPSB2YWx1ZTtcblxuXHRcdHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBnZXQgZGVwdGhQcmVwYXNzKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2RlcHRoUHJlcGFzcztcblx0fVxuXG5cdHB1YmxpYyBzZXQgZGVwdGhQcmVwYXNzKHZhbHVlOmJvb2xlYW4pXG5cdHtcblx0XHR0aGlzLl9kZXB0aFByZXBhc3MgPSB2YWx1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcmV0dXJucyB7Kn1cblx0ICovXG5cdHB1YmxpYyBnZXQgZmlsdGVyczNkKCk6QXJyYXk8RmlsdGVyM0RCYXNlPlxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyPyB0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5maWx0ZXJzIDogbnVsbDtcblx0fVxuXHRwdWJsaWMgc2V0IGZpbHRlcnMzZCh2YWx1ZTpBcnJheTxGaWx0ZXIzREJhc2U+KVxuXHR7XG5cdFx0aWYgKHZhbHVlICYmIHZhbHVlLmxlbmd0aCA9PSAwKVxuXHRcdFx0dmFsdWUgPSBudWxsO1xuXG5cdFx0aWYgKHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyICYmICF2YWx1ZSkge1xuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIuZGlzcG9zZSgpO1xuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIgPSBudWxsO1xuXHRcdH0gZWxzZSBpZiAoIXRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyICYmIHZhbHVlKSB7XG5cdFx0XHR0aGlzLl9wRmlsdGVyM0RSZW5kZXJlciA9IG5ldyBGaWx0ZXIzRFJlbmRlcmVyKHRoaXMuX3BTdGFnZSk7XG5cdFx0XHR0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5maWx0ZXJzID0gdmFsdWU7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyKSB7XG5cdFx0XHR0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5maWx0ZXJzID0gdmFsdWU7XG5cdFx0XHR0aGlzLl9wUmVxdWlyZURlcHRoUmVuZGVyID0gdGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIucmVxdWlyZURlcHRoUmVuZGVyO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl9wUmVxdWlyZURlcHRoUmVuZGVyID0gZmFsc2U7XG5cblx0XHRcdGlmICh0aGlzLl9wRGVwdGhSZW5kZXIpIHtcblx0XHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyLmRpc3Bvc2UoKTtcblx0XHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBEZWZhdWx0UmVuZGVyZXIgb2JqZWN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gYW50aUFsaWFzIFRoZSBhbW91bnQgb2YgYW50aS1hbGlhc2luZyB0byB1c2UuXG5cdCAqIEBwYXJhbSByZW5kZXJNb2RlIFRoZSByZW5kZXIgbW9kZSB0byB1c2UuXG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcihmb3JjZVNvZnR3YXJlOmJvb2xlYW4gPSBmYWxzZSwgcHJvZmlsZTpzdHJpbmcgPSBcImJhc2VsaW5lXCIsIG1vZGUgPSBcImF1dG9cIilcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHR0aGlzLl9za3lib3hSZW5kZXJhYmxlUG9vbCA9IFJlbmRlcmFibGVQb29sLmdldFBvb2woU2t5Ym94UmVuZGVyYWJsZSk7XG5cblx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlciA9IG5ldyBEZXB0aFJlbmRlcmVyKG5ldyBEZXB0aE1hcFBhc3MoKSk7XG5cdFx0dGhpcy5fcERpc3RhbmNlUmVuZGVyZXIgPSBuZXcgRGVwdGhSZW5kZXJlcihuZXcgRGlzdGFuY2VNYXBQYXNzKCkpO1xuXG5cdFx0aWYgKHRoaXMuX3BTdGFnZSA9PSBudWxsKVxuXHRcdFx0dGhpcy5zdGFnZSA9IFN0YWdlTWFuYWdlci5nZXRJbnN0YW5jZSgpLmdldEZyZWVTdGFnZShmb3JjZVNvZnR3YXJlLCBwcm9maWxlLCBtb2RlKTtcblxuXHRcdHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyID0gUlRUQnVmZmVyTWFuYWdlci5nZXRJbnN0YW5jZSh0aGlzLl9wU3RhZ2UpO1xuXG5cdFx0aWYgKHRoaXMuX3dpZHRoID09IDApXG5cdFx0XHR0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5cdFx0ZWxzZVxuXHRcdFx0dGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudmlld1dpZHRoID0gdGhpcy5fd2lkdGg7XG5cblx0XHRpZiAodGhpcy5faGVpZ2h0ID09IDApXG5cdFx0XHR0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblx0XHRlbHNlXG5cdFx0XHR0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci52aWV3SGVpZ2h0ID0gdGhpcy5faGVpZ2h0O1xuXHR9XG5cblx0cHVibGljIHJlbmRlcihlbnRpdHlDb2xsZWN0b3I6SUNvbGxlY3Rvcilcblx0e1xuXHRcdHN1cGVyLnJlbmRlcihlbnRpdHlDb2xsZWN0b3IpO1xuXG5cdFx0aWYgKCF0aGlzLl9wU3RhZ2UucmVjb3ZlckZyb21EaXNwb3NhbCgpKSB7Ly9pZiBjb250ZXh0IGhhcyBEaXNwb3NlZCBieSB0aGUgT1MsZG9uJ3QgcmVuZGVyIGF0IHRoaXMgZnJhbWVcblx0XHRcdHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCA9IHRydWU7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCkvLyByZXNldCBvciB1cGRhdGUgcmVuZGVyIHNldHRpbmdzXG5cdFx0XHR0aGlzLnBVcGRhdGVCYWNrQnVmZmVyKCk7XG5cblx0XHRpZiAodGhpcy5fc2hhcmVDb250ZXh0ICYmIHRoaXMuX3BDb250ZXh0KVxuXHRcdFx0dGhpcy5fcENvbnRleHQuY2xlYXIoMCwgMCwgMCwgMSwgMSwgMCwgQ29udGV4dEdMQ2xlYXJNYXNrLkRFUFRIKTtcblxuXHRcdGlmICh0aGlzLl9wRmlsdGVyM0RSZW5kZXJlcikge1xuXHRcdFx0dGhpcy50ZXh0dXJlUmF0aW9YID0gdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWDtcblx0XHRcdHRoaXMudGV4dHVyZVJhdGlvWSA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1k7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMudGV4dHVyZVJhdGlvWCA9IDE7XG5cdFx0XHR0aGlzLnRleHR1cmVSYXRpb1kgPSAxO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLl9wUmVxdWlyZURlcHRoUmVuZGVyKVxuXHRcdFx0dGhpcy5wUmVuZGVyU2NlbmVEZXB0aFRvVGV4dHVyZSg8RW50aXR5Q29sbGVjdG9yPiBlbnRpdHlDb2xsZWN0b3IpO1xuXG5cdFx0aWYgKHRoaXMuX2RlcHRoUHJlcGFzcylcblx0XHRcdHRoaXMucFJlbmRlckRlcHRoUHJlcGFzcyg8RW50aXR5Q29sbGVjdG9yPiBlbnRpdHlDb2xsZWN0b3IpO1xuXG5cdFx0aWYgKHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyICYmIHRoaXMuX3BDb250ZXh0KSB7IC8vVE9ET1xuXHRcdFx0Ly90aGlzLl9pUmVuZGVyKGVudGl0eUNvbGxlY3RvciwgdGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIuZ2V0TWFpbklucHV0VGV4dHVyZSh0aGlzLl9wU3RhZ2UpLCB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci5yZW5kZXJUb1RleHR1cmVSZWN0KTtcblx0XHRcdC8vdGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIucmVuZGVyKHRoaXMuX3BTdGFnZSwgZW50aXR5Q29sbGVjdG9yLmNhbWVyYSwgdGhpcy5fcERlcHRoUmVuZGVyKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmICh0aGlzLl9zaGFyZUNvbnRleHQpXG5cdFx0XHRcdHRoaXMuX2lSZW5kZXIoZW50aXR5Q29sbGVjdG9yLCBudWxsLCB0aGlzLl9wU2Npc3NvclJlY3QpO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHR0aGlzLl9pUmVuZGVyKGVudGl0eUNvbGxlY3Rvcik7XG5cdFx0fVxuXG5cdFx0c3VwZXIucmVuZGVyKGVudGl0eUNvbGxlY3Rvcik7XG5cblx0XHRpZiAoIXRoaXMuX3NoYXJlQ29udGV4dCAmJiB0aGlzLl9wQ29udGV4dClcblx0XHRcdHRoaXMuX3BDb250ZXh0LnByZXNlbnQoKTtcblxuXHRcdC8vIHJlZ2lzdGVyIHRoYXQgYSB2aWV3IGhhcyBiZWVuIHJlbmRlcmVkXG5cdFx0dGhpcy5fcFN0YWdlLmJ1ZmZlckNsZWFyID0gZmFsc2U7XG5cdH1cblxuXHRwdWJsaWMgcEV4ZWN1dGVSZW5kZXIoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvciwgdGFyZ2V0OlRleHR1cmVQcm94eUJhc2UgPSBudWxsLCBzY2lzc29yUmVjdDpSZWN0YW5nbGUgPSBudWxsLCBzdXJmYWNlU2VsZWN0b3I6bnVtYmVyID0gMClcblx0e1xuXHRcdHRoaXMudXBkYXRlTGlnaHRzKGVudGl0eUNvbGxlY3Rvcik7XG5cblx0XHQvLyBvdGhlcndpc2UgUlRUIHdpbGwgaW50ZXJmZXJlIHdpdGggb3RoZXIgUlRUc1xuXHRcdGlmICh0YXJnZXQpIHtcblx0XHRcdHRoaXMucENvbGxlY3RSZW5kZXJhYmxlcyhlbnRpdHlDb2xsZWN0b3IpO1xuXG5cdFx0XHR0aGlzLmRyYXdSZW5kZXJhYmxlcyh0aGlzLl9wT3BhcXVlUmVuZGVyYWJsZUhlYWQsIGVudGl0eUNvbGxlY3Rvcik7XG5cdFx0XHR0aGlzLmRyYXdSZW5kZXJhYmxlcyh0aGlzLl9wQmxlbmRlZFJlbmRlcmFibGVIZWFkLCBlbnRpdHlDb2xsZWN0b3IpO1xuXHRcdH1cblxuXHRcdHN1cGVyLnBFeGVjdXRlUmVuZGVyKGVudGl0eUNvbGxlY3RvciwgdGFyZ2V0LCBzY2lzc29yUmVjdCwgc3VyZmFjZVNlbGVjdG9yKTtcblx0fVxuXG5cdHByaXZhdGUgdXBkYXRlTGlnaHRzKGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IpXG5cdHtcblx0XHR2YXIgZGlyTGlnaHRzOkFycmF5PERpcmVjdGlvbmFsTGlnaHQ+ID0gZW50aXR5Q29sbGVjdG9yLmRpcmVjdGlvbmFsTGlnaHRzO1xuXHRcdHZhciBwb2ludExpZ2h0czpBcnJheTxQb2ludExpZ2h0PiA9IGVudGl0eUNvbGxlY3Rvci5wb2ludExpZ2h0cztcblx0XHR2YXIgbGVuOm51bWJlciwgaTpudW1iZXI7XG5cdFx0dmFyIGxpZ2h0OkxpZ2h0QmFzZTtcblx0XHR2YXIgc2hhZG93TWFwcGVyOlNoYWRvd01hcHBlckJhc2U7XG5cblx0XHRsZW4gPSBkaXJMaWdodHMubGVuZ3RoO1xuXHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0bGlnaHQgPSBkaXJMaWdodHNbaV07XG5cblx0XHRcdHNoYWRvd01hcHBlciA9IGxpZ2h0LnNoYWRvd01hcHBlcjtcblxuXHRcdFx0aWYgKGxpZ2h0LmNhc3RzU2hhZG93cyAmJiAoc2hhZG93TWFwcGVyLmF1dG9VcGRhdGVTaGFkb3dzIHx8IHNoYWRvd01hcHBlci5faVNoYWRvd3NJbnZhbGlkICkpXG5cdFx0XHRcdHNoYWRvd01hcHBlci5pUmVuZGVyRGVwdGhNYXAoZW50aXR5Q29sbGVjdG9yLCB0aGlzLl9wRGVwdGhSZW5kZXJlcik7XG5cdFx0fVxuXG5cdFx0bGVuID0gcG9pbnRMaWdodHMubGVuZ3RoO1xuXHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0bGlnaHQgPSBwb2ludExpZ2h0c1tpXTtcblxuXHRcdFx0c2hhZG93TWFwcGVyID0gbGlnaHQuc2hhZG93TWFwcGVyO1xuXG5cdFx0XHRpZiAobGlnaHQuY2FzdHNTaGFkb3dzICYmIChzaGFkb3dNYXBwZXIuYXV0b1VwZGF0ZVNoYWRvd3MgfHwgc2hhZG93TWFwcGVyLl9pU2hhZG93c0ludmFsaWQpKVxuXHRcdFx0XHRzaGFkb3dNYXBwZXIuaVJlbmRlckRlcHRoTWFwKGVudGl0eUNvbGxlY3RvciwgdGhpcy5fcERpc3RhbmNlUmVuZGVyZXIpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIHBEcmF3KGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IsIHRhcmdldDpUZXh0dXJlUHJveHlCYXNlKVxuXHR7XG5cdFx0aWYgKCF0YXJnZXQpXG5cdFx0XHR0aGlzLnBDb2xsZWN0UmVuZGVyYWJsZXMoZW50aXR5Q29sbGVjdG9yKTtcblxuXHRcdHRoaXMuX3BDb250ZXh0LnNldEJsZW5kRmFjdG9ycyhDb250ZXh0R0xCbGVuZEZhY3Rvci5PTkUsIENvbnRleHRHTEJsZW5kRmFjdG9yLlpFUk8pO1xuXG5cdFx0aWYgKGVudGl0eUNvbGxlY3Rvci5za3lCb3gpIHtcblx0XHRcdHRoaXMuX3BDb250ZXh0LnNldERlcHRoVGVzdChmYWxzZSwgQ29udGV4dEdMQ29tcGFyZU1vZGUuQUxXQVlTKTtcblxuXHRcdFx0dGhpcy5kcmF3U2t5Ym94KGVudGl0eUNvbGxlY3Rvcik7XG5cdFx0fVxuXG5cdFx0dGhpcy5fcENvbnRleHQuc2V0RGVwdGhUZXN0KHRydWUsIENvbnRleHRHTENvbXBhcmVNb2RlLkxFU1NfRVFVQUwpO1xuXG5cdFx0dGhpcy5kcmF3UmVuZGVyYWJsZXModGhpcy5fcE9wYXF1ZVJlbmRlcmFibGVIZWFkLCBlbnRpdHlDb2xsZWN0b3IpO1xuXHRcdHRoaXMuZHJhd1JlbmRlcmFibGVzKHRoaXMuX3BCbGVuZGVkUmVuZGVyYWJsZUhlYWQsIGVudGl0eUNvbGxlY3Rvcik7XG5cdH1cblxuXHQvKipcblx0ICogRHJhdyB0aGUgc2t5Ym94IGlmIHByZXNlbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlbnRpdHlDb2xsZWN0b3IgVGhlIEVudGl0eUNvbGxlY3RvciBjb250YWluaW5nIGFsbCBwb3RlbnRpYWxseSB2aXNpYmxlIGluZm9ybWF0aW9uLlxuXHQgKi9cblx0cHJpdmF0ZSBkcmF3U2t5Ym94KGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IpXG5cdHtcblx0XHR2YXIgc2t5Qm94OlNreWJveFJlbmRlcmFibGUgPSA8U2t5Ym94UmVuZGVyYWJsZT4gdGhpcy5fc2t5Ym94UmVuZGVyYWJsZVBvb2wuZ2V0SXRlbShlbnRpdHlDb2xsZWN0b3Iuc2t5Qm94KTtcblxuXHRcdHZhciBtYXRlcmlhbDpNYXRlcmlhbEJhc2UgPSBlbnRpdHlDb2xsZWN0b3Iuc2t5Qm94Lm1hdGVyaWFsO1xuXG5cdFx0dmFyIGNhbWVyYTpDYW1lcmEgPSBlbnRpdHlDb2xsZWN0b3IuY2FtZXJhO1xuXG5cdFx0dGhpcy51cGRhdGVTa3lib3hQcm9qZWN0aW9uKGNhbWVyYSk7XG5cblx0XHR2YXIgYWN0aXZlUGFzczpNYXRlcmlhbFBhc3NEYXRhID0gKDxJQ29udGV4dFN0YWdlR0w+IHRoaXMuX3BTdGFnZS5jb250ZXh0KS5nZXRNYXRlcmlhbChtYXRlcmlhbCwgdGhpcy5fcFN0YWdlLnByb2ZpbGUpLmdldE1hdGVyaWFsUGFzcyg8TWF0ZXJpYWxQYXNzQmFzZT4gbWF0ZXJpYWwuX2lTY3JlZW5QYXNzZXNbMF0sIHRoaXMuX3BTdGFnZS5wcm9maWxlKTtcblxuXHRcdG1hdGVyaWFsLl9pQWN0aXZhdGVQYXNzKGFjdGl2ZVBhc3MsIHRoaXMuX3BTdGFnZSwgY2FtZXJhKTtcblx0XHRtYXRlcmlhbC5faVJlbmRlclBhc3MoYWN0aXZlUGFzcywgc2t5Qm94LCB0aGlzLl9wU3RhZ2UsIGNhbWVyYSwgdGhpcy5fc2t5Ym94UHJvamVjdGlvbik7XG5cdFx0bWF0ZXJpYWwuX2lEZWFjdGl2YXRlUGFzcyhhY3RpdmVQYXNzLCB0aGlzLl9wU3RhZ2UpO1xuXHR9XG5cblx0cHJpdmF0ZSB1cGRhdGVTa3lib3hQcm9qZWN0aW9uKGNhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHR2YXIgbmVhcjpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgpO1xuXG5cdFx0dGhpcy5fc2t5Ym94UHJvamVjdGlvbi5jb3B5RnJvbSh0aGlzLl9wUnR0Vmlld1Byb2plY3Rpb25NYXRyaXgpO1xuXHRcdHRoaXMuX3NreWJveFByb2plY3Rpb24uY29weVJvd1RvKDIsIG5lYXIpO1xuXG5cdFx0dmFyIGNhbVBvczpWZWN0b3IzRCA9IGNhbWVyYS5zY2VuZVBvc2l0aW9uO1xuXG5cdFx0dmFyIGN4Om51bWJlciA9IG5lYXIueDtcblx0XHR2YXIgY3k6bnVtYmVyID0gbmVhci55O1xuXHRcdHZhciBjejpudW1iZXIgPSBuZWFyLno7XG5cdFx0dmFyIGN3Om51bWJlciA9IC0obmVhci54KmNhbVBvcy54ICsgbmVhci55KmNhbVBvcy55ICsgbmVhci56KmNhbVBvcy56ICsgTWF0aC5zcXJ0KGN4KmN4ICsgY3kqY3kgKyBjeipjeikpO1xuXG5cdFx0dmFyIHNpZ25YOm51bWJlciA9IGN4ID49IDA/IDEgOiAtMTtcblx0XHR2YXIgc2lnblk6bnVtYmVyID0gY3kgPj0gMD8gMSA6IC0xO1xuXG5cdFx0dmFyIHA6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0Qoc2lnblgsIHNpZ25ZLCAxLCAxKTtcblxuXHRcdHZhciBpbnZlcnNlOk1hdHJpeDNEID0gdGhpcy5fc2t5Ym94UHJvamVjdGlvbi5jbG9uZSgpO1xuXHRcdGludmVyc2UuaW52ZXJ0KCk7XG5cblx0XHR2YXIgcTpWZWN0b3IzRCA9IGludmVyc2UudHJhbnNmb3JtVmVjdG9yKHApO1xuXG5cdFx0dGhpcy5fc2t5Ym94UHJvamVjdGlvbi5jb3B5Um93VG8oMywgcCk7XG5cblx0XHR2YXIgYTpudW1iZXIgPSAocS54KnAueCArIHEueSpwLnkgKyBxLnoqcC56ICsgcS53KnAudykvKGN4KnEueCArIGN5KnEueSArIGN6KnEueiArIGN3KnEudyk7XG5cblx0XHR0aGlzLl9za3lib3hQcm9qZWN0aW9uLmNvcHlSb3dGcm9tKDIsIG5ldyBWZWN0b3IzRChjeCphLCBjeSphLCBjeiphLCBjdyphKSk7XG5cdH1cblxuXHQvKipcblx0ICogRHJhdyBhIGxpc3Qgb2YgcmVuZGVyYWJsZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSByZW5kZXJhYmxlcyBUaGUgcmVuZGVyYWJsZXMgdG8gZHJhdy5cblx0ICogQHBhcmFtIGVudGl0eUNvbGxlY3RvciBUaGUgRW50aXR5Q29sbGVjdG9yIGNvbnRhaW5pbmcgYWxsIHBvdGVudGlhbGx5IHZpc2libGUgaW5mb3JtYXRpb24uXG5cdCAqL1xuXHRwcml2YXRlIGRyYXdSZW5kZXJhYmxlcyhyZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBlbnRpdHlDb2xsZWN0b3I6SUNvbGxlY3Rvcilcblx0e1xuXHRcdHZhciBpOm51bWJlcjtcblx0XHR2YXIgbGVuOm51bWJlcjtcblx0XHR2YXIgcGFzc2VzOkFycmF5PElNYXRlcmlhbFBhc3M+O1xuXHRcdHZhciBhY3RpdmVQYXNzOk1hdGVyaWFsUGFzc0RhdGE7XG5cdFx0dmFyIGFjdGl2ZU1hdGVyaWFsOk1hdGVyaWFsRGF0YTtcblx0XHR2YXIgY29udGV4dDpJQ29udGV4dFN0YWdlR0wgPSA8SUNvbnRleHRTdGFnZUdMPiB0aGlzLl9wU3RhZ2UuY29udGV4dDtcblx0XHR2YXIgY2FtZXJhOkNhbWVyYSA9IGVudGl0eUNvbGxlY3Rvci5jYW1lcmE7XG5cdFx0dmFyIHJlbmRlcmFibGUyOlJlbmRlcmFibGVCYXNlO1xuXG5cdFx0d2hpbGUgKHJlbmRlcmFibGUpIHtcblx0XHRcdGFjdGl2ZU1hdGVyaWFsID0gY29udGV4dC5nZXRNYXRlcmlhbChyZW5kZXJhYmxlLm1hdGVyaWFsLCB0aGlzLl9wU3RhZ2UucHJvZmlsZSk7XG5cblx0XHRcdC8vaXRlcmF0ZSB0aHJvdWdoIGVhY2ggc2NyZWVuIHBhc3Ncblx0XHRcdHBhc3NlcyA9IHJlbmRlcmFibGUubWF0ZXJpYWwuX2lTY3JlZW5QYXNzZXM7XG5cdFx0XHRsZW4gPSByZW5kZXJhYmxlLm1hdGVyaWFsLl9pTnVtU2NyZWVuUGFzc2VzKCk7XG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdFx0cmVuZGVyYWJsZTIgPSByZW5kZXJhYmxlO1xuXG5cdFx0XHRcdGFjdGl2ZVBhc3MgPSBhY3RpdmVNYXRlcmlhbC5nZXRNYXRlcmlhbFBhc3MoPE1hdGVyaWFsUGFzc0Jhc2U+IHBhc3Nlc1tpXSwgdGhpcy5fcFN0YWdlLnByb2ZpbGUpO1xuXG5cdFx0XHRcdHJlbmRlcmFibGUubWF0ZXJpYWwuX2lBY3RpdmF0ZVBhc3MoYWN0aXZlUGFzcywgdGhpcy5fcFN0YWdlLCBjYW1lcmEpO1xuXG5cdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRyZW5kZXJhYmxlLm1hdGVyaWFsLl9pUmVuZGVyUGFzcyhhY3RpdmVQYXNzLCByZW5kZXJhYmxlMiwgdGhpcy5fcFN0YWdlLCBjYW1lcmEsIHRoaXMuX3BSdHRWaWV3UHJvamVjdGlvbk1hdHJpeCk7XG5cblx0XHRcdFx0XHRyZW5kZXJhYmxlMiA9IHJlbmRlcmFibGUyLm5leHQ7XG5cblx0XHRcdFx0fSB3aGlsZSAocmVuZGVyYWJsZTIgJiYgcmVuZGVyYWJsZTIubWF0ZXJpYWwgPT0gcmVuZGVyYWJsZS5tYXRlcmlhbCk7XG5cblx0XHRcdFx0YWN0aXZlTWF0ZXJpYWwubWF0ZXJpYWwuX2lEZWFjdGl2YXRlUGFzcyhhY3RpdmVQYXNzLCB0aGlzLl9wU3RhZ2UpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZW5kZXJhYmxlID0gcmVuZGVyYWJsZTI7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0aWYgKCF0aGlzLl9zaGFyZUNvbnRleHQpXG5cdFx0XHR0aGlzLl9wU3RhZ2UuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuZGlzcG9zZSgpO1xuXHRcdHRoaXMuX3BEaXN0YW5jZVJlbmRlcmVyLmRpc3Bvc2UoKTtcblx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlciA9IG51bGw7XG5cdFx0dGhpcy5fcERpc3RhbmNlUmVuZGVyZXIgPSBudWxsO1xuXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyID0gbnVsbDtcblxuXHRcdHN1cGVyLmRpc3Bvc2UoKTtcblx0fVxuXG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgcFJlbmRlckRlcHRoUHJlcGFzcyhlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yKVxuXHR7XG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuZGlzYWJsZUNvbG9yID0gdHJ1ZTtcblxuXHRcdGlmICh0aGlzLl9wRmlsdGVyM0RSZW5kZXJlcikgeyAvL1RPRE9cbi8vXHRcdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci50ZXh0dXJlUmF0aW9YID0gdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWDtcbi8vXHRcdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci50ZXh0dXJlUmF0aW9ZID0gdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWTtcbi8vXHRcdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci5faVJlbmRlcihlbnRpdHlDb2xsZWN0b3IsIHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLmdldE1haW5JbnB1dFRleHR1cmUodGhpcy5fcFN0YWdlKSwgdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIucmVuZGVyVG9UZXh0dXJlUmVjdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLnRleHR1cmVSYXRpb1ggPSAxO1xuXHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWSA9IDE7XG5cdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci5faVJlbmRlcihlbnRpdHlDb2xsZWN0b3IpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLmRpc2FibGVDb2xvciA9IGZhbHNlO1xuXHR9XG5cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBwUmVuZGVyU2NlbmVEZXB0aFRvVGV4dHVyZShlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3BEZXB0aFRleHR1cmVJbnZhbGlkIHx8ICF0aGlzLl9wRGVwdGhSZW5kZXIpXG5cdFx0XHR0aGlzLmluaXREZXB0aFRleHR1cmUoPElDb250ZXh0U3RhZ2VHTD4gdGhpcy5fcFN0YWdlLmNvbnRleHQpO1xuXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWCA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1g7XG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWSA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1k7XG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuX2lSZW5kZXIoZW50aXR5Q29sbGVjdG9yLCB0aGlzLl9wRGVwdGhSZW5kZXIpO1xuXHR9XG5cblxuXHQvKipcblx0ICogVXBkYXRlcyB0aGUgYmFja2J1ZmZlciBkaW1lbnNpb25zLlxuXHQgKi9cblx0cHVibGljIHBVcGRhdGVCYWNrQnVmZmVyKClcblx0e1xuXHRcdC8vIE5vIHJlYXNvbiB0cnlpbmcgdG8gY29uZmlndXJlIGJhY2sgYnVmZmVyIGlmIHRoZXJlIGlzIG5vIGNvbnRleHQgYXZhaWxhYmxlLlxuXHRcdC8vIERvaW5nIHRoaXMgYW55d2F5IChhbmQgcmVseWluZyBvbiBfc3RhZ2UgdG8gY2FjaGUgd2lkdGgvaGVpZ2h0IGZvclxuXHRcdC8vIGNvbnRleHQgZG9lcyBnZXQgYXZhaWxhYmxlKSBtZWFucyB1c2VzU29mdHdhcmVSZW5kZXJpbmcgd29uJ3QgYmUgcmVsaWFibGUuXG5cdFx0aWYgKHRoaXMuX3BTdGFnZS5jb250ZXh0ICYmICF0aGlzLl9zaGFyZUNvbnRleHQpIHtcblx0XHRcdGlmICh0aGlzLl93aWR0aCAmJiB0aGlzLl9oZWlnaHQpIHtcblx0XHRcdFx0dGhpcy5fcFN0YWdlLmNvbmZpZ3VyZUJhY2tCdWZmZXIodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCwgdGhpcy5fYW50aUFsaWFzLCB0cnVlKTtcblx0XHRcdFx0dGhpcy5fcEJhY2tCdWZmZXJJbnZhbGlkID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGlTZXRTdGFnZSh2YWx1ZTpTdGFnZSlcblx0e1xuXHRcdHN1cGVyLmlTZXRTdGFnZSh2YWx1ZSk7XG5cblx0XHR0aGlzLl9wRGlzdGFuY2VSZW5kZXJlci5pU2V0U3RhZ2UodmFsdWUpO1xuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLmlTZXRTdGFnZSh2YWx1ZSk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgaW5pdERlcHRoVGV4dHVyZShjb250ZXh0OklDb250ZXh0U3RhZ2VHTCk6dm9pZFxuXHR7XG5cdFx0dGhpcy5fcERlcHRoVGV4dHVyZUludmFsaWQgPSBmYWxzZTtcblxuXHRcdGlmICh0aGlzLl9wRGVwdGhSZW5kZXIpXG5cdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXIuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyID0gbmV3IFJlbmRlclRleHR1cmUodGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudGV4dHVyZVdpZHRoLCB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlSGVpZ2h0KTtcblx0fVxufVxuXG5leHBvcnQgPSBEZWZhdWx0UmVuZGVyZXI7Il19
/**
 *
 */
var IndexData = (function () {
    function IndexData(level) {
        this._dataDirty = true;
        this.invalid = new Array(8);
        this.contexts = new Array(8);
        this.buffers = new Array(8);
        this.level = level;
    }
    IndexData.prototype.updateData = function (offset, indices, numVertices) {
        if (this._dataDirty) {
            this._dataDirty = false;
            if (indices.length < IndexData.LIMIT_INDICES && numVertices < IndexData.LIMIT_VERTS) {
                //shortcut for those buffers that fit into the maximum buffer sizes
                this.indexMappings = null;
                this.originalIndices = null;
                this.setData(indices);
                this.offset = indices.length;
            }
            else {
                var i;
                var len;
                var outIndex;
                var j;
                var k;
                var splitIndices = new Array();
                this.indexMappings = new Array(indices.length);
                this.originalIndices = new Array();
                i = this.indexMappings.length;
                while (i--)
                    this.indexMappings[i] = -1;
                var originalIndex;
                var splitIndex;
                // Loop over all triangles
                outIndex = 0;
                len = indices.length;
                i = offset;
                k = 0;
                while (i < len && outIndex + 3 < IndexData.LIMIT_INDICES && k + 3 < IndexData.LIMIT_VERTS) {
                    for (j = 0; j < 3; j++) {
                        originalIndex = indices[i + j];
                        if (this.indexMappings[originalIndex] >= 0) {
                            splitIndex = this.indexMappings[originalIndex];
                        }
                        else {
                            // This vertex does not yet exist in the split list and
                            // needs to be copied from the long list.
                            splitIndex = k++;
                            this.indexMappings[originalIndex] = splitIndex;
                            this.originalIndices.push(originalIndex);
                        }
                        // Store new index, which may have come from the mapping look-up,
                        // or from copying a new set of vertex data from the original vector
                        splitIndices[outIndex + j] = splitIndex;
                    }
                    outIndex += 3;
                    i += 3;
                }
                this.setData(splitIndices);
                this.offset = i;
            }
        }
    };
    IndexData.prototype.invalidateData = function () {
        this._dataDirty = true;
    };
    IndexData.prototype.dispose = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.contexts[i]) {
                this.buffers[i].dispose();
                this.buffers[i] = null;
                this.contexts[i] = null;
            }
        }
    };
    /**
     * @private
     */
    IndexData.prototype.disposeBuffers = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.buffers[i]) {
                this.buffers[i].dispose();
                this.buffers[i] = null;
            }
        }
    };
    /**
     * @private
     */
    IndexData.prototype.invalidateBuffers = function () {
        for (var i = 0; i < 8; ++i)
            this.invalid[i] = true;
    };
    /**
     *
     * @param data
     * @private
     */
    IndexData.prototype.setData = function (data) {
        if (this.data && this.data.length != data.length)
            this.disposeBuffers();
        else
            this.invalidateBuffers();
        this.data = data;
    };
    IndexData.LIMIT_VERTS = 0xffff;
    IndexData.LIMIT_INDICES = 0xffffff;
    return IndexData;
})();
module.exports = IndexData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9wb29sL0luZGV4RGF0YS50cyJdLCJuYW1lcyI6WyJJbmRleERhdGEiLCJJbmRleERhdGEuY29uc3RydWN0b3IiLCJJbmRleERhdGEudXBkYXRlRGF0YSIsIkluZGV4RGF0YS5pbnZhbGlkYXRlRGF0YSIsIkluZGV4RGF0YS5kaXNwb3NlIiwiSW5kZXhEYXRhLmRpc3Bvc2VCdWZmZXJzIiwiSW5kZXhEYXRhLmludmFsaWRhdGVCdWZmZXJzIiwiSW5kZXhEYXRhLnNldERhdGEiXSwibWFwcGluZ3MiOiJBQUtBLEFBR0E7O0dBREc7SUFDRyxTQUFTO0lBd0JkQSxTQXhCS0EsU0FBU0EsQ0F3QkZBLEtBQVlBO1FBbEJoQkMsZUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFbkJBLFlBQU9BLEdBQWtCQSxJQUFJQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV0Q0EsYUFBUUEsR0FBcUJBLElBQUlBLEtBQUtBLENBQWFBLENBQUNBLENBQUNBLENBQUNBO1FBRXREQSxZQUFPQSxHQUF1QkEsSUFBSUEsS0FBS0EsQ0FBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFjL0RBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBO0lBQ3BCQSxDQUFDQTtJQUVNRCw4QkFBVUEsR0FBakJBLFVBQWtCQSxNQUFhQSxFQUFFQSxPQUFxQkEsRUFBRUEsV0FBa0JBO1FBRXpFRSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFFeEJBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLEdBQUdBLFNBQVNBLENBQUNBLGFBQWFBLElBQUlBLFdBQVdBLEdBQUdBLFNBQVNBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO2dCQUNyRkEsQUFDQUEsbUVBRG1FQTtnQkFDbkVBLElB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QUFPQSxFQUFFQSxDQUFDQTtnQkFDMUJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3hCQSxDQUFDQTtRQUNGQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVETDs7T0FFR0E7SUFDS0EscUNBQWlCQSxHQUF6QkE7UUFFQ00sR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDaENBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUVETjs7OztPQUlHQTtJQUNLQSwyQkFBT0EsR0FBZkEsVUFBZ0JBLElBQWtCQTtRQUVqQ08sRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDaERBLElBQUlBLENBQUNBLGNBQWNBLEVBQUVBLENBQUNBO1FBQ3ZCQSxJQUFJQTtZQUNIQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO1FBRTFCQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUNsQkEsQ0FBQ0E7SUFqSmNQLHFCQUFXQSxHQUFVQSxNQUFNQSxDQUFDQTtJQUU1QkEsdUJBQWFBLEdBQVVBLFFBQVFBLENBQUNBO0lBZ0poREEsZ0JBQUNBO0FBQURBLENBcEpBLEFBb0pDQSxJQUFBO0FBRUQsQUFBbUIsaUJBQVYsU0FBUyxDQUFDIiwiZmlsZSI6InBvb2wvSW5kZXhEYXRhLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdWJHZW9tZXRyeUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9kYXRhL1N1Ykdlb21ldHJ5QmFzZVwiKTtcblxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcbmltcG9ydCBJSW5kZXhCdWZmZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUluZGV4QnVmZmVyXCIpO1xuXG4vKipcbiAqXG4gKi9cbmNsYXNzIEluZGV4RGF0YVxue1xuXHRwcml2YXRlIHN0YXRpYyBMSU1JVF9WRVJUUzpudW1iZXIgPSAweGZmZmY7XG5cblx0cHJpdmF0ZSBzdGF0aWMgTElNSVRfSU5ESUNFUzpudW1iZXIgPSAweGZmZmZmZjtcblxuXHRwcml2YXRlIF9kYXRhRGlydHkgPSB0cnVlO1xuXG5cdHB1YmxpYyBpbnZhbGlkOkFycmF5PGJvb2xlYW4+ID0gbmV3IEFycmF5KDgpO1xuXG5cdHB1YmxpYyBjb250ZXh0czpBcnJheTxJQ29udGV4dEdMPiA9IG5ldyBBcnJheTxJQ29udGV4dEdMPig4KTtcblxuXHRwdWJsaWMgYnVmZmVyczpBcnJheTxJSW5kZXhCdWZmZXI+ID0gbmV3IEFycmF5PElJbmRleEJ1ZmZlcj4oOCk7XG5cblx0cHVibGljIGRhdGE6QXJyYXk8bnVtYmVyPjtcblxuXHRwdWJsaWMgaW5kZXhNYXBwaW5nczpBcnJheTxudW1iZXI+O1xuXG5cdHB1YmxpYyBvcmlnaW5hbEluZGljZXM6QXJyYXk8bnVtYmVyPjtcblxuXHRwdWJsaWMgb2Zmc2V0Om51bWJlcjtcblxuXHRwdWJsaWMgbGV2ZWw6bnVtYmVyO1xuXG5cdGNvbnN0cnVjdG9yKGxldmVsOm51bWJlcilcblx0e1xuXHRcdHRoaXMubGV2ZWwgPSBsZXZlbDtcblx0fVxuXG5cdHB1YmxpYyB1cGRhdGVEYXRhKG9mZnNldDpudW1iZXIsIGluZGljZXM6QXJyYXk8bnVtYmVyPiwgbnVtVmVydGljZXM6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2RhdGFEaXJ0eSkge1xuXHRcdFx0dGhpcy5fZGF0YURpcnR5ID0gZmFsc2U7XG5cblx0XHRcdGlmIChpbmRpY2VzLmxlbmd0aCA8IEluZGV4RGF0YS5MSU1JVF9JTkRJQ0VTICYmIG51bVZlcnRpY2VzIDwgSW5kZXhEYXRhLkxJTUlUX1ZFUlRTKSB7XG5cdFx0XHRcdC8vc2hvcnRjdXQgZm9yIHRob3NlIGJ1ZmZlcnMgdGhhdCBmaXQgaW50byB0aGUgbWF4aW11bSBidWZmZXIgc2l6ZXNcblx0XHRcdFx0dGhpcy5pbmRleE1hcHBpbmdzID0gbnVsbDtcblx0XHRcdFx0dGhpcy5vcmlnaW5hbEluZGljZXMgPSBudWxsO1xuXHRcdFx0XHR0aGlzLnNldERhdGEoaW5kaWNlcyk7XG5cdFx0XHRcdHRoaXMub2Zmc2V0ID0gaW5kaWNlcy5sZW5ndGg7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR2YXIgaTpudW1iZXI7XG5cdFx0XHRcdHZhciBsZW46bnVtYmVyO1xuXHRcdFx0XHR2YXIgb3V0SW5kZXg6bnVtYmVyO1xuXHRcdFx0XHR2YXIgajpudW1iZXI7XG5cdFx0XHRcdHZhciBrOm51bWJlcjtcblx0XHRcdFx0dmFyIHNwbGl0SW5kaWNlczpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblxuXHRcdFx0XHR0aGlzLmluZGV4TWFwcGluZ3MgPSBuZXcgQXJyYXk8bnVtYmVyPihpbmRpY2VzLmxlbmd0aCk7XG5cdFx0XHRcdHRoaXMub3JpZ2luYWxJbmRpY2VzID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblxuXHRcdFx0XHRpID0gdGhpcy5pbmRleE1hcHBpbmdzLmxlbmd0aDtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKVxuXHRcdFx0XHRcdHRoaXMuaW5kZXhNYXBwaW5nc1tpXSA9IC0xO1xuXG5cdFx0XHRcdHZhciBvcmlnaW5hbEluZGV4Om51bWJlcjtcblx0XHRcdFx0dmFyIHNwbGl0SW5kZXg6bnVtYmVyO1xuXG5cdFx0XHRcdC8vIExvb3Agb3ZlciBhbGwgdHJpYW5nbGVzXG5cdFx0XHRcdG91dEluZGV4ID0gMDtcblx0XHRcdFx0bGVuID0gaW5kaWNlcy5sZW5ndGg7XG5cdFx0XHRcdGkgPSBvZmZzZXQ7XG5cdFx0XHRcdGsgPSAwO1xuXHRcdFx0XHR3aGlsZSAoaSA8IGxlbiAmJiBvdXRJbmRleCArIDMgPCBJbmRleERhdGEuTElNSVRfSU5ESUNFUyAmJiBrICsgMyA8IEluZGV4RGF0YS5MSU1JVF9WRVJUUykge1xuXHRcdFx0XHRcdC8vIExvb3Agb3ZlciBhbGwgdmVydGljZXMgaW4gYSB0cmlhbmdsZSAvL1RPRE8gZW5zdXJlIHRoaXMgd29ya3MgZm9yIHNlZ21lbnRzIG9yIGFueSBncm91cGluZ1xuXHRcdFx0XHRcdGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHtcblxuXHRcdFx0XHRcdFx0b3JpZ2luYWxJbmRleCA9IGluZGljZXNbaSArIGpdO1xuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5pbmRleE1hcHBpbmdzW29yaWdpbmFsSW5kZXhdID49IDApIHtcblx0XHRcdFx0XHRcdFx0c3BsaXRJbmRleCA9IHRoaXMuaW5kZXhNYXBwaW5nc1tvcmlnaW5hbEluZGV4XTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0Ly8gVGhpcyB2ZXJ0ZXggZG9lcyBub3QgeWV0IGV4aXN0IGluIHRoZSBzcGxpdCBsaXN0IGFuZFxuXHRcdFx0XHRcdFx0XHQvLyBuZWVkcyB0byBiZSBjb3BpZWQgZnJvbSB0aGUgbG9uZyBsaXN0LlxuXHRcdFx0XHRcdFx0XHRzcGxpdEluZGV4ID0gaysrO1xuXHRcdFx0XHRcdFx0XHR0aGlzLmluZGV4TWFwcGluZ3Nbb3JpZ2luYWxJbmRleF0gPSBzcGxpdEluZGV4O1xuXHRcdFx0XHRcdFx0XHR0aGlzLm9yaWdpbmFsSW5kaWNlcy5wdXNoKG9yaWdpbmFsSW5kZXgpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBTdG9yZSBuZXcgaW5kZXgsIHdoaWNoIG1heSBoYXZlIGNvbWUgZnJvbSB0aGUgbWFwcGluZyBsb29rLXVwLFxuXHRcdFx0XHRcdFx0Ly8gb3IgZnJvbSBjb3B5aW5nIGEgbmV3IHNldCBvZiB2ZXJ0ZXggZGF0YSBmcm9tIHRoZSBvcmlnaW5hbCB2ZWN0b3Jcblx0XHRcdFx0XHRcdHNwbGl0SW5kaWNlc1tvdXRJbmRleCArIGpdID0gc3BsaXRJbmRleDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRvdXRJbmRleCArPSAzO1xuXHRcdFx0XHRcdGkgKz0gM1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5zZXREYXRhKHNwbGl0SW5kaWNlcyk7XG5cdFx0XHRcdHRoaXMub2Zmc2V0ID0gaTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgaW52YWxpZGF0ZURhdGEoKVxuXHR7XG5cdFx0dGhpcy5fZGF0YURpcnR5ID0gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBkaXNwb3NlKClcblx0e1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDg7ICsraSkge1xuXHRcdFx0aWYgKHRoaXMuY29udGV4dHNbaV0pIHtcblx0XHRcdFx0dGhpcy5idWZmZXJzW2ldLmRpc3Bvc2UoKTtcblx0XHRcdFx0dGhpcy5idWZmZXJzW2ldID0gbnVsbDtcblx0XHRcdFx0dGhpcy5jb250ZXh0c1tpXSA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIGRpc3Bvc2VCdWZmZXJzKClcblx0e1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDg7ICsraSkge1xuXHRcdFx0aWYgKHRoaXMuYnVmZmVyc1tpXSkge1xuXHRcdFx0XHR0aGlzLmJ1ZmZlcnNbaV0uZGlzcG9zZSgpO1xuXHRcdFx0XHR0aGlzLmJ1ZmZlcnNbaV0gPSBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0cHJpdmF0ZSBpbnZhbGlkYXRlQnVmZmVycygpXG5cdHtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA4OyArK2kpXG5cdFx0XHR0aGlzLmludmFsaWRbaV0gPSB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIHNldERhdGEoZGF0YTpBcnJheTxudW1iZXI+KVxuXHR7XG5cdFx0aWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoICE9IGRhdGEubGVuZ3RoKVxuXHRcdFx0dGhpcy5kaXNwb3NlQnVmZmVycygpO1xuXHRcdGVsc2Vcblx0XHRcdHRoaXMuaW52YWxpZGF0ZUJ1ZmZlcnMoKTtcblxuXHRcdHRoaXMuZGF0YSA9IGRhdGE7XG5cdH1cbn1cblxuZXhwb3J0ID0gSW5kZXhEYXRhOyJdfQ==
/**
 *
 */
var IndexData = (function () {
    function IndexData(level) {
        this._dataDirty = true;
        this.invalid = new Array(8);
        this.contexts = new Array(8);
        this.buffers = new Array(8);
        this.level = level;
    }
    IndexData.prototype.updateData = function (offset, indices, numVertices) {
        if (this._dataDirty) {
            this._dataDirty = false;
            if (indices.length < IndexData.LIMIT_INDICES && numVertices < IndexData.LIMIT_VERTS) {
                //shortcut for those buffers that fit into the maximum buffer sizes
                this.indexMappings = null;
                this.originalIndices = null;
                this.setData(indices);
                this.offset = indices.length;
            }
            else {
                var i;
                var len;
                var outIndex;
                var j;
                var k;
                var splitIndices = new Array();
                this.indexMappings = new Array(indices.length);
                this.originalIndices = new Array();
                i = this.indexMappings.length;
                while (i--)
                    this.indexMappings[i] = -1;
                var originalIndex;
                var splitIndex;
                // Loop over all triangles
                outIndex = 0;
                len = indices.length;
                i = offset;
                k = 0;
                while (i < len && outIndex + 3 < IndexData.LIMIT_INDICES && k + 3 < IndexData.LIMIT_VERTS) {
                    for (j = 0; j < 3; j++) {
                        originalIndex = indices[i + j];
                        if (this.indexMappings[originalIndex] >= 0) {
                            splitIndex = this.indexMappings[originalIndex];
                        }
                        else {
                            // This vertex does not yet exist in the split list and
                            // needs to be copied from the long list.
                            splitIndex = k++;
                            this.indexMappings[originalIndex] = splitIndex;
                            this.originalIndices.push(originalIndex);
                        }
                        // Store new index, which may have come from the mapping look-up,
                        // or from copying a new set of vertex data from the original vector
                        splitIndices[outIndex + j] = splitIndex;
                    }
                    outIndex += 3;
                    i += 3;
                }
                this.setData(splitIndices);
                this.offset = i;
            }
        }
    };
    IndexData.prototype.invalidateData = function () {
        this._dataDirty = true;
    };
    IndexData.prototype.dispose = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.contexts[i]) {
                this.contexts[i].disposeIndexData(this);
                this.contexts[i] = null;
            }
        }
    };
    /**
     * @private
     */
    IndexData.prototype.disposeBuffers = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.buffers[i]) {
                this.buffers[i].dispose();
                this.buffers[i] = null;
            }
        }
    };
    /**
     * @private
     */
    IndexData.prototype.invalidateBuffers = function () {
        for (var i = 0; i < 8; ++i)
            this.invalid[i] = true;
    };
    /**
     *
     * @param data
     * @private
     */
    IndexData.prototype.setData = function (data) {
        if (this.data && this.data.length != data.length)
            this.disposeBuffers();
        else
            this.invalidateBuffers();
        this.data = data;
    };
    IndexData.LIMIT_VERTS = 0xffff;
    IndexData.LIMIT_INDICES = 0xffffff;
    return IndexData;
})();
module.exports = IndexData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9wb29sL2luZGV4ZGF0YS50cyJdLCJuYW1lcyI6WyJJbmRleERhdGEiLCJJbmRleERhdGEuY29uc3RydWN0b3IiLCJJbmRleERhdGEudXBkYXRlRGF0YSIsIkluZGV4RGF0YS5pbnZhbGlkYXRlRGF0YSIsIkluZGV4RGF0YS5kaXNwb3NlIiwiSW5kZXhEYXRhLmRpc3Bvc2VCdWZmZXJzIiwiSW5kZXhEYXRhLmludmFsaWRhdGVCdWZmZXJzIiwiSW5kZXhEYXRhLnNldERhdGEiXSwibWFwcGluZ3MiOiJBQUtBLEFBR0E7O0dBREc7SUFDRyxTQUFTO0lBd0JkQSxTQXhCS0EsU0FBU0EsQ0F3QkZBLEtBQVlBO1FBbEJoQkMsZUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFbkJBLFlBQU9BLEdBQWtCQSxJQUFJQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV0Q0EsYUFBUUEsR0FBd0JBLElBQUlBLEtBQUtBLENBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1REEsWUFBT0EsR0FBdUJBLElBQUlBLEtBQUtBLENBQWVBLENBQUNBLENBQUNBLENBQUNBO1FBYy9EQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUNwQkEsQ0FBQ0E7SUFFTUQsOEJBQVVBLEdBQWpCQSxVQUFrQkEsTUFBYUEsRUFBRUEsT0FBcUJBLEVBQUVBLFdBQWtCQTtRQUV6RUUsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDckJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLEtBQUtBLENBQUNBO1lBRXhCQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxTQUFTQSxDQUFDQSxhQUFhQSxJQUFJQSxXQUFXQSxHQUFHQSxTQUFTQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDckZBLEFBQ0FBLG1FQURtRUE7Z0JBQ25FQSxJ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QSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUN4QkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFFREw7O09BRUdBO0lBQ0tBLHFDQUFpQkEsR0FBekJBO1FBRUNNLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ2hDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUN6QkEsQ0FBQ0E7SUFFRE47Ozs7T0FJR0E7SUFDS0EsMkJBQU9BLEdBQWZBLFVBQWdCQSxJQUFrQkE7UUFFakNPLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1lBQ2hEQSxJQUFJQSxDQUFDQSxjQUFjQSxFQUFFQSxDQUFDQTtRQUN2QkEsSUFBSUE7WUFDSEEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxDQUFDQTtRQUUxQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDbEJBLENBQUNBO0lBaEpjUCxxQkFBV0EsR0FBVUEsTUFBTUEsQ0FBQ0E7SUFFNUJBLHVCQUFhQSxHQUFVQSxRQUFRQSxDQUFDQTtJQStJaERBLGdCQUFDQTtBQUFEQSxDQW5KQSxBQW1KQ0EsSUFBQTtBQUVELEFBQW1CLGlCQUFWLFNBQVMsQ0FBQyIsImZpbGUiOiJwb29sL0luZGV4RGF0YS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3ViR2VvbWV0cnlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9TdWJHZW9tZXRyeUJhc2VcIik7XG5cbmltcG9ydCBDb250ZXh0R0xCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xCYXNlXCIpO1xuaW1wb3J0IElJbmRleEJ1ZmZlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JSW5kZXhCdWZmZXJcIik7XG5cbi8qKlxuICpcbiAqL1xuY2xhc3MgSW5kZXhEYXRhXG57XG5cdHByaXZhdGUgc3RhdGljIExJTUlUX1ZFUlRTOm51bWJlciA9IDB4ZmZmZjtcblxuXHRwcml2YXRlIHN0YXRpYyBMSU1JVF9JTkRJQ0VTOm51bWJlciA9IDB4ZmZmZmZmO1xuXG5cdHByaXZhdGUgX2RhdGFEaXJ0eSA9IHRydWU7XG5cblx0cHVibGljIGludmFsaWQ6QXJyYXk8Ym9vbGVhbj4gPSBuZXcgQXJyYXkoOCk7XG5cblx0cHVibGljIGNvbnRleHRzOkFycmF5PENvbnRleHRHTEJhc2U+ID0gbmV3IEFycmF5PENvbnRleHRHTEJhc2U+KDgpO1xuXG5cdHB1YmxpYyBidWZmZXJzOkFycmF5PElJbmRleEJ1ZmZlcj4gPSBuZXcgQXJyYXk8SUluZGV4QnVmZmVyPig4KTtcblxuXHRwdWJsaWMgZGF0YTpBcnJheTxudW1iZXI+O1xuXG5cdHB1YmxpYyBpbmRleE1hcHBpbmdzOkFycmF5PG51bWJlcj47XG5cblx0cHVibGljIG9yaWdpbmFsSW5kaWNlczpBcnJheTxudW1iZXI+O1xuXG5cdHB1YmxpYyBvZmZzZXQ6bnVtYmVyO1xuXG5cdHB1YmxpYyBsZXZlbDpudW1iZXI7XG5cblx0Y29uc3RydWN0b3IobGV2ZWw6bnVtYmVyKVxuXHR7XG5cdFx0dGhpcy5sZXZlbCA9IGxldmVsO1xuXHR9XG5cblx0cHVibGljIHVwZGF0ZURhdGEob2Zmc2V0Om51bWJlciwgaW5kaWNlczpBcnJheTxudW1iZXI+LCBudW1WZXJ0aWNlczpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fZGF0YURpcnR5KSB7XG5cdFx0XHR0aGlzLl9kYXRhRGlydHkgPSBmYWxzZTtcblxuXHRcdFx0aWYgKGluZGljZXMubGVuZ3RoIDwgSW5kZXhEYXRhLkxJTUlUX0lORElDRVMgJiYgbnVtVmVydGljZXMgPCBJbmRleERhdGEuTElNSVRfVkVSVFMpIHtcblx0XHRcdFx0Ly9zaG9ydGN1dCBmb3IgdGhvc2UgYnVmZmVycyB0aGF0IGZpdCBpbnRvIHRoZSBtYXhpbXVtIGJ1ZmZlciBzaXplc1xuXHRcdFx0XHR0aGlzLmluZGV4TWFwcGluZ3MgPSBudWxsO1xuXHRcdFx0XHR0aGlzLm9yaWdpbmFsSW5kaWNlcyA9IG51bGw7XG5cdFx0XHRcdHRoaXMuc2V0RGF0YShpbmRpY2VzKTtcblx0XHRcdFx0dGhpcy5vZmZzZXQgPSBpbmRpY2VzLmxlbmd0aDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZhciBpOm51bWJlcjtcblx0XHRcdFx0dmFyIGxlbjpudW1iZXI7XG5cdFx0XHRcdHZhciBvdXRJbmRleDpudW1iZXI7XG5cdFx0XHRcdHZhciBqOm51bWJlcjtcblx0XHRcdFx0dmFyIGs6bnVtYmVyO1xuXHRcdFx0XHR2YXIgc3BsaXRJbmRpY2VzOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXG5cdFx0XHRcdHRoaXMuaW5kZXhNYXBwaW5ncyA9IG5ldyBBcnJheTxudW1iZXI+KGluZGljZXMubGVuZ3RoKTtcblx0XHRcdFx0dGhpcy5vcmlnaW5hbEluZGljZXMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXG5cdFx0XHRcdGkgPSB0aGlzLmluZGV4TWFwcGluZ3MubGVuZ3RoO1xuXG5cdFx0XHRcdHdoaWxlIChpLS0pXG5cdFx0XHRcdFx0dGhpcy5pbmRleE1hcHBpbmdzW2ldID0gLTE7XG5cblx0XHRcdFx0dmFyIG9yaWdpbmFsSW5kZXg6bnVtYmVyO1xuXHRcdFx0XHR2YXIgc3BsaXRJbmRleDpudW1iZXI7XG5cblx0XHRcdFx0Ly8gTG9vcCBvdmVyIGFsbCB0cmlhbmdsZXNcblx0XHRcdFx0b3V0SW5kZXggPSAwO1xuXHRcdFx0XHRsZW4gPSBpbmRpY2VzLmxlbmd0aDtcblx0XHRcdFx0aSA9IG9mZnNldDtcblx0XHRcdFx0ayA9IDA7XG5cdFx0XHRcdHdoaWxlIChpIDwgbGVuICYmIG91dEluZGV4ICsgMyA8IEluZGV4RGF0YS5MSU1JVF9JTkRJQ0VTICYmIGsgKyAzIDwgSW5kZXhEYXRhLkxJTUlUX1ZFUlRTKSB7XG5cdFx0XHRcdFx0Ly8gTG9vcCBvdmVyIGFsbCB2ZXJ0aWNlcyBpbiBhIHRyaWFuZ2xlIC8vVE9ETyBlbnN1cmUgdGhpcyB3b3JrcyBmb3Igc2VnbWVudHMgb3IgYW55IGdyb3VwaW5nXG5cdFx0XHRcdFx0Zm9yIChqID0gMDsgaiA8IDM7IGorKykge1xuXG5cdFx0XHRcdFx0XHRvcmlnaW5hbEluZGV4ID0gaW5kaWNlc1tpICsgal07XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLmluZGV4TWFwcGluZ3Nbb3JpZ2luYWxJbmRleF0gPj0gMCkge1xuXHRcdFx0XHRcdFx0XHRzcGxpdEluZGV4ID0gdGhpcy5pbmRleE1hcHBpbmdzW29yaWdpbmFsSW5kZXhdO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHQvLyBUaGlzIHZlcnRleCBkb2VzIG5vdCB5ZXQgZXhpc3QgaW4gdGhlIHNwbGl0IGxpc3QgYW5kXG5cdFx0XHRcdFx0XHRcdC8vIG5lZWRzIHRvIGJlIGNvcGllZCBmcm9tIHRoZSBsb25nIGxpc3QuXG5cdFx0XHRcdFx0XHRcdHNwbGl0SW5kZXggPSBrKys7XG5cdFx0XHRcdFx0XHRcdHRoaXMuaW5kZXhNYXBwaW5nc1tvcmlnaW5hbEluZGV4XSA9IHNwbGl0SW5kZXg7XG5cdFx0XHRcdFx0XHRcdHRoaXMub3JpZ2luYWxJbmRpY2VzLnB1c2gob3JpZ2luYWxJbmRleCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIFN0b3JlIG5ldyBpbmRleCwgd2hpY2ggbWF5IGhhdmUgY29tZSBmcm9tIHRoZSBtYXBwaW5nIGxvb2stdXAsXG5cdFx0XHRcdFx0XHQvLyBvciBmcm9tIGNvcHlpbmcgYSBuZXcgc2V0IG9mIHZlcnRleCBkYXRhIGZyb20gdGhlIG9yaWdpbmFsIHZlY3RvclxuXHRcdFx0XHRcdFx0c3BsaXRJbmRpY2VzW291dEluZGV4ICsgal0gPSBzcGxpdEluZGV4O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG91dEluZGV4ICs9IDM7XG5cdFx0XHRcdFx0aSArPSAzXG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLnNldERhdGEoc3BsaXRJbmRpY2VzKTtcblx0XHRcdFx0dGhpcy5vZmZzZXQgPSBpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBpbnZhbGlkYXRlRGF0YSgpXG5cdHtcblx0XHR0aGlzLl9kYXRhRGlydHkgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgODsgKytpKSB7XG5cdFx0XHRpZiAodGhpcy5jb250ZXh0c1tpXSkge1xuXHRcdFx0XHR0aGlzLmNvbnRleHRzW2ldLmRpc3Bvc2VJbmRleERhdGEodGhpcyk7XG5cdFx0XHRcdHRoaXMuY29udGV4dHNbaV0gPSBudWxsXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIGRpc3Bvc2VCdWZmZXJzKClcblx0e1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDg7ICsraSkge1xuXHRcdFx0aWYgKHRoaXMuYnVmZmVyc1tpXSkge1xuXHRcdFx0XHR0aGlzLmJ1ZmZlcnNbaV0uZGlzcG9zZSgpO1xuXHRcdFx0XHR0aGlzLmJ1ZmZlcnNbaV0gPSBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0cHJpdmF0ZSBpbnZhbGlkYXRlQnVmZmVycygpXG5cdHtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA4OyArK2kpXG5cdFx0XHR0aGlzLmludmFsaWRbaV0gPSB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIHNldERhdGEoZGF0YTpBcnJheTxudW1iZXI+KVxuXHR7XG5cdFx0aWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoICE9IGRhdGEubGVuZ3RoKVxuXHRcdFx0dGhpcy5kaXNwb3NlQnVmZmVycygpO1xuXHRcdGVsc2Vcblx0XHRcdHRoaXMuaW52YWxpZGF0ZUJ1ZmZlcnMoKTtcblxuXHRcdHRoaXMuZGF0YSA9IGRhdGE7XG5cdH1cbn1cblxuZXhwb3J0ID0gSW5kZXhEYXRhOyJdfQ==
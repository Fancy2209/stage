var SubGeometryBase = require("awayjs-core/lib/data/SubGeometryBase");
var SubGeometryEvent = require("awayjs-core/lib/events/SubGeometryEvent");
/**
 *
 */
var VertexData = (function () {
    function VertexData(subGeometry, dataType) {
        var _this = this;
        this._dataDirty = true;
        this.invalid = new Array(8);
        this.buffers = new Array(8);
        this.contexts = new Array(8);
        this._subGeometry = subGeometry;
        this._dataType = dataType;
        this._onVerticesUpdatedDelegate = function (event) { return _this._onVerticesUpdated(event); };
        this._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);
    }
    VertexData.prototype.updateData = function (originalIndices, indexMappings) {
        if (originalIndices === void 0) { originalIndices = null; }
        if (indexMappings === void 0) { indexMappings = null; }
        if (this._dataDirty) {
            this._dataDirty = false;
            this.dataPerVertex = this._subGeometry.getStride(this._dataType);
            var vertices = this._subGeometry[this._dataType];
            if (indexMappings == null) {
                this.setData(vertices);
            }
            else {
                var splitVerts = new Array(originalIndices.length * this.dataPerVertex);
                var originalIndex;
                var splitIndex;
                var i = 0;
                var j = 0;
                while (i < originalIndices.length) {
                    originalIndex = originalIndices[i];
                    splitIndex = indexMappings[originalIndex] * this.dataPerVertex;
                    originalIndex *= this.dataPerVertex;
                    for (j = 0; j < this.dataPerVertex; j++)
                        splitVerts[splitIndex + j] = vertices[originalIndex + j];
                    i++;
                }
                this.setData(splitVerts);
            }
        }
    };
    VertexData.prototype.dispose = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.contexts[i]) {
                this.buffers[i].dispose();
                this.buffers[i] = null;
                this.contexts[i] = null;
            }
        }
    };
    /**
     * @private
     */
    VertexData.prototype.disposeBuffers = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.buffers[i]) {
                this.buffers[i].dispose();
                this.buffers[i] = null;
            }
        }
    };
    /**
     * @private
     */
    VertexData.prototype.invalidateBuffers = function () {
        for (var i = 0; i < 8; ++i)
            this.invalid[i] = true;
    };
    /**
     *
     * @param data
     * @param dataPerVertex
     * @private
     */
    VertexData.prototype.setData = function (data) {
        if (this.data && this.data.length != data.length)
            this.disposeBuffers();
        else
            this.invalidateBuffers();
        this.data = data;
    };
    /**
     * //TODO
     *
     * @param event
     * @private
     */
    VertexData.prototype._onVerticesUpdated = function (event) {
        var dataType = this._subGeometry.concatenateArrays ? SubGeometryBase.VERTEX_DATA : event.dataType;
        if (dataType == this._dataType)
            this._dataDirty = true;
    };
    return VertexData;
})();
module.exports = VertexData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9wb29sL1ZlcnRleERhdGEudHMiXSwibmFtZXMiOlsiVmVydGV4RGF0YSIsIlZlcnRleERhdGEuY29uc3RydWN0b3IiLCJWZXJ0ZXhEYXRhLnVwZGF0ZURhdGEiLCJWZXJ0ZXhEYXRhLmRpc3Bvc2UiLCJWZXJ0ZXhEYXRhLmRpc3Bvc2VCdWZmZXJzIiwiVmVydGV4RGF0YS5pbnZhbGlkYXRlQnVmZmVycyIsIlZlcnRleERhdGEuc2V0RGF0YSIsIlZlcnRleERhdGEuX29uVmVydGljZXNVcGRhdGVkIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLGVBQWUsV0FBYyxzQ0FBc0MsQ0FBQyxDQUFDO0FBQzVFLElBQU8sZ0JBQWdCLFdBQWMseUNBQXlDLENBQUMsQ0FBQztBQUtoRixBQUdBOztHQURHO0lBQ0csVUFBVTtJQWlCZkEsU0FqQktBLFVBQVVBLENBaUJIQSxXQUEyQkEsRUFBRUEsUUFBZUE7UUFqQnpEQyxpQkEwSENBO1FBckhRQSxlQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVuQkEsWUFBT0EsR0FBa0JBLElBQUlBLEtBQUtBLENBQVVBLENBQUNBLENBQUNBLENBQUNBO1FBRS9DQSxZQUFPQSxHQUF3QkEsSUFBSUEsS0FBS0EsQ0FBZ0JBLENBQUNBLENBQUNBLENBQUNBO1FBRTNEQSxhQUFRQSxHQUFxQkEsSUFBSUEsS0FBS0EsQ0FBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFRNURBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLFdBQVdBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUUxQkEsSUFBSUEsQ0FBQ0EsMEJBQTBCQSxHQUFHQSxVQUFDQSxLQUFzQkEsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUE5QkEsQ0FBOEJBLENBQUNBO1FBQzdGQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxnQkFBZ0JBLENBQUNBLGdCQUFn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RUROOzs7OztPQUtHQTtJQUNLQSx1Q0FBa0JBLEdBQTFCQSxVQUEyQkEsS0FBc0JBO1FBRWhETyxJQUFJQSxRQUFRQSxHQUFVQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxpQkFBaUJBLEdBQUVBLGVBQWVBLENBQUNBLFdBQVdBLEdBQUdBLEtBQUtBLENBQUNBLFFBQVFBLENBQUNBO1FBRXhHQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtZQUM5QkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDekJBLENBQUNBO0lBQ0ZQLGlCQUFDQTtBQUFEQSxDQTFIQSxBQTBIQ0EsSUFBQTtBQUVELEFBQW9CLGlCQUFYLFVBQVUsQ0FBQyIsImZpbGUiOiJwb29sL1ZlcnRleERhdGEuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN1Ykdlb21ldHJ5QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2RhdGEvU3ViR2VvbWV0cnlCYXNlXCIpO1xuaW1wb3J0IFN1Ykdlb21ldHJ5RXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvU3ViR2VvbWV0cnlFdmVudFwiKTtcblxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcbmltcG9ydCBJVmVydGV4QnVmZmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JVmVydGV4QnVmZmVyXCIpO1xuXG4vKipcbiAqXG4gKi9cbmNsYXNzIFZlcnRleERhdGFcbntcblx0cHJpdmF0ZSBfb25WZXJ0aWNlc1VwZGF0ZWREZWxlZ2F0ZTooZXZlbnQ6U3ViR2VvbWV0cnlFdmVudCkgPT4gdm9pZDtcblx0cHJpdmF0ZSBfc3ViR2VvbWV0cnk6U3ViR2VvbWV0cnlCYXNlO1xuXHRwcml2YXRlIF9kYXRhVHlwZTpzdHJpbmc7XG5cdHByaXZhdGUgX2RhdGFEaXJ0eSA9IHRydWU7XG5cblx0cHVibGljIGludmFsaWQ6QXJyYXk8Ym9vbGVhbj4gPSBuZXcgQXJyYXk8Ym9vbGVhbj4oOCk7XG5cblx0cHVibGljIGJ1ZmZlcnM6QXJyYXk8SVZlcnRleEJ1ZmZlcj4gPSBuZXcgQXJyYXk8SVZlcnRleEJ1ZmZlcj4oOCk7XG5cblx0cHVibGljIGNvbnRleHRzOkFycmF5PElDb250ZXh0R0w+ID0gbmV3IEFycmF5PElDb250ZXh0R0w+KDgpO1xuXG5cdHB1YmxpYyBkYXRhOkFycmF5PG51bWJlcj47XG5cblx0cHVibGljIGRhdGFQZXJWZXJ0ZXg6bnVtYmVyO1xuXG5cdGNvbnN0cnVjdG9yKHN1Ykdlb21ldHJ5OlN1Ykdlb21ldHJ5QmFzZSwgZGF0YVR5cGU6c3RyaW5nKVxuXHR7XG5cdFx0dGhpcy5fc3ViR2VvbWV0cnkgPSBzdWJHZW9tZXRyeTtcblx0XHR0aGlzLl9kYXRhVHlwZSA9IGRhdGFUeXBlO1xuXG5cdFx0dGhpcy5fb25WZXJ0aWNlc1VwZGF0ZWREZWxlZ2F0ZSA9IChldmVudDpTdWJHZW9tZXRyeUV2ZW50KSA9PiB0aGlzLl9vblZlcnRpY2VzVXBkYXRlZChldmVudCk7XG5cdFx0dGhpcy5fc3ViR2VvbWV0cnkuYWRkRXZlbnRMaXN0ZW5lcihTdWJHZW9tZXRyeUV2ZW50LlZFUlRJQ0VTX1VQREFURUQsIHRoaXMuX29uVmVydGljZXNVcGRhdGVkRGVsZWdhdGUpO1xuXHR9XG5cblx0cHVibGljIHVwZGF0ZURhdGEob3JpZ2luYWxJbmRpY2VzOkFycmF5PG51bWJlcj4gPSBudWxsLCBpbmRleE1hcHBpbmdzOkFycmF5PG51bWJlcj4gPSBudWxsKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2RhdGFEaXJ0eSkge1xuXHRcdFx0dGhpcy5fZGF0YURpcnR5ID0gZmFsc2U7XG5cblx0XHRcdHRoaXMuZGF0YVBlclZlcnRleCA9IHRoaXMuX3N1Ykdlb21ldHJ5LmdldFN0cmlkZSh0aGlzLl9kYXRhVHlwZSk7XG5cblx0XHRcdHZhciB2ZXJ0aWNlczpBcnJheTxudW1iZXI+ID0gdGhpcy5fc3ViR2VvbWV0cnlbdGhpcy5fZGF0YVR5cGVdO1xuXG5cdFx0XHRpZiAoaW5kZXhNYXBwaW5ncyA9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuc2V0RGF0YSh2ZXJ0aWNlcyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR2YXIgc3BsaXRWZXJ0czpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4ob3JpZ2luYWxJbmRpY2VzLmxlbmd0aCp0aGlzLmRhdGFQZXJWZXJ0ZXgpO1xuXHRcdFx0XHR2YXIgb3JpZ2luYWxJbmRleDpudW1iZXI7XG5cdFx0XHRcdHZhciBzcGxpdEluZGV4Om51bWJlcjtcblx0XHRcdFx0dmFyIGk6bnVtYmVyID0gMDtcblx0XHRcdFx0dmFyIGo6bnVtYmVyID0gMDtcblx0XHRcdFx0d2hpbGUoaSA8IG9yaWdpbmFsSW5kaWNlcy5sZW5ndGgpIHtcblx0XHRcdFx0XHRvcmlnaW5hbEluZGV4ID0gb3JpZ2luYWxJbmRpY2VzW2ldO1xuXG5cdFx0XHRcdFx0c3BsaXRJbmRleCA9IGluZGV4TWFwcGluZ3Nbb3JpZ2luYWxJbmRleF0qdGhpcy5kYXRhUGVyVmVydGV4O1xuXHRcdFx0XHRcdG9yaWdpbmFsSW5kZXggKj0gdGhpcy5kYXRhUGVyVmVydGV4O1xuXG5cdFx0XHRcdFx0Zm9yIChqID0gMDsgaiA8IHRoaXMuZGF0YVBlclZlcnRleDsgaisrKVxuXHRcdFx0XHRcdFx0c3BsaXRWZXJ0c1tzcGxpdEluZGV4ICsgal0gPSB2ZXJ0aWNlc1tvcmlnaW5hbEluZGV4ICsgal07XG5cblx0XHRcdFx0XHRpKys7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLnNldERhdGEoc3BsaXRWZXJ0cyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgODsgKytpKSB7XG5cdFx0XHRpZiAodGhpcy5jb250ZXh0c1tpXSkge1xuXHRcdFx0XHR0aGlzLmJ1ZmZlcnNbaV0uZGlzcG9zZSgpO1xuXHRcdFx0XHR0aGlzLmJ1ZmZlcnNbaV0gPSBudWxsO1xuXHRcdFx0XHR0aGlzLmNvbnRleHRzW2ldID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQHByaXZhdGVcblx0ICovXG5cdHByaXZhdGUgZGlzcG9zZUJ1ZmZlcnMoKVxuXHR7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgODsgKytpKSB7XG5cdFx0XHRpZiAodGhpcy5idWZmZXJzW2ldKSB7XG5cdFx0XHRcdHRoaXMuYnVmZmVyc1tpXS5kaXNwb3NlKCk7XG5cdFx0XHRcdHRoaXMuYnVmZmVyc1tpXSA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIGludmFsaWRhdGVCdWZmZXJzKClcblx0e1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDg7ICsraSlcblx0XHRcdHRoaXMuaW52YWxpZFtpXSA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIGRhdGFcblx0ICogQHBhcmFtIGRhdGFQZXJWZXJ0ZXhcblx0ICogQHByaXZhdGVcblx0ICovXG5cdHByaXZhdGUgc2V0RGF0YShkYXRhOkFycmF5PG51bWJlcj4pXG5cdHtcblx0XHRpZiAodGhpcy5kYXRhICYmIHRoaXMuZGF0YS5sZW5ndGggIT0gZGF0YS5sZW5ndGgpXG5cdFx0XHR0aGlzLmRpc3Bvc2VCdWZmZXJzKCk7XG5cdFx0ZWxzZVxuXHRcdFx0dGhpcy5pbnZhbGlkYXRlQnVmZmVycygpO1xuXG5cdFx0dGhpcy5kYXRhID0gZGF0YTtcblx0fVxuXG5cdC8qKlxuXHQgKiAvL1RPRE9cblx0ICpcblx0ICogQHBhcmFtIGV2ZW50XG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIF9vblZlcnRpY2VzVXBkYXRlZChldmVudDpTdWJHZW9tZXRyeUV2ZW50KVxuXHR7XG5cdFx0dmFyIGRhdGFUeXBlOnN0cmluZyA9IHRoaXMuX3N1Ykdlb21ldHJ5LmNvbmNhdGVuYXRlQXJyYXlzPyBTdWJHZW9tZXRyeUJhc2UuVkVSVEVYX0RBVEEgOiBldmVudC5kYXRhVHlwZTtcblxuXHRcdGlmIChkYXRhVHlwZSA9PSB0aGlzLl9kYXRhVHlwZSlcblx0XHRcdHRoaXMuX2RhdGFEaXJ0eSA9IHRydWU7XG5cdH1cbn1cblxuZXhwb3J0ID0gVmVydGV4RGF0YTsiXX0=
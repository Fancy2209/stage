var SubGeometryBase = require("awayjs-display/lib/base/SubGeometryBase");
var SubGeometryEvent = require("awayjs-display/lib/events/SubGeometryEvent");
/**
 *
 */
var VertexData = (function () {
    function VertexData(subGeometry, dataType) {
        var _this = this;
        this._dataDirty = true;
        this.invalid = new Array(8);
        this.buffers = new Array(8);
        this.contexts = new Array(8);
        this._subGeometry = subGeometry;
        this._dataType = dataType;
        this._onVerticesUpdatedDelegate = function (event) { return _this._onVerticesUpdated(event); };
        this._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);
    }
    VertexData.prototype.updateData = function (originalIndices, indexMappings) {
        if (originalIndices === void 0) { originalIndices = null; }
        if (indexMappings === void 0) { indexMappings = null; }
        if (this._dataDirty) {
            this._dataDirty = false;
            this.dataPerVertex = this._subGeometry.getStride(this._dataType);
            var vertices = this._subGeometry[this._dataType];
            if (indexMappings == null) {
                this.setData(vertices);
            }
            else {
                var splitVerts = new Array(originalIndices.length * this.dataPerVertex);
                var originalIndex;
                var splitIndex;
                var i = 0;
                var j = 0;
                while (i < originalIndices.length) {
                    originalIndex = originalIndices[i];
                    splitIndex = indexMappings[originalIndex] * this.dataPerVertex;
                    originalIndex *= this.dataPerVertex;
                    for (j = 0; j < this.dataPerVertex; j++)
                        splitVerts[splitIndex + j] = vertices[originalIndex + j];
                    i++;
                }
                this.setData(splitVerts);
            }
        }
    };
    VertexData.prototype.dispose = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.contexts[i]) {
                this.contexts[i].disposeVertexData(this);
                this.contexts[i] = null;
            }
        }
    };
    /**
     * @private
     */
    VertexData.prototype.disposeBuffers = function () {
        for (var i = 0; i < 8; ++i) {
            if (this.buffers[i]) {
                this.buffers[i].dispose();
                this.buffers[i] = null;
            }
        }
    };
    /**
     * @private
     */
    VertexData.prototype.invalidateBuffers = function () {
        for (var i = 0; i < 8; ++i)
            this.invalid[i] = true;
    };
    /**
     *
     * @param data
     * @param dataPerVertex
     * @private
     */
    VertexData.prototype.setData = function (data) {
        if (this.data && this.data.length != data.length)
            this.disposeBuffers();
        else
            this.invalidateBuffers();
        this.data = data;
    };
    /**
     * //TODO
     *
     * @param event
     * @private
     */
    VertexData.prototype._onVerticesUpdated = function (event) {
        var dataType = this._subGeometry.concatenateArrays ? SubGeometryBase.VERTEX_DATA : event.dataType;
        if (dataType == this._dataType)
            this._dataDirty = true;
    };
    return VertexData;
})();
module.exports = VertexData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9wb29sL3ZlcnRleGRhdGEudHMiXSwibmFtZXMiOlsiVmVydGV4RGF0YSIsIlZlcnRleERhdGEuY29uc3RydWN0b3IiLCJWZXJ0ZXhEYXRhLnVwZGF0ZURhdGEiLCJWZXJ0ZXhEYXRhLmRpc3Bvc2UiLCJWZXJ0ZXhEYXRhLmRpc3Bvc2VCdWZmZXJzIiwiVmVydGV4RGF0YS5pbnZhbGlkYXRlQnVmZmVycyIsIlZlcnRleERhdGEuc2V0RGF0YSIsIlZlcnRleERhdGEuX29uVmVydGljZXNVcGRhdGVkIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLGVBQWUsV0FBYyx5Q0FBeUMsQ0FBQyxDQUFDO0FBQy9FLElBQU8sZ0JBQWdCLFdBQWMsNENBQTRDLENBQUMsQ0FBQztBQUtuRixBQUdBOztHQURHO0lBQ0csVUFBVTtJQWlCZkEsU0FqQktBLFVBQVVBLENBaUJIQSxXQUEyQkEsRUFBRUEsUUFBZUE7UUFqQnpEQyxpQkF5SENBO1FBcEhRQSxlQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVuQkEsWUFBT0EsR0FBa0JBLElBQUlBLEtBQUtBLENBQVVBLENBQUNBLENBQUNBLENBQUNBO1FBRS9DQSxZQUFPQSxHQUF3QkEsSUFBSUEsS0FBS0EsQ0FBZ0JBLENBQUNBLENBQUNBLENBQUNBO1FBRTNEQSxhQUFRQSxHQUF3QkEsSUFBSUEsS0FBS0EsQ0FBZ0JBLENBQUNBLENBQUNBLENBQUNBO1FBUWxFQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxXQUFXQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsUUFBUUEsQ0FBQ0E7UUFFMUJBLElBQUlBLENBQUNBLDBCQUEwQkEsR0FBR0EsVUFBQ0EsS0FBc0JBLElBQUtBLE9BQUFBLEtBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBOUJBLENBQThCQSxDQUFDQTtRQUM3RkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxnQkFB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QTtRQUVoRE8sSUFBSUEsUUFBUUEsR0FBVUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsaUJBQWlCQSxHQUFFQSxlQUFlQSxDQUFDQSxXQUFXQSxHQUFHQSxLQUFLQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUV4R0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsSUFBSUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7WUFDOUJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUNGUCxpQkFBQ0E7QUFBREEsQ0F6SEEsQUF5SENBLElBQUE7QUFFRCxBQUFvQixpQkFBWCxVQUFVLENBQUMiLCJmaWxlIjoicG9vbC9WZXJ0ZXhEYXRhLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdWJHZW9tZXRyeUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL1N1Ykdlb21ldHJ5QmFzZVwiKTtcbmltcG9ydCBTdWJHZW9tZXRyeUV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL1N1Ykdlb21ldHJ5RXZlbnRcIik7XG5cbmltcG9ydCBDb250ZXh0R0xCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xCYXNlXCIpO1xuaW1wb3J0IElWZXJ0ZXhCdWZmZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lWZXJ0ZXhCdWZmZXJcIik7XG5cbi8qKlxuICpcbiAqL1xuY2xhc3MgVmVydGV4RGF0YVxue1xuXHRwcml2YXRlIF9vblZlcnRpY2VzVXBkYXRlZERlbGVnYXRlOihldmVudDpTdWJHZW9tZXRyeUV2ZW50KSA9PiB2b2lkO1xuXHRwcml2YXRlIF9zdWJHZW9tZXRyeTpTdWJHZW9tZXRyeUJhc2U7XG5cdHByaXZhdGUgX2RhdGFUeXBlOnN0cmluZztcblx0cHJpdmF0ZSBfZGF0YURpcnR5ID0gdHJ1ZTtcblxuXHRwdWJsaWMgaW52YWxpZDpBcnJheTxib29sZWFuPiA9IG5ldyBBcnJheTxib29sZWFuPig4KTtcblxuXHRwdWJsaWMgYnVmZmVyczpBcnJheTxJVmVydGV4QnVmZmVyPiA9IG5ldyBBcnJheTxJVmVydGV4QnVmZmVyPig4KTtcblxuXHRwdWJsaWMgY29udGV4dHM6QXJyYXk8Q29udGV4dEdMQmFzZT4gPSBuZXcgQXJyYXk8Q29udGV4dEdMQmFzZT4oOCk7XG5cblx0cHVibGljIGRhdGE6QXJyYXk8bnVtYmVyPjtcblxuXHRwdWJsaWMgZGF0YVBlclZlcnRleDpudW1iZXI7XG5cblx0Y29uc3RydWN0b3Ioc3ViR2VvbWV0cnk6U3ViR2VvbWV0cnlCYXNlLCBkYXRhVHlwZTpzdHJpbmcpXG5cdHtcblx0XHR0aGlzLl9zdWJHZW9tZXRyeSA9IHN1Ykdlb21ldHJ5O1xuXHRcdHRoaXMuX2RhdGFUeXBlID0gZGF0YVR5cGU7XG5cblx0XHR0aGlzLl9vblZlcnRpY2VzVXBkYXRlZERlbGVnYXRlID0gKGV2ZW50OlN1Ykdlb21ldHJ5RXZlbnQpID0+IHRoaXMuX29uVmVydGljZXNVcGRhdGVkKGV2ZW50KTtcblx0XHR0aGlzLl9zdWJHZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKFN1Ykdlb21ldHJ5RXZlbnQuVkVSVElDRVNfVVBEQVRFRCwgdGhpcy5fb25WZXJ0aWNlc1VwZGF0ZWREZWxlZ2F0ZSk7XG5cdH1cblxuXHRwdWJsaWMgdXBkYXRlRGF0YShvcmlnaW5hbEluZGljZXM6QXJyYXk8bnVtYmVyPiA9IG51bGwsIGluZGV4TWFwcGluZ3M6QXJyYXk8bnVtYmVyPiA9IG51bGwpXG5cdHtcblx0XHRpZiAodGhpcy5fZGF0YURpcnR5KSB7XG5cdFx0XHR0aGlzLl9kYXRhRGlydHkgPSBmYWxzZTtcblxuXHRcdFx0dGhpcy5kYXRhUGVyVmVydGV4ID0gdGhpcy5fc3ViR2VvbWV0cnkuZ2V0U3RyaWRlKHRoaXMuX2RhdGFUeXBlKTtcblxuXHRcdFx0dmFyIHZlcnRpY2VzOkFycmF5PG51bWJlcj4gPSB0aGlzLl9zdWJHZW9tZXRyeVt0aGlzLl9kYXRhVHlwZV07XG5cblx0XHRcdGlmIChpbmRleE1hcHBpbmdzID09IG51bGwpIHtcblx0XHRcdFx0dGhpcy5zZXREYXRhKHZlcnRpY2VzKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZhciBzcGxpdFZlcnRzOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPihvcmlnaW5hbEluZGljZXMubGVuZ3RoKnRoaXMuZGF0YVBlclZlcnRleCk7XG5cdFx0XHRcdHZhciBvcmlnaW5hbEluZGV4Om51bWJlcjtcblx0XHRcdFx0dmFyIHNwbGl0SW5kZXg6bnVtYmVyO1xuXHRcdFx0XHR2YXIgaTpudW1iZXIgPSAwO1xuXHRcdFx0XHR2YXIgajpudW1iZXIgPSAwO1xuXHRcdFx0XHR3aGlsZShpIDwgb3JpZ2luYWxJbmRpY2VzLmxlbmd0aCkge1xuXHRcdFx0XHRcdG9yaWdpbmFsSW5kZXggPSBvcmlnaW5hbEluZGljZXNbaV07XG5cblx0XHRcdFx0XHRzcGxpdEluZGV4ID0gaW5kZXhNYXBwaW5nc1tvcmlnaW5hbEluZGV4XSp0aGlzLmRhdGFQZXJWZXJ0ZXg7XG5cdFx0XHRcdFx0b3JpZ2luYWxJbmRleCAqPSB0aGlzLmRhdGFQZXJWZXJ0ZXg7XG5cblx0XHRcdFx0XHRmb3IgKGogPSAwOyBqIDwgdGhpcy5kYXRhUGVyVmVydGV4OyBqKyspXG5cdFx0XHRcdFx0XHRzcGxpdFZlcnRzW3NwbGl0SW5kZXggKyBqXSA9IHZlcnRpY2VzW29yaWdpbmFsSW5kZXggKyBqXTtcblxuXHRcdFx0XHRcdGkrKztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuc2V0RGF0YShzcGxpdFZlcnRzKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZGlzcG9zZSgpXG5cdHtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA4OyArK2kpIHtcblx0XHRcdGlmICh0aGlzLmNvbnRleHRzW2ldKSB7XG5cdFx0XHRcdHRoaXMuY29udGV4dHNbaV0uZGlzcG9zZVZlcnRleERhdGEodGhpcyk7XG5cdFx0XHRcdHRoaXMuY29udGV4dHNbaV0gPSBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0cHJpdmF0ZSBkaXNwb3NlQnVmZmVycygpXG5cdHtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA4OyArK2kpIHtcblx0XHRcdGlmICh0aGlzLmJ1ZmZlcnNbaV0pIHtcblx0XHRcdFx0dGhpcy5idWZmZXJzW2ldLmRpc3Bvc2UoKTtcblx0XHRcdFx0dGhpcy5idWZmZXJzW2ldID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQHByaXZhdGVcblx0ICovXG5cdHByaXZhdGUgaW52YWxpZGF0ZUJ1ZmZlcnMoKVxuXHR7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgODsgKytpKVxuXHRcdFx0dGhpcy5pbnZhbGlkW2ldID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YVxuXHQgKiBAcGFyYW0gZGF0YVBlclZlcnRleFxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0cHJpdmF0ZSBzZXREYXRhKGRhdGE6QXJyYXk8bnVtYmVyPilcblx0e1xuXHRcdGlmICh0aGlzLmRhdGEgJiYgdGhpcy5kYXRhLmxlbmd0aCAhPSBkYXRhLmxlbmd0aClcblx0XHRcdHRoaXMuZGlzcG9zZUJ1ZmZlcnMoKTtcblx0XHRlbHNlXG5cdFx0XHR0aGlzLmludmFsaWRhdGVCdWZmZXJzKCk7XG5cblx0XHR0aGlzLmRhdGEgPSBkYXRhO1xuXHR9XG5cblx0LyoqXG5cdCAqIC8vVE9ET1xuXHQgKlxuXHQgKiBAcGFyYW0gZXZlbnRcblx0ICogQHByaXZhdGVcblx0ICovXG5cdHByaXZhdGUgX29uVmVydGljZXNVcGRhdGVkKGV2ZW50OlN1Ykdlb21ldHJ5RXZlbnQpXG5cdHtcblx0XHR2YXIgZGF0YVR5cGU6c3RyaW5nID0gdGhpcy5fc3ViR2VvbWV0cnkuY29uY2F0ZW5hdGVBcnJheXM/IFN1Ykdlb21ldHJ5QmFzZS5WRVJURVhfREFUQSA6IGV2ZW50LmRhdGFUeXBlO1xuXG5cdFx0aWYgKGRhdGFUeXBlID09IHRoaXMuX2RhdGFUeXBlKVxuXHRcdFx0dGhpcy5fZGF0YURpcnR5ID0gdHJ1ZTtcblx0fVxufVxuXG5leHBvcnQgPSBWZXJ0ZXhEYXRhOyJdfQ==
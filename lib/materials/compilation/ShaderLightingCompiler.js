var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var LightSources = require("awayjs-core/lib/materials/LightSources");
var ContextGLProfile = require("awayjs-stagegl/lib/core/stagegl/ContextGLProfile");
var ShaderCompilerBase = require("awayjs-stagegl/lib/materials/compilation/ShaderCompilerBase");
/**
 * ShaderCompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a
 * material. Concrete subclasses are used by the default materials.
 *
 * @see away.materials.ShadingMethodBase
 */
var ShaderLightingCompiler = (function (_super) {
    __extends(ShaderLightingCompiler, _super);
    /**
     * Creates a new ShaderCompilerBase object.
     * @param profile The compatibility profile of the renderer.
     */
    function ShaderLightingCompiler(material, materialPass, shaderObject) {
        _super.call(this, material, materialPass, shaderObject);
        this._materialLightingPass = materialPass;
        this._shaderLightingObject = shaderObject;
    }
    /**
     * Compile the code for the methods.
     */
    ShaderLightingCompiler.prototype.pCompileDependencies = function () {
        _super.prototype.pCompileDependencies.call(this);
        //compile the lighting code
        if (this._shaderLightingObject.usesShadows)
            this.pCompileShadowCode();
        if (this._shaderLightingObject.usesLights) {
            this.initLightRegisters();
            this.compileLightCode();
        }
        if (this._shaderLightingObject.usesProbes)
            this.compileLightProbeCode();
        this._pVertexCode += this._materialLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);
        this._pFragmentCode += this._materialLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);
    };
    /**
     * Provides the code to provide shadow mapping.
     */
    ShaderLightingCompiler.prototype.pCompileShadowCode = function () {
        if (this._shaderLightingObject.normalDependencies > 0) {
            this._pSharedRegisters.shadowTarget = this._pSharedRegisters.normalFragment;
        }
        else {
            this._pSharedRegisters.shadowTarget = this._pRegisterCache.getFreeFragmentVectorTemp();
            this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget, 1);
        }
    };
    /**
     * Initializes constant registers to contain light data.
     */
    ShaderLightingCompiler.prototype.initLightRegisters = function () {
        // init these first so we're sure they're in sequence
        var i, len;
        if (this._dirLightVertexConstants) {
            len = this._dirLightVertexConstants.length;
            for (i = 0; i < len; ++i) {
                this._dirLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();
                if (this._shaderLightingObject.lightVertexConstantIndex == -1)
                    this._shaderLightingObject.lightVertexConstantIndex = this._dirLightVertexConstants[i].index * 4;
            }
        }
        if (this._pointLightVertexConstants) {
            len = this._pointLightVertexConstants.length;
            for (i = 0; i < len; ++i) {
                this._pointLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();
                if (this._shaderLightingObject.lightVertexConstantIndex == -1)
                    this._shaderLightingObject.lightVertexConstantIndex = this._pointLightVertexConstants[i].index * 4;
            }
        }
        len = this._dirLightFragmentConstants.length;
        for (i = 0; i < len; ++i) {
            this._dirLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();
            if (this._shaderLightingObject.lightFragmentConstantIndex == -1)
                this._shaderLightingObject.lightFragmentConstantIndex = this._dirLightFragmentConstants[i].index * 4;
        }
        len = this._pointLightFragmentConstants.length;
        for (i = 0; i < len; ++i) {
            this._pointLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();
            if (this._shaderLightingObject.lightFragmentConstantIndex == -1)
                this._shaderLightingObject.lightFragmentConstantIndex = this._pointLightFragmentConstants[i].index * 4;
        }
    };
    /**
     * Compiles the shading code for directional and point lights.
     */
    ShaderLightingCompiler.prototype.compileLightCode = function () {
        var diffuseColorReg;
        var specularColorReg;
        var lightPosReg;
        var lightDirReg;
        var vertexRegIndex = 0;
        var fragmentRegIndex = 0;
        var addSpec = this._shaderLightingObject.usesLightsForSpecular;
        var addDiff = this._shaderLightingObject.usesLightsForDiffuse;
        for (var i = 0; i < this._materialLightingPass.iNumDirectionalLights; ++i) {
            if (this._shaderLightingObject.usesTangentSpace) {
                lightDirReg = this._dirLightVertexConstants[vertexRegIndex++];
                var lightVarying = this._pRegisterCache.getFreeVarying();
                this._pVertexCode += "m33 " + lightVarying + ".xyz, " + lightDirReg + ", " + this._pSharedRegisters.animatedTangent + "\n" + "mov " + lightVarying + ".w, " + lightDirReg + ".w\n";
                lightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();
                this._pRegisterCache.addVertexTempUsages(lightDirReg, 1);
                this._pFragmentCode += "nrm " + lightDirReg + ".xyz, " + lightVarying + "\n" + "mov " + lightDirReg + ".w, " + lightVarying + ".w\n";
            }
            else {
                lightDirReg = this._dirLightFragmentConstants[fragmentRegIndex++];
            }
            diffuseColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];
            specularColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];
            if (addDiff)
                this._pFragmentCode += this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);
            if (addSpec)
                this._pFragmentCode += this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);
            if (this._shaderLightingObject.usesTangentSpace)
                this._pRegisterCache.removeVertexTempUsage(lightDirReg);
        }
        vertexRegIndex = 0;
        fragmentRegIndex = 0;
        for (var i = 0; i < this._materialLightingPass.iNumPointLights; ++i) {
            if (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment)
                lightPosReg = this._pointLightVertexConstants[vertexRegIndex++];
            else
                lightPosReg = this._pointLightFragmentConstants[fragmentRegIndex++];
            diffuseColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];
            specularColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];
            lightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();
            this._pRegisterCache.addFragmentTempUsages(lightDirReg, 1);
            var lightVarying;
            if (this._shaderLightingObject.usesTangentSpace) {
                lightVarying = this._pRegisterCache.getFreeVarying();
                var temp = this._pRegisterCache.getFreeVertexVectorTemp();
                this._pVertexCode += "sub " + temp + ", " + lightPosReg + ", " + this._pSharedRegisters.localPosition + "\n" + "m33 " + lightVarying + ".xyz, " + temp + ", " + this._pSharedRegisters.animatedTangent + "\n" + "mov " + lightVarying + ".w, " + this._pSharedRegisters.localPosition + ".w\n";
            }
            else if (!this._shaderLightingObject.usesGlobalPosFragment) {
                lightVarying = this._pRegisterCache.getFreeVarying();
                this._pVertexCode += "sub " + lightVarying + ", " + lightPosReg + ", " + this._pSharedRegisters.globalPositionVertex + "\n";
            }
            else {
                lightVarying = lightDirReg;
                this._pFragmentCode += "sub " + lightDirReg + ", " + lightPosReg + ", " + this._pSharedRegisters.globalPositionVarying + "\n";
            }
            if (this._shaderLightingObject.usesLightFallOff) {
                // calculate attenuation
                this._pFragmentCode += "dp3 " + lightDirReg + ".w, " + lightVarying + ", " + lightVarying + "\n" + "sub " + lightDirReg + ".w, " + lightDirReg + ".w, " + diffuseColorReg + ".w\n" + "mul " + lightDirReg + ".w, " + lightDirReg + ".w, " + specularColorReg + ".w\n" + "sat " + lightDirReg + ".w, " + lightDirReg + ".w\n" + "sub " + lightDirReg + ".w, " + this._pSharedRegisters.commons + ".w, " + lightDirReg + ".w\n" + "nrm " + lightDirReg + ".xyz, " + lightVarying + "\n";
            }
            else {
                this._pFragmentCode += "nrm " + lightDirReg + ".xyz, " + lightVarying + "\n" + "mov " + lightDirReg + ".w, " + lightVarying + ".w\n";
            }
            if (this._shaderLightingObject.lightFragmentConstantIndex == -1)
                this._shaderLightingObject.lightFragmentConstantIndex = lightPosReg.index * 4;
            if (addDiff)
                this._pFragmentCode += this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);
            if (addSpec)
                this._pFragmentCode += this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);
            this._pRegisterCache.removeFragmentTempUsage(lightDirReg);
        }
    };
    /**
     * Compiles shading code for light probes.
     */
    ShaderLightingCompiler.prototype.compileLightProbeCode = function () {
        var weightReg;
        var weightComponents = [".x", ".y", ".z", ".w"];
        var weightRegisters = new Array();
        var i;
        var texReg;
        var addSpec = this._shaderLightingObject.usesProbesForSpecular;
        var addDiff = this._shaderLightingObject.usesProbesForDiffuse;
        if (addDiff)
            this._shaderLightingObject.lightProbeDiffuseIndices = new Array();
        if (addSpec)
            this._shaderLightingObject.lightProbeSpecularIndices = new Array();
        for (i = 0; i < this._pNumProbeRegisters; ++i) {
            weightRegisters[i] = this._pRegisterCache.getFreeFragmentConstant();
            if (i == 0)
                this._shaderLightingObject.probeWeightsIndex = weightRegisters[i].index * 4;
        }
        for (i = 0; i < this._materialLightingPass.iNumLightProbes; ++i) {
            weightReg = weightRegisters[Math.floor(i / 4)].toString() + weightComponents[i % 4];
            if (addDiff) {
                texReg = this._pRegisterCache.getFreeTextureReg();
                this._shaderLightingObject.lightProbeDiffuseIndices[i] = texReg.index;
                this._pFragmentCode += this._materialLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);
            }
            if (addSpec) {
                texReg = this._pRegisterCache.getFreeTextureReg();
                this._shaderLightingObject.lightProbeSpecularIndices[i] = texReg.index;
                this._pFragmentCode += this._materialLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);
            }
        }
    };
    /**
     * Reset all the indices to "unused".
     */
    ShaderLightingCompiler.prototype.pInitRegisterIndices = function () {
        _super.prototype.pInitRegisterIndices.call(this);
        this._shaderLightingObject.lightVertexConstantIndex = -1;
        this._shaderLightingObject.lightFragmentConstantIndex = -1;
        this._shaderLightingObject.probeWeightsIndex = -1;
        this._pNumProbeRegisters = Math.ceil(this._materialLightingPass.iNumLightProbes / 4);
        //init light data
        if (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment) {
            this._pointLightVertexConstants = new Array(this._materialLightingPass.iNumPointLights);
            this._pointLightFragmentConstants = new Array(this._materialLightingPass.iNumPointLights * 2);
        }
        else {
            this._pointLightFragmentConstants = new Array(this._materialLightingPass.iNumPointLights * 3);
        }
        if (this._shaderLightingObject.usesTangentSpace) {
            this._dirLightVertexConstants = new Array(this._materialLightingPass.iNumDirectionalLights);
            this._dirLightFragmentConstants = new Array(this._materialLightingPass.iNumDirectionalLights * 2);
        }
        else {
            this._dirLightFragmentConstants = new Array(this._materialLightingPass.iNumDirectionalLights * 3);
        }
    };
    /**
     * Figure out which named registers are required, and how often.
     */
    ShaderLightingCompiler.prototype.pCalculateDependencies = function () {
        var numAllLights = this._materialLightingPass.iNumPointLights + this._materialLightingPass.iNumDirectionalLights;
        var numLightProbes = this._materialLightingPass.iNumLightProbes;
        var diffuseLightSources = this._pMaterial.diffuseLightSources;
        var specularLightSources = this._materialLightingPass._iUsesSpecular() ? this._pMaterial.specularLightSources : 0x00;
        var combinedLightSources = diffuseLightSources | specularLightSources;
        this._shaderLightingObject.usesLightFallOff = this._pMaterial.enableLightFallOff && this._shaderLightingObject.profile != ContextGLProfile.BASELINE_CONSTRAINED;
        this._shaderLightingObject.numLights = numAllLights + numLightProbes;
        this._shaderLightingObject.numPointLights = this._materialLightingPass.iNumPointLights;
        this._shaderLightingObject.numDirectionalLights = this._materialLightingPass.iNumDirectionalLights;
        this._shaderLightingObject.numLightProbes = numLightProbes;
        this._shaderLightingObject.pointLightsOffset = this._materialLightingPass.pointLightsOffset;
        this._shaderLightingObject.directionalLightsOffset = this._materialLightingPass.directionalLightsOffset;
        this._shaderLightingObject.lightProbesOffset = this._materialLightingPass.lightProbesOffset;
        this._shaderLightingObject.lightPicker = this._materialLightingPass.lightPicker;
        this._shaderLightingObject.usesLights = numAllLights > 0 && (combinedLightSources & LightSources.LIGHTS) != 0;
        this._shaderLightingObject.usesProbes = numLightProbes > 0 && (combinedLightSources & LightSources.PROBES) != 0;
        this._shaderLightingObject.usesLightsForSpecular = numAllLights > 0 && (specularLightSources & LightSources.LIGHTS) != 0;
        this._shaderLightingObject.usesProbesForSpecular = numLightProbes > 0 && (specularLightSources & LightSources.PROBES) != 0;
        this._shaderLightingObject.usesLightsForDiffuse = numAllLights > 0 && (diffuseLightSources & LightSources.LIGHTS) != 0;
        this._shaderLightingObject.usesProbesForDiffuse = numLightProbes > 0 && (diffuseLightSources & LightSources.PROBES) != 0;
        this._shaderLightingObject.usesShadows = this._materialLightingPass._iUsesShadows();
        _super.prototype.pCalculateDependencies.call(this);
    };
    return ShaderLightingCompiler;
})(ShaderCompilerBase);
module.exports = ShaderLightingCompiler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hdGVyaWFscy9jb21waWxhdGlvbi9zaGFkZXJsaWdodGluZ2NvbXBpbGVyLnRzIl0sIm5hbWVzIjpbIlNoYWRlckxpZ2h0aW5nQ29tcGlsZXIiLCJTaGFkZXJMaWdodGluZ0NvbXBpbGVyLmNvbnN0cnVjdG9yIiwiU2hhZGVyTGlnaHRpbmdDb21waWxlci5wQ29tcGlsZURlcGVuZGVuY2llcyIsIlNoYWRlckxpZ2h0aW5nQ29tcGlsZXIucENvbXBpbGVTaGFkb3dDb2RlIiwiU2hhZGVyTGlnaHRpbmdDb21waWxlci5pbml0TGlnaHRSZWdpc3RlcnMiLCJTaGFkZXJMaWdodGluZ0NvbXBpbGVyLmNvbXBpbGVMaWdodENvZGUiLCJTaGFkZXJMaWdodGluZ0NvbXBpbGVyLmNvbXBpbGVMaWdodFByb2JlQ29kZSIsIlNoYWRlckxpZ2h0aW5nQ29tcGlsZXIucEluaXRSZWdpc3RlckluZGljZXMiLCJTaGFkZXJMaWdodGluZ0NvbXBpbGVyLnBDYWxjdWxhdGVEZXBlbmRlbmNpZXMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sWUFBWSxXQUFlLHdDQUF3QyxDQUFDLENBQUM7QUFFNUUsSUFBTyxnQkFBZ0IsV0FBYyxrREFBa0QsQ0FBQyxDQUFDO0FBRXpGLElBQU8sa0JBQWtCLFdBQWEsNkRBQTZELENBQUMsQ0FBQztBQUtyRyxBQU1BOzs7OztHQURHO0lBQ0csc0JBQXNCO0lBQVNBLFVBQS9CQSxzQkFBc0JBLFVBQTJCQTtJQVd0REE7OztPQUdHQTtJQUNIQSxTQWZLQSxzQkFBc0JBLENBZWZBLFFBQTRCQSxFQUFFQSxZQUFpQ0EsRUFBRUEsWUFBaUNBO1FBRTdHQyxrQkFBTUEsUUFBUUEsRUFBRUEsWUFBWUEsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFFNUNBLElBQUlBLENBQUNBLHFCQUFxQkEsR0FBR0EsWUFBWUEsQ0FBQ0E7UUFDMUNBLElBQUlBLENBQUNBLHFCQUFxQkEsR0FBR0EsWUFBWUEsQ0FBQ0E7SUFDM0NBLENBQUNBO0lBRUREOztPQUVHQTtJQUNJQSxxREFBb0JBLEdBQTNCQTtRQUVDRSxnQkFBS0EsQ0FBQ0Esb0JBQW9CQSxXQUFFQSxDQUFDQTtRQUU3QkEsQUFDQUEsMkJBRDJCQTtRQUMzQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxXQUFXQSxDQUFDQTtZQUMxQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxDQUFDQTtRQUUzQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxDQUFDQTtZQUMxQkEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxFQUFFQSxDQUFDQTtRQUN6QkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxVQUFVQSxDQUFDQTtZQUN6Q0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxFQUFFQSxDQUFDQTtRQUU5QkEsSUFBSUEsQ0FBQ0EsWUFBWUEsSUFBSUEsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSwyQkFBMkJBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsRUFBRUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtRQUN0SkEsSUFBSUEsQ0FBQ0EsY0FBY0EsSUFBSUEsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSw2QkFBNkJBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsRUFBRUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtJQUMzSkEsQ0FBQ0E7SUFFREY7O09BRUdBO0lBQ0lBLG1EQUFrQkEsR0FBekJBO1FBRUNHLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN2REEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGNBQWNBLENBQUNBO1FBQzdFQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLHlCQUF5QkEsRUFBRUEsQ0FBQ0E7WUFDdkZBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNwRkEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFFREg7O09BRUdBO0lBQ0tBLG1EQUFrQkEsR0FBMUJBO1FBRUNJLEFBQ0FBLHFEQURxREE7WUFDakRBLENBQVFBLEVBQUVBLEdBQVVBLENBQUNBO1FBRXpCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUNBLE1BQU1BLENBQUNBO1lBQzNDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtnQkFDMUJBLElBQUlBLENBQUNBLHdCQUF3QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EscUJBQXFCQSxFQUFFQSxDQUFDQTtnQkFFaEZBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0Esd0JBQXdCQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDN0RBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0Esd0JBQXdCQSxHQUFHQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1lBQ2pHQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSwwQkFBMEJBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSwwQkFBMEJBLENBQUNBLE1BQU1BLENBQUNBO1lBQzdDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtnQkFDMUJBLElBQUlBLENBQUNBLDBCQUEwQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EscUJBQXFCQSxFQUFFQSxDQUFDQTtnQkFFbEZBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0Esd0JBQXdCQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDN0RBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0Esd0JBQXdCQSxHQUFHQSxJQUFJQSxDQUFDQSwwQkFBMEJBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1lBQ25HQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUVEQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSwwQkFBMEJBLENBQUNBLE1BQU1BLENBQUNBO1FBQzdDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUMxQkEsSUFBSUEsQ0FBQ0EsMEJBQTBCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1lBRXBGQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxxQkFBcUJBLENBQUNBLDBCQUEwQkEsSUFB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QkFBb0JBLFdBQUVBLENBQUNBO1FBRTdCQSxJQUFJQSxDQUFDQSxxQkFBcUJBLENBQUNBLHdCQUF3QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDekRBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsMEJBQTBCQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzREEsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxpQkFBaUJBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRWxEQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsZUFBZUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFbkZBLEFBQ0FBLGlCQURpQkE7UUFDakJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsZ0JBQWdCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxxQkFBcUJBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdEdBLElBQUlBLENBQUNBLDBCQUEwQkEsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBd0JBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7WUFDL0dBLElBQUlBLENBQUNBLDRCQUE0QkEsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBd0JBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsZUFBZUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDcEhBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLElBQUlBLENBQUNBLDRCQUE0QkEsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBd0JBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsZUFBZUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDcEhBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFD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Y2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtc3RhZ2VnbC8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTGlnaHRTb3VyY2VzXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9tYXRlcmlhbHMvTGlnaHRTb3VyY2VzXCIpO1xuXG5pbXBvcnQgQ29udGV4dEdMUHJvZmlsZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9Db250ZXh0R0xQcm9maWxlXCIpO1xuaW1wb3J0IFN0YWdlR0xNYXRlcmlhbEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL1N0YWdlR0xNYXRlcmlhbEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJDb21waWxlckJhc2VcIik7XG5pbXBvcnQgU2hhZGVyTGlnaHRpbmdPYmplY3RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0XCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcbmltcG9ydCBJTGlnaHRpbmdQYXNzU3RhZ2VHTFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9tYXRlcmlhbHMvcGFzc2VzL0lMaWdodGluZ1Bhc3NTdGFnZUdMXCIpO1xuXG4vKipcbiAqIFNoYWRlckNvbXBpbGVyQmFzZSBpcyBhbiBhYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBzaGFkZXIgY29tcGlsZXJzIHRoYXQgdXNlIG1vZHVsYXIgc2hhZGVyIG1ldGhvZHMgdG8gYXNzZW1ibGUgYVxuICogbWF0ZXJpYWwuIENvbmNyZXRlIHN1YmNsYXNzZXMgYXJlIHVzZWQgYnkgdGhlIGRlZmF1bHQgbWF0ZXJpYWxzLlxuICpcbiAqIEBzZWUgYXdheS5tYXRlcmlhbHMuU2hhZGluZ01ldGhvZEJhc2VcbiAqL1xuY2xhc3MgU2hhZGVyTGlnaHRpbmdDb21waWxlciBleHRlbmRzIFNoYWRlckNvbXBpbGVyQmFzZVxue1xuXHRwcml2YXRlIF9tYXRlcmlhbExpZ2h0aW5nUGFzczpJTGlnaHRpbmdQYXNzU3RhZ2VHTDtcblx0cHJpdmF0ZSBfc2hhZGVyTGlnaHRpbmdPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3Q7XG5cdHB1YmxpYyBfcG9pbnRMaWdodEZyYWdtZW50Q29uc3RhbnRzOkFycmF5PFNoYWRlclJlZ2lzdGVyRWxlbWVudD47XG5cdHB1YmxpYyBfcG9pbnRMaWdodFZlcnRleENvbnN0YW50czpBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+O1xuXHRwdWJsaWMgX2RpckxpZ2h0RnJhZ21lbnRDb25zdGFudHM6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pjtcblx0cHVibGljIF9kaXJMaWdodFZlcnRleENvbnN0YW50czpBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+O1xuXG5cdHB1YmxpYyBfcE51bVByb2JlUmVnaXN0ZXJzOm51bWJlcjtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBTaGFkZXJDb21waWxlckJhc2Ugb2JqZWN0LlxuXHQgKiBAcGFyYW0gcHJvZmlsZSBUaGUgY29tcGF0aWJpbGl0eSBwcm9maWxlIG9mIHRoZSByZW5kZXJlci5cblx0ICovXG5cdGNvbnN0cnVjdG9yKG1hdGVyaWFsOlN0YWdlR0xNYXRlcmlhbEJhc2UsIG1hdGVyaWFsUGFzczpJTGlnaHRpbmdQYXNzU3RhZ2VHTCwgc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0KVxuXHR7XG5cdFx0c3VwZXIobWF0ZXJpYWwsIG1hdGVyaWFsUGFzcywgc2hhZGVyT2JqZWN0KTtcblxuXHRcdHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzID0gbWF0ZXJpYWxQYXNzO1xuXHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0ID0gc2hhZGVyT2JqZWN0O1xuXHR9XG5cblx0LyoqXG5cdCAqIENvbXBpbGUgdGhlIGNvZGUgZm9yIHRoZSBtZXRob2RzLlxuXHQgKi9cblx0cHVibGljIHBDb21waWxlRGVwZW5kZW5jaWVzKClcblx0e1xuXHRcdHN1cGVyLnBDb21waWxlRGVwZW5kZW5jaWVzKCk7XG5cblx0XHQvL2NvbXBpbGUgdGhlIGxpZ2h0aW5nIGNvZGVcblx0XHRpZiAodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1NoYWRvd3MpXG5cdFx0XHR0aGlzLnBDb21waWxlU2hhZG93Q29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNMaWdodHMpIHtcblx0XHRcdHRoaXMuaW5pdExpZ2h0UmVnaXN0ZXJzKCk7XG5cdFx0XHR0aGlzLmNvbXBpbGVMaWdodENvZGUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1Byb2Jlcylcblx0XHRcdHRoaXMuY29tcGlsZUxpZ2h0UHJvYmVDb2RlKCk7XG5cblx0XHR0aGlzLl9wVmVydGV4Q29kZSArPSB0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5faUdldFBvc3RMaWdodGluZ1ZlcnRleENvZGUodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QsIHRoaXMuX3BSZWdpc3RlckNhY2hlLCB0aGlzLl9wU2hhcmVkUmVnaXN0ZXJzKTtcblx0XHR0aGlzLl9wRnJhZ21lbnRDb2RlICs9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLl9pR2V0UG9zdExpZ2h0aW5nRnJhZ21lbnRDb2RlKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LCB0aGlzLl9wUmVnaXN0ZXJDYWNoZSwgdGhpcy5fcFNoYXJlZFJlZ2lzdGVycyk7XG5cdH1cblxuXHQvKipcblx0ICogUHJvdmlkZXMgdGhlIGNvZGUgdG8gcHJvdmlkZSBzaGFkb3cgbWFwcGluZy5cblx0ICovXG5cdHB1YmxpYyBwQ29tcGlsZVNoYWRvd0NvZGUoKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0Lm5vcm1hbERlcGVuZGVuY2llcyA+IDApIHtcblx0XHRcdHRoaXMuX3BTaGFyZWRSZWdpc3RlcnMuc2hhZG93VGFyZ2V0ID0gdGhpcy5fcFNoYXJlZFJlZ2lzdGVycy5ub3JtYWxGcmFnbWVudDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5fcFNoYXJlZFJlZ2lzdGVycy5zaGFkb3dUYXJnZXQgPSB0aGlzLl9wUmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0XHR0aGlzLl9wUmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModGhpcy5fcFNoYXJlZFJlZ2lzdGVycy5zaGFkb3dUYXJnZXQsIDEpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBJbml0aWFsaXplcyBjb25zdGFudCByZWdpc3RlcnMgdG8gY29udGFpbiBsaWdodCBkYXRhLlxuXHQgKi9cblx0cHJpdmF0ZSBpbml0TGlnaHRSZWdpc3RlcnMoKVxuXHR7XG5cdFx0Ly8gaW5pdCB0aGVzZSBmaXJzdCBzbyB3ZSdyZSBzdXJlIHRoZXkncmUgaW4gc2VxdWVuY2Vcblx0XHR2YXIgaTpudW1iZXIsIGxlbjpudW1iZXI7XG5cblx0XHRpZiAodGhpcy5fZGlyTGlnaHRWZXJ0ZXhDb25zdGFudHMpIHtcblx0XHRcdGxlbiA9IHRoaXMuX2RpckxpZ2h0VmVydGV4Q29uc3RhbnRzLmxlbmd0aDtcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0XHR0aGlzLl9kaXJMaWdodFZlcnRleENvbnN0YW50c1tpXSA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXG5cdFx0XHRcdGlmICh0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodFZlcnRleENvbnN0YW50SW5kZXggPT0gLTEpXG5cdFx0XHRcdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRWZXJ0ZXhDb25zdGFudEluZGV4ID0gdGhpcy5fZGlyTGlnaHRWZXJ0ZXhDb25zdGFudHNbaV0uaW5kZXgqNDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy5fcG9pbnRMaWdodFZlcnRleENvbnN0YW50cykge1xuXHRcdFx0bGVuID0gdGhpcy5fcG9pbnRMaWdodFZlcnRleENvbnN0YW50cy5sZW5ndGg7XG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdFx0dGhpcy5fcG9pbnRMaWdodFZlcnRleENvbnN0YW50c1tpXSA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXG5cdFx0XHRcdGlmICh0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodFZlcnRleENvbnN0YW50SW5kZXggPT0gLTEpXG5cdFx0XHRcdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRWZXJ0ZXhDb25zdGFudEluZGV4ID0gdGhpcy5fcG9pbnRMaWdodFZlcnRleENvbnN0YW50c1tpXS5pbmRleCo0O1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGxlbiA9IHRoaXMuX2RpckxpZ2h0RnJhZ21lbnRDb25zdGFudHMubGVuZ3RoO1xuXHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0dGhpcy5fZGlyTGlnaHRGcmFnbWVudENvbnN0YW50c1tpXSA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cblx0XHRcdGlmICh0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodEZyYWdtZW50Q29uc3RhbnRJbmRleCA9PSAtMSlcblx0XHRcdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRGcmFnbWVudENvbnN0YW50SW5kZXggPSB0aGlzLl9kaXJMaWdodEZyYWdtZW50Q29uc3RhbnRzW2ldLmluZGV4KjQ7XG5cdFx0fVxuXG5cdFx0bGVuID0gdGhpcy5fcG9pbnRMaWdodEZyYWdtZW50Q29uc3RhbnRzLmxlbmd0aDtcblx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdHRoaXMuX3BvaW50TGlnaHRGcmFnbWVudENvbnN0YW50c1tpXSA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cblx0XHRcdGlmICh0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodEZyYWdtZW50Q29uc3RhbnRJbmRleCA9PSAtMSlcblx0XHRcdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRGcmFnbWVudENvbnN0YW50SW5kZXggPSB0aGlzLl9wb2ludExpZ2h0RnJhZ21lbnRDb25zdGFudHNbaV0uaW5kZXgqNDtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQ29tcGlsZXMgdGhlIHNoYWRpbmcgY29kZSBmb3IgZGlyZWN0aW9uYWwgYW5kIHBvaW50IGxpZ2h0cy5cblx0ICovXG5cdHByaXZhdGUgY29tcGlsZUxpZ2h0Q29kZSgpXG5cdHtcblx0XHR2YXIgZGlmZnVzZUNvbG9yUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblx0XHR2YXIgc3BlY3VsYXJDb2xvclJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XG5cdFx0dmFyIGxpZ2h0UG9zUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblx0XHR2YXIgbGlnaHREaXJSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xuXHRcdHZhciB2ZXJ0ZXhSZWdJbmRleDpudW1iZXIgPSAwO1xuXHRcdHZhciBmcmFnbWVudFJlZ0luZGV4Om51bWJlciA9IDA7XG5cdFx0dmFyIGFkZFNwZWM6Ym9vbGVhbiA9IHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNMaWdodHNGb3JTcGVjdWxhcjtcblx0XHR2YXIgYWRkRGlmZjpib29sZWFuID0gdGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc0xpZ2h0c0ZvckRpZmZ1c2U7XG5cblx0XHQvL2NvbXBpbGUgdGhlIHNoYWRpbmcgY29kZSBmb3IgZGlyZWN0aW9uYWwgbGlnaHRzLlxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1EaXJlY3Rpb25hbExpZ2h0czsgKytpKSB7XG5cdFx0XHRpZiAodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1RhbmdlbnRTcGFjZSkge1xuXHRcdFx0XHRsaWdodERpclJlZyA9IHRoaXMuX2RpckxpZ2h0VmVydGV4Q29uc3RhbnRzW3ZlcnRleFJlZ0luZGV4KytdO1xuXG5cdFx0XHRcdHZhciBsaWdodFZhcnlpbmc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gdGhpcy5fcFJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZhcnlpbmcoKTtcblxuXHRcdFx0XHR0aGlzLl9wVmVydGV4Q29kZSArPSBcIm0zMyBcIiArIGxpZ2h0VmFyeWluZyArIFwiLnh5eiwgXCIgKyBsaWdodERpclJlZyArIFwiLCBcIiArIHRoaXMuX3BTaGFyZWRSZWdpc3RlcnMuYW5pbWF0ZWRUYW5nZW50ICsgXCJcXG5cIiArXG5cdFx0XHRcdFx0XCJtb3YgXCIgKyBsaWdodFZhcnlpbmcgKyBcIi53LCBcIiArIGxpZ2h0RGlyUmVnICsgXCIud1xcblwiO1xuXG5cdFx0XHRcdGxpZ2h0RGlyUmVnID0gdGhpcy5fcFJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdFx0XHR0aGlzLl9wUmVnaXN0ZXJDYWNoZS5hZGRWZXJ0ZXhUZW1wVXNhZ2VzKGxpZ2h0RGlyUmVnLCAxKTtcblxuXHRcdFx0XHR0aGlzLl9wRnJhZ21lbnRDb2RlICs9IFwibnJtIFwiICsgbGlnaHREaXJSZWcgKyBcIi54eXosIFwiICsgbGlnaHRWYXJ5aW5nICsgXCJcXG5cIiArXG5cdFx0XHRcdFx0XCJtb3YgXCIgKyBsaWdodERpclJlZyArIFwiLncsIFwiICsgbGlnaHRWYXJ5aW5nICsgXCIud1xcblwiO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsaWdodERpclJlZyA9IHRoaXMuX2RpckxpZ2h0RnJhZ21lbnRDb25zdGFudHNbZnJhZ21lbnRSZWdJbmRleCsrXTtcblx0XHRcdH1cblxuXHRcdFx0ZGlmZnVzZUNvbG9yUmVnID0gdGhpcy5fZGlyTGlnaHRGcmFnbWVudENvbnN0YW50c1tmcmFnbWVudFJlZ0luZGV4KytdO1xuXHRcdFx0c3BlY3VsYXJDb2xvclJlZyA9IHRoaXMuX2RpckxpZ2h0RnJhZ21lbnRDb25zdGFudHNbZnJhZ21lbnRSZWdJbmRleCsrXTtcblxuXHRcdFx0aWYgKGFkZERpZmYpXG5cdFx0XHRcdHRoaXMuX3BGcmFnbWVudENvZGUgKz0gdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuX2lHZXRQZXJMaWdodERpZmZ1c2VGcmFnbWVudENvZGUodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QsIGxpZ2h0RGlyUmVnLCBkaWZmdXNlQ29sb3JSZWcsIHRoaXMuX3BSZWdpc3RlckNhY2hlLCB0aGlzLl9wU2hhcmVkUmVnaXN0ZXJzKTtcblxuXHRcdFx0aWYgKGFkZFNwZWMpXG5cdFx0XHRcdHRoaXMuX3BGcmFnbWVudENvZGUgKz0gdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuX2lHZXRQZXJMaWdodFNwZWN1bGFyRnJhZ21lbnRDb2RlKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LCBsaWdodERpclJlZywgc3BlY3VsYXJDb2xvclJlZywgdGhpcy5fcFJlZ2lzdGVyQ2FjaGUsIHRoaXMuX3BTaGFyZWRSZWdpc3RlcnMpO1xuXG5cdFx0XHRpZiAodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1RhbmdlbnRTcGFjZSlcblx0XHRcdFx0dGhpcy5fcFJlZ2lzdGVyQ2FjaGUucmVtb3ZlVmVydGV4VGVtcFVzYWdlKGxpZ2h0RGlyUmVnKTtcblx0XHR9XG5cblx0XHR2ZXJ0ZXhSZWdJbmRleCA9IDA7XG5cdFx0ZnJhZ21lbnRSZWdJbmRleCA9IDA7XG5cblx0XHQvL2NvbXBpbGUgdGhlIHNoYWRpbmcgY29kZSBmb3IgcG9pbnQgbGlnaHRzXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuaU51bVBvaW50TGlnaHRzOyArK2kpIHtcblxuXHRcdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNUYW5nZW50U3BhY2UgfHwgIXRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNHbG9iYWxQb3NGcmFnbWVudClcblx0XHRcdFx0bGlnaHRQb3NSZWcgPSB0aGlzLl9wb2ludExpZ2h0VmVydGV4Q29uc3RhbnRzW3ZlcnRleFJlZ0luZGV4KytdO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHRsaWdodFBvc1JlZyA9IHRoaXMuX3BvaW50TGlnaHRGcmFnbWVudENvbnN0YW50c1tmcmFnbWVudFJlZ0luZGV4KytdO1xuXG5cdFx0XHRkaWZmdXNlQ29sb3JSZWcgPSB0aGlzLl9wb2ludExpZ2h0RnJhZ21lbnRDb25zdGFudHNbZnJhZ21lbnRSZWdJbmRleCsrXTtcblx0XHRcdHNwZWN1bGFyQ29sb3JSZWcgPSB0aGlzLl9wb2ludExpZ2h0RnJhZ21lbnRDb25zdGFudHNbZnJhZ21lbnRSZWdJbmRleCsrXTtcblxuXHRcdFx0bGlnaHREaXJSZWcgPSB0aGlzLl9wUmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0XHR0aGlzLl9wUmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMobGlnaHREaXJSZWcsIDEpO1xuXG5cdFx0XHR2YXIgbGlnaHRWYXJ5aW5nOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblxuXHRcdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNUYW5nZW50U3BhY2UpIHtcblx0XHRcdFx0bGlnaHRWYXJ5aW5nID0gdGhpcy5fcFJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZhcnlpbmcoKTtcblx0XHRcdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gdGhpcy5fcFJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleFZlY3RvclRlbXAoKTtcblx0XHRcdFx0dGhpcy5fcFZlcnRleENvZGUgKz0gXCJzdWIgXCIgKyB0ZW1wICsgXCIsIFwiICsgbGlnaHRQb3NSZWcgKyBcIiwgXCIgKyB0aGlzLl9wU2hhcmVkUmVnaXN0ZXJzLmxvY2FsUG9zaXRpb24gKyBcIlxcblwiICtcblx0XHRcdFx0XHRcIm0zMyBcIiArIGxpZ2h0VmFyeWluZyArIFwiLnh5eiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgdGhpcy5fcFNoYXJlZFJlZ2lzdGVycy5hbmltYXRlZFRhbmdlbnQgKyBcIlxcblwiICtcblx0XHRcdFx0XHRcIm1vdiBcIiArIGxpZ2h0VmFyeWluZyArIFwiLncsIFwiICsgdGhpcy5fcFNoYXJlZFJlZ2lzdGVycy5sb2NhbFBvc2l0aW9uICsgXCIud1xcblwiO1xuXHRcdFx0fSBlbHNlIGlmICghdGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc0dsb2JhbFBvc0ZyYWdtZW50KSB7XG5cdFx0XHRcdGxpZ2h0VmFyeWluZyA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVWYXJ5aW5nKCk7XG5cdFx0XHRcdHRoaXMuX3BWZXJ0ZXhDb2RlICs9IFwic3ViIFwiICsgbGlnaHRWYXJ5aW5nICsgXCIsIFwiICsgbGlnaHRQb3NSZWcgKyBcIiwgXCIgKyB0aGlzLl9wU2hhcmVkUmVnaXN0ZXJzLmdsb2JhbFBvc2l0aW9uVmVydGV4ICsgXCJcXG5cIjtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGxpZ2h0VmFyeWluZyA9IGxpZ2h0RGlyUmVnO1xuXHRcdFx0XHR0aGlzLl9wRnJhZ21lbnRDb2RlICs9IFwic3ViIFwiICsgbGlnaHREaXJSZWcgKyBcIiwgXCIgKyBsaWdodFBvc1JlZyArIFwiLCBcIiArIHRoaXMuX3BTaGFyZWRSZWdpc3RlcnMuZ2xvYmFsUG9zaXRpb25WYXJ5aW5nICsgXCJcXG5cIjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNMaWdodEZhbGxPZmYpIHtcblx0XHRcdFx0Ly8gY2FsY3VsYXRlIGF0dGVudWF0aW9uXG5cdFx0XHRcdHRoaXMuX3BGcmFnbWVudENvZGUgKz0gLy8gYXR0ZW51YXRlXG5cdFx0XHRcdFx0XCJkcDMgXCIgKyBsaWdodERpclJlZyArIFwiLncsIFwiICsgbGlnaHRWYXJ5aW5nICsgXCIsIFwiICsgbGlnaHRWYXJ5aW5nICsgXCJcXG5cIiArIC8vIHcgPSBkIC0gcmFkaXVzXG5cdFx0XHRcdFx0XCJzdWIgXCIgKyBsaWdodERpclJlZyArIFwiLncsIFwiICsgbGlnaHREaXJSZWcgKyBcIi53LCBcIiArIGRpZmZ1c2VDb2xvclJlZyArIFwiLndcXG5cIiArIC8vIHcgPSAoZCAtIHJhZGl1cykvKG1heC1taW4pXG5cdFx0XHRcdFx0XCJtdWwgXCIgKyBsaWdodERpclJlZyArIFwiLncsIFwiICsgbGlnaHREaXJSZWcgKyBcIi53LCBcIiArIHNwZWN1bGFyQ29sb3JSZWcgKyBcIi53XFxuXCIgKyAvLyB3ID0gY2xhbXAodywgMCwgMSlcblx0XHRcdFx0XHRcInNhdCBcIiArIGxpZ2h0RGlyUmVnICsgXCIudywgXCIgKyBsaWdodERpclJlZyArIFwiLndcXG5cIiArIC8vIHcgPSAxLXdcblx0XHRcdFx0XHRcInN1YiBcIiArIGxpZ2h0RGlyUmVnICsgXCIudywgXCIgKyB0aGlzLl9wU2hhcmVkUmVnaXN0ZXJzLmNvbW1vbnMgKyBcIi53LCBcIiArIGxpZ2h0RGlyUmVnICsgXCIud1xcblwiICsgLy8gbm9ybWFsaXplXG5cdFx0XHRcdFx0XCJucm0gXCIgKyBsaWdodERpclJlZyArIFwiLnh5eiwgXCIgKyBsaWdodFZhcnlpbmcgKyBcIlxcblwiO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcEZyYWdtZW50Q29kZSArPSBcIm5ybSBcIiArIGxpZ2h0RGlyUmVnICsgXCIueHl6LCBcIiArIGxpZ2h0VmFyeWluZyArIFwiXFxuXCIgK1xuXHRcdFx0XHRcdFwibW92IFwiICsgbGlnaHREaXJSZWcgKyBcIi53LCBcIiArIGxpZ2h0VmFyeWluZyArIFwiLndcXG5cIjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LmxpZ2h0RnJhZ21lbnRDb25zdGFudEluZGV4ID09IC0xKVxuXHRcdFx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodEZyYWdtZW50Q29uc3RhbnRJbmRleCA9IGxpZ2h0UG9zUmVnLmluZGV4KjQ7XG5cblx0XHRcdGlmIChhZGREaWZmKVxuXHRcdFx0XHR0aGlzLl9wRnJhZ21lbnRDb2RlICs9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLl9pR2V0UGVyTGlnaHREaWZmdXNlRnJhZ21lbnRDb2RlKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LCBsaWdodERpclJlZywgZGlmZnVzZUNvbG9yUmVnLCB0aGlzLl9wUmVnaXN0ZXJDYWNoZSwgdGhpcy5fcFNoYXJlZFJlZ2lzdGVycyk7XG5cblx0XHRcdGlmIChhZGRTcGVjKVxuXHRcdFx0XHR0aGlzLl9wRnJhZ21lbnRDb2RlICs9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLl9pR2V0UGVyTGlnaHRTcGVjdWxhckZyYWdtZW50Q29kZSh0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdCwgbGlnaHREaXJSZWcsIHNwZWN1bGFyQ29sb3JSZWcsIHRoaXMuX3BSZWdpc3RlckNhY2hlLCB0aGlzLl9wU2hhcmVkUmVnaXN0ZXJzKTtcblxuXHRcdFx0dGhpcy5fcFJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UobGlnaHREaXJSZWcpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDb21waWxlcyBzaGFkaW5nIGNvZGUgZm9yIGxpZ2h0IHByb2Jlcy5cblx0ICovXG5cdHByaXZhdGUgY29tcGlsZUxpZ2h0UHJvYmVDb2RlKClcblx0e1xuXHRcdHZhciB3ZWlnaHRSZWc6c3RyaW5nO1xuXHRcdHZhciB3ZWlnaHRDb21wb25lbnRzID0gWyBcIi54XCIsIFwiLnlcIiwgXCIuelwiLCBcIi53XCIgXTtcblx0XHR2YXIgd2VpZ2h0UmVnaXN0ZXJzOkFycmF5PFNoYWRlclJlZ2lzdGVyRWxlbWVudD4gPSBuZXcgQXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50PigpO1xuXHRcdHZhciBpOm51bWJlcjtcblx0XHR2YXIgdGV4UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblx0XHR2YXIgYWRkU3BlYzpib29sZWFuID0gdGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1Byb2Jlc0ZvclNwZWN1bGFyO1xuXHRcdHZhciBhZGREaWZmOmJvb2xlYW4gPSB0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC51c2VzUHJvYmVzRm9yRGlmZnVzZTtcblxuXHRcdGlmIChhZGREaWZmKVxuXHRcdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRQcm9iZURpZmZ1c2VJbmRpY2VzID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblxuXHRcdGlmIChhZGRTcGVjKVxuXHRcdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRQcm9iZVNwZWN1bGFySW5kaWNlcyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XG5cblx0XHRmb3IgKGkgPSAwOyBpIDwgdGhpcy5fcE51bVByb2JlUmVnaXN0ZXJzOyArK2kpIHtcblx0XHRcdHdlaWdodFJlZ2lzdGVyc1tpXSA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cblx0XHRcdGlmIChpID09IDApXG5cdFx0XHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnByb2JlV2VpZ2h0c0luZGV4ID0gd2VpZ2h0UmVnaXN0ZXJzW2ldLmluZGV4KjQ7XG5cdFx0fVxuXG5cdFx0Zm9yIChpID0gMDsgaSA8IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1MaWdodFByb2JlczsgKytpKSB7XG5cdFx0XHR3ZWlnaHRSZWcgPSB3ZWlnaHRSZWdpc3RlcnNbTWF0aC5mbG9vcihpLzQpXS50b1N0cmluZygpICsgd2VpZ2h0Q29tcG9uZW50c1tpJTRdO1xuXG5cdFx0XHRpZiAoYWRkRGlmZikge1xuXHRcdFx0XHR0ZXhSZWcgPSB0aGlzLl9wUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xuXHRcdFx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodFByb2JlRGlmZnVzZUluZGljZXNbaV0gPSB0ZXhSZWcuaW5kZXg7XG5cdFx0XHRcdHRoaXMuX3BGcmFnbWVudENvZGUgKz0gdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuX2lHZXRQZXJQcm9iZURpZmZ1c2VGcmFnbWVudENvZGUodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QsIHRleFJlZywgd2VpZ2h0UmVnLCB0aGlzLl9wUmVnaXN0ZXJDYWNoZSwgdGhpcy5fcFNoYXJlZFJlZ2lzdGVycyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhZGRTcGVjKSB7XG5cdFx0XHRcdHRleFJlZyA9IHRoaXMuX3BSZWdpc3RlckNhY2hlLmdldEZyZWVUZXh0dXJlUmVnKCk7XG5cdFx0XHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LmxpZ2h0UHJvYmVTcGVjdWxhckluZGljZXNbaV0gPSB0ZXhSZWcuaW5kZXg7XG5cdFx0XHRcdHRoaXMuX3BGcmFnbWVudENvZGUgKz0gdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuX2lHZXRQZXJQcm9iZVNwZWN1bGFyRnJhZ21lbnRDb2RlKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LCB0ZXhSZWcsIHdlaWdodFJlZywgdGhpcy5fcFJlZ2lzdGVyQ2FjaGUsIHRoaXMuX3BTaGFyZWRSZWdpc3RlcnMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBSZXNldCBhbGwgdGhlIGluZGljZXMgdG8gXCJ1bnVzZWRcIi5cblx0ICovXG5cdHB1YmxpYyBwSW5pdFJlZ2lzdGVySW5kaWNlcygpXG5cdHtcblx0XHRzdXBlci5wSW5pdFJlZ2lzdGVySW5kaWNlcygpO1xuXG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRWZXJ0ZXhDb25zdGFudEluZGV4ID0gLTE7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRGcmFnbWVudENvbnN0YW50SW5kZXggPSAtMTtcblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5wcm9iZVdlaWdodHNJbmRleCA9IC0xO1xuXG5cdFx0dGhpcy5fcE51bVByb2JlUmVnaXN0ZXJzID0gTWF0aC5jZWlsKHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1MaWdodFByb2Jlcy80KTtcblxuXHRcdC8vaW5pdCBsaWdodCBkYXRhXG5cdFx0aWYgKHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNUYW5nZW50U3BhY2UgfHwgIXRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNHbG9iYWxQb3NGcmFnbWVudCkge1xuXHRcdFx0dGhpcy5fcG9pbnRMaWdodFZlcnRleENvbnN0YW50cyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1Qb2ludExpZ2h0cyk7XG5cdFx0XHR0aGlzLl9wb2ludExpZ2h0RnJhZ21lbnRDb25zdGFudHMgPSBuZXcgQXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pih0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5pTnVtUG9pbnRMaWdodHMqMik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuX3BvaW50TGlnaHRGcmFnbWVudENvbnN0YW50cyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1Qb2ludExpZ2h0cyozKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1RhbmdlbnRTcGFjZSkge1xuXHRcdFx0dGhpcy5fZGlyTGlnaHRWZXJ0ZXhDb25zdGFudHMgPSBuZXcgQXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pih0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5pTnVtRGlyZWN0aW9uYWxMaWdodHMpO1xuXHRcdFx0dGhpcy5fZGlyTGlnaHRGcmFnbWVudENvbnN0YW50cyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1EaXJlY3Rpb25hbExpZ2h0cyoyKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5fZGlyTGlnaHRGcmFnbWVudENvbnN0YW50cyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1EaXJlY3Rpb25hbExpZ2h0cyozKTtcblx0XHR9XG5cdH1cblxuXG5cdC8qKlxuXHQgKiBGaWd1cmUgb3V0IHdoaWNoIG5hbWVkIHJlZ2lzdGVycyBhcmUgcmVxdWlyZWQsIGFuZCBob3cgb2Z0ZW4uXG5cdCAqL1xuXHRwdWJsaWMgcENhbGN1bGF0ZURlcGVuZGVuY2llcygpXG5cdHtcblx0XHR2YXIgbnVtQWxsTGlnaHRzOm51bWJlciA9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1Qb2ludExpZ2h0cyArIHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmlOdW1EaXJlY3Rpb25hbExpZ2h0cztcblx0XHR2YXIgbnVtTGlnaHRQcm9iZXM6bnVtYmVyID0gdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuaU51bUxpZ2h0UHJvYmVzO1xuXHRcdHZhciBkaWZmdXNlTGlnaHRTb3VyY2VzOm51bWJlciA9IHRoaXMuX3BNYXRlcmlhbC5kaWZmdXNlTGlnaHRTb3VyY2VzO1xuXHRcdHZhciBzcGVjdWxhckxpZ2h0U291cmNlczpudW1iZXIgPSB0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5faVVzZXNTcGVjdWxhcigpPyB0aGlzLl9wTWF0ZXJpYWwuc3BlY3VsYXJMaWdodFNvdXJjZXMgOiAweDAwO1xuXHRcdHZhciBjb21iaW5lZExpZ2h0U291cmNlczpudW1iZXIgPSBkaWZmdXNlTGlnaHRTb3VyY2VzIHwgc3BlY3VsYXJMaWdodFNvdXJjZXM7XG5cblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC51c2VzTGlnaHRGYWxsT2ZmID0gdGhpcy5fcE1hdGVyaWFsLmVuYWJsZUxpZ2h0RmFsbE9mZiAmJiB0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5wcm9maWxlICE9IENvbnRleHRHTFByb2ZpbGUuQkFTRUxJTkVfQ09OU1RSQUlORUQ7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubnVtTGlnaHRzID0gbnVtQWxsTGlnaHRzICsgbnVtTGlnaHRQcm9iZXM7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubnVtUG9pbnRMaWdodHMgPSB0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5pTnVtUG9pbnRMaWdodHM7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubnVtRGlyZWN0aW9uYWxMaWdodHMgPSB0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5pTnVtRGlyZWN0aW9uYWxMaWdodHM7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubnVtTGlnaHRQcm9iZXMgPSBudW1MaWdodFByb2Jlcztcblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5wb2ludExpZ2h0c09mZnNldCA9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLnBvaW50TGlnaHRzT2Zmc2V0O1xuXHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LmRpcmVjdGlvbmFsTGlnaHRzT2Zmc2V0ID0gdGhpcy5fbWF0ZXJpYWxMaWdodGluZ1Bhc3MuZGlyZWN0aW9uYWxMaWdodHNPZmZzZXQ7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QubGlnaHRQcm9iZXNPZmZzZXQgPSB0aGlzLl9tYXRlcmlhbExpZ2h0aW5nUGFzcy5saWdodFByb2Jlc09mZnNldDtcblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC5saWdodFBpY2tlciA9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyO1xuXHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNMaWdodHMgPSBudW1BbGxMaWdodHMgPiAwICYmIChjb21iaW5lZExpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5MSUdIVFMpICE9IDA7XG5cdFx0dGhpcy5fc2hhZGVyTGlnaHRpbmdPYmplY3QudXNlc1Byb2JlcyA9IG51bUxpZ2h0UHJvYmVzID4gMCAmJiAoY29tYmluZWRMaWdodFNvdXJjZXMgJiBMaWdodFNvdXJjZXMuUFJPQkVTKSAhPSAwO1xuXHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNMaWdodHNGb3JTcGVjdWxhciA9IG51bUFsbExpZ2h0cyA+IDAgJiYgKHNwZWN1bGFyTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLkxJR0hUUykgIT0gMDtcblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC51c2VzUHJvYmVzRm9yU3BlY3VsYXIgPSBudW1MaWdodFByb2JlcyA+IDAgJiYgKHNwZWN1bGFyTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLlBST0JFUykgIT0gMDtcblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC51c2VzTGlnaHRzRm9yRGlmZnVzZSA9IG51bUFsbExpZ2h0cyA+IDAgJiYgKGRpZmZ1c2VMaWdodFNvdXJjZXMgJiBMaWdodFNvdXJjZXMuTElHSFRTKSAhPSAwO1xuXHRcdHRoaXMuX3NoYWRlckxpZ2h0aW5nT2JqZWN0LnVzZXNQcm9iZXNGb3JEaWZmdXNlID0gbnVtTGlnaHRQcm9iZXMgPiAwICYmIChkaWZmdXNlTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLlBST0JFUykgIT0gMDtcblx0XHR0aGlzLl9zaGFkZXJMaWdodGluZ09iamVjdC51c2VzU2hhZG93cyA9IHRoaXMuX21hdGVyaWFsTGlnaHRpbmdQYXNzLl9pVXNlc1NoYWRvd3MoKTtcblxuXHRcdHN1cGVyLnBDYWxjdWxhdGVEZXBlbmRlbmNpZXMoKTtcblx0fVxufVxuXG5leHBvcnQgPSBTaGFkZXJMaWdodGluZ0NvbXBpbGVyOyJdfQ==
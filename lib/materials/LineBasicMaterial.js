var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/core/stagegl/ContextGLProgramType");
var StageGLMaterialBase = require("awayjs-stagegl/lib/materials/StageGLMaterialBase");
var LineBasicPass = require("awayjs-stagegl/lib/materials/passes/LineBasicPass");
/**
 * LineMaterial is a material exclusively used to render wireframe objects
 *
 * @see away.entities.Lines
 */
var LineBasicMaterial = (function (_super) {
    __extends(LineBasicMaterial, _super);
    /**
     * Creates a new LineMaterial object.
     *
     * @param thickness The thickness of the wireframe lines.
     */
    function LineBasicMaterial(thickness) {
        if (thickness === void 0) { thickness = 1.25; }
        _super.call(this);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = thickness;
        this.bothSides = true;
        this._pAddScreenPass(this._screenPass = new LineBasicPass());
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iGetVertexCode = function (shaderObject, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n" + "mov v0, va3				\n";
    };
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iActivatePass = function (pass, stage, camera) {
        _super.prototype._iActivatePass.call(this, pass, stage, camera);
        var context = stage.context;
        this._constants[0] = this._thickness / ((stage.scissorRect) ? Math.min(stage.scissorRect.width, stage.scissorRect.height) : Math.min(stage.width, stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineBasicMaterial.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineBasicMaterial.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iRenderPass = function (pass, renderable, stage, camera, viewProjection) {
        _super.prototype._iRenderPass.call(this, pass, renderable, stage, camera, viewProjection);
        var context = stage.context;
        this._calcMatrix.copyFrom(renderable.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        context.activateBuffer(0, renderable.getVertexData(LineSubGeometry.START_POSITION_DATA), renderable.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        context.activateBuffer(1, renderable.getVertexData(LineSubGeometry.END_POSITION_DATA), renderable.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        context.activateBuffer(2, renderable.getVertexData(LineSubGeometry.THICKNESS_DATA), renderable.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        context.activateBuffer(3, renderable.getVertexData(LineSubGeometry.COLOR_DATA), renderable.getVertexOffset(LineSubGeometry.COLOR_DATA), LineSubGeometry.COLOR_FORMAT);
        context.drawTriangles(context.getIndexBuffer(renderable.getIndexData()), 0, renderable.numTriangles);
    };
    LineBasicMaterial.pONE_VECTOR = Array(1, 1, 1, 1);
    LineBasicMaterial.pFRONT_VECTOR = Array(0, 0, -1, 0);
    return LineBasicMaterial;
})(StageGLMaterialBase);
module.exports = LineBasicMaterial;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9tYXRlcmlhbHMvbGluZWJhc2ljbWF0ZXJpYWwudHMiXSwibmFtZXMiOlsiTGluZUJhc2ljTWF0ZXJpYWwiLCJMaW5lQmFzaWNNYXRlcmlhbC5jb25zdHJ1Y3RvciIsIkxpbmVCYXNpY01hdGVyaWFsLl9pR2V0VmVydGV4Q29kZSIsIkxpbmVCYXNpY01hdGVyaWFsLl9pQWN0aXZhdGVQYXNzIiwiTGluZUJhc2ljTWF0ZXJpYWwuX2lSZW5kZXJQYXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUVoRSxJQUFPLGVBQWUsV0FBYyx5Q0FBeUMsQ0FBQyxDQUFDO0FBTS9FLElBQU8sb0JBQW9CLFdBQWEsc0RBQXNELENBQUMsQ0FBQztBQUVoRyxJQUFPLG1CQUFtQixXQUFhLGtEQUFrRCxDQUFDLENBQUM7QUFJM0YsSUFBTyxhQUFhLFdBQWMsbURBQW1ELENBQUMsQ0FBQztBQUV2RixBQUtBOzs7O0dBREc7SUFDRyxpQkFBaUI7SUFBU0EsVUFBMUJBLGlCQUFpQkEsVUFBNEJBO0lBV2xEQTs7OztPQUlHQTtJQUNIQSxTQWhCS0EsaUJBQWlCQSxDQWdCVkEsU0FBdUJBO1FBQXZCQyx5QkFBdUJBLEdBQXZCQSxnQkFBdUJBO1FBRWxDQSxpQkFBT0EsQ0FBQ0E7UUFiREEsZUFBVUEsR0FBaUJBLElBQUlBLEtBQUtBLENBQVNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBZWhFQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUU1QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFdEJBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLGFBQWFBLEVBQUVBLENBQUNBLENBQUNBO1FBRTdEQSxJQUFJQSxDQUFDQSxXQUFX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LEVBQUVBLFVBQVVBLENBQUNBLGFBQWFBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLENBQUNBLEVBQUVBLGVBQWVBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7UUFDbExBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGFBQWFBLENBQUNBLGVBQWVBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLGVBQWVBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLGVBQWVBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBO1FBRXRLQSxPQUFPQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtJQUN0R0EsQ0FBQ0E7SUF6SWFKLDZCQUFXQSxHQUFpQkEsS0FBS0EsQ0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLCtCQUFhQSxHQUFpQkEsS0FBS0EsQ0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUF5SXhFQSx3QkFBQ0E7QUFBREEsQ0E1SUEsQUE0SUNBLEVBNUkrQixtQkFBbUIsRUE0SWxEO0FBRUQsQUFBMkIsaUJBQWxCLGlCQUFpQixDQUFDIiwiZmlsZSI6Im1hdGVyaWFscy9MaW5lQmFzaWNNYXRlcmlhbC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcblxuaW1wb3J0IExpbmVTdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGluZVN1Ykdlb21ldHJ5XCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgTWF0ZXJpYWxQYXNzRGF0YVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvcG9vbC9NYXRlcmlhbFBhc3NEYXRhXCIpO1xuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuaW1wb3J0IENvbnRleHRHTFByb2dyYW1UeXBlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9Db250ZXh0R0xQcm9ncmFtVHlwZVwiKTtcbmltcG9ydCBJQ29udGV4dFN0YWdlR0xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3N0YWdlZ2wvSUNvbnRleHRTdGFnZUdMXCIpO1xuaW1wb3J0IFN0YWdlR0xNYXRlcmlhbEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL1N0YWdlR0xNYXRlcmlhbEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyT2JqZWN0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckRhdGFcIik7XG5pbXBvcnQgTGluZUJhc2ljUGFzc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9wYXNzZXMvTGluZUJhc2ljUGFzc1wiKTtcblxuLyoqXG4gKiBMaW5lTWF0ZXJpYWwgaXMgYSBtYXRlcmlhbCBleGNsdXNpdmVseSB1c2VkIHRvIHJlbmRlciB3aXJlZnJhbWUgb2JqZWN0c1xuICpcbiAqIEBzZWUgYXdheS5lbnRpdGllcy5MaW5lc1xuICovXG5jbGFzcyBMaW5lQmFzaWNNYXRlcmlhbCBleHRlbmRzIFN0YWdlR0xNYXRlcmlhbEJhc2Vcbntcblx0cHVibGljIHN0YXRpYyBwT05FX1ZFQ1RPUjpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigxLCAxLCAxLCAxKTtcblx0cHVibGljIHN0YXRpYyBwRlJPTlRfVkVDVE9SOkFycmF5PG51bWJlcj4gPSBBcnJheTxudW1iZXI+KDAsIDAsIC0xLCAwKTtcblxuXHRwcml2YXRlIF9jb25zdGFudHM6QXJyYXk8bnVtYmVyPiA9IG5ldyBBcnJheTxudW1iZXI+KDAsIDAsIDAsIDApO1xuXHRwcml2YXRlIF9jYWxjTWF0cml4Ok1hdHJpeDNEO1xuXHRwcml2YXRlIF90aGlja25lc3M6bnVtYmVyO1xuXG5cdHByaXZhdGUgX3NjcmVlblBhc3M6TGluZUJhc2ljUGFzcztcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBMaW5lTWF0ZXJpYWwgb2JqZWN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gdGhpY2tuZXNzIFRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZSBsaW5lcy5cblx0ICovXG5cdGNvbnN0cnVjdG9yKHRoaWNrbmVzczpudW1iZXIgPSAxLjI1KVxuXHR7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMuX3RoaWNrbmVzcyA9IHRoaWNrbmVzcztcblxuXHRcdHRoaXMuYm90aFNpZGVzID0gdHJ1ZTtcblxuXHRcdHRoaXMuX3BBZGRTY3JlZW5QYXNzKHRoaXMuX3NjcmVlblBhc3MgPSBuZXcgTGluZUJhc2ljUGFzcygpKTtcblxuXHRcdHRoaXMuX2NhbGNNYXRyaXggPSBuZXcgTWF0cml4M0QoKTtcblxuXHRcdHRoaXMuX2NvbnN0YW50c1sxXSA9IDEvMjU1O1xuXHR9XG5cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaUdldFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZzpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0cmV0dXJuIFwibTQ0IHZ0MCwgdmEwLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBleWUgc3BhY2Vcblx0XHRcdFwibTQ0IHZ0MSwgdmExLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMSB0byBleWUgc3BhY2Vcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXG5cdFx0XHQvLyB0ZXN0IGlmIGJlaGluZCBjYW1lcmEgbmVhciBwbGFuZVxuXHRcdFx0Ly8gaWYgMCAtIFEwLnogPCBDYW1lcmEubmVhciB0aGVuIHRoZSBwb2ludCBuZWVkcyB0byBiZSBjbGlwcGVkXG5cdFx0XHQvL1wibmVnIHZ0NS54LCB2dDAuelx0XHRcdFx0XFxuXCIgKyAvLyAwIC0gUTAuelxuXHRcdFx0XCJzbHQgdnQ1LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gYmVoaW5kID0gKCAwIC0gUTAueiA8IC1DYW1lcmEubmVhciApID8gMSA6IDBcblx0XHRcdFwic3ViIHZ0NS55LCB2YzUueCwgdnQ1LnhcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgPSAxIC0gYmVoaW5kXG5cblx0XHRcdC8vIHAgPSBwb2ludCBvbiB0aGUgcGxhbmUgKDAsMCwtbmVhcilcblx0XHRcdC8vIG4gPSBwbGFuZSBub3JtYWwgKDAsMCwtMSlcblx0XHRcdC8vIEQgPSBRMSAtIFEwXG5cdFx0XHQvLyB0ID0gKCBkb3QoIG4sICggcCAtIFEwICkgKSAvICggZG90KCBuLCBkIClcblxuXHRcdFx0Ly8gc29sdmUgZm9yIHQgd2hlcmUgbGluZSBjcm9zc2VzIENhbWVyYS5uZWFyXG5cdFx0XHRcImFkZCB2dDQueCwgdnQwLnosIHZjNy56XHRcdFx0XFxuXCIgKyAvLyBRMC56ICsgKCAtQ2FtZXJhLm5lYXIgKVxuXHRcdFx0XCJzdWIgdnQ0LnksIHZ0MC56LCB2dDEuelx0XHRcdFxcblwiICsgLy8gUTAueiAtIFExLnpcblxuXHRcdFx0Ly8gZml4IGRpdmlkZSBieSB6ZXJvIGZvciBob3Jpem9udGFsIGxpbmVzXG5cdFx0XHRcInNlcSB2dDQueiwgdnQ0LnkgdmM2LnhcdFx0XHRcXG5cIiArIC8vIG9mZnNldCA9IChRMC56IC0gUTEueik9PTAgPyAxIDogMFxuXHRcdFx0XCJhZGQgdnQ0LnksIHZ0NC55LCB2dDQuelx0XHRcdFxcblwiICsgLy8gKCBRMC56IC0gUTEueiApICsgb2Zmc2V0XG5cblx0XHRcdFwiZGl2IHZ0NC56LCB2dDQueCwgdnQ0LnlcdFx0XHRcXG5cIiArIC8vIHQgPSAoIFEwLnogLSBuZWFyICkgLyAoIFEwLnogLSBRMS56IClcblxuXHRcdFx0XCJtdWwgdnQ0Lnh5eiwgdnQ0Lnp6eiwgdnQyLnh5elx0XFxuXCIgKyAvLyB0KEwpXG5cdFx0XHRcImFkZCB2dDMueHl6LCB2dDAueHl6LCB2dDQueHl6XHRcXG5cIiArIC8vIFFjbGlwcGVkID0gUTAgKyB0KEwpXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFFjbGlwcGVkLncgPSAxXG5cblx0XHRcdC8vIElmIG5lY2Vzc2FyeSwgcmVwbGFjZSBRMCB3aXRoIG5ldyBRY2xpcHBlZFxuXHRcdFx0XCJtdWwgdnQwLCB2dDAsIHZ0NS55eXl5XHRcdFx0XFxuXCIgKyAvLyAhYmVoaW5kICogUTBcblx0XHRcdFwibXVsIHZ0MywgdnQzLCB2dDUueHh4eFx0XHRcdFxcblwiICsgLy8gYmVoaW5kICogUWNsaXBwZWRcblx0XHRcdFwiYWRkIHZ0MCwgdnQwLCB2dDNcdFx0XHRcdFxcblwiICsgLy8gbmV3UTAgPSBRMCArIFFjbGlwcGVkXG5cblx0XHRcdC8vIGNhbGN1bGF0ZSBzaWRlIHZlY3RvciBmb3IgbGluZVxuXHRcdFx0XCJzdWIgdnQyLCB2dDEsIHZ0MCBcdFx0XHRcXG5cIiArIC8vIEwgPSBRMSAtIFEwXG5cdFx0XHRcIm5ybSB2dDIueHl6LCB2dDIueHl6XHRcdFx0XFxuXCIgKyAvLyBub3JtYWxpemUoIEwgKVxuXHRcdFx0XCJucm0gdnQ1Lnh5eiwgdnQwLnh5elx0XHRcdFxcblwiICsgLy8gRCA9IG5vcm1hbGl6ZSggUTEgKVxuXHRcdFx0XCJtb3YgdnQ1LncsIHZjNS54XHRcdFx0XHRcXG5cIiArIC8vIEQudyA9IDFcblx0XHRcdFwiY3JzIHZ0My54eXosIHZ0MiwgdnQ1XHRcdFx0XFxuXCIgKyAvLyBTID0gTCB4IERcblx0XHRcdFwibnJtIHZ0My54eXosIHZ0My54eXpcdFx0XHRcXG5cIiArIC8vIG5vcm1hbGl6ZSggUyApXG5cblx0XHRcdC8vIGZhY2UgdGhlIHNpZGUgdmVjdG9yIHByb3Blcmx5IGZvciB0aGUgZ2l2ZW4gcG9pbnRcblx0XHRcdFwibXVsIHZ0My54eXosIHZ0My54eXosIHZhMi54eHhcdFxcblwiICsgLy8gUyAqPSB3ZWlnaHRcblx0XHRcdFwibW92IHZ0My53LCB2YzUueFx0XHRcdFxcblwiICsgLy8gUy53ID0gMVxuXG5cdFx0XHQvLyBjYWxjdWxhdGUgdGhlIGFtb3VudCByZXF1aXJlZCB0byBtb3ZlIGF0IHRoZSBwb2ludCdzIGRpc3RhbmNlIHRvIGNvcnJlc3BvbmQgdG8gdGhlIGxpbmUncyBwaXhlbCB3aWR0aFxuXHRcdFx0Ly8gc2NhbGUgdGhlIHNpZGUgdmVjdG9yIGJ5IHRoYXQgYW1vdW50XG5cdFx0XHRcImRwMyB2dDQueCwgdnQwLCB2YzZcdFx0XHRcXG5cIiArIC8vIGRpc3RhbmNlID0gZG90KCB2aWV3IClcblx0XHRcdFwibXVsIHZ0NC54LCB2dDQueCwgdmM3LnhcdFx0XHRcXG5cIiArIC8vIGRpc3RhbmNlICo9IHZwc29kXG5cdFx0XHRcIm11bCB2dDMueHl6LCB2dDMueHl6LCB2dDQueHh4XHRcXG5cIiArIC8vIFMueHl6ICo9IHBpeGVsU2NhbGVGYWN0b3JcblxuXHRcdFx0Ly8gYWRkIHNjYWxlZCBzaWRlIHZlY3RvciB0byBRMCBhbmQgdHJhbnNmb3JtIHRvIGNsaXAgc3BhY2Vcblx0XHRcdFwiYWRkIHZ0MC54eXosIHZ0MC54eXosIHZ0My54eXpcdFxcblwiICsgLy8gUTAgKyBTXG5cblx0XHRcdFwibTQ0IG9wLCB2dDAsIHZjMFx0XHRcdFxcblwiICsgLy8gdHJhbnNmb3JtIFEwIHRvIGNsaXAgc3BhY2VcblxuXHRcdFx0Ly8gaW50ZXJwb2xhdGUgY29sb3Jcblx0XHRcdFwibW92IHYwLCB2YTNcdFx0XHRcdFxcblwiO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lBY3RpdmF0ZVBhc3MocGFzczpNYXRlcmlhbFBhc3NEYXRhLCBzdGFnZTpTdGFnZSwgY2FtZXJhOkNhbWVyYSlcblx0e1xuXHRcdHN1cGVyLl9pQWN0aXZhdGVQYXNzKHBhc3MsIHN0YWdlLCBjYW1lcmEpO1xuXG5cdFx0dmFyIGNvbnRleHQ6SUNvbnRleHRTdGFnZUdMID0gPElDb250ZXh0U3RhZ2VHTD4gc3RhZ2UuY29udGV4dDtcblxuXHRcdHRoaXMuX2NvbnN0YW50c1swXSA9IHRoaXMuX3RoaWNrbmVzcy8oKHN0YWdlLnNjaXNzb3JSZWN0KT8gTWF0aC5taW4oc3RhZ2Uuc2Npc3NvclJlY3Qud2lkdGgsIHN0YWdlLnNjaXNzb3JSZWN0LmhlaWdodCkgOiBNYXRoLm1pbihzdGFnZS53aWR0aCwgc3RhZ2UuaGVpZ2h0KSk7XG5cblx0XHQvLyB2YWx1ZSB0byBjb252ZXJ0IGRpc3RhbmNlIGZyb20gY2FtZXJhIHRvIG1vZGVsIGxlbmd0aCBwZXIgcGl4ZWwgd2lkdGhcblx0XHR0aGlzLl9jb25zdGFudHNbMl0gPSBjYW1lcmEucHJvamVjdGlvbi5uZWFyO1xuXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgNSwgTGluZUJhc2ljTWF0ZXJpYWwucE9ORV9WRUNUT1IsIDEpO1xuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDYsIExpbmVCYXNpY01hdGVyaWFsLnBGUk9OVF9WRUNUT1IsIDEpO1xuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDcsIHRoaXMuX2NvbnN0YW50cywgMSk7XG5cblx0XHQvLyBwcm9qZWN0aW9uIG1hdHJpeFxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21NYXRyaXgoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCAwLCBjYW1lcmEucHJvamVjdGlvbi5tYXRyaXgsIHRydWUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lSZW5kZXJQYXNzKHBhc3M6TWF0ZXJpYWxQYXNzRGF0YSwgcmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgc3RhZ2U6U3RhZ2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxuXHR7XG5cdFx0c3VwZXIuX2lSZW5kZXJQYXNzKHBhc3MsIHJlbmRlcmFibGUsIHN0YWdlLCBjYW1lcmEsIHZpZXdQcm9qZWN0aW9uKTtcblxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0U3RhZ2VHTCA9IDxJQ29udGV4dFN0YWdlR0w+IHN0YWdlLmNvbnRleHQ7XG5cdFx0dGhpcy5fY2FsY01hdHJpeC5jb3B5RnJvbShyZW5kZXJhYmxlLnNvdXJjZUVudGl0eS5zY2VuZVRyYW5zZm9ybSk7XG5cdFx0dGhpcy5fY2FsY01hdHJpeC5hcHBlbmQoY2FtZXJhLmludmVyc2VTY2VuZVRyYW5zZm9ybSk7XG5cblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tTWF0cml4KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgOCwgdGhpcy5fY2FsY01hdHJpeCwgdHJ1ZSk7XG5cblx0XHRjb250ZXh0LmFjdGl2YXRlQnVmZmVyKDAsIHJlbmRlcmFibGUuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuU1RBUlRfUE9TSVRJT05fREFUQSksIHJlbmRlcmFibGUuZ2V0VmVydGV4T2Zmc2V0KExpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0ZPUk1BVCk7XG5cdFx0Y29udGV4dC5hY3RpdmF0ZUJ1ZmZlcigxLCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0ZPUk1BVCk7XG5cdFx0Y29udGV4dC5hY3RpdmF0ZUJ1ZmZlcigyLCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19GT1JNQVQpO1xuXHRcdGNvbnRleHQuYWN0aXZhdGVCdWZmZXIoMywgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5DT0xPUl9EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LkNPTE9SX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuQ09MT1JfRk9STUFUKTtcblxuXHRcdGNvbnRleHQuZHJhd1RyaWFuZ2xlcyhjb250ZXh0LmdldEluZGV4QnVmZmVyKHJlbmRlcmFibGUuZ2V0SW5kZXhEYXRhKCkpLCAwLCByZW5kZXJhYmxlLm51bVRyaWFuZ2xlcyk7XG5cdH1cbn1cblxuZXhwb3J0ID0gTGluZUJhc2ljTWF0ZXJpYWw7Il19
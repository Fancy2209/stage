var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var AGALMiniAssembler = require("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");
var ContextGLTextureFormat = require("awayjs-stagegl/lib/core/stagegl/ContextGLTextureFormat");
var Filter3DTaskBase = (function () {
    function Filter3DTaskBase(requireDepthRender) {
        if (requireDepthRender === void 0) { requireDepthRender = false; }
        this._scaledTextureWidth = -1;
        this._scaledTextureHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._textureDimensionsInvalid = true;
        this._program3DInvalid = true;
        this._textureScale = 0;
        this._requireDepthRender = requireDepthRender;
    }
    Object.defineProperty(Filter3DTaskBase.prototype, "textureScale", {
        /**
         * The texture scale for the input of this texture. This will define the output of the previous entry in the chain
         */
        get: function () {
            return this._textureScale;
        },
        set: function (value) {
            if (this._textureScale == value)
                return;
            this._textureScale = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "target", {
        get: function () {
            return this._target;
        },
        set: function (value) {
            this._target = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        set: function (value) {
            if (this._textureWidth == value)
                return;
            this._textureWidth = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        set: function (value) {
            if (this._textureHeight == value)
                return;
            this._textureHeight = value;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Filter3DTaskBase.prototype.getMainInputTexture = function (stage) {
        if (this._textureDimensionsInvalid)
            this.pUpdateTextures(stage);
        return this._mainInputTexture;
    };
    Filter3DTaskBase.prototype.dispose = function () {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        if (this._program3D)
            this._program3D.dispose();
    };
    Filter3DTaskBase.prototype.pInvalidateProgram = function () {
        this._program3DInvalid = true;
    };
    Filter3DTaskBase.prototype.pUpdateProgram = function (stage) {
        if (this._program3D)
            this._program3D.dispose();
        this._program3D = stage.context.createProgram();
        var vertexByteCode = (new AGALMiniAssembler().assemble("part vertex 1\n" + this.pGetVertexCode() + "endpart"))['vertex'].data;
        var fragmentByteCode = (new AGALMiniAssembler().assemble("part fragment 1\n" + this.pGetFragmentCode() + "endpart"))['fragment'].data;
        this._program3D.upload(vertexByteCode, fragmentByteCode);
        this._program3DInvalid = false;
    };
    Filter3DTaskBase.prototype.pGetVertexCode = function () {
        // TODO: imeplement AGAL <> GLSL
        return "mov op, va0\n" + "mov v0, va1\n";
    };
    Filter3DTaskBase.prototype.pGetFragmentCode = function () {
        throw new AbstractMethodError();
        return null;
    };
    Filter3DTaskBase.prototype.pUpdateTextures = function (stage) {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        this._mainInputTexture = stage.context.createTexture(this._scaledTextureWidth, this._scaledTextureHeight, ContextGLTextureFormat.BGRA, true);
        this._textureDimensionsInvalid = false;
    };
    Filter3DTaskBase.prototype.getProgram = function (stage) {
        if (this._program3DInvalid)
            this.pUpdateProgram(stage);
        return this._program3D;
    };
    Filter3DTaskBase.prototype.activate = function (stage, camera, depthTexture) {
    };
    Filter3DTaskBase.prototype.deactivate = function (stage) {
    };
    Object.defineProperty(Filter3DTaskBase.prototype, "requireDepthRender", {
        get: function () {
            return this._requireDepthRender;
        },
        enumerable: true,
        configurable: true
    });
    return Filter3DTaskBase;
})();
module.exports = Filter3DTaskBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9maWx0ZXJzL3Rhc2tzL2ZpbHRlcjNkdGFza2Jhc2UudHMiXSwibmFtZXMiOlsiRmlsdGVyM0RUYXNrQmFzZSIsIkZpbHRlcjNEVGFza0Jhc2UuY29uc3RydWN0b3IiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVTY2FsZSIsIkZpbHRlcjNEVGFza0Jhc2UudGFyZ2V0IiwiRmlsdGVyM0RUYXNrQmFzZS50ZXh0dXJlV2lkdGgiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVIZWlnaHQiLCJGaWx0ZXIzRFRhc2tCYXNlLmdldE1haW5JbnB1dFRleHR1cmUiLCJGaWx0ZXIzRFRhc2tCYXNlLmRpc3Bvc2UiLCJGaWx0ZXIzRFRhc2tCYXNlLnBJbnZhbGlkYXRlUHJvZ3JhbSIsIkZpbHRlcjNEVGFza0Jhc2UucFVwZGF0ZVByb2dyYW0iLCJGaWx0ZXIzRFRhc2tCYXNlLnBHZXRWZXJ0ZXhDb2RlIiwiRmlsdGVyM0RUYXNrQmFzZS5wR2V0RnJhZ21lbnRDb2RlIiwiRmlsdGVyM0RUYXNrQmFzZS5wVXBkYXRlVGV4dHVyZXMiLCJGaWx0ZXIzRFRhc2tCYXNlLmdldFByb2dyYW0iLCJGaWx0ZXIzRFRhc2tCYXNlLmFjdGl2YXRlIiwiRmlsdGVyM0RUYXNrQmFzZS5kZWFjdGl2YXRlIiwiRmlsdGVyM0RUYXNrQmFzZS5yZXF1aXJlRGVwdGhSZW5kZXIiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sbUJBQW1CLFdBQWEsNENBQTRDLENBQUMsQ0FBQztBQU1yRixJQUFPLGlCQUFpQixXQUFhLHNEQUFzRCxDQUFDLENBQUM7QUFDN0YsSUFBTyxzQkFBc0IsV0FBWSx3REFBd0QsQ0FBQyxDQUFDO0FBS25HLElBQU0sZ0JBQWdCO0lBZXJCQSxTQWZLQSxnQkFBZ0JBLENBZVRBLGtCQUFrQ0E7UUFBbENDLGtDQUFrQ0EsR0FBbENBLDBCQUFrQ0E7UUFYdENBLHdCQUFtQkEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLHlCQUFvQkEs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cUJBO0lBRWpFYyxDQUFDQTtJQUVNZCxxQ0FBVUEsR0FBakJBLFVBQWtCQSxLQUFXQTtJQUU3QmUsQ0FBQ0E7SUFFRGYsc0JBQVdBLGdEQUFrQkE7YUFBN0JBO1lBRUNnQixNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBO1FBQ2pDQSxDQUFDQTs7O09BQUFoQjtJQUVGQSx1QkFBQ0E7QUFBREEsQ0FqS0EsQUFpS0NBLElBQUE7QUFFRCxBQUEwQixpQkFBakIsZ0JBQWdCLENBQUMiLCJmaWxlIjoiZmlsdGVycy90YXNrcy9GaWx0ZXIzRFRhc2tCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xuaW1wb3J0IEJ5dGVBcnJheVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvQnl0ZUFycmF5XCIpO1xuXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvYmFzZS9TdGFnZVwiKTtcbmltcG9ydCBBR0FMTWluaUFzc2VtYmxlclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hZ2xzbC9hc3NlbWJsZXIvQUdBTE1pbmlBc3NlbWJsZXJcIik7XG5pbXBvcnQgQ29udGV4dEdMVGV4dHVyZUZvcm1hdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0NvbnRleHRHTFRleHR1cmVGb3JtYXRcIik7XG5pbXBvcnQgSUNvbnRleHRTdGFnZUdMXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0lDb250ZXh0U3RhZ2VHTFwiKTtcbmltcG9ydCBJUHJvZ3JhbVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3N0YWdlZ2wvSVByb2dyYW1cIik7XG5pbXBvcnQgSVRleHR1cmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0lUZXh0dXJlXCIpO1xuXG5jbGFzcyBGaWx0ZXIzRFRhc2tCYXNlXG57XG5cdHByaXZhdGUgX21haW5JbnB1dFRleHR1cmU6SVRleHR1cmU7XG5cblx0cHJpdmF0ZSBfc2NhbGVkVGV4dHVyZVdpZHRoOm51bWJlciA9IC0xO1xuXHRwcml2YXRlIF9zY2FsZWRUZXh0dXJlSGVpZ2h0Om51bWJlciA9IC0xO1xuXHRwcml2YXRlIF90ZXh0dXJlV2lkdGg6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3RleHR1cmVIZWlnaHQ6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZDpib29sZWFuID0gdHJ1ZTtcblx0cHJpdmF0ZSBfcHJvZ3JhbTNESW52YWxpZDpib29sZWFuID0gdHJ1ZTtcblx0cHJpdmF0ZSBfcHJvZ3JhbTNEOklQcm9ncmFtO1xuXHRwcml2YXRlIF90YXJnZXQ6SVRleHR1cmU7XG5cdHByaXZhdGUgX3JlcXVpcmVEZXB0aFJlbmRlcjpib29sZWFuO1xuXHRwcml2YXRlIF90ZXh0dXJlU2NhbGU6bnVtYmVyID0gMDtcblxuXHRjb25zdHJ1Y3RvcihyZXF1aXJlRGVwdGhSZW5kZXI6Ym9vbGVhbiA9IGZhbHNlKVxuXHR7XG5cblx0XHR0aGlzLl9yZXF1aXJlRGVwdGhSZW5kZXIgPSByZXF1aXJlRGVwdGhSZW5kZXI7XG5cblx0fVxuXG5cdC8qKlxuXHQgKiBUaGUgdGV4dHVyZSBzY2FsZSBmb3IgdGhlIGlucHV0IG9mIHRoaXMgdGV4dHVyZS4gVGhpcyB3aWxsIGRlZmluZSB0aGUgb3V0cHV0IG9mIHRoZSBwcmV2aW91cyBlbnRyeSBpbiB0aGUgY2hhaW5cblx0ICovXG5cdHB1YmxpYyBnZXQgdGV4dHVyZVNjYWxlKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZVNjYWxlO1xuXHR9XG5cblx0cHVibGljIHNldCB0ZXh0dXJlU2NhbGUodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3RleHR1cmVTY2FsZSA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3RleHR1cmVTY2FsZSA9IHZhbHVlO1xuXHRcdHRoaXMuX3NjYWxlZFRleHR1cmVXaWR0aCA9IHRoaXMuX3RleHR1cmVXaWR0aCA+PiB0aGlzLl90ZXh0dXJlU2NhbGU7XG5cdFx0dGhpcy5fc2NhbGVkVGV4dHVyZUhlaWdodCA9IHRoaXMuX3RleHR1cmVIZWlnaHQgPj4gdGhpcy5fdGV4dHVyZVNjYWxlO1xuXHRcdHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZCA9IHRydWU7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHRhcmdldCgpOklUZXh0dXJlXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdGFyZ2V0O1xuXHR9XG5cblx0cHVibGljIHNldCB0YXJnZXQodmFsdWU6SVRleHR1cmUpXG5cdHtcblx0XHR0aGlzLl90YXJnZXQgPSB2YWx1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgdGV4dHVyZVdpZHRoKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZVdpZHRoO1xuXHR9XG5cblx0cHVibGljIHNldCB0ZXh0dXJlV2lkdGgodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3RleHR1cmVXaWR0aCA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3RleHR1cmVXaWR0aCA9IHZhbHVlO1xuXHRcdHRoaXMuX3NjYWxlZFRleHR1cmVXaWR0aCA9IHRoaXMuX3RleHR1cmVXaWR0aCA+PiB0aGlzLl90ZXh0dXJlU2NhbGU7XG5cdFx0dGhpcy5fdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkID0gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgdGV4dHVyZUhlaWdodCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVIZWlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHRleHR1cmVIZWlnaHQodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3RleHR1cmVIZWlnaHQgPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl90ZXh0dXJlSGVpZ2h0ID0gdmFsdWU7XG5cdFx0dGhpcy5fc2NhbGVkVGV4dHVyZUhlaWdodCA9IHRoaXMuX3RleHR1cmVIZWlnaHQgPj4gdGhpcy5fdGV4dHVyZVNjYWxlO1xuXHRcdHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZCA9IHRydWU7XG5cdH1cblxuXHRwdWJsaWMgZ2V0TWFpbklucHV0VGV4dHVyZShzdGFnZTpTdGFnZSk6SVRleHR1cmVcblx0e1xuXHRcdGlmICh0aGlzLl90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQpXG5cdFx0XHR0aGlzLnBVcGRhdGVUZXh0dXJlcyhzdGFnZSk7XG5cblx0XHRyZXR1cm4gdGhpcy5fbWFpbklucHV0VGV4dHVyZTtcblx0fVxuXG5cdHB1YmxpYyBkaXNwb3NlKClcblx0e1xuXHRcdGlmICh0aGlzLl9tYWluSW5wdXRUZXh0dXJlKVxuXHRcdFx0dGhpcy5fbWFpbklucHV0VGV4dHVyZS5kaXNwb3NlKCk7XG5cblx0XHRpZiAodGhpcy5fcHJvZ3JhbTNEKVxuXHRcdFx0dGhpcy5fcHJvZ3JhbTNELmRpc3Bvc2UoKTtcblx0fVxuXG5cdHB1YmxpYyBwSW52YWxpZGF0ZVByb2dyYW0oKVxuXHR7XG5cdFx0dGhpcy5fcHJvZ3JhbTNESW52YWxpZCA9IHRydWU7XG5cdH1cblxuXHRwdWJsaWMgcFVwZGF0ZVByb2dyYW0oc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHRpZiAodGhpcy5fcHJvZ3JhbTNEKVxuXHRcdFx0dGhpcy5fcHJvZ3JhbTNELmRpc3Bvc2UoKTtcblxuXHRcdHRoaXMuX3Byb2dyYW0zRCA9ICg8SUNvbnRleHRTdGFnZUdMPiBzdGFnZS5jb250ZXh0KS5jcmVhdGVQcm9ncmFtKCk7XG5cblx0XHR2YXIgdmVydGV4Qnl0ZUNvZGU6Qnl0ZUFycmF5ID0gKG5ldyBBR0FMTWluaUFzc2VtYmxlcigpLmFzc2VtYmxlKFwicGFydCB2ZXJ0ZXggMVxcblwiICsgdGhpcy5wR2V0VmVydGV4Q29kZSgpICsgXCJlbmRwYXJ0XCIpKVsndmVydGV4J10uZGF0YTtcblx0XHR2YXIgZnJhZ21lbnRCeXRlQ29kZTpCeXRlQXJyYXkgPSAobmV3IEFHQUxNaW5pQXNzZW1ibGVyKCkuYXNzZW1ibGUoXCJwYXJ0IGZyYWdtZW50IDFcXG5cIiArIHRoaXMucEdldEZyYWdtZW50Q29kZSgpICsgXCJlbmRwYXJ0XCIpKVsnZnJhZ21lbnQnXS5kYXRhO1xuXHRcdHRoaXMuX3Byb2dyYW0zRC51cGxvYWQodmVydGV4Qnl0ZUNvZGUsIGZyYWdtZW50Qnl0ZUNvZGUpO1xuXHRcdHRoaXMuX3Byb2dyYW0zREludmFsaWQgPSBmYWxzZTtcblx0fVxuXG5cdHB1YmxpYyBwR2V0VmVydGV4Q29kZSgpOnN0cmluZ1xuXHR7XG5cdFx0Ly8gVE9ETzogaW1lcGxlbWVudCBBR0FMIDw+IEdMU0xcblxuXHRcdHJldHVybiBcIm1vdiBvcCwgdmEwXFxuXCIgKyBcIm1vdiB2MCwgdmExXFxuXCI7XG5cdH1cblxuXHRwdWJsaWMgcEdldEZyYWdtZW50Q29kZSgpOnN0cmluZ1xuXHR7XG5cdFx0dGhyb3cgbmV3IEFic3RyYWN0TWV0aG9kRXJyb3IoKTtcblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cHVibGljIHBVcGRhdGVUZXh0dXJlcyhzdGFnZTpTdGFnZSlcblx0e1xuXHRcdGlmICh0aGlzLl9tYWluSW5wdXRUZXh0dXJlKVxuXHRcdFx0dGhpcy5fbWFpbklucHV0VGV4dHVyZS5kaXNwb3NlKCk7XG5cblx0XHR0aGlzLl9tYWluSW5wdXRUZXh0dXJlID0gKDxJQ29udGV4dFN0YWdlR0w+IHN0YWdlLmNvbnRleHQpLmNyZWF0ZVRleHR1cmUodGhpcy5fc2NhbGVkVGV4dHVyZVdpZHRoLCB0aGlzLl9zY2FsZWRUZXh0dXJlSGVpZ2h0LCBDb250ZXh0R0xUZXh0dXJlRm9ybWF0LkJHUkEsIHRydWUpO1xuXG5cdFx0dGhpcy5fdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkID0gZmFsc2U7XG5cdH1cblxuXHRwdWJsaWMgZ2V0UHJvZ3JhbShzdGFnZTpTdGFnZSk6SVByb2dyYW1cblx0e1xuXHRcdGlmICh0aGlzLl9wcm9ncmFtM0RJbnZhbGlkKVxuXHRcdFx0dGhpcy5wVXBkYXRlUHJvZ3JhbShzdGFnZSk7XG5cblx0XHRyZXR1cm4gdGhpcy5fcHJvZ3JhbTNEO1xuXHR9XG5cblx0cHVibGljIGFjdGl2YXRlKHN0YWdlOlN0YWdlLCBjYW1lcmE6Q2FtZXJhLCBkZXB0aFRleHR1cmU6SVRleHR1cmUpXG5cdHtcblx0fVxuXG5cdHB1YmxpYyBkZWFjdGl2YXRlKHN0YWdlOlN0YWdlKVxuXHR7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHJlcXVpcmVEZXB0aFJlbmRlcigpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9yZXF1aXJlRGVwdGhSZW5kZXI7XG5cdH1cblxufVxuXG5leHBvcnQgPSBGaWx0ZXIzRFRhc2tCYXNlOyJdfQ==
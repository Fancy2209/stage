var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var AGALMiniAssembler = require("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");
var ContextGLTextureFormat = require("awayjs-stagegl/lib/core/stagegl/ContextGLTextureFormat");
var Filter3DTaskBase = (function () {
    function Filter3DTaskBase(requireDepthRender) {
        if (requireDepthRender === void 0) { requireDepthRender = false; }
        this._scaledTextureWidth = -1;
        this._scaledTextureHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._textureDimensionsInvalid = true;
        this._program3DInvalid = true;
        this._textureScale = 0;
        this._requireDepthRender = requireDepthRender;
    }
    Object.defineProperty(Filter3DTaskBase.prototype, "textureScale", {
        /**
         * The texture scale for the input of this texture. This will define the output of the previous entry in the chain
         */
        get: function () {
            return this._textureScale;
        },
        set: function (value) {
            if (this._textureScale == value)
                return;
            this._textureScale = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "target", {
        get: function () {
            return this._target;
        },
        set: function (value) {
            this._target = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        set: function (value) {
            if (this._textureWidth == value)
                return;
            this._textureWidth = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        set: function (value) {
            if (this._textureHeight == value)
                return;
            this._textureHeight = value;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Filter3DTaskBase.prototype.getMainInputTexture = function (stage) {
        if (this._textureDimensionsInvalid)
            this.pUpdateTextures(stage);
        return this._mainInputTexture;
    };
    Filter3DTaskBase.prototype.dispose = function () {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        if (this._program3D)
            this._program3D.dispose();
    };
    Filter3DTaskBase.prototype.pInvalidateProgram = function () {
        this._program3DInvalid = true;
    };
    Filter3DTaskBase.prototype.pUpdateProgram = function (stage) {
        if (this._program3D)
            this._program3D.dispose();
        this._program3D = stage.context.createProgram();
        var vertexByteCode = (new AGALMiniAssembler().assemble("part vertex 1\n" + this.pGetVertexCode() + "endpart"))['vertex'].data;
        var fragmentByteCode = (new AGALMiniAssembler().assemble("part fragment 1\n" + this.pGetFragmentCode() + "endpart"))['fragment'].data;
        this._program3D.upload(vertexByteCode, fragmentByteCode);
        this._program3DInvalid = false;
    };
    Filter3DTaskBase.prototype.pGetVertexCode = function () {
        // TODO: imeplement AGAL <> GLSL
        return "mov op, va0\n" + "mov v0, va1\n";
    };
    Filter3DTaskBase.prototype.pGetFragmentCode = function () {
        throw new AbstractMethodError();
        return null;
    };
    Filter3DTaskBase.prototype.pUpdateTextures = function (stage) {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        this._mainInputTexture = stage.context.createTexture(this._scaledTextureWidth, this._scaledTextureHeight, ContextGLTextureFormat.BGRA, true);
        this._textureDimensionsInvalid = false;
    };
    Filter3DTaskBase.prototype.getProgram = function (stage) {
        if (this._program3DInvalid)
            this.pUpdateProgram(stage);
        return this._program3D;
    };
    Filter3DTaskBase.prototype.activate = function (stage, camera, depthTexture) {
    };
    Filter3DTaskBase.prototype.deactivate = function (stage) {
    };
    Object.defineProperty(Filter3DTaskBase.prototype, "requireDepthRender", {
        get: function () {
            return this._requireDepthRender;
        },
        enumerable: true,
        configurable: true
    });
    return Filter3DTaskBase;
})();
module.exports = Filter3DTaskBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbHRlcnMvdGFza3MvZmlsdGVyM2R0YXNrYmFzZS50cyJdLCJuYW1lcyI6WyJGaWx0ZXIzRFRhc2tCYXNlIiwiRmlsdGVyM0RUYXNrQmFzZS5jb25zdHJ1Y3RvciIsIkZpbHRlcjNEVGFza0Jhc2UudGV4dHVyZVNjYWxlIiwiRmlsdGVyM0RUYXNrQmFzZS50YXJnZXQiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVXaWR0aCIsIkZpbHRlcjNEVGFza0Jhc2UudGV4dHVyZUhlaWdodCIsIkZpbHRlcjNEVGFza0Jhc2UuZ2V0TWFpbklucHV0VGV4dHVyZSIsIkZpbHRlcjNEVGFza0Jhc2UuZGlzcG9zZSIsIkZpbHRlcjNEVGFza0Jhc2UucEludmFsaWRhdGVQcm9ncmFtIiwiRmlsdGVyM0RUYXNrQmFzZS5wVXBkYXRlUHJvZ3JhbSIsIkZpbHRlcjNEVGFza0Jhc2UucEdldFZlcnRleENvZGUiLCJGaWx0ZXIzRFRhc2tCYXNlLnBHZXRGcmFnbWVudENvZGUiLCJGaWx0ZXIzRFRhc2tCYXNlLnBVcGRhdGVUZXh0dXJlcyIsIkZpbHRlcjNEVGFza0Jhc2UuZ2V0UHJvZ3JhbSIsIkZpbHRlcjNEVGFza0Jhc2UuYWN0aXZhdGUiLCJGaWx0ZXIzRFRhc2tCYXNlLmRlYWN0aXZhdGUiLCJGaWx0ZXIzRFRhc2tCYXNlLnJlcXVpcmVEZXB0aFJlbmRlciJdLCJtYXBwaW5ncyI6IkFBR0EsSUFBTyxtQkFBbUIsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBR3JGLElBQU8saUJBQWlCLFdBQWEsc0RBQXNELENBQUMsQ0FBQztBQUM3RixJQUFPLHNCQUFzQixXQUFZLHdEQUF3RCxDQUFDLENBQUM7QUFLbkcsSUFBTSxnQkFBZ0I7SUFlckJBLFNBZktBLGdCQUFnQkEsQ0FlVEEsa0JBQWtDQTtRQUFsQ0Msa0NBQWtDQSxHQUFsQ0EsMEJBQWtDQTtRQVh0Q0Esd0JBQW1CQSxHQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoQ0EseUJBQW9CQSxHQUFVQSxDQUFDQSxDQUFDQSxD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RU1kLHFDQUFVQSxHQUFqQkEsVUFBa0JBLEtBQVdBO0lBRTdCZSxDQUFDQTtJQUVEZixzQkFBV0EsZ0RBQWtCQTthQUE3QkE7WUFFQ2dCLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0E7UUFDakNBLENBQUNBOzs7T0FBQWhCO0lBRUZBLHVCQUFDQTtBQUFEQSxDQWpLQSxBQWlLQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJmaWx0ZXJzL3Rhc2tzL0ZpbHRlcjNEVGFza0Jhc2UuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtc3RhZ2VnbC8iLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xuaW1wb3J0IEJ5dGVBcnJheVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvQnl0ZUFycmF5XCIpO1xuXG5pbXBvcnQgQUdBTE1pbmlBc3NlbWJsZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL0FHQUxNaW5pQXNzZW1ibGVyXCIpO1xuaW1wb3J0IENvbnRleHRHTFRleHR1cmVGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9Db250ZXh0R0xUZXh0dXJlRm9ybWF0XCIpO1xuaW1wb3J0IElDb250ZXh0U3RhZ2VHTFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9JQ29udGV4dFN0YWdlR0xcIik7XG5pbXBvcnQgSVByb2dyYW1cdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvY29yZS9zdGFnZWdsL0lQcm9ncmFtXCIpO1xuaW1wb3J0IElUZXh0dXJlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9JVGV4dHVyZVwiKTtcblxuY2xhc3MgRmlsdGVyM0RUYXNrQmFzZVxue1xuXHRwcml2YXRlIF9tYWluSW5wdXRUZXh0dXJlOklUZXh0dXJlO1xuXG5cdHByaXZhdGUgX3NjYWxlZFRleHR1cmVXaWR0aDpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfc2NhbGVkVGV4dHVyZUhlaWdodDpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfdGV4dHVyZVdpZHRoOm51bWJlciA9IC0xO1xuXHRwcml2YXRlIF90ZXh0dXJlSGVpZ2h0Om51bWJlciA9IC0xO1xuXHRwcml2YXRlIF90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQ6Ym9vbGVhbiA9IHRydWU7XG5cdHByaXZhdGUgX3Byb2dyYW0zREludmFsaWQ6Ym9vbGVhbiA9IHRydWU7XG5cdHByaXZhdGUgX3Byb2dyYW0zRDpJUHJvZ3JhbTtcblx0cHJpdmF0ZSBfdGFyZ2V0OklUZXh0dXJlO1xuXHRwcml2YXRlIF9yZXF1aXJlRGVwdGhSZW5kZXI6Ym9vbGVhbjtcblx0cHJpdmF0ZSBfdGV4dHVyZVNjYWxlOm51bWJlciA9IDA7XG5cblx0Y29uc3RydWN0b3IocmVxdWlyZURlcHRoUmVuZGVyOmJvb2xlYW4gPSBmYWxzZSlcblx0e1xuXG5cdFx0dGhpcy5fcmVxdWlyZURlcHRoUmVuZGVyID0gcmVxdWlyZURlcHRoUmVuZGVyO1xuXG5cdH1cblxuXHQvKipcblx0ICogVGhlIHRleHR1cmUgc2NhbGUgZm9yIHRoZSBpbnB1dCBvZiB0aGlzIHRleHR1cmUuIFRoaXMgd2lsbCBkZWZpbmUgdGhlIG91dHB1dCBvZiB0aGUgcHJldmlvdXMgZW50cnkgaW4gdGhlIGNoYWluXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IHRleHR1cmVTY2FsZSgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVTY2FsZTtcblx0fVxuXG5cdHB1YmxpYyBzZXQgdGV4dHVyZVNjYWxlKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl90ZXh0dXJlU2NhbGUgPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl90ZXh0dXJlU2NhbGUgPSB2YWx1ZTtcblx0XHR0aGlzLl9zY2FsZWRUZXh0dXJlV2lkdGggPSB0aGlzLl90ZXh0dXJlV2lkdGggPj4gdGhpcy5fdGV4dHVyZVNjYWxlO1xuXHRcdHRoaXMuX3NjYWxlZFRleHR1cmVIZWlnaHQgPSB0aGlzLl90ZXh0dXJlSGVpZ2h0ID4+IHRoaXMuX3RleHR1cmVTY2FsZTtcblx0XHR0aGlzLl90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGdldCB0YXJnZXQoKTpJVGV4dHVyZVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3RhcmdldDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgdGFyZ2V0KHZhbHVlOklUZXh0dXJlKVxuXHR7XG5cdFx0dGhpcy5fdGFyZ2V0ID0gdmFsdWU7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHRleHR1cmVXaWR0aCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVXaWR0aDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgdGV4dHVyZVdpZHRoKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl90ZXh0dXJlV2lkdGggPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl90ZXh0dXJlV2lkdGggPSB2YWx1ZTtcblx0XHR0aGlzLl9zY2FsZWRUZXh0dXJlV2lkdGggPSB0aGlzLl90ZXh0dXJlV2lkdGggPj4gdGhpcy5fdGV4dHVyZVNjYWxlO1xuXHRcdHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZCA9IHRydWU7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHRleHR1cmVIZWlnaHQoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlSGVpZ2h0O1xuXHR9XG5cblx0cHVibGljIHNldCB0ZXh0dXJlSGVpZ2h0KHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl90ZXh0dXJlSGVpZ2h0ID09IHZhbHVlKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fdGV4dHVyZUhlaWdodCA9IHZhbHVlO1xuXHRcdHRoaXMuX3NjYWxlZFRleHR1cmVIZWlnaHQgPSB0aGlzLl90ZXh0dXJlSGVpZ2h0ID4+IHRoaXMuX3RleHR1cmVTY2FsZTtcblx0XHR0aGlzLl90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGdldE1haW5JbnB1dFRleHR1cmUoc3RhZ2U6U3RhZ2UpOklUZXh0dXJlXG5cdHtcblx0XHRpZiAodGhpcy5fdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkKVxuXHRcdFx0dGhpcy5wVXBkYXRlVGV4dHVyZXMoc3RhZ2UpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX21haW5JbnB1dFRleHR1cmU7XG5cdH1cblxuXHRwdWJsaWMgZGlzcG9zZSgpXG5cdHtcblx0XHRpZiAodGhpcy5fbWFpbklucHV0VGV4dHVyZSlcblx0XHRcdHRoaXMuX21haW5JbnB1dFRleHR1cmUuZGlzcG9zZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3Byb2dyYW0zRClcblx0XHRcdHRoaXMuX3Byb2dyYW0zRC5kaXNwb3NlKCk7XG5cdH1cblxuXHRwdWJsaWMgcEludmFsaWRhdGVQcm9ncmFtKClcblx0e1xuXHRcdHRoaXMuX3Byb2dyYW0zREludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIHBVcGRhdGVQcm9ncmFtKHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3Byb2dyYW0zRClcblx0XHRcdHRoaXMuX3Byb2dyYW0zRC5kaXNwb3NlKCk7XG5cblx0XHR0aGlzLl9wcm9ncmFtM0QgPSAoPElDb250ZXh0U3RhZ2VHTD4gc3RhZ2UuY29udGV4dCkuY3JlYXRlUHJvZ3JhbSgpO1xuXG5cdFx0dmFyIHZlcnRleEJ5dGVDb2RlOkJ5dGVBcnJheSA9IChuZXcgQUdBTE1pbmlBc3NlbWJsZXIoKS5hc3NlbWJsZShcInBhcnQgdmVydGV4IDFcXG5cIiArIHRoaXMucEdldFZlcnRleENvZGUoKSArIFwiZW5kcGFydFwiKSlbJ3ZlcnRleCddLmRhdGE7XG5cdFx0dmFyIGZyYWdtZW50Qnl0ZUNvZGU6Qnl0ZUFycmF5ID0gKG5ldyBBR0FMTWluaUFzc2VtYmxlcigpLmFzc2VtYmxlKFwicGFydCBmcmFnbWVudCAxXFxuXCIgKyB0aGlzLnBHZXRGcmFnbWVudENvZGUoKSArIFwiZW5kcGFydFwiKSlbJ2ZyYWdtZW50J10uZGF0YTtcblx0XHR0aGlzLl9wcm9ncmFtM0QudXBsb2FkKHZlcnRleEJ5dGVDb2RlLCBmcmFnbWVudEJ5dGVDb2RlKTtcblx0XHR0aGlzLl9wcm9ncmFtM0RJbnZhbGlkID0gZmFsc2U7XG5cdH1cblxuXHRwdWJsaWMgcEdldFZlcnRleENvZGUoKTpzdHJpbmdcblx0e1xuXHRcdC8vIFRPRE86IGltZXBsZW1lbnQgQUdBTCA8PiBHTFNMXG5cblx0XHRyZXR1cm4gXCJtb3Ygb3AsIHZhMFxcblwiICsgXCJtb3YgdjAsIHZhMVxcblwiO1xuXHR9XG5cblx0cHVibGljIHBHZXRGcmFnbWVudENvZGUoKTpzdHJpbmdcblx0e1xuXHRcdHRocm93IG5ldyBBYnN0cmFjdE1ldGhvZEVycm9yKCk7XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdHB1YmxpYyBwVXBkYXRlVGV4dHVyZXMoc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHRpZiAodGhpcy5fbWFpbklucHV0VGV4dHVyZSlcblx0XHRcdHRoaXMuX21haW5JbnB1dFRleHR1cmUuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fbWFpbklucHV0VGV4dHVyZSA9ICg8SUNvbnRleHRTdGFnZUdMPiBzdGFnZS5jb250ZXh0KS5jcmVhdGVUZXh0dXJlKHRoaXMuX3NjYWxlZFRleHR1cmVXaWR0aCwgdGhpcy5fc2NhbGVkVGV4dHVyZUhlaWdodCwgQ29udGV4dEdMVGV4dHVyZUZvcm1hdC5CR1JBLCB0cnVlKTtcblxuXHRcdHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZCA9IGZhbHNlO1xuXHR9XG5cblx0cHVibGljIGdldFByb2dyYW0oc3RhZ2U6U3RhZ2UpOklQcm9ncmFtXG5cdHtcblx0XHRpZiAodGhpcy5fcHJvZ3JhbTNESW52YWxpZClcblx0XHRcdHRoaXMucFVwZGF0ZVByb2dyYW0oc3RhZ2UpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Byb2dyYW0zRDtcblx0fVxuXG5cdHB1YmxpYyBhY3RpdmF0ZShzdGFnZTpTdGFnZSwgY2FtZXJhOkNhbWVyYSwgZGVwdGhUZXh0dXJlOklUZXh0dXJlKVxuXHR7XG5cdH1cblxuXHRwdWJsaWMgZGVhY3RpdmF0ZShzdGFnZTpTdGFnZSlcblx0e1xuXHR9XG5cblx0cHVibGljIGdldCByZXF1aXJlRGVwdGhSZW5kZXIoKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZURlcHRoUmVuZGVyO1xuXHR9XG5cbn1cblxuZXhwb3J0ID0gRmlsdGVyM0RUYXNrQmFzZTsiXX0=
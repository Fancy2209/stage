var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var AGALMiniAssembler = require("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");
var ContextGLTextureFormat = require("awayjs-stagegl/lib/base/ContextGLTextureFormat");
var Filter3DTaskBase = (function () {
    function Filter3DTaskBase(requireDepthRender) {
        if (requireDepthRender === void 0) { requireDepthRender = false; }
        this._scaledTextureWidth = -1;
        this._scaledTextureHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._textureDimensionsInvalid = true;
        this._program3DInvalid = true;
        this._textureScale = 0;
        this._requireDepthRender = requireDepthRender;
    }
    Object.defineProperty(Filter3DTaskBase.prototype, "textureScale", {
        /**
         * The texture scale for the input of this texture. This will define the output of the previous entry in the chain
         */
        get: function () {
            return this._textureScale;
        },
        set: function (value) {
            if (this._textureScale == value)
                return;
            this._textureScale = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "target", {
        get: function () {
            return this._target;
        },
        set: function (value) {
            this._target = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        set: function (value) {
            if (this._textureWidth == value)
                return;
            this._textureWidth = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        set: function (value) {
            if (this._textureHeight == value)
                return;
            this._textureHeight = value;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Filter3DTaskBase.prototype.getMainInputTexture = function (stage) {
        if (this._textureDimensionsInvalid)
            this.pUpdateTextures(stage);
        return this._mainInputTexture;
    };
    Filter3DTaskBase.prototype.dispose = function () {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        if (this._program3D)
            this._program3D.dispose();
    };
    Filter3DTaskBase.prototype.pInvalidateProgram = function () {
        this._program3DInvalid = true;
    };
    Filter3DTaskBase.prototype.pUpdateProgram = function (stage) {
        if (this._program3D)
            this._program3D.dispose();
        this._program3D = stage.context.createProgram();
        var vertexByteCode = (new AGALMiniAssembler().assemble("part vertex 1\n" + this.pGetVertexCode() + "endpart"))['vertex'].data;
        var fragmentByteCode = (new AGALMiniAssembler().assemble("part fragment 1\n" + this.pGetFragmentCode() + "endpart"))['fragment'].data;
        this._program3D.upload(vertexByteCode, fragmentByteCode);
        this._program3DInvalid = false;
    };
    Filter3DTaskBase.prototype.pGetVertexCode = function () {
        // TODO: imeplement AGAL <> GLSL
        return "mov op, va0\n" + "mov v0, va1\n";
    };
    Filter3DTaskBase.prototype.pGetFragmentCode = function () {
        throw new AbstractMethodError();
        return null;
    };
    Filter3DTaskBase.prototype.pUpdateTextures = function (stage) {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        this._mainInputTexture = stage.context.createTexture(this._scaledTextureWidth, this._scaledTextureHeight, ContextGLTextureFormat.BGRA, true);
        this._textureDimensionsInvalid = false;
    };
    Filter3DTaskBase.prototype.getProgram = function (stage) {
        if (this._program3DInvalid)
            this.pUpdateProgram(stage);
        return this._program3D;
    };
    Filter3DTaskBase.prototype.activate = function (stage, camera, depthTexture) {
    };
    Filter3DTaskBase.prototype.deactivate = function (stage) {
    };
    Object.defineProperty(Filter3DTaskBase.prototype, "requireDepthRender", {
        get: function () {
            return this._requireDepthRender;
        },
        enumerable: true,
        configurable: true
    });
    return Filter3DTaskBase;
})();
module.exports = Filter3DTaskBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9maWx0ZXJzL3Rhc2tzL2ZpbHRlcjNkdGFza2Jhc2UudHMiXSwibmFtZXMiOlsiRmlsdGVyM0RUYXNrQmFzZSIsIkZpbHRlcjNEVGFza0Jhc2UuY29uc3RydWN0b3IiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVTY2FsZSIsIkZpbHRlcjNEVGFza0Jhc2UudGFyZ2V0IiwiRmlsdGVyM0RUYXNrQmFzZS50ZXh0dXJlV2lkdGgiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVIZWlnaHQiLCJGaWx0ZXIzRFRhc2tCYXNlLmdldE1haW5JbnB1dFRleHR1cmUiLCJGaWx0ZXIzRFRhc2tCYXNlLmRpc3Bvc2UiLCJGaWx0ZXIzRFRhc2tCYXNlLnBJbnZhbGlkYXRlUHJvZ3JhbSIsIkZpbHRlcjNEVGFza0Jhc2UucFVwZGF0ZVByb2dyYW0iLCJGaWx0ZXIzRFRhc2tCYXNlLnBHZXRWZXJ0ZXhDb2RlIiwiRmlsdGVyM0RUYXNrQmFzZS5wR2V0RnJhZ21lbnRDb2RlIiwiRmlsdGVyM0RUYXNrQmFzZS5wVXBkYXRlVGV4dHVyZXMiLCJGaWx0ZXIzRFRhc2tCYXNlLmdldFByb2dyYW0iLCJGaWx0ZXIzRFRhc2tCYXNlLmFjdGl2YXRlIiwiRmlsdGVyM0RUYXNrQmFzZS5kZWFjdGl2YXRlIiwiRmlsdGVyM0RUYXNrQmFzZS5yZXF1aXJlRGVwdGhSZW5kZXIiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sbUJBQW1CLFdBQWEsNENBQTRDLENBQUMsQ0FBQztBQU1yRixJQUFPLGlCQUFpQixXQUFhLHNEQUFzRCxDQUFDLENBQUM7QUFDN0YsSUFBTyxzQkFBc0IsV0FBWSxnREFBZ0QsQ0FBQyxDQUFDO0FBSzNGLElBQU0sZ0JBQWdCO0lBZXJCQSxTQWZLQSxnQkFBZ0JBLENBZVRBLGtCQUFrQ0E7UUFBbENDLGtDQUFrQ0EsR0FBbENBLDBCQUFrQ0E7UUFYdENBLHdCQUFtQkEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLHlCQUFvQkEs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cUJBO0lBRWpFYyxDQUFDQTtJQUVNZCxxQ0FBVUEsR0FBakJBLFVBQWtCQSxLQUFXQTtJQUU3QmUsQ0FBQ0E7SUFFRGYsc0JBQVdBLGdEQUFrQkE7YUFBN0JBO1lBRUNnQixNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBO1FBQ2pDQSxDQUFDQTs7O09BQUFoQjtJQUVGQSx1QkFBQ0E7QUFBREEsQ0FqS0EsQUFpS0NBLElBQUE7QUFFRCxBQUEwQixpQkFBakIsZ0JBQWdCLENBQUMiLCJmaWxlIjoiZmlsdGVycy90YXNrcy9GaWx0ZXIzRFRhc2tCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xuaW1wb3J0IEJ5dGVBcnJheVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvQnl0ZUFycmF5XCIpO1xuXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgQUdBTE1pbmlBc3NlbWJsZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYWdsc2wvYXNzZW1ibGVyL0FHQUxNaW5pQXNzZW1ibGVyXCIpO1xuaW1wb3J0IENvbnRleHRHTFRleHR1cmVGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMVGV4dHVyZUZvcm1hdFwiKTtcbmltcG9ydCBJQ29udGV4dFN0YWdlR0xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lDb250ZXh0U3RhZ2VHTFwiKTtcbmltcG9ydCBJUHJvZ3JhbVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lQcm9ncmFtXCIpO1xuaW1wb3J0IElUZXh0dXJlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSVRleHR1cmVcIik7XG5cbmNsYXNzIEZpbHRlcjNEVGFza0Jhc2Vcbntcblx0cHJpdmF0ZSBfbWFpbklucHV0VGV4dHVyZTpJVGV4dHVyZTtcblxuXHRwcml2YXRlIF9zY2FsZWRUZXh0dXJlV2lkdGg6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3NjYWxlZFRleHR1cmVIZWlnaHQ6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3RleHR1cmVXaWR0aDpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfdGV4dHVyZUhlaWdodDpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkOmJvb2xlYW4gPSB0cnVlO1xuXHRwcml2YXRlIF9wcm9ncmFtM0RJbnZhbGlkOmJvb2xlYW4gPSB0cnVlO1xuXHRwcml2YXRlIF9wcm9ncmFtM0Q6SVByb2dyYW07XG5cdHByaXZhdGUgX3RhcmdldDpJVGV4dHVyZTtcblx0cHJpdmF0ZSBfcmVxdWlyZURlcHRoUmVuZGVyOmJvb2xlYW47XG5cdHByaXZhdGUgX3RleHR1cmVTY2FsZTpudW1iZXIgPSAwO1xuXG5cdGNvbnN0cnVjdG9yKHJlcXVpcmVEZXB0aFJlbmRlcjpib29sZWFuID0gZmFsc2UpXG5cdHtcblxuXHRcdHRoaXMuX3JlcXVpcmVEZXB0aFJlbmRlciA9IHJlcXVpcmVEZXB0aFJlbmRlcjtcblxuXHR9XG5cblx0LyoqXG5cdCAqIFRoZSB0ZXh0dXJlIHNjYWxlIGZvciB0aGUgaW5wdXQgb2YgdGhpcyB0ZXh0dXJlLiBUaGlzIHdpbGwgZGVmaW5lIHRoZSBvdXRwdXQgb2YgdGhlIHByZXZpb3VzIGVudHJ5IGluIHRoZSBjaGFpblxuXHQgKi9cblx0cHVibGljIGdldCB0ZXh0dXJlU2NhbGUoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlU2NhbGU7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHRleHR1cmVTY2FsZSh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fdGV4dHVyZVNjYWxlID09IHZhbHVlKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fdGV4dHVyZVNjYWxlID0gdmFsdWU7XG5cdFx0dGhpcy5fc2NhbGVkVGV4dHVyZVdpZHRoID0gdGhpcy5fdGV4dHVyZVdpZHRoID4+IHRoaXMuX3RleHR1cmVTY2FsZTtcblx0XHR0aGlzLl9zY2FsZWRUZXh0dXJlSGVpZ2h0ID0gdGhpcy5fdGV4dHVyZUhlaWdodCA+PiB0aGlzLl90ZXh0dXJlU2NhbGU7XG5cdFx0dGhpcy5fdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkID0gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgdGFyZ2V0KCk6SVRleHR1cmVcblx0e1xuXHRcdHJldHVybiB0aGlzLl90YXJnZXQ7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHRhcmdldCh2YWx1ZTpJVGV4dHVyZSlcblx0e1xuXHRcdHRoaXMuX3RhcmdldCA9IHZhbHVlO1xuXHR9XG5cblx0cHVibGljIGdldCB0ZXh0dXJlV2lkdGgoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlV2lkdGg7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHRleHR1cmVXaWR0aCh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fdGV4dHVyZVdpZHRoID09IHZhbHVlKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fdGV4dHVyZVdpZHRoID0gdmFsdWU7XG5cdFx0dGhpcy5fc2NhbGVkVGV4dHVyZVdpZHRoID0gdGhpcy5fdGV4dHVyZVdpZHRoID4+IHRoaXMuX3RleHR1cmVTY2FsZTtcblx0XHR0aGlzLl90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGdldCB0ZXh0dXJlSGVpZ2h0KCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZUhlaWdodDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgdGV4dHVyZUhlaWdodCh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fdGV4dHVyZUhlaWdodCA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3RleHR1cmVIZWlnaHQgPSB2YWx1ZTtcblx0XHR0aGlzLl9zY2FsZWRUZXh0dXJlSGVpZ2h0ID0gdGhpcy5fdGV4dHVyZUhlaWdodCA+PiB0aGlzLl90ZXh0dXJlU2NhbGU7XG5cdFx0dGhpcy5fdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkID0gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXRNYWluSW5wdXRUZXh0dXJlKHN0YWdlOlN0YWdlKTpJVGV4dHVyZVxuXHR7XG5cdFx0aWYgKHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZClcblx0XHRcdHRoaXMucFVwZGF0ZVRleHR1cmVzKHN0YWdlKTtcblxuXHRcdHJldHVybiB0aGlzLl9tYWluSW5wdXRUZXh0dXJlO1xuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0aWYgKHRoaXMuX21haW5JbnB1dFRleHR1cmUpXG5cdFx0XHR0aGlzLl9tYWluSW5wdXRUZXh0dXJlLmRpc3Bvc2UoKTtcblxuXHRcdGlmICh0aGlzLl9wcm9ncmFtM0QpXG5cdFx0XHR0aGlzLl9wcm9ncmFtM0QuZGlzcG9zZSgpO1xuXHR9XG5cblx0cHVibGljIHBJbnZhbGlkYXRlUHJvZ3JhbSgpXG5cdHtcblx0XHR0aGlzLl9wcm9ncmFtM0RJbnZhbGlkID0gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBwVXBkYXRlUHJvZ3JhbShzdGFnZTpTdGFnZSlcblx0e1xuXHRcdGlmICh0aGlzLl9wcm9ncmFtM0QpXG5cdFx0XHR0aGlzLl9wcm9ncmFtM0QuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fcHJvZ3JhbTNEID0gKDxJQ29udGV4dFN0YWdlR0w+IHN0YWdlLmNvbnRleHQpLmNyZWF0ZVByb2dyYW0oKTtcblxuXHRcdHZhciB2ZXJ0ZXhCeXRlQ29kZTpCeXRlQXJyYXkgPSAobmV3IEFHQUxNaW5pQXNzZW1ibGVyKCkuYXNzZW1ibGUoXCJwYXJ0IHZlcnRleCAxXFxuXCIgKyB0aGlzLnBHZXRWZXJ0ZXhDb2RlKCkgKyBcImVuZHBhcnRcIikpWyd2ZXJ0ZXgnXS5kYXRhO1xuXHRcdHZhciBmcmFnbWVudEJ5dGVDb2RlOkJ5dGVBcnJheSA9IChuZXcgQUdBTE1pbmlBc3NlbWJsZXIoKS5hc3NlbWJsZShcInBhcnQgZnJhZ21lbnQgMVxcblwiICsgdGhpcy5wR2V0RnJhZ21lbnRDb2RlKCkgKyBcImVuZHBhcnRcIikpWydmcmFnbWVudCddLmRhdGE7XG5cdFx0dGhpcy5fcHJvZ3JhbTNELnVwbG9hZCh2ZXJ0ZXhCeXRlQ29kZSwgZnJhZ21lbnRCeXRlQ29kZSk7XG5cdFx0dGhpcy5fcHJvZ3JhbTNESW52YWxpZCA9IGZhbHNlO1xuXHR9XG5cblx0cHVibGljIHBHZXRWZXJ0ZXhDb2RlKCk6c3RyaW5nXG5cdHtcblx0XHQvLyBUT0RPOiBpbWVwbGVtZW50IEFHQUwgPD4gR0xTTFxuXG5cdFx0cmV0dXJuIFwibW92IG9wLCB2YTBcXG5cIiArIFwibW92IHYwLCB2YTFcXG5cIjtcblx0fVxuXG5cdHB1YmxpYyBwR2V0RnJhZ21lbnRDb2RlKCk6c3RyaW5nXG5cdHtcblx0XHR0aHJvdyBuZXcgQWJzdHJhY3RNZXRob2RFcnJvcigpO1xuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRwdWJsaWMgcFVwZGF0ZVRleHR1cmVzKHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX21haW5JbnB1dFRleHR1cmUpXG5cdFx0XHR0aGlzLl9tYWluSW5wdXRUZXh0dXJlLmRpc3Bvc2UoKTtcblxuXHRcdHRoaXMuX21haW5JbnB1dFRleHR1cmUgPSAoPElDb250ZXh0U3RhZ2VHTD4gc3RhZ2UuY29udGV4dCkuY3JlYXRlVGV4dHVyZSh0aGlzLl9zY2FsZWRUZXh0dXJlV2lkdGgsIHRoaXMuX3NjYWxlZFRleHR1cmVIZWlnaHQsIENvbnRleHRHTFRleHR1cmVGb3JtYXQuQkdSQSwgdHJ1ZSk7XG5cblx0XHR0aGlzLl90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQgPSBmYWxzZTtcblx0fVxuXG5cdHB1YmxpYyBnZXRQcm9ncmFtKHN0YWdlOlN0YWdlKTpJUHJvZ3JhbVxuXHR7XG5cdFx0aWYgKHRoaXMuX3Byb2dyYW0zREludmFsaWQpXG5cdFx0XHR0aGlzLnBVcGRhdGVQcm9ncmFtKHN0YWdlKTtcblxuXHRcdHJldHVybiB0aGlzLl9wcm9ncmFtM0Q7XG5cdH1cblxuXHRwdWJsaWMgYWN0aXZhdGUoc3RhZ2U6U3RhZ2UsIGNhbWVyYTpDYW1lcmEsIGRlcHRoVGV4dHVyZTpJVGV4dHVyZSlcblx0e1xuXHR9XG5cblx0cHVibGljIGRlYWN0aXZhdGUoc3RhZ2U6U3RhZ2UpXG5cdHtcblx0fVxuXG5cdHB1YmxpYyBnZXQgcmVxdWlyZURlcHRoUmVuZGVyKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVEZXB0aFJlbmRlcjtcblx0fVxuXG59XG5cbmV4cG9ydCA9IEZpbHRlcjNEVGFza0Jhc2U7Il19
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var BitmapData = require("awayjs-core/lib/base/BitmapData");
var TextureBaseWebGL = require("awayjs-stagegl/lib/base/TextureBaseWebGL");
var TextureWebGL = (function (_super) {
    __extends(TextureWebGL, _super);
    function TextureWebGL(gl, width, height) {
        _super.call(this, gl);
        this.textureType = "texture2d";
        this._width = width;
        this._height = height;
        this._glTexture = this._gl.createTexture();
    }
    TextureWebGL.prototype.dispose = function () {
        this._gl.deleteTexture(this._glTexture);
    };
    Object.defineProperty(TextureWebGL.prototype, "width", {
        get: function () {
            return this._width;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TextureWebGL.prototype, "height", {
        get: function () {
            return this._height;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TextureWebGL.prototype, "frameBuffer", {
        get: function () {
            if (!this._frameBuffer) {
                this._frameBuffer = this._gl.createFramebuffer();
                this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, this._frameBuffer);
                this._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);
                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._width, this._height, 0, this._gl.RGBA, this._gl.UNSIGNED_BYTE, null);
                var renderBuffer = this._gl.createRenderbuffer();
                this._gl.bindRenderbuffer(this._gl.RENDERBUFFER, renderBuffer);
                this._gl.renderbufferStorage(this._gl.RENDERBUFFER, this._gl.DEPTH_COMPONENT16, this._width, this._height);
                this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER, this._gl.COLOR_ATTACHMENT0, this._gl.TEXTURE_2D, this._glTexture, 0);
                this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER, this._gl.DEPTH_ATTACHMENT, this._gl.RENDERBUFFER, renderBuffer);
                this._gl.bindTexture(this._gl.TEXTURE_2D, null);
                this._gl.bindRenderbuffer(this._gl.RENDERBUFFER, null);
                this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);
            }
            return this._frameBuffer;
        },
        enumerable: true,
        configurable: true
    });
    TextureWebGL.prototype.uploadFromData = function (data, miplevel) {
        if (miplevel === void 0) { miplevel = 0; }
        if (data instanceof BitmapData)
            data = data.imageData;
        this._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);
        this._gl.texImage2D(this._gl.TEXTURE_2D, miplevel, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);
        this._gl.bindTexture(this._gl.TEXTURE_2D, null);
    };
    TextureWebGL.prototype.uploadCompressedTextureFromByteArray = function (data, byteArrayOffset /*uint*/, async) {
        if (async === void 0) { async = false; }
        var ext = this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
        //this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this)
    };
    Object.defineProperty(TextureWebGL.prototype, "glTexture", {
        get: function () {
            return this._glTexture;
        },
        enumerable: true,
        configurable: true
    });
    TextureWebGL.prototype.generateMipmaps = function () {
        //TODO: implement generating mipmaps
        //this._gl.bindTexture( this._gl.TEXTURE_2D, this._glTexture );
        //this._gl.generateMipmap(this._gl.TEXTURE_2D);
        //this._gl.bindTexture( this._gl.TEXTURE_2D, null );
    };
    return TextureWebGL;
})(TextureBaseWebGL);
module.exports = TextureWebGL;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1RleHR1cmVXZWJHTC50cyJdLCJuYW1lcyI6WyJUZXh0dXJlV2ViR0wiLCJUZXh0dXJlV2ViR0wuY29uc3RydWN0b3IiLCJUZXh0dXJlV2ViR0wuZGlzcG9zZSIsIlRleHR1cmVXZWJHTC53aWR0aCIsIlRleHR1cmVXZWJHTC5oZWlnaHQiLCJUZXh0dXJlV2ViR0wuZnJhbWVCdWZmZXIiLCJUZXh0dXJlV2ViR0wudXBsb2FkRnJvbURhdGEiLCJUZXh0dXJlV2ViR0wudXBsb2FkQ29tcHJlc3NlZFRleHR1cmVGcm9tQnl0ZUFycmF5IiwiVGV4dHVyZVdlYkdMLmdsVGV4dHVyZSIsIlRleHR1cmVXZWJHTC5nZW5lcmF0ZU1pcG1hcHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sVUFBVSxXQUFlLGlDQUFpQyxDQUFDLENBQUM7QUFJbkUsSUFBTyxnQkFBZ0IsV0FBYywwQ0FBMEMsQ0FBQyxDQUFDO0FBRWpGLElBQU0sWUFBWTtJQUFTQSxVQUFyQkEsWUFBWUEsVUFBeUJBO0lBWTFDQSxTQVpLQSxZQUFZQSxDQVlMQSxFQUF3QkEsRUFBRUEsS0FBWUEsRUFBRUEsTUFBYUE7UUFFaEVDLGtCQUFNQSxFQUFFQSxDQUFDQSxDQUFDQTtRQVhKQSxnQkFBV0EsR0FBVUEsV0FBV0EsQ0FBQ0E7UUFZdkNBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLEtBQUtBLENBQUNBO1FBQ3BCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUV0QkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0E7SUFDNUNBLENBQUNBO0lBRU1ELDhCQUFPQSxHQUFkQTtRQUVDRSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtJQUN6Q0EsQ0FBQ0E7SUFFREYsc0JBQVdBLCtCQUFLQTthQUFoQkE7WUFFQ0csTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDcEJBLENBQUNBOzs7T0FBQUg7SUFFREEsc0JBQVdBLGdDQUFNQTthQUFqQkE7WUFFQ0ksTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7UUFDckJBLENBQUNBOzs7T0FBQUo7SUFFREEsc0JBQVdBLHFDQUFXQTthQUF0QkE7WUFFQ0ssRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3hCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO2dCQUNqREEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsV0FBV0EsRUFBRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtnQkFDM0RBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFVBQVVBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGFBQWFBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO2dCQUV0SUEsSUFBSUEsWUFBWUEsR0FBcUJBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGtCQUFrQkEsRUFBRUEsQ0FBQ0E7Z0JBQ25FQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBO2dCQUMvREEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxZQUFZQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxpQkFBaUJBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO2dCQUUzR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxpQkFBaUJBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO2dCQUN6SEEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsdUJBQXVCQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLEVBQUVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBO2dCQUV2SEEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ2hEQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO2dCQUN2REEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsV0FBV0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDdERBLENBQUNBO1lBRURBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO1FBQzFCQSxDQUFDQTs7O09BQUFMO0lBSU1BLHFDQUFjQSxHQUFyQkEsVUFBc0JBLElBQVFBLEVBQUVBLFFBQW1CQTtRQUFuQk0sd0JBQW1CQSxHQUFuQkEsWUFBbUJBO1FBRWxEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxZQUFZQSxVQUFVQSxDQUFDQTtZQUM5QkEsSUFBSUEsR0FBaUJBLElBQUtBLENBQUNBLFNBQVNBLENBQUNBO1FBRXRDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUMzREEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUEsUUFBUUEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsYUFBYUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDL0dBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO0lBQ2pEQSxDQUFDQTtJQUVNTiwyREFBb0NBLEdBQTNDQSxVQUE0Q0EsSUFBY0EsRUFBRUEsZUFBZUEsQ0FBUUEsUUFBREEsQUFBU0EsRUFBRUEsS0FBcUJBO1FBQXJCTyxxQkFBcUJBLEdBQXJCQSxhQUFxQkE7UUFFakhBLElBQUlBLEdBQUdBLEdBQVVBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLENBQUNBLHNDQUFzQ0EsQ0FBQ0EsQ0FBQ0E7UUFDL0VBLDZEQUE2REE7SUFDOURBLENBQUNBO0lBRURQLHNCQUFXQSxtQ0FBU0E7YUFBcEJBO1lBRUNRLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBO1FBQ3hCQSxDQUFDQTs7O09BQUFSO0lBRU1BLHNDQUFlQSxHQUF0QkE7UUFFQ1Msb0NBQW9DQTtRQUNwQ0EsK0RBQStEQTtRQUMvREEsK0NBQStDQTtRQUMvQ0Esb0RBQW9EQTtJQUNyREEsQ0FBQ0E7SUFDRlQsbUJBQUNBO0FBQURBLENBekZBLEFBeUZDQSxFQXpGMEIsZ0JBQWdCLEVBeUYxQztBQUVELEFBQXNCLGlCQUFiLFlBQVksQ0FBQyIsImZpbGUiOiJiYXNlL1RleHR1cmVXZWJHTC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQml0bWFwRGF0YVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYmFzZS9CaXRtYXBEYXRhXCIpO1xyXG5pbXBvcnQgQnl0ZUFycmF5XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9CeXRlQXJyYXlcIik7XHJcblxyXG5pbXBvcnQgSVRleHR1cmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JVGV4dHVyZVwiKTtcclxuaW1wb3J0IFRleHR1cmVCYXNlV2ViR0xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1RleHR1cmVCYXNlV2ViR0xcIik7XHJcblxyXG5jbGFzcyBUZXh0dXJlV2ViR0wgZXh0ZW5kcyBUZXh0dXJlQmFzZVdlYkdMIGltcGxlbWVudHMgSVRleHR1cmVcclxue1xyXG5cclxuXHRwdWJsaWMgdGV4dHVyZVR5cGU6c3RyaW5nID0gXCJ0ZXh0dXJlMmRcIjtcclxuXHJcblx0cHJpdmF0ZSBfd2lkdGg6bnVtYmVyO1xyXG5cdHByaXZhdGUgX2hlaWdodDpudW1iZXI7XHJcblxyXG5cdHByaXZhdGUgX2ZyYW1lQnVmZmVyOldlYkdMRnJhbWVidWZmZXI7XHJcblxyXG5cdHByaXZhdGUgX2dsVGV4dHVyZTpXZWJHTFRleHR1cmU7XHJcblxyXG5cdGNvbnN0cnVjdG9yKGdsOldlYkdMUmVuZGVyaW5nQ29udGV4dCwgd2lkdGg6bnVtYmVyLCBoZWlnaHQ6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHN1cGVyKGdsKTtcclxuXHRcdHRoaXMuX3dpZHRoID0gd2lkdGg7XHJcblx0XHR0aGlzLl9oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG5cdFx0dGhpcy5fZ2xUZXh0dXJlID0gdGhpcy5fZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGRpc3Bvc2UoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2dsLmRlbGV0ZVRleHR1cmUodGhpcy5fZ2xUZXh0dXJlKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgd2lkdGgoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fd2lkdGg7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGhlaWdodCgpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9oZWlnaHQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGZyYW1lQnVmZmVyKCk6V2ViR0xGcmFtZWJ1ZmZlclxyXG5cdHtcclxuXHRcdGlmICghdGhpcy5fZnJhbWVCdWZmZXIpIHtcclxuXHRcdFx0dGhpcy5fZnJhbWVCdWZmZXIgPSB0aGlzLl9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpO1xyXG5cdFx0XHR0aGlzLl9nbC5iaW5kRnJhbWVidWZmZXIodGhpcy5fZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyKTtcclxuXHRcdFx0dGhpcy5fZ2wuYmluZFRleHR1cmUodGhpcy5fZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xUZXh0dXJlKTtcclxuXHRcdFx0dGhpcy5fZ2wudGV4SW1hZ2UyRCh0aGlzLl9nbC5URVhUVVJFXzJELCAwLCB0aGlzLl9nbC5SR0JBLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAwLCB0aGlzLl9nbC5SR0JBLCB0aGlzLl9nbC5VTlNJR05FRF9CWVRFLCBudWxsKTtcclxuXHJcblx0XHRcdHZhciByZW5kZXJCdWZmZXI6V2ViR0xSZW5kZXJidWZmZXIgPSB0aGlzLl9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTtcclxuXHRcdFx0dGhpcy5fZ2wuYmluZFJlbmRlcmJ1ZmZlcih0aGlzLl9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlckJ1ZmZlcik7XHJcblx0XHRcdHRoaXMuX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UodGhpcy5fZ2wuUkVOREVSQlVGRkVSLCB0aGlzLl9nbC5ERVBUSF9DT01QT05FTlQxNiwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7XHJcblxyXG5cdFx0XHR0aGlzLl9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCh0aGlzLl9nbC5GUkFNRUJVRkZFUiwgdGhpcy5fZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHRoaXMuX2dsLlRFWFRVUkVfMkQsIHRoaXMuX2dsVGV4dHVyZSwgMCk7XHJcblx0XHRcdHRoaXMuX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKHRoaXMuX2dsLkZSQU1FQlVGRkVSLCB0aGlzLl9nbC5ERVBUSF9BVFRBQ0hNRU5ULCB0aGlzLl9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlckJ1ZmZlcik7XHJcblxyXG5cdFx0XHR0aGlzLl9nbC5iaW5kVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFXzJELCBudWxsKTtcclxuXHRcdFx0dGhpcy5fZ2wuYmluZFJlbmRlcmJ1ZmZlcih0aGlzLl9nbC5SRU5ERVJCVUZGRVIsIG51bGwpO1xyXG5cdFx0XHR0aGlzLl9nbC5iaW5kRnJhbWVidWZmZXIodGhpcy5fZ2wuRlJBTUVCVUZGRVIsIG51bGwpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0aGlzLl9mcmFtZUJ1ZmZlcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB1cGxvYWRGcm9tRGF0YShiaXRtYXBEYXRhOkJpdG1hcERhdGEsIG1pcGxldmVsPzpudW1iZXIpO1xyXG5cdHB1YmxpYyB1cGxvYWRGcm9tRGF0YShpbWFnZTpIVE1MSW1hZ2VFbGVtZW50LCBtaXBsZXZlbD86bnVtYmVyKTtcclxuXHRwdWJsaWMgdXBsb2FkRnJvbURhdGEoZGF0YTphbnksIG1pcGxldmVsOm51bWJlciA9IDApXHJcblx0e1xyXG5cdFx0aWYgKGRhdGEgaW5zdGFuY2VvZiBCaXRtYXBEYXRhKVxyXG5cdFx0XHRkYXRhID0gKDxCaXRtYXBEYXRhPiBkYXRhKS5pbWFnZURhdGE7XHJcblxyXG5cdFx0dGhpcy5fZ2wuYmluZFRleHR1cmUodGhpcy5fZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xUZXh0dXJlKTtcclxuXHRcdHRoaXMuX2dsLnRleEltYWdlMkQodGhpcy5fZ2wuVEVYVFVSRV8yRCwgbWlwbGV2ZWwsIHRoaXMuX2dsLlJHQkEsIHRoaXMuX2dsLlJHQkEsIHRoaXMuX2dsLlVOU0lHTkVEX0JZVEUsIGRhdGEpO1xyXG5cdFx0dGhpcy5fZ2wuYmluZFRleHR1cmUodGhpcy5fZ2wuVEVYVFVSRV8yRCwgbnVsbCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdXBsb2FkQ29tcHJlc3NlZFRleHR1cmVGcm9tQnl0ZUFycmF5KGRhdGE6Qnl0ZUFycmF5LCBieXRlQXJyYXlPZmZzZXQ6bnVtYmVyIC8qdWludCovLCBhc3luYzpib29sZWFuID0gZmFsc2UpXHJcblx0e1xyXG5cdFx0dmFyIGV4dDpPYmplY3QgPSB0aGlzLl9nbC5nZXRFeHRlbnNpb24oXCJXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGNcIik7XHJcblx0XHQvL3RoaXMuX2dsLmNvbXByZXNzZWRUZXhJbWFnZTJEKHRoaXMuX2dsLlRFWFRVUkVfMkQsIDAsIHRoaXMpXHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGdsVGV4dHVyZSgpOldlYkdMVGV4dHVyZVxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9nbFRleHR1cmU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2VuZXJhdGVNaXBtYXBzKClcclxuXHR7XHJcblx0XHQvL1RPRE86IGltcGxlbWVudCBnZW5lcmF0aW5nIG1pcG1hcHNcclxuXHRcdC8vdGhpcy5fZ2wuYmluZFRleHR1cmUoIHRoaXMuX2dsLlRFWFRVUkVfMkQsIHRoaXMuX2dsVGV4dHVyZSApO1xyXG5cdFx0Ly90aGlzLl9nbC5nZW5lcmF0ZU1pcG1hcCh0aGlzLl9nbC5URVhUVVJFXzJEKTtcclxuXHRcdC8vdGhpcy5fZ2wuYmluZFRleHR1cmUoIHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwgKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IFRleHR1cmVXZWJHTDsiXX0=
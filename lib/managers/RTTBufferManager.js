var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var Event = require("awayjs-core/lib/events/Event");
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var TextureUtils = require("awayjs-core/lib/utils/TextureUtils");
var RTTBufferManager = (function (_super) {
    __extends(RTTBufferManager, _super);
    function RTTBufferManager(stage) {
        _super.call(this);
        this._viewWidth = -1;
        this._viewHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._buffersInvalid = true;
        this._renderToTextureRect = new Rectangle();
        this._stage = stage;
    }
    RTTBufferManager.getInstance = function (stage) {
        if (!stage)
            throw new Error("stage key cannot be null!");
        if (RTTBufferManager._instances == null)
            RTTBufferManager._instances = new Array();
        var rttBufferManager = RTTBufferManager.getRTTBufferManagerFromStage(stage);
        if (rttBufferManager == null) {
            rttBufferManager = new RTTBufferManager(stage);
            var vo = new RTTBufferManagerVO();
            vo.stage3d = stage;
            vo.rttbfm = rttBufferManager;
            RTTBufferManager._instances.push(vo);
        }
        return rttBufferManager;
    };
    RTTBufferManager.getRTTBufferManagerFromStage = function (stage) {
        var l = RTTBufferManager._instances.length;
        var r;
        for (var c = 0; c < l; c++) {
            r = RTTBufferManager._instances[c];
            if (r.stage3d === stage)
                return r.rttbfm;
        }
        return null;
    };
    RTTBufferManager.deleteRTTBufferManager = function (stage) {
        var l = RTTBufferManager._instances.length;
        var r;
        for (var c = 0; c < l; c++) {
            r = RTTBufferManager._instances[c];
            if (r.stage3d === stage) {
                RTTBufferManager._instances.splice(c, 1);
                return;
            }
        }
    };
    Object.defineProperty(RTTBufferManager.prototype, "textureRatioX", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._textureRatioX;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureRatioY", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._textureRatioY;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "viewWidth", {
        get: function () {
            return this._viewWidth;
        },
        set: function (value) {
            if (value == this._viewWidth)
                return;
            this._viewWidth = value;
            this._buffersInvalid = true;
            this._textureWidth = TextureUtils.getBestPowerOf2(this._viewWidth);
            if (this._textureWidth > this._viewWidth) {
                this._renderToTextureRect.x = Math.floor((this._textureWidth - this._viewWidth) * .5);
                this._renderToTextureRect.width = this._viewWidth;
            }
            else {
                this._renderToTextureRect.x = 0;
                this._renderToTextureRect.width = this._textureWidth;
            }
            this.dispatchEvent(new Event(Event.RESIZE));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "viewHeight", {
        get: function () {
            return this._viewHeight;
        },
        set: function (value) {
            if (value == this._viewHeight)
                return;
            this._viewHeight = value;
            this._buffersInvalid = true;
            this._textureHeight = TextureUtils.getBestPowerOf2(this._viewHeight);
            if (this._textureHeight > this._viewHeight) {
                this._renderToTextureRect.y = Math.floor((this._textureHeight - this._viewHeight) * .5);
                this._renderToTextureRect.height = this._viewHeight;
            }
            else {
                this._renderToTextureRect.y = 0;
                this._renderToTextureRect.height = this._textureHeight;
            }
            this.dispatchEvent(new Event(Event.RESIZE));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToTextureVertexBuffer", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToTextureVertexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToScreenVertexBuffer", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToScreenVertexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "indexBuffer", {
        get: function () {
            return this._indexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToTextureRect", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToTextureRect;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        enumerable: true,
        configurable: true
    });
    RTTBufferManager.prototype.dispose = function () {
        RTTBufferManager.deleteRTTBufferManager(this._stage);
        if (this._indexBuffer) {
            this._indexBuffer.dispose();
            this._renderToScreenVertexBuffer.dispose();
            this._renderToTextureVertexBuffer.dispose();
            this._renderToScreenVertexBuffer = null;
            this._renderToTextureVertexBuffer = null;
            this._indexBuffer = null;
        }
    };
    // todo: place all this in a separate model, since it's used all over the place
    // maybe it even has a place in the core (together with screenRect etc)?
    // needs to be stored per view of course
    RTTBufferManager.prototype.updateRTTBuffers = function () {
        var context = this._stage.context;
        var textureVerts;
        var screenVerts;
        var x;
        var y;
        if (this._renderToTextureVertexBuffer == null)
            this._renderToTextureVertexBuffer = context.createVertexBuffer(4, 5);
        if (this._renderToScreenVertexBuffer == null)
            this._renderToScreenVertexBuffer = context.createVertexBuffer(4, 5);
        if (!this._indexBuffer) {
            this._indexBuffer = context.createIndexBuffer(6);
            this._indexBuffer.uploadFromArray([2, 1, 0, 3, 2, 0], 0, 6);
        }
        this._textureRatioX = x = Math.min(this._viewWidth / this._textureWidth, 1);
        this._textureRatioY = y = Math.min(this._viewHeight / this._textureHeight, 1);
        var u1 = (1 - x) * .5;
        var u2 = (x + 1) * .5;
        var v1 = (y + 1) * .5;
        var v2 = (1 - y) * .5;
        // last element contains indices for data per vertex that can be passed to the vertex shader if necessary (ie: frustum corners for deferred rendering)
        textureVerts = [-x, -y, u1, v1, 0, x, -y, u2, v1, 1, x, y, u2, v2, 2, -x, y, u1, v2, 3];
        screenVerts = [-1, -1, u1, v1, 0, 1, -1, u2, v1, 1, 1, 1, u2, v2, 2, -1, 1, u1, v2, 3];
        this._renderToTextureVertexBuffer.uploadFromArray(textureVerts, 0, 4);
        this._renderToScreenVertexBuffer.uploadFromArray(screenVerts, 0, 4);
        this._buffersInvalid = false;
    };
    return RTTBufferManager;
})(EventDispatcher);
var RTTBufferManagerVO = (function () {
    function RTTBufferManagerVO() {
    }
    return RTTBufferManagerVO;
})();
module.exports = RTTBufferManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1zdGFnZWdsL2xpYi9tYW5hZ2Vycy9ydHRidWZmZXJtYW5hZ2VyLnRzIl0sIm5hbWVzIjpbIlJUVEJ1ZmZlck1hbmFnZXIiLCJSVFRCdWZmZXJNYW5hZ2VyLmNvbnN0cnVjdG9yIiwiUlRUQnVmZmVyTWFuYWdlci5nZXRJbnN0YW5jZSIsIlJUVEJ1ZmZlck1hbmFnZXIuZ2V0UlRUQnVmZmVyTWFuYWdlckZyb21TdGFnZSIsIlJUVEJ1ZmZlck1hbmFnZXIuZGVsZXRlUlRUQnVmZmVyTWFuYWdlciIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWCIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWSIsIlJUVEJ1ZmZlck1hbmFnZXIudmlld1dpZHRoIiwiUlRUQnVmZmVyTWFuYWdlci52aWV3SGVpZ2h0IiwiUlRUQnVmZmVyTWFuYWdlci5yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXIiLCJSVFRCdWZmZXJNYW5hZ2VyLnJlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyIiwiUlRUQnVmZmVyTWFuYWdlci5pbmRleEJ1ZmZlciIsIlJUVEJ1ZmZlck1hbmFnZXIucmVuZGVyVG9UZXh0dXJlUmVjdCIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVdpZHRoIiwiUlRUQnVmZmVyTWFuYWdlci50ZXh0dXJlSGVpZ2h0IiwiUlRUQnVmZmVyTWFuYWdlci5kaXNwb3NlIiwiUlRUQnVmZmVyTWFuYWdlci51cGRhdGVSVFRCdWZmZXJzIiwiUlRUQnVmZmVyTWFuYWdlclZPIiwiUlRUQnVmZmVyTWFuYWdlclZPLmNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFNBQVMsV0FBZSxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2pFLElBQU8sS0FBSyxXQUFnQiw4QkFBOEIsQ0FBQyxDQUFDO0FBQzVELElBQU8sZUFBZSxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFDOUUsSUFBTyxZQUFZLFdBQWUsb0NBQW9DLENBQUMsQ0FBQztBQU94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QUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzdEQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMxRUEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFNUVBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLEVBQUVBLENBQUNBO1FBQzNCQSxJQUFJQSxFQUFFQSxHQUFVQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQTtRQUMzQkEsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDM0JBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLEVBQUVBLENBQUNBO1FBRTNCQSxBQUNBQSxzSkFEc0pBO1FBQ3RKQSxZQUFZQSxHQUFHQSxDQUFLQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFFQSxDQUFDQTtRQUU3RkEsV0FBV0EsR0FBR0EsQ0FBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBRUEsQ0FBQ0E7UUFFN0ZBLElBQUlBLENBQUNBLDRCQUE0QkEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsWUFBWUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdEVBLElBQUlBLENBQUNBLDJCQUEyQkEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFcEVBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLEtBQUtBLENBQUNBO0lBQzlCQSxDQUFDQTtJQUNGaEIsdUJBQUNBO0FBQURBLENBM1BBLEFBMlBDQSxFQTNQOEIsZUFBZSxFQTJQN0M7QUFJRCxJQUFNLGtCQUFrQjtJQUF4QmlCLFNBQU1BLGtCQUFrQkE7SUFLeEJDLENBQUNBO0lBQURELHlCQUFDQTtBQUFEQSxDQUxBLEFBS0NBLElBQUE7QUFQRCxpQkFBUyxnQkFBZ0IsQ0FBQyIsImZpbGUiOiJtYW5hZ2Vycy9SVFRCdWZmZXJNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWN0YW5nbGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUmVjdGFuZ2xlXCIpO1xuaW1wb3J0IEV2ZW50XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9FdmVudFwiKTtcbmltcG9ydCBFdmVudERpc3BhdGNoZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnREaXNwYXRjaGVyXCIpO1xuaW1wb3J0IFRleHR1cmVVdGlsc1x0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvVGV4dHVyZVV0aWxzXCIpO1xuXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcbmltcG9ydCBDb250ZXh0R0xCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xCYXNlXCIpO1xuaW1wb3J0IElJbmRleEJ1ZmZlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JSW5kZXhCdWZmZXJcIik7XG5pbXBvcnQgSVZlcnRleEJ1ZmZlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSVZlcnRleEJ1ZmZlclwiKTtcblxuY2xhc3MgUlRUQnVmZmVyTWFuYWdlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlclxue1xuXHRwcml2YXRlIHN0YXRpYyBfaW5zdGFuY2VzOkFycmF5PFJUVEJ1ZmZlck1hbmFnZXJWTz47XG5cblx0cHJpdmF0ZSBfcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyOklWZXJ0ZXhCdWZmZXI7XG5cdHByaXZhdGUgX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyOklWZXJ0ZXhCdWZmZXI7XG5cblx0cHJpdmF0ZSBfaW5kZXhCdWZmZXI6SUluZGV4QnVmZmVyO1xuXHRwcml2YXRlIF9zdGFnZTpTdGFnZTtcblx0cHJpdmF0ZSBfdmlld1dpZHRoOm51bWJlciA9IC0xO1xuXHRwcml2YXRlIF92aWV3SGVpZ2h0Om51bWJlciA9IC0xO1xuXHRwcml2YXRlIF90ZXh0dXJlV2lkdGg6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3RleHR1cmVIZWlnaHQ6bnVtYmVyID0gLTE7XG5cdHByaXZhdGUgX3JlbmRlclRvVGV4dHVyZVJlY3Q6UmVjdGFuZ2xlO1xuXHRwcml2YXRlIF9idWZmZXJzSW52YWxpZDpib29sZWFuID0gdHJ1ZTtcblxuXHRwcml2YXRlIF90ZXh0dXJlUmF0aW9YOm51bWJlcjtcblx0cHJpdmF0ZSBfdGV4dHVyZVJhdGlvWTpudW1iZXI7XG5cblx0Y29uc3RydWN0b3Ioc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdCA9IG5ldyBSZWN0YW5nbGUoKTtcblxuXHRcdHRoaXMuX3N0YWdlID0gc3RhZ2U7XG5cblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2Uoc3RhZ2U6U3RhZ2UpOlJUVEJ1ZmZlck1hbmFnZXJcblx0e1xuXHRcdGlmICghc3RhZ2UpXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJzdGFnZSBrZXkgY2Fubm90IGJlIG51bGwhXCIpO1xuXG5cdFx0aWYgKFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcyA9PSBudWxsKVxuXHRcdFx0UlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzID0gbmV3IEFycmF5PFJUVEJ1ZmZlck1hbmFnZXJWTz4oKTtcblxuXHRcdHZhciBydHRCdWZmZXJNYW5hZ2VyOlJUVEJ1ZmZlck1hbmFnZXIgPSBSVFRCdWZmZXJNYW5hZ2VyLmdldFJUVEJ1ZmZlck1hbmFnZXJGcm9tU3RhZ2Uoc3RhZ2UpO1xuXG5cdFx0aWYgKHJ0dEJ1ZmZlck1hbmFnZXIgPT0gbnVsbCkge1xuXHRcdFx0cnR0QnVmZmVyTWFuYWdlciA9IG5ldyBSVFRCdWZmZXJNYW5hZ2VyKHN0YWdlKTtcblxuXHRcdFx0dmFyIHZvOlJUVEJ1ZmZlck1hbmFnZXJWTyA9IG5ldyBSVFRCdWZmZXJNYW5hZ2VyVk8oKTtcblxuXHRcdFx0dm8uc3RhZ2UzZCA9IHN0YWdlO1xuXHRcdFx0dm8ucnR0YmZtID0gcnR0QnVmZmVyTWFuYWdlcjtcblxuXHRcdFx0UlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzLnB1c2godm8pO1xuXHRcdH1cblxuXHRcdHJldHVybiBydHRCdWZmZXJNYW5hZ2VyO1xuXG5cdH1cblxuXHRwcml2YXRlIHN0YXRpYyBnZXRSVFRCdWZmZXJNYW5hZ2VyRnJvbVN0YWdlKHN0YWdlOlN0YWdlKTpSVFRCdWZmZXJNYW5hZ2VyXG5cdHtcblxuXHRcdHZhciBsOm51bWJlciA9IFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcy5sZW5ndGg7XG5cdFx0dmFyIHI6UlRUQnVmZmVyTWFuYWdlclZPO1xuXG5cdFx0Zm9yICh2YXIgYzpudW1iZXIgPSAwOyBjIDwgbDsgYysrKSB7XG5cdFx0XHRyID0gUlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzWyBjIF07XG5cblx0XHRcdGlmIChyLnN0YWdlM2QgPT09IHN0YWdlKVxuXHRcdFx0XHRyZXR1cm4gci5ydHRiZm07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRwcml2YXRlIHN0YXRpYyBkZWxldGVSVFRCdWZmZXJNYW5hZ2VyKHN0YWdlOlN0YWdlKTp2b2lkXG5cdHtcblx0XHR2YXIgbDpudW1iZXIgPSBSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXMubGVuZ3RoO1xuXHRcdHZhciByOlJUVEJ1ZmZlck1hbmFnZXJWTztcblxuXHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGw7IGMrKykge1xuXHRcdFx0ciA9IFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlc1sgYyBdO1xuXG5cdFx0XHRpZiAoci5zdGFnZTNkID09PSBzdGFnZSkge1xuXHRcdFx0XHRSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXMuc3BsaWNlKGMsIDEpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGdldCB0ZXh0dXJlUmF0aW9YKCk6bnVtYmVyXG5cdHtcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXG5cdFx0XHR0aGlzLnVwZGF0ZVJUVEJ1ZmZlcnMoKTtcblxuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlUmF0aW9YO1xuXHR9XG5cblx0cHVibGljIGdldCB0ZXh0dXJlUmF0aW9ZKCk6bnVtYmVyXG5cdHtcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXG5cdFx0XHR0aGlzLnVwZGF0ZVJUVEJ1ZmZlcnMoKTtcblxuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlUmF0aW9ZO1xuXHR9XG5cblx0cHVibGljIGdldCB2aWV3V2lkdGgoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl92aWV3V2lkdGg7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHZpZXdXaWR0aCh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodmFsdWUgPT0gdGhpcy5fdmlld1dpZHRoKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fdmlld1dpZHRoID0gdmFsdWU7XG5cblx0XHR0aGlzLl9idWZmZXJzSW52YWxpZCA9IHRydWU7XG5cblx0XHR0aGlzLl90ZXh0dXJlV2lkdGggPSBUZXh0dXJlVXRpbHMuZ2V0QmVzdFBvd2VyT2YyKHRoaXMuX3ZpZXdXaWR0aCk7XG5cblx0XHRpZiAodGhpcy5fdGV4dHVyZVdpZHRoID4gdGhpcy5fdmlld1dpZHRoKSB7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LnggPSBNYXRoLmZsb29yKCh0aGlzLl90ZXh0dXJlV2lkdGggLSB0aGlzLl92aWV3V2lkdGgpKi41KTtcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3Qud2lkdGggPSB0aGlzLl92aWV3V2lkdGg7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3QueCA9IDA7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LndpZHRoID0gdGhpcy5fdGV4dHVyZVdpZHRoO1xuXHRcdH1cblxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoRXZlbnQuUkVTSVpFKSk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHZpZXdIZWlnaHQoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl92aWV3SGVpZ2h0O1xuXHR9XG5cblx0cHVibGljIHNldCB2aWV3SGVpZ2h0KHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh2YWx1ZSA9PSB0aGlzLl92aWV3SGVpZ2h0KVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fdmlld0hlaWdodCA9IHZhbHVlO1xuXG5cdFx0dGhpcy5fYnVmZmVyc0ludmFsaWQgPSB0cnVlO1xuXG5cdFx0dGhpcy5fdGV4dHVyZUhlaWdodCA9IFRleHR1cmVVdGlscy5nZXRCZXN0UG93ZXJPZjIodGhpcy5fdmlld0hlaWdodCk7XG5cblx0XHRpZiAodGhpcy5fdGV4dHVyZUhlaWdodCA+IHRoaXMuX3ZpZXdIZWlnaHQpIHtcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3QueSA9IE1hdGguZmxvb3IoKHRoaXMuX3RleHR1cmVIZWlnaHQgLSB0aGlzLl92aWV3SGVpZ2h0KSouNSk7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LmhlaWdodCA9IHRoaXMuX3ZpZXdIZWlnaHQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3QueSA9IDA7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LmhlaWdodCA9IHRoaXMuX3RleHR1cmVIZWlnaHQ7XG5cdFx0fVxuXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChFdmVudC5SRVNJWkUpKTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyKCk6SVZlcnRleEJ1ZmZlclxuXHR7XG5cdFx0aWYgKHRoaXMuX2J1ZmZlcnNJbnZhbGlkKVxuXHRcdFx0dGhpcy51cGRhdGVSVFRCdWZmZXJzKCk7XG5cblx0XHRyZXR1cm4gdGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyO1xuXHR9XG5cblx0cHVibGljIGdldCByZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlcigpOklWZXJ0ZXhCdWZmZXJcblx0e1xuXHRcdGlmICh0aGlzLl9idWZmZXJzSW52YWxpZClcblx0XHRcdHRoaXMudXBkYXRlUlRUQnVmZmVycygpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyO1xuXG5cdH1cblxuXHRwdWJsaWMgZ2V0IGluZGV4QnVmZmVyKCk6SUluZGV4QnVmZmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5faW5kZXhCdWZmZXI7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHJlbmRlclRvVGV4dHVyZVJlY3QoKTpSZWN0YW5nbGVcblx0e1xuXHRcdGlmICh0aGlzLl9idWZmZXJzSW52YWxpZClcblx0XHRcdHRoaXMudXBkYXRlUlRUQnVmZmVycygpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3Q7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHRleHR1cmVXaWR0aCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVXaWR0aDtcblx0fVxuXG5cdHB1YmxpYyBnZXQgdGV4dHVyZUhlaWdodCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVIZWlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgZGlzcG9zZSgpXG5cdHtcblx0XHRSVFRCdWZmZXJNYW5hZ2VyLmRlbGV0ZVJUVEJ1ZmZlck1hbmFnZXIodGhpcy5fc3RhZ2UpO1xuXG5cdFx0aWYgKHRoaXMuX2luZGV4QnVmZmVyKSB7XG5cdFx0XHR0aGlzLl9pbmRleEJ1ZmZlci5kaXNwb3NlKCk7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlci5kaXNwb3NlKCk7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXIuZGlzcG9zZSgpO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIgPSBudWxsO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyID0gbnVsbDtcblx0XHRcdHRoaXMuX2luZGV4QnVmZmVyID0gbnVsbDtcblx0XHR9XG5cdH1cblxuXHQvLyB0b2RvOiBwbGFjZSBhbGwgdGhpcyBpbiBhIHNlcGFyYXRlIG1vZGVsLCBzaW5jZSBpdCdzIHVzZWQgYWxsIG92ZXIgdGhlIHBsYWNlXG5cdC8vIG1heWJlIGl0IGV2ZW4gaGFzIGEgcGxhY2UgaW4gdGhlIGNvcmUgKHRvZ2V0aGVyIHdpdGggc2NyZWVuUmVjdCBldGMpP1xuXHQvLyBuZWVkcyB0byBiZSBzdG9yZWQgcGVyIHZpZXcgb2YgY291cnNlXG5cdHByaXZhdGUgdXBkYXRlUlRUQnVmZmVycygpXG5cdHtcblx0XHR2YXIgY29udGV4dDpDb250ZXh0R0xCYXNlID0gPENvbnRleHRHTEJhc2U+IHRoaXMuX3N0YWdlLmNvbnRleHQ7XG5cdFx0dmFyIHRleHR1cmVWZXJ0czpudW1iZXJbXTtcblx0XHR2YXIgc2NyZWVuVmVydHM6bnVtYmVyW107XG5cblx0XHR2YXIgeDpudW1iZXI7XG5cdFx0dmFyIHk6bnVtYmVyO1xuXG5cdFx0aWYgKHRoaXMuX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlciA9PSBudWxsKVxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyID0gY29udGV4dC5jcmVhdGVWZXJ0ZXhCdWZmZXIoNCwgNSk7XG5cblx0XHRpZiAodGhpcy5fcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIgPT0gbnVsbClcblx0XHRcdHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyID0gY29udGV4dC5jcmVhdGVWZXJ0ZXhCdWZmZXIoNCwgNSk7XG5cblx0XHRpZiAoIXRoaXMuX2luZGV4QnVmZmVyKSB7XG5cdFx0XHR0aGlzLl9pbmRleEJ1ZmZlciA9IGNvbnRleHQuY3JlYXRlSW5kZXhCdWZmZXIoNik7XG5cblx0XHRcdHRoaXMuX2luZGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheShbMiwgMSwgMCwgMywgMiwgMF0sIDAsIDYpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3RleHR1cmVSYXRpb1ggPSB4ID0gTWF0aC5taW4odGhpcy5fdmlld1dpZHRoL3RoaXMuX3RleHR1cmVXaWR0aCwgMSk7XG5cdFx0dGhpcy5fdGV4dHVyZVJhdGlvWSA9IHkgPSBNYXRoLm1pbih0aGlzLl92aWV3SGVpZ2h0L3RoaXMuX3RleHR1cmVIZWlnaHQsIDEpO1xuXG5cdFx0dmFyIHUxOm51bWJlciA9ICgxIC0geCkqLjU7XG5cdFx0dmFyIHUyOm51bWJlciA9ICh4ICsgMSkqLjU7XG5cdFx0dmFyIHYxOm51bWJlciA9ICh5ICsgMSkqLjU7XG5cdFx0dmFyIHYyOm51bWJlciA9ICgxIC0geSkqLjU7XG5cblx0XHQvLyBsYXN0IGVsZW1lbnQgY29udGFpbnMgaW5kaWNlcyBmb3IgZGF0YSBwZXIgdmVydGV4IHRoYXQgY2FuIGJlIHBhc3NlZCB0byB0aGUgdmVydGV4IHNoYWRlciBpZiBuZWNlc3NhcnkgKGllOiBmcnVzdHVtIGNvcm5lcnMgZm9yIGRlZmVycmVkIHJlbmRlcmluZylcblx0XHR0ZXh0dXJlVmVydHMgPSBbICAgIC14LCAteSwgdTEsIHYxLCAwLCB4LCAteSwgdTIsIHYxLCAxLCB4LCB5LCB1MiwgdjIsIDIsIC14LCB5LCB1MSwgdjIsIDMgXTtcblxuXHRcdHNjcmVlblZlcnRzID0gWyAgICAgLTEsIC0xLCB1MSwgdjEsIDAsIDEsIC0xLCB1MiwgdjEsIDEsIDEsIDEsIHUyLCB2MiwgMiwgLTEsIDEsIHUxLCB2MiwgMyBdO1xuXG5cdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheSh0ZXh0dXJlVmVydHMsIDAsIDQpO1xuXHRcdHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheShzY3JlZW5WZXJ0cywgMCwgNCk7XG5cblx0XHR0aGlzLl9idWZmZXJzSW52YWxpZCA9IGZhbHNlO1xuXHR9XG59XG5cbmV4cG9ydCA9IFJUVEJ1ZmZlck1hbmFnZXI7XG5cbmNsYXNzIFJUVEJ1ZmZlck1hbmFnZXJWT1xue1xuXHRwdWJsaWMgc3RhZ2UzZDpTdGFnZTtcblxuXHRwdWJsaWMgcnR0YmZtOlJUVEJ1ZmZlck1hbmFnZXI7XG59Il19